/**
 * IMPORTANT NOTE:
 *
 * This file is licensed only for the use of Apple developers in providing MusicKit Web Services,
 * and is subject to the Apple Media Services Terms and Conditions and the Apple Developer Program
 * License Agreement. You may not copy, modify, re-host, or create derivative works of this file or the
 * accompanying Documentation, or any part thereof, including any updates, without Apple's written consent.
 *
 * ACKNOWLEDGEMENTS:
 * https://js-cdn.music.apple.com/musickit/v1/acknowledgements.txt
 */

!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).MusicKit={})}(this,(function(e){"use strict";var n=void 0!==typeof self?self:this;function formatArtworkURL(e,n,d){return n=n||e.height||100,d=d||e.width||100,window.devicePixelRatio>=1.5&&(d*=2,n*=2),e.url.replace("{h}",""+n).replace("{w}",""+d).replace("{f}","jpeg")}const K=()=>{},asAsync=e=>{e.then(K,K)},d=/\/(?:([a-z]{2})\/)?(album|artist|episode|movie|music-video|playlist|podcast|post|season|show|song|station)\/(?:[^/]*\/)?(?:id)?(\d+|[a-z]{2}\.[a-z0-9-]+|umc.cmc.[a-zA-Z0-9]+)(?:.*(?:[?|&]i=(\d+)).*)?.*$/i;function formattedMediaURL(e){const n=function(e){const n=e.match(d)||[],[,p,h,y,m]=n;return{storefrontId:p,kind:h,contentId:y,itemId:m}}(e);let{storefrontId:p,kind:h,contentId:y,itemId:m}=n;if([p,h,y].some(e=>void 0===e))throw new TypeError("Invalid Media URL: "+e);return"music-video"===h&&(h="musicVideo"),-1!==["album","playlist"].indexOf(h)&&m?(h="song",y=m):"podcast"===h&&m&&(h="episode",y=m),{storefrontId:p,kind:h,contentId:y,isUTS:!!y&&y.startsWith("umc.")}}const p=/^http(?:s)?\:\/\/(?:itunes|(embed\.)?(music|podcasts|tv))\.apple\.com/i,h=["allow-forms","allow-popups","allow-same-origin","allow-scripts","allow-storage-access-by-user-activation","allow-top-navigation-by-user-activation"],y=["autoplay *","encrypted-media *","fullscreen *","clipboard-write"];function isLive(e){var n;return!!(null==e||null===(n=e.attributes)||void 0===n?void 0:n.isLive)}function isStream$1(e){var n,d;return"stream"===(null==e||null===(n=e.attributes)||void 0===n||null===(d=n.playParams)||void 0===d?void 0:d.format)}function isLiveRadioStation(e){return isLive(e)&&isStream$1(e)}function isLiveRadioKind(e,n){var d;return isLiveRadioStation(e)&&(null===(d=e.attributes)||void 0===d?void 0:d.mediaKind)===n}function isBroadcastRadio(e){return isLive(e)&&isStream$1(e)&&void 0!==e.attributes.stationProviderName&&"Shoutcast"===e.attributes.streamingRadioSubType}function getFilterFromFlags(e){const n=e.includes("radio-live"),d=e.includes("radio-aod"),p=e.includes("radio-broadcast");return e=>(!n||n&&!isLiveRadioStation(e))&&(!d||d&&!function(e){return!isLive(e)&&isStream$1(e)&&"Episode"===e.attributes.streamingRadioSubType}(e))&&(!p||p&&!isBroadcastRadio(e))}const m={album:"albums",albums:"albums",artist:"artists",artists:"artists",song:"songs",songs:"songs"};function normalizeContentType(e){let n=m[e];return n||(n=e.replace(/_|[A-Z]/g,(e,n)=>"_"===e?"-":(e=e.toLowerCase(),0===n?e:"-"+e)),e.endsWith("y")?n=n.substring(0,n.length-1)+"ies":n.endsWith("s")||(n+="s"),m[e]=n,n)}const g={400:"REQUEST_ERROR",401:"UNAUTHORIZED_ERROR",403:"ACCESS_DENIED",404:"NOT_FOUND",405:"NOT_FOUND",413:"REQUEST_ERROR",414:"REQUEST_ERROR",429:"QUOTA_EXCEEDED",500:"SERVER_ERROR",501:"NOT_FOUND",503:"SERVICE_UNAVAILABLE"},b={"-1004":"DEVICE_LIMIT","-1017":"GEO_BLOCK",1010:g[404],2002:"AUTHORIZATION_ERROR",2034:"TOKEN_EXPIRED",3059:"DEVICE_LIMIT",3063:"SUBSCRIPTION_ERROR",3076:"CONTENT_UNAVAILABLE",3082:"CONTENT_RESTRICTED",3084:"STREAM_UPSELL",5002:g[500],180202:"PLAYREADY_CBC_ENCRYPTION_ERROR",190121:"WIDEVINE_CDM_EXPIRED"},_=new Set(["CONTENT_EQUIVALENT","CONTENT_UNAVAILABLE","CONTENT_UNSUPPORTED","SERVER_ERROR","SUBSCRIPTION_ERROR","UNSUPPORTED_ERROR","USER_INTERACTION_REQUIRED"]);class MKError extends Error{static playActivityError(e){return new this("PLAY_ACTIVITY",e)}static parseError(e){return new this("PARSE_ERROR",e)}static responseError(e){const{status:n,statusText:d}=e,p=new this(g[n]||"NETWORK_ERROR",d||""+n);return p.data=e,p}static serverError(e,n="UNKNOWN_ERROR"){let{status:d,dialog:p,failureType:h,customerMessage:y,errorMessage:m,message:g}=e;p&&(g=p.message||p.customerMessage||p.errorMessage,p.message=g);const _=b[h]||b[d]||n,P=new this(_,g||y||m);return"STREAM_UPSELL"===_&&p&&p.okButtonAction&&p.okButtonAction.url&&(p.okButtonAction.url=p.okButtonAction.url.replace(/\&(?:challenge|key-system|uri|user-initiated)=[^\&]+/gim,"")),P.dialog=p,P}static internalError(e){return new this(MKError.INTERNAL_ERROR,e)}constructor(e,n){super(),this.errorCode="UNKNOWN_ERROR",e&&_.has(e)?(this.name=this.errorCode=e,this.message=this.description=n||e):n||"string"!=typeof e?(this.name=this.errorCode=e||"UNKNOWN_ERROR",n&&(this.message=this.description=n)):(this.name=this.errorCode="UNKNOWN_ERROR",this.message=this.description=e),Error.captureStackTrace&&Error.captureStackTrace(this,MKError)}}MKError.ACCESS_DENIED=g[403],MKError.AGE_VERIFICATION="AGE_VERIFICATION",MKError.AUTHORIZATION_ERROR=b[2002],MKError.CONFIGURATION_ERROR="CONFIGURATION_ERROR",MKError.CONTENT_EQUIVALENT="CONTENT_EQUIVALENT",MKError.CONTENT_RESTRICTED=b[3082],MKError.CONTENT_UNAVAILABLE=b[3076],MKError.CONTENT_UNSUPPORTED="CONTENT_UNSUPPORTED",MKError.DEVICE_LIMIT=b[3059],MKError.GEO_BLOCK=b[-1017],MKError.INVALID_ARGUMENTS="INVALID_ARGUMENTS",MKError.PLAYREADY_CBC_ENCRYPTION_ERROR="PLAYREADY_CBC_ENCRYPTION_ERROR",MKError.MEDIA_CERTIFICATE="MEDIA_CERTIFICATE",MKError.MEDIA_DESCRIPTOR="MEDIA_DESCRIPTOR",MKError.MEDIA_LICENSE="MEDIA_LICENSE",MKError.MEDIA_KEY="MEDIA_KEY",MKError.MEDIA_PLAYBACK="MEDIA_PLAYBACK",MKError.MEDIA_SESSION="MEDIA_SESSION",MKError.NETWORK_ERROR="NETWORK_ERROR",MKError.NOT_FOUND=b[1010],MKError.PARSE_ERROR="PARSE_ERROR",MKError.PLAY_ACTIVITY="PLAY_ACTIVITY",MKError.QUOTA_EXCEEDED=g[429],MKError.REQUEST_ERROR=g[400],MKError.SERVER_ERROR=b[5002],MKError.SERVICE_UNAVAILABLE=g[503],MKError.STREAM_UPSELL=b[3084],MKError.SUBSCRIPTION_ERROR=b[3063],MKError.TOKEN_EXPIRED=b[2034],MKError.UNAUTHORIZED_ERROR=g[401],MKError.UNKNOWN_ERROR="UNKNOWN_ERROR",MKError.UNSUPPORTED_ERROR="UNSUPPORTED_ERROR",MKError.USER_INTERACTION_REQUIRED="USER_INTERACTION_REQUIRED",MKError.INTERNAL_ERROR="INTERNAL_ERROR",MKError.OUTPUT_RESTRICTED="OUTPUT_RESTRICTED",MKError.WIDEVINE_CDM_EXPIRED="WIDEVINE_CDM_EXPIRED";class GenericStorage{get data(){return this._data}set data(e){this._data=e}get length(){return this.keys.length}get keys(){return Object.keys(this.data)}getItem(e){return this.data[e]||null}setItem(e,n){this.data[e]=n}removeItem(e){delete this.data[e]}clear(){this.keys.forEach(e=>this.removeItem(e))}key(e){return this.keys[e]||null}constructor(e={}){this.data=e}}function getCookie(e="",n=document.cookie){const d=n.match(new RegExp(`(?:^|;\\s*)${e}=([^;]*)`));if(d)return d[1]}function setCookie(e,n,d="",p=14,h,y){const m=new Date;h=null!=h?h:window;const g=(y=null!=y?y:/\./.test(h.location.hostname)?h.location.hostname:"").length>0?`domain=${y}; `:"";m.setTime(m.getTime()+24*p*60*60*1e3);let b="";"https:"===h.location.protocol&&(b="; secure"),h.document.cookie=`${e}=${n}; expires=${m.toUTCString()}; ${g}path=${d}${b}`}function removeCookie(e,n,d){setCookie(e,"","/",0,n,d)}function hasSessionStorage(){let e=!1;try{e="undefined"!=typeof sessionStorage}catch(Lr){}return e}function getSessionStorage(){let e;return hasSessionStorage()&&(e=sessionStorage),e}function hasLocalStorage(){let e=!1;try{e="undefined"!=typeof localStorage}catch(Lr){}return e}function getLocalStorage(){let e;return hasLocalStorage()&&(e=localStorage),e}class Notifications{get shouldStorageDispatch(){return"undefined"!=typeof window&&hasSessionStorage()&&this.dispatchNamespace}addEventListener(e,n){Array.isArray(this._eventRegistry[e])&&this._eventRegistry[e].push(n)}dispatchEvent(e,n){Array.isArray(this._eventRegistry[e])&&this._eventRegistry[e].forEach(e=>e(n))}dispatchDistributedEvent(e,n){if(this.dispatchEvent(e,n),this.shouldStorageDispatch){var d;const p=`${this.dispatchNamespace}:${e}`;null===(d=getSessionStorage())||void 0===d||d.setItem(p,JSON.stringify(n))}}removeEventListener(e,n){if(Array.isArray(this._eventRegistry[e])){const d=this._eventRegistry[e].indexOf(n);this._eventRegistry[e].splice(d,1)}}_handleGlobalStorageEvent(e){var n;if(this.dispatchNamespace&&(null===(n=e.key)||void 0===n?void 0:n.startsWith(this.dispatchNamespace+":"))){const n=e.key.substring(this.dispatchNamespace.length+1);this.dispatchEvent(n,JSON.parse(e.newValue))}}constructor(e=[],n){this._eventRegistry={},e.forEach(e=>{this._eventRegistry[e]=[]}),n&&n.namespace&&(this.dispatchNamespace="com.apple."+n.namespace),this.shouldStorageDispatch&&(this._handleGlobalStorageEvent=this._handleGlobalStorageEvent.bind(this),window.addEventListener("storage",this._handleGlobalStorageEvent))}}var P="undefined"!=typeof FastBoot?FastBoot.require("buffer").Buffer:"undefined"!=typeof process&&null!==process.versions&&null!==process.versions.node?Buffer:window.Buffer;function memoize(e){return function(...n){let d="",p=n.length;for(e._memoized=e._memoized||{};p--;){const e=n[p];d+=e===Object(e)?JSON.stringify(e):e}return d in e._memoized?e._memoized[d]:e._memoized[d]=e(...n)}}function isObject(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function generateUUID(){let e=strRandomizer()+strRandomizer();for(;e.length<16;)e+=strRandomizer();return e.slice(0,16)}function strRandomizer(){return Math.random().toString(16).substring(2)}const T=memoize(e=>/^[a|i|l|p]{1}\.[a-zA-Z0-9]+$/.test(e)),S=memoize(e=>/^(a\.)?[a-zA-Z0-9]+$/.test(e));function isNodeEnvironment$1(e){const isDefined=e=>null!=e;return 0===arguments.length&&"undefined"!=typeof process&&(e=process),isDefined(e)&&isDefined(e.versions)&&isDefined(e.versions.node)||"undefined"!=typeof FastBoot}const E=memoize(isNodeEnvironment$1()?e=>P.from(e,"base64").toString("binary"):e=>window.atob(e));memoize(isNodeEnvironment$1()?e=>P.from(e).toString("base64"):e=>window.btoa(e));const debounce=(e,n=250,d={isImmediate:!1})=>{let p;return function(...h){const y=this,m=d.isImmediate&&void 0===p;void 0!==p&&clearTimeout(p),p=setTimeout((function(){p=void 0,d.isImmediate||e.apply(y,h)}),n),m&&e.apply(y,h)}},exceptFields=(e,...n)=>{const d={};return Object.keys(e).forEach(p=>{n.includes(p)||(d[p]=e[p])}),d},arrayEquals=(e,n)=>!!e&&!!n&&[].every.call(e,(e,d)=>e===n[d]);function hasOwn(e,n){return Object.prototype.hasOwnProperty.call(Object(e),n)}function deepClone(e){const n=Object.prototype.toString.call(e).toLowerCase().slice(8,-1);switch(n){case"set":return new Set([...e].map(e=>deepClone(e)));case"map":return new Map([...e].map(([e,n])=>[deepClone(e),deepClone(n)]));case"date":return new Date(e.getTime());case"regexp":{const n=e,d="string"==typeof n.flags?n.flags:[n.global?"g":void 0,n.ignoreCase?"i":void 0,n.multiline?"m":void 0,n.sticky?"y":void 0,n.unicode?"u":void 0].filter(e=>void 0!==e).join("");return RegExp(e.source,d)}case"arraybuffer":{const n=e;if("function"==typeof n.slice)return n.slice(0);{const d=new e.constructor(n.byteLength);return new Uint8Array(d).set(new Uint8Array(n)),d}}case"dataview":case"int8array":case"uint8array":case"uint8clampedarray":case"int16array":case"uint16array":case"int32array":case"uint32array":case"float32array":case"float64array":case"bigint64array":case"biguint64array":{const d=e;return new(0,d.constructor)(deepClone(d.buffer),d.byteOffset,"dataview"===n?d.byteLength:d.length)}case"array":case"object":{const n=Array.isArray(e)?[]:{};for(const d in e)hasOwn(e,d)&&(n[d]=deepClone(e[d]));return n}default:return e}}function isEmpty(e){if("object"!=typeof e)throw new TypeError("Source is not an Object");for(const n in e)if(hasOwn(e,n))return!1;return!0}function transform$9(e,n,d=!1){return d&&(e=Object.keys(e).reduce((n,d)=>(n[e[d]]=d,n),{})),Object.keys(e).reduce((d,p)=>{const h=e[p],y="function"==typeof h?h():function(e,n){return n.split(".").reduce((e,n)=>{if(void 0!==e)return e[n]},e)}(n,h);return y&&function(e,n,d){n.split(".").reduce((n,p,h,y)=>{const m=h===y.length-1,g=hasOwn(n,p),b=n[p]instanceof Object,_=null===n[p];if(!m&&g&&(!b||_))throw new TypeError(`Value at ${y.slice(0,h+1).join(".")} in keypath is not an Object.`);return m?(n[p]=d,e):g?n[p]:n[p]={}},e)}(d,p,y),d},{})}function transformKeys(e,n){return Object.keys(e).reduce((d,p)=>(d[n(p)]=e[p],d),{})}const k=["contributors","modalities","musicVideo","podcast-episodes","radioStation","song","uploaded-audios","uploadedAudio","uploaded-videos","uploadedVideo","workouts","workout-programs"],w={"uploaded-videos":!0,uploadedVideo:!0,"uploaded-audios":!0,uploadedAudio:!0,"podcast-episodes":!0},O=["Vod","LiveService","EbsEvent","Event"],I={mediaItemStateDidChange:"mediaItemStateDidChange",mediaItemStateWillChange:"mediaItemStateWillChange"},A={CRITICAL:50,ERROR:40,WARNING:30,NOTICE:20,INFO:10,DEBUG:2,TRACE:1,NONE:0};const R={OFF:"NONE",0:"NONE","+":"INFO","++":"DEBUG",V:"DEBUG",D:"DEBUG",VERBOSE:"DEBUG",VV:"TRACE",SILLY:"TRACE","*":"TRACE"};function getLoggingLevel(e,n={}){if("number"==typeof e)return function(e){return"number"==typeof e&&Object.values(A).includes(e)}(e)?e:void 0;let d=e.toUpperCase();return n.allowShorthands&&void 0!==R[d]&&(d=R[d]),function(e){return"string"==typeof e&&void 0!==A[e.toUpperCase()]}(d)?A[d]:void 0}function getLoggingLevelName(e){for(const[n,d]of Object.entries(A))if(e===d)return n}function walk(e,n){const d=[e];for(;d.length>0;){const e=d.shift();void 0!==e&&(d.push(...e.children),n(e))}}function _defineProperty$T(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$T(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$T(e,n,d[n])}))}return e}function _objectSpreadProps$A(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}const C=A.ERROR,DEFAULT_POLICY=(e,n)=>e!==A.NONE&&n>=e;class Logger{get parent(){return this._parent}get children(){return Array.from(this._children.values())}get namespace(){return void 0===this._parent?this.name:this._parent.namespace+"/"+this.name}get enabled(){return this.level!==A.NONE}get level(){var e,n,d;return null!==(d=null!==(n=this._level)&&void 0!==n?n:null===(e=this.parent)||void 0===e?void 0:e.level)&&void 0!==d?d:C}get levelName(){var e;return null!==(e=getLoggingLevelName(this.level))&&void 0!==e?e:"UNKNOWN"}get levelPolicy(){var e,n,d;return null!==(d=null!==(n=this._levelPolicy)&&void 0!==n?n:null===(e=this.parent)||void 0===e?void 0:e.levelPolicy)&&void 0!==d?d:DEFAULT_POLICY}get handlers(){var e,n,d;return null!==(d=null!==(n=this._handlers)&&void 0!==n?n:null===(e=this.parent)||void 0===e?void 0:e.handlers)&&void 0!==d?d:{}}isEnabledFor(e){return this.levelPolicy(this.level,e)}setLevel(e){const n=getLoggingLevel(e);void 0!==n&&(this._level=n)}clearLevel(){this._level=void 0}setLevelPolicy(e){this._levelPolicy=e}clearLevelPolicy(){this._levelPolicy=void 0}addHandler(e,n){this._handlers||(this._handlers={}),this._handlers[e]=n}hasHandler(e){var n;return void 0!==(null===(n=this._handlers)||void 0===n?void 0:n[e])}removeHandler(e){void 0!==this._handlers&&(delete this._handlers[e],0===Object.keys(this._handlers).length&&this.clearHandlers())}clearHandlers(){this._handlers=void 0}createChild(e,n){const d=this._children.get(e);return void 0!==d?d:new Logger(e,_objectSpreadProps$A(_objectSpread$T({},n),{parent:this}))}linkChild(e){if(void 0!==e.parent&&e.parent!==this)throw new Error(`Logger '${e.name}' is already a child of a different parent ('${e.parent.name}')`);const n=this._children.get(e.name);if(void 0!==n&&n!==e)throw new Error(`A child with name '${e.name}' is already registered`);return void 0===n&&(this._children.set(e.name,e),e.linkParent(this)),e}unlinkChild(e){const n=this._children.get(e.name);return n===e&&(this._children.delete(e.name),n.unlinkParent()),e}getByName(e){return this._children.get(e)}getByNamespace(e){return function(e,n,d="/"){if(""===(n=n.trim())||"*"===n)return e;const p=n.split(d);p[0].trim()===e.name&&p.shift();if(0===p.length)return e;let h=e;for(;void 0!==h&&p.length>0;){const e=p.shift();h=h.getByName(e.trim())}return h}(this,e)}linkParent(e){return this.parent!==e&&(this.unlinkParent(),this._parent=e,e.linkChild(this)),this}unlinkParent(){return void 0!==this._parent&&(this._parent.unlinkChild(this),this._parent=void 0),this}log(e,n,...d){const p=getLoggingLevel(e);void 0!==p&&this.logRecord({time:Date.now(),namespace:this.namespace,level:p,message:n,args:d})}logRecord(e){if(!this.levelPolicy(this.level,e.level))return;const n=_objectSpread$T({namespace:this.namespace},e);for(const d of Object.values(this.handlers))d.process(n)}error(e,...n){this.log(A.ERROR,e,...n)}warning(e,...n){this.log(A.WARNING,e,...n)}warn(e,...n){this.warning(e,...n)}info(e,...n){this.log(A.INFO,e,...n)}debug(e,...n){this.log(A.DEBUG,e,...n)}trace(e,...n){this.log(A.TRACE,e,...n)}constructor(e,n){this._children=new Map,this.name=e,this._levelPolicy=null==n?void 0:n.levelPolicy,this._handlers=null==n?void 0:n.handlers,void 0!==(null==n?void 0:n.parent)&&this.linkParent(n.parent),void 0!==(null==n?void 0:n.level)&&this.setLevel(n.level)}}class CallbackHandler{process(e){this.enabled&&void 0!==this.callback&&this.callback(e)}constructor(e,n={}){var d;this.callback=e,this.enabled=null===(d=n.enabled)||void 0===d||d}}const M=/%{([^}]+)}/gi;var D;const j={timestamp:e=>String(e.time),time:e=>String(e.time),datetime:e=>new Date(e.time).toISOString(),date:e=>new Date(e.time).toISOString(),level:e=>String(e.level),levelname:e=>null!==(D=getLoggingLevelName(e.level))&&void 0!==D?D:"UNKNOWN",message:e=>e.message,name:e=>e.namespace.split("/").pop(),namespace:e=>e.namespace};const x=new Map([[A.CRITICAL,"error"],[A.ERROR,"error"],[A.WARNING,"warn"],[A.NOTICE,"warn"],[A.INFO,"log"],[A.DEBUG,"debug"]]),$=(L="%{datetime} %{levelname} - [%{namespace}] %{message}",function(e){return L.replace(M,(function(n,d){return d=d.toLowerCase(),void 0!==j[d]?j[d](e):n}))});var L;const N=new Logger("media-item");var U,G;e.PlaybackType=void 0,(U=e.PlaybackType||(e.PlaybackType={}))[U.none=0]="none",U[U.preview=1]="preview",U[U.unencryptedFull=2]="unencryptedFull",U[U.encryptedFull=3]="encryptedFull",function(e){e[e.none=0]="none",e[e.loading=1]="loading",e[e.ready=2]="ready",e[e.playing=3]="playing",e[e.ended=4]="ended",e[e.unavailable=5]="unavailable",e[e.restricted=6]="restricted",e[e.error=7]="error",e[e.unsupported=8]="unsupported"}(G||(G={}));const{none:B,loading:F,ready:V,playing:H,ended:q,unavailable:z,restricted:W,error:Y,unsupported:Q}=G,J={[B]:{allowed:[F],unknown:[q,z,W,Y,Q]},[F]:{allowed:[V,W,Y,Q],unknown:[]},[V]:{allowed:[H],unknown:[Y]},[H]:{allowed:[q,Y],unknown:[z,W,Q]},[q]:{allowed:[],unknown:[]},[z]:{allowed:[],unknown:[]},[W]:{allowed:[],unknown:[]},[Y]:{allowed:[],unknown:[]},[Q]:{allowed:[],unknown:[]}},toName=e=>G[e],createMediaItemStateGuard=(e=B)=>{const n={current:e,set(e){const{current:d}=n;if(!((e,n)=>J[e].allowed.includes(n))(d,e)){const n=((e,n)=>J[e].unknown.includes(n))(d,e);N.debug(`MediaItem.state was changed from ${toName(d)} to ${toName(e)}`,n?"but it is unknown whether it should be allowed or not.":"and it should not be happening")}n.current=e}};return n};function isStringNotEmpty(e){return!function(e){return void 0===e||""===e.trim()}(e)}function transform$8(e){return transform$9({"attributes.albumName":"metadata.playlistName","attributes.artistName":"metadata.artistName","attributes.artwork"(){const n=null==e?void 0:e.artworkURL;if(n)return function(e){const n=e.split("/").pop(),[d,p]=!!n&&n.match(/\d+/g)||["100","100"];return{width:parseInt(d,10),height:parseInt(p,10),url:e.replace(`${d}x${p}`,"{w}x{h}")}}(n)},"attributes.composerName":"metadata.composerName","attributes.contentRating"(){var n;if(1===(null==e||null===(n=e.metadata)||void 0===n?void 0:n.explicit))return"explicit"},"attributes.discNumber"(){var n;return(null==e||null===(n=e.metadata)||void 0===n?void 0:n.discNumber)||1},"attributes.durationInMillis":"metadata.duration","attributes.genreNames"(){var n;return[null==e||null===(n=e.metadata)||void 0===n?void 0:n.genre]},"attributes.isrc"(){var n;const d=null==e||null===(n=e.metadata)||void 0===n?void 0:n.xid;if(d)return d.replace(/^([^:]+):isrc:/,"$1")},"attributes.name":"metadata.itemName","attributes.playParams.id":"metadata.itemId","attributes.playParams.kind":"metadata.kind","attributes.previews":()=>[{url:null==e?void 0:e.previewURL}],"attributes.releaseDate":"metadata.releaseDate","attributes.trackNumber":"metadata.trackNumber",assetURL:"URL",cloudId:"metadata.cloud-id",id(){var n;return""+(null==e||null===(n=e.metadata)||void 0===n?void 0:n.itemId)},flavor:"flavor",type:"metadata.kind"},e)}function _defineProperty$S(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}const{mediaItemStateDidChange:X,mediaItemStateWillChange:Z}=I,ee={isEntitledToPlay:!0};class MediaItem extends Notifications{get ageGatePolicy(){var e;return null===(e=this.defaultPlayable)||void 0===e?void 0:e.ageGatePolicy}get albumInfo(){const{albumName:e,artistName:n}=this,d=[];return n&&d.push(n),e&&d.push(e),d.join(" - ")}get albumName(){return this.attributes.albumName}get artistName(){return this.attributes.genreNames&&this.attributes.genreNames.indexOf("Classical")>-1&&this.attributes.composerName?this.attributes.composerName:this.attributes.artistName}get artwork(){var e,n;return null!==(n=this.attributes.artwork)&&void 0!==n?n:null===(e=this.attributes.images)||void 0===e?void 0:e.coverArt16X9}get artworkURL(){if(this.artwork&&this.artwork.url)return this.artwork.url}get assets(){return this._assets}get canPlay(){return this.isPlayable&&this.isReady}get container(){return this._container}set container(e){this._container=e}get contentRating(){return this.attributes.contentRating}get context(){return this._context}set context(e){this._context=e}get defaultPlayable(){var e;return null===(e=this.playables)||void 0===e?void 0:e[0]}get discNumber(){return this.attributes.discNumber}get hasContainerArtwork(){return this.container&&this.container.attributes&&this.container.attributes.artwork&&this.container.attributes.artwork.url}get hasPlaylistContainer(){return this.container&&"playlists"===this.container.type&&this.container.attributes}get isEntitledToPlay(){const{attributes:e,defaultPlayable:n}=this;var d;return null!==(d=e.isEntitledToPlay||(null==n?void 0:n.isEntitledToPlay))&&void 0!==d&&d}get supportsLinearScrubbing(){var e,n,d;return this.isLinearStream&&!0===(null===(e=this.defaultPlayable)||void 0===e||null===(n=e.assets)||void 0===n||null===(d=n.streamCapability)||void 0===d?void 0:d.supportsLinearScrubbing)}get isAssetScrubbingDisabled(){return!!this.isLinearStream&&!this.supportsLinearScrubbing}get isLinearStream(){return"LiveService"===(null==(e=this)?void 0:e.type)||"Event"===(null==e||null===(n=e.defaultPlayable)||void 0===n?void 0:n.type)||"EbsEvent"===(null==e||null===(d=e.defaultPlayable)||void 0===d?void 0:d.type);var e,n,d}get isLiveRadioStation(){return isLiveRadioStation(this)}get isLiveAudioStation(){return isLiveRadioKind(this,"audio")}get isLiveVideoStation(){return isLiveRadioKind(this,"video")}get isSong(){return"song"===this.type}get info(){return`${this.title} - ${this.albumInfo}`}get isCloudItem(){return this.playParams&&this.playParams.isLibrary||T(this.id)}get isCloudUpload(){return-1===this._songId}get isExplicitItem(){return"explicit"===this.contentRating}get isLoading(){return this.state===G.loading}get isPlayableMediaType(){return this.isUTS||-1!==k.indexOf(this.type)}get isPlayable(){var e;return!!this.isPlayableMediaType&&(!(!this.isLiveRadioStation&&!this.hasOffersHlsUrl)||(this.needsPlayParams?!!this.playParams:this.isUTS?this.isEntitledToPlay:!!this.attributes.assetUrl||!!(null===(e=this.attributes.previews)||void 0===e?void 0:e.length)))}get isPlaying(){return this.state===G.playing}get isPreparedToPlay(){if("song"===this.type)return!!this._assets&&!!this.keyURLs&&!!this._songId;if(this.isUTS){const e=isStringNotEmpty(this.assetURL),n=!!(this.keyURLs&&isStringNotEmpty(this.keyURLs["hls-key-cert-url"])&&isStringNotEmpty(this.keyURLs["hls-key-server-url"])&&isStringNotEmpty(this.keyURLs["widevine-cert-url"]));return e&&n}return!!isStringNotEmpty(this.assetURL)||this.playRawAssetURL&&!!isStringNotEmpty(this.attributes.assetUrl)}get isrc(){return this.attributes.isrc}get isReady(){return this.state===G.ready}get isRestricted(){return this.state===G.restricted}get isUTS(){var e;return!(!(null===(e=this.defaultPlayable)||void 0===e?void 0:e.type)||!O.includes(this.defaultPlayable.type))}get isUnavailable(){return this.state===G.unavailable}get needsPlayParams(){return["musicVideo","song"].includes(this.type)}get normalizedType(){return normalizeContentType(this.type)}get offers(){return this.attributes.offers}get offersHlsUrl(){const{offers:e}=this,n=null==e?void 0:e.find(e=>{var n;return!!(null===(n=e.hlsUrl)||void 0===n?void 0:n.length)});return null==n?void 0:n.hlsUrl}get hasOffersHlsUrl(){return isStringNotEmpty(this.offersHlsUrl)}set playbackData(e){if(void 0===e)return;this.previewURL&&(e.previewURL=this.previewURL);const n=transform$8(e);this.artwork&&n.artwork&&delete n.artwork,n.id!==this.id&&delete n.id,this.playParams&&n.attributes.playParams&&(n.attributes.playParams=this.playParams),n.attributes=function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$S(e,n,d[n])}))}return e}({},this.attributes,n.attributes),Object.assign(this,n),N.debug("media-item: item merged with playbackData",this),this.state=G.ready}get playbackDuration(){return this.attributes.durationInMillis||this.attributes.durationInMilliseconds}get playEvent(){var e;return null===(e=this.defaultPlayable)||void 0===e?void 0:e.playEvent}get playlistArtworkURL(){var e,n,d;return this.hasPlaylistContainer&&this.hasContainerArtwork?null===(e=this.container)||void 0===e||null===(n=e.attributes)||void 0===n||null===(d=n.artwork)||void 0===d?void 0:d.url:this.artworkURL}get playlistName(){var e,n;return this.hasPlaylistContainer?null===(e=this.container)||void 0===e||null===(n=e.attributes)||void 0===n?void 0:n.name:this.albumName}get playParams(){return this.attributes.playParams}get playRawAssetURL(){return this.offers?this.offers.some(e=>"STDQ"===e.type):!(!this.isCloudUpload&&!w[this.type])}get previewURL(){var e,n,d,p,h,y,m,g,b,_,P,T,S,E,k;return(null===(e=this.attributes)||void 0===e||null===(n=e.previews)||void 0===n||null===(d=n[0])||void 0===d?void 0:d.url)||(null===(p=this.attributes)||void 0===p||null===(h=p.previews)||void 0===h||null===(y=h[0])||void 0===y?void 0:y.hlsUrl)||(null===(m=this.attributes)||void 0===m||null===(g=m.trailers)||void 0===g||null===(b=g[0])||void 0===b||null===(_=b.assets)||void 0===_?void 0:_.hlsUrl)||(null===(P=this.attributes)||void 0===P||null===(T=P.movieClips)||void 0===T||null===(S=T[0])||void 0===S?void 0:S.hlsUrl)||(null===(E=this.attributes)||void 0===E||null===(k=E.video)||void 0===k?void 0:k.hlsUrl)}get rating(){return this.attributes.rating}get releaseDate(){if(this._releaseDate)return this._releaseDate;if(this.attributes&&(this.attributes.releaseDate||this.attributes.releaseDateTime)){const e=this.attributes.releaseDate||this.attributes.releaseDateTime;return this._releaseDate=/^\d{4}-\d{1,2}-\d{1,2}/.test(e)?new Date(e):void 0,this._releaseDate}}set releaseDate(e){this._releaseDate="string"==typeof e?/^\d{4}-\d{1,2}-\d{1,2}/.test(e)?new Date(e):void 0:"number"==typeof e?new Date(e):e}get songId(){return this._songId&&-1!==this._songId?this._songId:this.id}get state(){return this._state.current}set state(e){const n={oldState:this._state.current,state:e};this._stateWillChange&&this._stateWillChange(this),this.dispatchEvent(Z,n),this._state.set(e),this._stateDidChange&&this._stateDidChange(this),this.dispatchEvent(X,n)}get title(){return this.attributes.name||this.attributes.title}get trackNumber(){return this.attributes.trackNumber}beginMonitoringStateDidChange(e){this._stateDidChange=e}beginMonitoringStateWillChange(e){this._stateWillChange=e}endMonitoringStateDidChange(){this._stateDidChange=void 0}endMonitoringStateWillChange(){this._stateWillChange=void 0}isEqual(e){return this.id===e.id&&this.type===e.type&&this.attributes===e.attributes}resetState(){this.endMonitoringStateWillChange(),this.endMonitoringStateDidChange(),this.state=G.none}restrict(){this.isExplicitItem&&(this.state=G.restricted,this._removePlayableData())}notSupported(){this.state=G.unsupported,this._removePlayableData()}updateFromLoadError(e){switch(e.errorCode){case MKError.CONTENT_RESTRICTED:this.state=G.restricted;break;case MKError.CONTENT_UNAVAILABLE:this.state=G.unavailable;break;default:this.state=G.error}}updateFromSongList(e){"musicVideo"===this.type?this.updateWithLoadedAssets(void 0,e["hls-playlist-url"]):this.updateWithLoadedAssets(e.assets),this._songId=e.songId,this.updateWithLoadedKeys({"hls-key-cert-url":e["hls-key-cert-url"],"hls-key-server-url":e["hls-key-server-url"],"widevine-cert-url":e["widevine-cert-url"]})}updateWithLoadedKeys(e,n){this.keyURLs=e,n&&(this.keyServerQueryParameters=n)}updateWithLoadedAssets(e,n){e&&(this._assets=e),n&&(this.assetURL=n)}_removePlayableData(){var e,n,d;null===(e=this.attributes)||void 0===e||delete e.playParams,null===(n=this.attributes)||void 0===n||delete n.previews,null===(d=this.attributes)||void 0===d||delete d.trailers}constructor(n={}){super([X,Z]),this.hlsMetadata={},this.attributes={},this.playbackType=e.PlaybackType.none,this._assets=[],this._state=createMediaItemStateGuard(),N.debug("media-item: creating Media Item with options:",n);n.id&&n.attributes?(Object.keys(n).forEach(e=>{hasOwn(ee,e)||(this[e]=n[e])}),this.type=this.playParams&&this.playParams.kind?this.playParams.kind:this.type||"song"):(this.id=n.id||generateUUID(),this.type=n.type||"song",this.attributes={playParams:{id:this.id,kind:this.type}}),this.contentType=n.contentType,this._context=n.context||{},n.container?this._container=n.container:n.containerId&&n.containerType&&(this._container={id:n.containerId,type:n.containerType})}}const te=["contributors","modalities","movie","musicVideo","musicMovie","trailer","tvEpisode","uploadedVideo","uploaded-videos","music-videos","music-movies","tv-episodes","workouts"];function getPlayerType(e){var n,d;return(null==e?void 0:e.isUTS)||te.includes(null==e?void 0:e.type)?"video":"podcast-episodes"===(null==e?void 0:e.type)?"audio":null!==(d=null==e||null===(n=e.attributes)||void 0===n?void 0:n.mediaKind)&&void 0!==d?d:"audio"}var re,ne;e.PlaybackStates=void 0,(re=e.PlaybackStates||(e.PlaybackStates={}))[re.none=0]="none",re[re.loading=1]="loading",re[re.playing=2]="playing",re[re.paused=3]="paused",re[re.stopped=4]="stopped",re[re.ended=5]="ended",re[re.seeking=6]="seeking",re[re.waiting=8]="waiting",re[re.stalled=9]="stalled",re[re.completed=10]="completed",e.PresentationMode=void 0,(ne=e.PresentationMode||(e.PresentationMode={}))[ne.pictureinpicture=0]="pictureinpicture",ne[ne.inline=1]="inline";const ie={AFG:"143610",AGO:"143564",AIA:"143538",ALB:"143575",AND:"143611",ARE:"143481",ARG:"143505",ARM:"143524",ATG:"143540",AUS:"143460",AUT:"143445",AZE:"143568",BEL:"143446",BEN:"143576",BFA:"143578",BGD:"143490",BGR:"143526",BHR:"143559",BHS:"143539",BIH:"143612",BLR:"143565",BLZ:"143555",BMU:"143542",BOL:"143556",BRA:"143503",BRB:"143541",BRN:"143560",BTN:"143577",BWA:"143525",CAF:"143623",CAN:"143455",CHE:"143459",CHL:"143483",CHN:"143465",CIV:"143527",CMR:"143574",COD:"143613",COG:"143582",COL:"143501",CPV:"143580",CRI:"143495",CYM:"143544",CYP:"143557",CZE:"143489",DEU:"143443",DMA:"143545",DNK:"143458",DOM:"143508",DZA:"143563",ECU:"143509",EGY:"143516",ESP:"143454",EST:"143518",ETH:"143569",FIN:"143447",FJI:"143583",FRA:"143442",FSM:"143591",GAB:"143614",GBR:"143444",GEO:"143615",GHA:"143573",GIN:"143616",GMB:"143584",GNB:"143585",GRC:"143448",GRD:"143546",GTM:"143504",GUY:"143553",HKG:"143463",HND:"143510",HRV:"143494",HUN:"143482",IDN:"143476",IND:"143467",IRL:"143449",IRQ:"143617",ISL:"143558",ISR:"143491",ITA:"143450",JAM:"143511",JOR:"143528",JPN:"143462",KAZ:"143517",KEN:"143529",KGZ:"143586",KHM:"143579",KNA:"143548",KOR:"143466",KWT:"143493",LAO:"143587",LBN:"143497",LBR:"143588",LBY:"143567",LCA:"143549",LIE:"143522",LKA:"143486",LTU:"143520",LUX:"143451",LVA:"143519",MAC:"143515",MAR:"143620",MCO:"143618",MDA:"143523",MDG:"143531",MDV:"143488",MEX:"143468",MKD:"143530",MLI:"143532",MLT:"143521",MMR:"143570",MNE:"143619",MNG:"143592",MOZ:"143593",MRT:"143590",MSR:"143547",MUS:"143533",MWI:"143589",MYS:"143473",NAM:"143594",NER:"143534",NGA:"143561",NIC:"143512",NLD:"143452",NOR:"143457",NPL:"143484",NRU:"143606",NZL:"143461",OMN:"143562",PAK:"143477",PAN:"143485",PER:"143507",PHL:"143474",PLW:"143595",PNG:"143597",POL:"143478",PRT:"143453",PRY:"143513",PSE:"143596",QAT:"143498",ROU:"143487",RUS:"143469",RWA:"143621",SAU:"143479",SEN:"143535",SGP:"143464",SLB:"143601",SLE:"143600",SLV:"143506",SRB:"143500",STP:"143598",SUR:"143554",SVK:"143496",SVN:"143499",SWE:"143456",SWZ:"143602",SYC:"143599",TCA:"143552",TCD:"143581",THA:"143475",TJK:"143603",TKM:"143604",TON:"143608",TTO:"143551",TUN:"143536",TUR:"143480",TWN:"143470",TZA:"143572",UGA:"143537",UKR:"143492",URY:"143514",USA:"143441",UZB:"143566",VCT:"143550",VEN:"143502",VGB:"143543",VNM:"143471",VUT:"143609",WSM:"143607",XKX:"143624",YEM:"143571",ZAF:"143472",ZMB:"143622",ZWE:"143605"};function asyncGeneratorStep$1k(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$1k(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$1k(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1k(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}class DeveloperToken{get isExpired(){return this.expiration<Date.now()}_decode(e){return JSON.parse(E(e))}constructor(e){if(this.token=e,!e||!/^[a-z0-9\-\_]{16,}\.[a-z0-9\-\_]{16,}\.[a-z0-9\-\_]{16,}/i.test(e))throw new Error("Invalid token.");const[n,d]=e.split("."),{exp:p,iss:h}=this._decode(d);if(this.expiration=1e3*p,this.isExpired)throw new Error("Initialized with an expired token.");this.teamId=h;const{kid:y}=this._decode(n);this.keyId=y}}function invoke(e){return void 0===e||(e=>"function"!=typeof e)(e)?e:e()}const ae={AW:"ABW",AF:"AFG",AO:"AGO",AI:"AIA",AX:"ALA",AL:"ALB",AD:"AND",AE:"ARE",AR:"ARG",AM:"ARM",AS:"ASM",AQ:"ATA",TF:"ATF",AG:"ATG",AU:"AUS",AT:"AUT",AZ:"AZE",BI:"BDI",BE:"BEL",BJ:"BEN",BQ:"BES",BF:"BFA",BD:"BGD",BG:"BGR",BH:"BHR",BS:"BHS",BA:"BIH",BL:"BLM",BY:"BLR",BZ:"BLZ",BM:"BMU",BO:"BOL",BR:"BRA",BB:"BRB",BN:"BRN",BT:"BTN",BV:"BVT",BW:"BWA",CF:"CAF",CA:"CAN",CC:"CCK",CH:"CHE",CL:"CHL",CN:"CHN",CI:"CIV",CM:"CMR",CD:"COD",CG:"COG",CK:"COK",CO:"COL",KM:"COM",CV:"CPV",CR:"CRI",CU:"CUB",CW:"CUW",CX:"CXR",KY:"CYM",CY:"CYP",CZ:"CZE",DE:"DEU",DJ:"DJI",DM:"DMA",DK:"DNK",DO:"DOM",DZ:"DZA",EC:"ECU",EG:"EGY",ER:"ERI",EH:"ESH",ES:"ESP",EE:"EST",ET:"ETH",FI:"FIN",FJ:"FJI",FK:"FLK",FR:"FRA",FO:"FRO",FM:"FSM",GA:"GAB",GB:"GBR",GE:"GEO",GG:"GGY",GH:"GHA",GI:"GIB",GN:"GIN",GP:"GLP",GM:"GMB",GW:"GNB",GQ:"GNQ",GR:"GRC",GD:"GRD",GL:"GRL",GT:"GTM",GF:"GUF",GU:"GUM",GY:"GUY",HK:"HKG",HM:"HMD",HN:"HND",HR:"HRV",HT:"HTI",HU:"HUN",ID:"IDN",IM:"IMN",IN:"IND",IO:"IOT",IE:"IRL",IR:"IRN",IQ:"IRQ",IS:"ISL",IL:"ISR",IT:"ITA",JM:"JAM",JE:"JEY",JO:"JOR",JP:"JPN",KZ:"KAZ",KE:"KEN",KG:"KGZ",KH:"KHM",KI:"KIR",KN:"KNA",KR:"KOR",KW:"KWT",LA:"LAO",LB:"LBN",LR:"LBR",LY:"LBY",LC:"LCA",LI:"LIE",LK:"LKA",LS:"LSO",LT:"LTU",LU:"LUX",LV:"LVA",MO:"MAC",MF:"MAF",MA:"MAR",MC:"MCO",MD:"MDA",MG:"MDG",MV:"MDV",MX:"MEX",MH:"MHL",MK:"MKD",ML:"MLI",MT:"MLT",MM:"MMR",ME:"MNE",MN:"MNG",MP:"MNP",MZ:"MOZ",MR:"MRT",MS:"MSR",MQ:"MTQ",MU:"MUS",MW:"MWI",MY:"MYS",YT:"MYT",NA:"NAM",NC:"NCL",NE:"NER",NF:"NFK",NG:"NGA",NI:"NIC",NU:"NIU",NL:"NLD",NO:"NOR",NP:"NPL",NR:"NRU",NZ:"NZL",OM:"OMN",PK:"PAK",PA:"PAN",PN:"PCN",PE:"PER",PH:"PHL",PW:"PLW",PG:"PNG",PL:"POL",PR:"PRI",KP:"PRK",PT:"PRT",PY:"PRY",PS:"PSE",PF:"PYF",QA:"QAT",RE:"REU",RO:"ROU",RU:"RUS",RW:"RWA",SA:"SAU",SD:"SDN",SN:"SEN",SG:"SGP",GS:"SGS",SH:"SHN",SJ:"SJM",SB:"SLB",SL:"SLE",SV:"SLV",SM:"SMR",SO:"SOM",PM:"SPM",RS:"SRB",SS:"SSD",ST:"STP",SR:"SUR",SK:"SVK",SI:"SVN",SE:"SWE",SZ:"SWZ",SX:"SXM",SC:"SYC",SY:"SYR",TC:"TCA",TD:"TCD",TG:"TGO",TH:"THA",TJ:"TJK",TK:"TKL",TM:"TKM",TL:"TLS",TO:"TON",TT:"TTO",TN:"TUN",TR:"TUR",TV:"TUV",TW:"TWN",TZ:"TZA",UG:"UGA",UA:"UKR",UM:"UMI",UY:"URY",US:"USA",UZ:"UZB",VA:"VAT",VC:"VCT",VE:"VEN",VG:"VGB",VI:"VIR",VN:"VNM",VU:"VUT",WF:"WLF",WS:"WSM",XK:"XKX",YE:"YEM",ZA:"ZAF",ZM:"ZMB",ZW:"ZWE"};const oe={af:48,sq:1,ar:34,eu:1,bg:49,be:1,ca:42,zh:19,"zh-tw":18,"zh-cn":19,"zh-hk":45,"zh-sg":19,hr:41,cs:22,da:11,nl:10,"nl-be":65,en:1,"en-us":1,"en-eg":26,"en-au":27,"en-gb":2,"en-ca":6,"en-nz":27,"en-ie":26,"en-za":26,"en-jm":26,"en-bz":26,"en-tt":26,"en-001":26,et:30,fo:1,fa:59,fi:12,fr:3,"fr-ca":5,gd:2,de:4,"de-ch":57,el:23,he:36,hi:50,hu:21,is:31,id:37,it:7,ja:9,ko:13,lv:33,lt:32,mk:1,mt:1,no:14,nb:14,nn:14,pl:20,"pt-br":15,pt:24,rm:1,ro:39,ru:16,sr:1,sk:40,sl:52,es:8,"es-mx":28,"es-419":44,sv:17,th:35,ts:1,tn:1,tr:25,uk:29,ur:55,ve:1,vi:43,xh:1,yi:1,zu:56,ms:38,iw:36,lo:46,tl:47,kk:51,ta:53,te:54,bn:58,ga:60,ht:61,la:62,pa:63,sa:64};let se="Music-User-Token";function getLanguages(){if("undefined"==typeof navigator)return[];if(navigator.languages)return navigator.languages;const e=navigator.language||navigator.userLanguage;return e?[e]:[]}function _defineProperty$R(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$R(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$R(e,n,d[n])}))}return e}function _objectSpreadProps$z(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}se="Media-User-Token";const addPathToURL=(e,n)=>void 0===e||""===e?n||"":void 0===n?e:(e.endsWith("/")&&(e=e.slice(0,-1)),n.startsWith("/")&&(n=n.slice(1)),`${e}/${n}`),addQueryParamsToURL=(e,n)=>{const d=urlEncodeParameters(n);return""===d?e:e.endsWith("&")||e.endsWith("?")?`${e}${d}`:e.includes("?")?`${e}&${d}`:`${e}?${d}`},ce="undefined"!=typeof Headers,headersToDict=e=>{let n={};var d;return d=e,ce&&d instanceof Headers?e.forEach((e,d)=>n[d]=e):Array.isArray(e)?e.forEach(([e,d])=>n[e]=d):n=e,n},mergeFetchHeaders=(e={},n={})=>_objectSpread$R({},headersToDict(e),headersToDict(n)),mergeFetchOptions=(e,n)=>{if(e||n)return(null==e?void 0:e.headers)&&(null==n?void 0:n.headers)?_objectSpreadProps$z(_objectSpread$R({},e,n),{headers:mergeFetchHeaders(e.headers,n.headers)}):_objectSpread$R({},e,n)};function parseQueryParams(e){if(!e||e.startsWith("http")&&!e.includes("?"))return{};try{var n;return parseParams(null!==(n=e.split("?")[1])&&void 0!==n?n:e,"&",decodeURIComponent)}catch(Lr){return{}}}function parseParams(e,n="&",d=(e=>e)){return"string"!=typeof e?{}:e.split(n).map(e=>e.trim().split("=",2)).reduce((e,n)=>{const[p,h]=n;return""===p&&void 0===h||(e[d(p)]=d(h),void 0===h&&(e[d(p)]=void 0)),e},{})}function getMaxAgeFromHeaders(e){const n=function(e,n){if(void 0!==n)return ce&&n instanceof Headers?n.get(e):n[e]}("cache-control",e);if(n){return(e=>{const n=Number(e);if(Number.isFinite(n))return n})(parseParams(n,",")["max-age"])}}function rewriteLastUrlPath(e,n){const d=e.split("/");return d.pop(),d.push(n),d.join("/")}const recursiveEncodeParameters=(e,n)=>Object.keys(e).reduce((d,p)=>{const h=e[p],y=n?`${n}[${encodeURIComponent(p)}]`:encodeURIComponent(p);return`${d}${d?"&":""}${isObject(h)?recursiveEncodeParameters(h,y):`${y}=${encodeURIComponent(""+h)}`}`},"");function urlEncodeParameters(e){return e?recursiveEncodeParameters(e):""}const le={};function findOrCreate(e,n){const d=e.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,n)=>n.toUpperCase());if(hasOwn(le,d)){const p=le[d];if(n!==p.constructor)throw new Error(`DevFlag ${e} was already registered with a different type (${p.constructor.name})`);return p}const p=new n(e);return Object.defineProperty(le,d,{configurable:!0,enumerable:!0,get:function(){return p},set(e){p.set(e)}}),p}class LocalStorageDevFlag{get value(){return this.get()}get configured(){return void 0!==this.value}read(){var e,n;const d=null!==(n=null===(e=getLocalStorage())||void 0===e?void 0:e.getItem(this.key))&&void 0!==n?n:null;return null!==d?d:void 0}write(e){var n;null===(n=getLocalStorage())||void 0===n||n.setItem(this.key,e)}clear(){var e;null===(e=getLocalStorage())||void 0===e||e.removeItem(this.key)}constructor(e){if("string"!=typeof e||""===e.trim())throw new Error("DevFlag requires a non-empty string key");this.key=e}}class StringDevFlag extends LocalStorageDevFlag{static register(e){return findOrCreate(e,this)}static get(e){return this.register(e).get()}static set(e,n){this.register(e).set(n)}get(){return this.read()}set(e){"string"!=typeof e&&console.warn("Value for StringDevFlag should be a string"),this.write(e)}}class BooleanDevFlag extends LocalStorageDevFlag{static register(e){return findOrCreate(e,this)}static get(e){return this.register(e).get()}static set(e,n){this.register(e).set(n)}get(){const e=this.read();if(void 0!==e)return"1"===e||"true"===e.toLowerCase()}set(e){"boolean"==typeof e?this.write(!0===e?"1":"0"):console.warn("Value for BooleanDevFlag should be a boolean")}get enabled(){return!0===this.get()}enable(){this.set(!0)}disable(){this.set(!1)}toggle(){this.set(!this.get())}}class JsonDevFlag extends LocalStorageDevFlag{static register(e){return findOrCreate(e,this)}static get(e){return this.register(e).get()}static set(e,n){this.register(e).set(n)}get(){const e=this.read();if(void 0!==e)try{return JSON.parse(e)}catch(Y){return}}set(e){this.write(JSON.stringify(e))}prop(e){if(void 0!==this.value)return this.value[e]}}const ue=JsonDevFlag.register("mk-hlsjs-automation-config"),de=new RegExp("^https://([a-z0-9]+-)?"+("js-cdn.music.apple.com"+"/musickit/v3/".replace(/v3/,"(v2|v3)")).replace(/[\.\/]/g,"\\$&"),"i"),pe=/^https:\/\/(.*\/includes\/js-cdn)\//i,he=/^([a-z]+:)?\/\//;function findScript(e){return isNodeEnvironment$1()||!e?null:document.querySelector(`script[src*="${e}"]`)}function getScriptSrcElements(){if("undefined"==typeof document||!document.querySelectorAll)return[];return Array.from(document.querySelectorAll("script[src]"))}function determineCdnBasePrefix(){for(const e of getScriptSrcElements()){const n=de.exec(e.src);if(n)return n[1]||""}return""}function determineCdnPathPrefix(){for(const e of getScriptSrcElements()){const n=pe.exec(e.src);if(n)return n[1]||""}return""}function determineCdnBaseHost(){if(isNodeEnvironment$1())return"";return`//${determineCdnBasePrefix()}js-cdn.music.apple.com`}function determineCdnPathHost(){const e=determineCdnPathPrefix();return e?"//"+e:e}const ye=StringDevFlag.register("mk-hlsjs-log-level"),fe=StringDevFlag.register("mk-hlsjs-version");function getHlsJsCdnConfig(){const e={hls:"",rtc:""};if(isNodeEnvironment$1())return e;const n=determineCdnPathHost()||determineCdnBaseHost(),d=fe.get()||"2.440.6",p=function(){const e=ye.value;switch(e){case"info":case"error":case"warn":return"hls.production.verbose.min.js";case"trace":case"debug":return console.warn(`HLS log level ${e} is not supported, loading production build.`),"hls.js";default:return"hls.js"}}();return e.hls=`https:${n}/hls.js/${d}/hls.js/${p}`,e.rtc=`https:${n}/hls.js/${d}/rtc.js/rtc.min.js`,function(e){const n=ue.get();if(!(null==n?void 0:n.url))return;const{url:d}=n;isAppleHostname(d)&&"carry-"===determineCdnBasePrefix()&&(e.hls=d)}(e),e}function isAppleHostname(e){try{return new URL(e).hostname.endsWith(".apple.com")}catch(Lr){}return!1}function cdnBaseURL(e,n=window){var d;if(isNodeEnvironment$1())return"";const p=null===(d=getLocalStorage())||void 0===d?void 0:d.getItem("mkCDNBaseURLOverride");if(p)return p;const h=findScript(e);return h?h.getAttribute("src").replace(new RegExp(e+"$"),""):(determineCdnPathHost()||determineCdnBaseHost())+"/musickit/v3/"}const me=new Map;function loadScript(e,n){const d=me.get(e);if(d)return d;const p=new Promise((d,p)=>{isNodeEnvironment$1()&&p("Dynamic script loading is unsupported in Node environments.");if(findScript(e))return d();const h=document.createElement("script");let y;if(n&&Object.keys(n).forEach(e=>{h.setAttribute(e,n[e])}),h.onload=()=>{d()},h.onerror=e=>{p(e)},he.test(e))y=e;else{y=`${cdnBaseURL(e)}${e}`}h.src=y,document.head.appendChild(h)});return me.set(e,p),p}const ge=new Logger("storekit"),ve=["apps.apple.com","books.apple.com","fitness.apple.com","mediaauth.apple.com","multidev.apple.com","music.apple.com","one.apple.com","podcasts.apple.com","tv.apple.com","itunes.apple.com"];class AuthBridgeApp extends class{init(e,n){var d;this._receiveWindow=e,this._sendWindow=n,this.handleMessage=this.handleMessage.bind(this),null===(d=this._receiveWindow)||void 0===d||d.addEventListener("message",this.handleMessage)}sendMessage(e,n){const d={action:"mediakit:"+e,data:n};this._sendWindow&&this._sendWindow.postMessage(JSON.stringify(d),this._targetOrigin)}handleMessage(e){if(!this._isOriginAllowed(e.origin))return;let n;try{n=JSON.parse(e.data)}catch(Lr){}if(!n||!this._isNamespacedData(n))return;"*"===this._targetOrigin&&(this._targetOrigin=e.origin),ge.debug("auth-bridge: handleMessage",n);const d=n.action.replace("mediakit:","");this[d]?this[d](n.data):ge.debug("auth-bridge: unsupported method",d)}_isOriginAllowed(e){if(!e)return!1;const[n,d]=e.split("://");let p="";return d&&(p=d.split(":")[0],p&&(p=p.toLocaleLowerCase())),"https"===n&&!!p&&ve.some(e=>p===e||p.endsWith("."+e))}_isNamespacedData(e){return e.action&&-1!==e.action.indexOf("mediakit:")}constructor(){this._targetOrigin="*"}}{requestAuthUpdate(){this.whenFrameInited.then(()=>this.sendMessage("requestAuthUpdate"))}setCookieItem(e,n){this.whenFrameInited.then(()=>this.sendMessage("setCookieItem",{name:e,value:n}))}clearAuth(){this.whenFrameInited.then(()=>this.sendMessage("clearAuth"))}frameInit(){var e;null===(e=this._frameInitResolve)||void 0===e||e.call(this),this.requestAuthUpdate()}updateAuth(e){if((null==e?void 0:e.enabled)&&(null==e?void 0:e.cookies)){const n=e.cookies;Object.keys(n).forEach(e=>{var d;const p=null!==(d=n[e])&&void 0!==d?d:"";p?setCookie(e,p,"/",30):removeCookie(e)})}this._authUpdateResolve&&(this._authUpdateResolve(),this._authUpdateResolve=void 0)}authClearedFromOtherFrame(){ge.warn("Override auth-bridge/app's authClearedFromOtherFrame to trigger app-specific sign out behavior")}_getIframeSrc(){let e="",n=determineCdnPathPrefix();if(n)n+="/musickit/v3/",e="?inc="+encodeURIComponent(n);else{const n=determineCdnBasePrefix();n&&(e="?env="+n.substring(0,n.length-1))}return"https://mediaauth.apple.com/auth-bridge/"+e}constructor(){super(),this.whenFrameInited=new Promise(e=>this._frameInitResolve=e),this.whenAuthCompleted=new Promise(e=>this._authUpdateResolve=e),this.frame=document.createElement("iframe"),this.frame.src=this._getIframeSrc(),this.frame.style.display="none",document.body.appendChild(this.frame),this.init(window,this.frame.contentWindow)}}const be=new Set(["apps","books","music","podcasts","tv"]),_e=/\.apple\.com$/;function getCommerceHostname(e,n){!n&&"undefined"!=typeof location&&location.hostname&&(n=location);let d=e+".itunes.apple.com";if(!n)return d;const p=function(e){if(!e||!_e.test(e))return;const n=e.split(".");let d=n[n.length-3];const p=d;if(d&&d.includes("-")){const e=d.split("-");d=e[e.length-1]}return be.has(d)?p:void 0}(n.hostname);return p&&(d=`${e}.${p}.apple.com`),d}var Pe,Te,Se;function buildQueryParams(e={app:Pe.APP,p:Pe.P}){return void 0===e.app&&(e.app=Pe.APP),void 0===e.p&&(e.p=Pe.P),Object.keys(e).map(n=>`${encodeURIComponent(n)}=${encodeURIComponent(e[n])}`).join("&")}!function(e){e.APP="music",e.P="subscribe"}(Pe||(Pe={})),function(e){e.DEFAULT_CID="pldfltcid",e.TV_CID="pltvcid",e.RESTRICTIONS_ENABLED="itre",e.STOREFRONT_COUNTRY_CODE="itua",e.USER_TOKEN="media-user-token"}(Te||(Te={})),e.SKRealm=void 0,(Se=e.SKRealm||(e.SKRealm={}))[Se.MUSIC=0]="MUSIC",Se[Se.PODCAST=1]="PODCAST",Se[Se.TV=2]="TV";const Ee={[e.SKRealm.TV]:"com.apple.onboarding.tvapp",[e.SKRealm.MUSIC]:"com.apple.onboarding.applemusic"},ke={[e.SKRealm.TV]:"pltvcid",[e.SKRealm.MUSIC]:"pldfltcid"},we={"com.apple.onboarding.tvapp":5,"com.apple.onboarding.applemusic":3},Oe=memoize(e=>{const n=new Uint16Array(e),d=n.length;let p="";for(let h=0;h<d;h++)p+=String.fromCharCode(n[h]);return p}),Ie=memoize(e=>{const n=E(e);return Ae(n)});function ensureArray(e=[]){return Array.isArray(e)?e:[e]}const Ae=memoize(e=>{const n=e.length,d=new ArrayBuffer(n),p=new Uint8Array(d);for(let h=0;h<n;h++)p[h]=e.charCodeAt(h);return p}),Re=memoize(e=>{const n=e.length,d=new ArrayBuffer(2*n),p=new Uint16Array(d);for(let h=0;h<n;h++)p[h]=e.charCodeAt(h);return p}),Ce=memoize(e=>{let n,d,p,h,y,m,g,b=0;const _="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let P="";for(;b<e.length;)n=e[b++],d=b<e.length?e[b++]:Number.NaN,p=b<e.length?e[b++]:Number.NaN,h=n>>2,y=(3&n)<<4|d>>4,m=(15&d)<<2|p>>6,g=63&p,isNaN(d)?m=g=64:isNaN(p)&&(g=64),P+=_.charAt(h)+_.charAt(y)+_.charAt(m)+_.charAt(g);return P});function asyncGeneratorStep$1j(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}var Me;!function(e){e[e.ParseError=-32700]="ParseError",e[e.InvalidRequest=-32600]="InvalidRequest",e[e.MethodNotFound=-32601]="MethodNotFound",e[e.InvalidParams=-32602]="InvalidParams",e[e.InternalError=-32603]="InternalError"}(Me||(Me={}));class Dispatch{get source(){return this._source}set source(e){if(!e&&this._source)return this._source.removeEventListener("message",this.handle),void(this._source=void 0);e.addEventListener("message",this.handle),this._source=e}apply(e,n){if(!this.destination)throw new Error("No destination");const d=this._sequence++,p=new Promise((e,n)=>{this._registry[d]={resolve:e,reject:n}});return this.send(this.destination,{jsonrpc:"2.0",id:d,method:e,params:n}),p}call(e,...n){return this.apply(e,n)}handleRequest(e){var n,d=this;return(n=function*(){const n={jsonrpc:"2.0",id:e.id},p=d.methods[e.method];if(!p)return Object.assign(n,{error:{code:Me.MethodNotFound,message:"Method not found"}});try{const d=yield p.apply(void 0,ensureArray(e.params));return Object.assign(n,{result:d})}catch(Y){return Object.assign(n,{error:{code:Y.code||Me.InternalError,message:Y.message}})}},function(){var e=this,d=arguments;return new Promise((function(p,h){var y=n.apply(e,d);function _next(e){asyncGeneratorStep$1j(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1j(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))})()}handleResponse(e){const n=this._registry[e.id];delete this._registry[e.id],n&&(e.error?n.reject(Object.assign(Error(),e.error)):n.resolve(e.result))}send(e,n){e.postMessage(n,e.window===e?this.origin:void 0)}constructor(e={}){this._registry={},this._sequence=0,this.handle=e=>{e.data&&"2.0"===e.data.jsonrpc&&("*"!==this.origin&&this.origin!==e.origin||(e.data.method&&this.destination?this.handleRequest(e.data).then(e=>{this.send(this.destination,e)}):(hasOwn(e.data,"result")||e.data.error)&&this.handleResponse(e.data)))},this.destination=e.destination,this.methods=e.methods||{},this.origin=e.origin||"*",e.source&&(this.source=e.source)}}function asyncGeneratorStep$1i(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$1i(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$1i(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1i(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$Q(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$Q(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$Q(e,n,d[n])}))}return e}function _objectSpreadProps$y(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}var De;function validateToken(e){if("string"!=typeof e)return!1;const n=e.match(/[a-zA-Z0-9=\/+]{32,}==$/);var d;return null!==(d=n&&n.length>0)&&void 0!==d&&d}!function(e){e[e.UNAVAILABLE=-1]="UNAVAILABLE",e[e.NOT_DETERMINED=0]="NOT_DETERMINED",e[e.DENIED=1]="DENIED",e[e.RESTRICTED=2]="RESTRICTED",e[e.AUTHORIZED=3]="AUTHORIZED"}(De||(De={}));const je=`https://${getCommerceHostname("buy")}/commerce/account/authenticateMusicKitRequest`,xe="https://authorize.music.apple.com",$e=/^https?:\/\/(.+\.)*(apple\.com|apps\.mzstatic\.com)(\/[\w\d]+)*$/;var Le,Ne;!function(e){e[e.AUTHORIZE=0]="AUTHORIZE",e[e.SUBSCRIBE=1]="SUBSCRIBE"}(Le||(Le={}));class ServiceSetupView{get isServiceView(){return/(authorize\.(.+\.)*apple\.com)/i.test(window.location.hostname)||window&&window.name===this.target||!1}focus(){this._window&&window.focus&&this._window.focus()}load(e={action:Le.AUTHORIZE}){var n=this;return _asyncToGenerator$1i((function*(){return e.action===Le.SUBSCRIBE?n._subscribeAction(e.parameters):n._authorizeAction(e.parameters)}))()}present(e="",n){const{height:d,left:p,top:h,width:y}=this._calculateClientDimensions(),m={height:650,menubar:"no",resizable:"no",scrollbars:"no",status:"no",toolbar:"no",width:650},g=_objectSpread$Q(_objectSpreadProps$y(_objectSpread$Q({},m),{left:y/2-m.width/2+p,top:d/2-m.height/2+h}),n),b=Object.keys(g).map(e=>`${e}=${g[e]}`).join(",");return/trident|msie/i.test(navigator.userAgent)?(this._window=window.open(window.location.href,this.target,b)||void 0,this._window.location.href=e):this._window=window.open(e,this.target,b)||void 0,/\bedge\b/i.test(navigator.userAgent)&&(this._window.opener=self),this.focus(),this._window}_startPollingForWindowClosed(e){this._window&&void 0===this._windowClosedInterval&&(this._windowClosedInterval=setInterval(()=>{var n;(null===(n=this._window)||void 0===n?void 0:n.closed)&&(this._stopPollingForWindowClosed(),e())},500))}_stopPollingForWindowClosed(){void 0!==this._windowClosedInterval&&(clearInterval(this._windowClosedInterval),this._windowClosedInterval=void 0)}_authorizeAction(e={}){var n=this;return _asyncToGenerator$1i((function*(){var d;let p,h;const y=(null===(d=window.location)||void 0===d?void 0:d.href)||"";return"GET"===n.authenticateMethod?h=`${xe}/woa?${buildQueryParams(_objectSpreadProps$y(_objectSpread$Q({},n.deeplinkParameters),{a:btoa(n._thirdPartyInfo()),referrer:y}))}`:(p=n._buildFormElement(je),document.body.appendChild(p)),new Promise((d,y)=>{const m=n.present(h);n._startPollingForWindowClosed(()=>{y(De.NOT_DETERMINED)}),n.dispatch=new Dispatch({methods:{authorize(e,n,p){validateToken(e)?d({restricted:n&&"1"===n,userToken:e,cid:p}):y(De.NOT_DETERMINED)},close(){},decline(){y(De.DENIED)},switchUserId(){y(De.NOT_DETERMINED)},thirdPartyInfo:()=>n._thirdPartyInfo(n.developerToken,_objectSpread$Q({},n.deeplinkParameters,e)),unavailable(){y(De.UNAVAILABLE)}},origin:xe,source:window,destination:m}),p&&p.submit()})}))()}_buildFormElement(e,n=this.target,d=this.developerToken){const p=document.createElement("form");p.setAttribute("method","post"),p.setAttribute("action",e),p.setAttribute("target",n),p.style.display="none";const h=document.createElement("input");h.setAttribute("name","jwtToken"),h.setAttribute("value",d),p.appendChild(h);const y=document.createElement("input");y.setAttribute("name","isWebPlayer"),y.setAttribute("value","true"),p.appendChild(y);const m=document.createElement("input");return m.setAttribute("name","LogoURL"),m.setAttribute("value",""),p.appendChild(m),p}_calculateClientDimensions(e=window){return{height:e.innerHeight?e.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,left:e.screenLeft?e.screenLeft:screen.availLeft||screen.left,top:e.screenTop?e.screenTop:screen.availTop||screen.top,width:e.innerWidth?e.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width}}_subscribeAction(e={}){var n=this;return _asyncToGenerator$1i((function*(){return Object.assign(e,n.deeplinkParameters),new Promise((d,p)=>{const h="https://authorize.music.apple.com/upsell?"+buildQueryParams(e);n.present(h),window.addEventListener("message",({data:e,origin:n,source:h})=>{const{closeWindow:y,launchClient:m}="string"==typeof e?JSON.parse(e):e;n&&!$e.test(n)||(m?0===m.supported?p("Unable to subscribe on this platform."):d(m):p("Subscribe action error."))})})}))()}_thirdPartyInfo(e=this.developerToken,n){let d=this.iconURL;const p=window.location.host||document.referrer,h=[...[].slice.call(document.querySelectorAll('link[rel="apple-music-app-icon"]')),...[].slice.call(document.querySelectorAll('link[rel="apple-touch-icon-precomposed"]')),...[].slice.call(document.querySelectorAll('link[rel="apple-touch-icon"]'))];if(h&&h[0]&&h[0].href){const e=h.find(e=>!!e.sizes&&"120x120"===e.sizes.value);var y;d=null!==(y=null==e?void 0:e.href)&&void 0!==y?y:h[0].href}return JSON.stringify({thirdPartyIconURL:d,thirdPartyName:p,thirdPartyParameters:n,thirdPartyToken:e})}constructor(e,n={}){if(this.developerToken=e,this.authenticateMethod="GET",this.target="apple-music-service-view",this.deeplinkParameters=n&&n.deeplinkParameters||{},this.iconURL=n&&n.iconURL,this.authenticateMethod=n&&n.authenticateMethod||"GET",this.isServiceView&&window.opener!==window){var d;const e=null===(d=getSessionStorage())||void 0===d?void 0:d.getItem("ac"),n=null!=e?new URL(e).origin:void 0;var p;if(n)this.dispatch=new Dispatch({destination:null!==(p=window.opener)&&void 0!==p?p:void 0,origin:n,source:window})}}}function asyncGeneratorStep$1h(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$1h(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$1h(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1h(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _fetchStorefronts(){return(_fetchStorefronts=_asyncToGenerator$1h((function*(e,n="https://api.music.apple.com/v1"){const d=new Headers({Authorization:"Bearer "+e}),p=yield fetch(n+"/storefronts",{headers:d}),h=yield p.json();return h.errors?Promise.reject(h.errors):h.data}))).apply(this,arguments)}!function(e){e.ID="us",e.LANGUAGE_TAG="en-gb"}(Ne||(Ne={}));class Storefront{static inferFromLanguages(e,n=getLanguages()){return _asyncToGenerator$1h((function*(){const d=yield function(e){return _fetchStorefronts.apply(this,arguments)}(e),p=d.map(e=>e.id),h=n[0]||"en-US",[y,m]=h.toLowerCase().split(/-|_/),g=p.includes(m)?m:"us";return d.find(e=>e.id===g)}))()}constructor(e,n,d){this.id=e,this.attributes=n,this.type="storefronts",this.href=d||`/v1/${this.type}/${e}`}}function asyncGeneratorStep$1g(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$1g(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$1g(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1g(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$P(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$P(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$P(e,n,d[n])}))}return e}var Ue,Ge={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},Be={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};!function(e){e.authorizationStatusDidChange="authorizationStatusDidChange",e.authorizationStatusWillChange="authorizationStatusWillChange",e.eligibleForSubscribeView="eligibleForSubscribeView",e.needsGDPRDidChange="needsGDPRDidChange",e.storefrontCountryCodeDidChange="storefrontCountryCodeDidChange",e.storefrontIdentifierDidChange="storefrontIdentifierDidChange",e.userTokenDidChange="userTokenDidChange"}(Ue||(Ue={})),Te.DEFAULT_CID;let Fe=!1;Fe=!0;const Ke="https://"+getCommerceHostname("buy"),Ve=`https://${getCommerceHostname("play")}/WebObjects/MZPlay.woa/wa`;class StoreKit extends Notifications{updateUserTokenFromStorage(){const e=this._getStorageItem(Te.USER_TOKEN);this.userToken=e||void 0}get authorizationStatus(){return this._authorizationStatus}set authorizationStatus(e){this._authorizationStatus!==e&&(this._getIsActiveSubscription.updateCache(void 0),this.dispatchEvent(Ue.authorizationStatusWillChange,{authorizationStatus:this._authorizationStatus,newAuthorizationStatus:e}),this._authorizationStatus=e,this.dispatchEvent(Ue.authorizationStatusDidChange,{authorizationStatus:e}))}get cid(){if(!this._cids[this.cidNamespace]){const e=this._getStorageItem(this.cidNamespace);this._cids[this.cidNamespace]=e||void 0}return this._cids[this.cidNamespace]}set cid(e){e?this._setStorageItem(this.cidNamespace,e):this._removeStorageItem(this.cidNamespace),this._cids[this.cidNamespace]=e}eligibleForSubscribeView(){var e=this;return _asyncToGenerator$1g((function*(){const n=yield e.hasMusicSubscription();return(!e.hasAuthorized||e.hasAuthorized&&!n)&&!e._dispatchedSubscribeView}))()}get hasAuthorized(){return this.authorizationStatus>De.DENIED}get logoutURL(){if(!this._disableLogoutURL)return this.iTunesBuyBase+"/account/web/logout"}get parentalControls(){return this._parentalControls}set parentalControls(n){this._parentalControls=n,n&&(this.realm===e.SKRealm.MUSIC?this.restrictedEnabled=n.musicParentalControlsEnabled:this.realm===e.SKRealm.TV&&n.videoContentRestrictions&&(this.authorizationStatus=De.RESTRICTED))}get _pldfltcid(){return this._cids[Te.DEFAULT_CID]}set _pldfltcid(e){this._cids[Te.DEFAULT_CID]=e}get privacyAcknowledgements(){return this._privacyAcknowledgements}set privacyAcknowledgements(e){if(this._privacyAcknowledgements=e,!e)return this._gdprVersion=-1,void(this._needsGDPR=void 0);if(this.bundleId){var n;const d=null!==(n=this._needsGDPR)&&void 0!==n&&n;this._gdprVersion=e[this.bundleId]||0,this._needsGDPR=this._gdprVersion<(we[this.bundleId]||0),d!==this._needsGDPR&&this.dispatchEvent(Ue.needsGDPRDidChange,{GDPRVersion:this._gdprVersion,needsGDPR:this._needsGDPR})}}get restrictedEnabled(){if(this.userToken&&"boolean"!=typeof this._restrictedEnabled){const e=this._getStorageItem(Te.RESTRICTIONS_ENABLED);if(e)this._restrictedEnabled="0"!==e;else if(this._storefrontCountryCode){const e=["br","ch","gt","hu","id","in","it","kr","la","lt","my","ru","sg","tr"];this._restrictedEnabled=-1!==e.indexOf(this._storefrontCountryCode)||void 0}}return this._restrictedEnabled}set restrictedEnabled(e){this._restrictedEnabledOverridden||(this.userToken&&void 0!==e&&this._setStorageItem(Te.RESTRICTIONS_ENABLED,e?"1":"0"),this._restrictedEnabled=e,e&&(this.authorizationStatus=De.RESTRICTED))}overrideRestrictEnabled(e){this._restrictedEnabledOverridden=!1,this.restrictedEnabled=e,this._restrictedEnabledOverridden=!0}get storefrontCountryCode(){if(!this._storefrontCountryCode){const e=this._getStorageItem(Te.STOREFRONT_COUNTRY_CODE);this._storefrontCountryCode=(null==e?void 0:e.toLowerCase())||Ne.ID}return this._storefrontCountryCode}set storefrontCountryCode(e){e&&this.userToken?this._setStorageItem(Te.STOREFRONT_COUNTRY_CODE,e):this._removeStorageItem(Te.STOREFRONT_COUNTRY_CODE),e!==this._storefrontCountryCode&&(this._storefrontCountryCode=e,this.dispatchEvent(Ue.storefrontCountryCodeDidChange,{storefrontCountryCode:e}))}get storefrontIdentifier(){return this._storefrontIdentifier}set storefrontIdentifier(e){this._storefrontIdentifier=e,this.dispatchEvent(Ue.storefrontIdentifierDidChange,{storefrontIdentifier:e})}runTokenValidations(e,n=!0){e&&validateToken(e)?(n&&this._setStorageItem(Te.USER_TOKEN,e),this.authorizationStatus=this.restrictedEnabled?De.RESTRICTED:De.AUTHORIZED):(this._removeStorageItem(Te.USER_TOKEN),this.authorizationStatus=De.NOT_DETERMINED)}wrapDynamicUserTokenForChanges(e,n=invoke(e)){if("function"!=typeof e)return e;let d=n;return()=>{const n=invoke(e);return d!==n&&(d=n,this.runTokenValidations(n,!1),this.dispatchEvent(Ue.userTokenDidChange,{userToken:n})),n||""}}get dynamicUserToken(){return this._dynamicUserToken}set dynamicUserToken(e){const n=invoke(e);this._dynamicUserToken=this.wrapDynamicUserTokenForChanges(e,n),this.runTokenValidations(n,"function"!=typeof e),this.dispatchEvent(Ue.userTokenDidChange,{userToken:n})}get userToken(){return invoke(this.dynamicUserToken)}set userToken(e){this.dynamicUserToken=e}get userTokenIsValid(){return validateToken(this.userToken)}deeplinkURL(e={}){return"https://finance-app.itunes.apple.com/deeplink?"+buildQueryParams(e=_objectSpread$P({},this.deeplinkParameters||{},e))}itunesDeeplinkURL(e={p:"browse"}){return"https://itunes.apple.com/deeplink?"+buildQueryParams(e=_objectSpread$P({},this.deeplinkParameters||{},e))}pldfltcid(){var e=this;return _asyncToGenerator$1g((function*(){if(!e._cids[Te.DEFAULT_CID])try{yield e.infoRefresh()}catch(Lr){return}return e._cids[Te.DEFAULT_CID]}))()}renewUserToken(){var e=this;return _asyncToGenerator$1g((function*(){if(!e.userToken)return e.requestUserToken();const n=new Headers({Authorization:"Bearer "+e.developerToken,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+e.userToken}),d=yield fetch(e.playBase+"/renewMusicToken",{method:"POST",headers:n});if(401===d.status)return yield e.revokeUserToken(),Promise.reject(new Error("Renew token"));const p=yield d.json();return p["music-token"]&&(e.userToken=p["music-token"]),e.userToken}))()}requestStorefrontCountryCode(){var e=this;return _asyncToGenerator$1g((function*(){if(e.authorizationStatus<=De.DENIED)return Promise.reject("Not authorized: "+e.authorizationStatus);const n=new Headers({Authorization:"Bearer "+e.developerToken,[se]:e.userToken||""}),d=yield fetch(e.apiBase+"/me/storefront",{headers:n});if(d&&!d.ok)return e._reset(),Promise.reject("Storefront Country Code error.");const p=yield d.json();if(p.errors)return Promise.reject(p.errors);const[h]=p.data;return h&&h.id?(e.storefrontCountryCode=h.id,e.storefrontCountryCode):Promise.reject("Storefront Country Code error.")}))()}requestStorefrontIdentifier(){var e=this;return _asyncToGenerator$1g((function*(){if(!e.storefrontIdentifier){const n=yield Storefront.inferFromLanguages(e.developerToken);e.storefrontIdentifier=n.id}return e.storefrontIdentifier}))()}requestUserToken(){var e=this;return _asyncToGenerator$1g((function*(){if(e._serviceSetupView.isServiceView)return e.userToken||"";try{const n=yield e._serviceSetupView.load({action:Le.AUTHORIZE});e.cid=n.cid,e.userToken=n.userToken,e.restrictedEnabled=n.restricted}catch(n){return e._reset(),e.authorizationStatus=n,Promise.reject(n)}return e.userToken}))()}revokeUserToken(){var e=this;return _asyncToGenerator$1g((function*(){var n;try{yield e._webPlayerLogout()}catch(Lr){}null===(n=e.authBridgeApp)||void 0===n||n.clearAuth(),e.dispatchEvent(Ue.authorizationStatusWillChange,{authorizationStatus:e.authorizationStatus,newAuthorizationStatus:De.NOT_DETERMINED}),e._reset(),e.dispatchEvent(Ue.authorizationStatusDidChange,{authorizationStatus:e.authorizationStatus}),e.dispatchEvent(Ue.userTokenDidChange,{userToken:e.userToken})}))()}setCids(e){this._cids=_objectSpread$P({},this._cids,e),Object.keys(this._cids).forEach(e=>{this._setStorageItem(e,this._cids[e])})}shouldDisplayPrivacyLink(e){var n=this;return _asyncToGenerator$1g((function*(){return e||(e=n.bundleId),void 0!==n._needsGDPR||(yield n.me()),n._needsGDPR}))()}hasMusicSubscription(){var e=this;return _asyncToGenerator$1g((function*(){return!!e.hasAuthorized&&e._getIsActiveSubscription()}))()}_getIsActiveSubscription(){var e=this;return _asyncToGenerator$1g((function*(){var n;return!!(null===(n=(yield e.me()).subscription)||void 0===n?void 0:n.active)}))()}resetSubscribeViewEligibility(){this._dispatchedSubscribeView=!1}presentSubscribeViewForEligibleUsers(e={},n=!0){var d=this;return _asyncToGenerator$1g((function*(){const p=yield d.eligibleForSubscribeView();if(!d._serviceSetupView.isServiceView&&p){if(!n)return d.dispatchEvent(Ue.eligibleForSubscribeView,e),void(d._dispatchedSubscribeView=!0);try{const e=yield d._serviceSetupView.load({action:Le.SUBSCRIBE});return d._dispatchedSubscribeView=!0,e}catch(h){return d.revokeUserToken()}}}))()}infoRefresh(){var e=this;return _asyncToGenerator$1g((function*(){if(e.authorizationStatus<=De.DENIED)return Promise.reject("Not authorized: "+e.authorizationStatus);const n=new Headers({Authorization:"Bearer "+e.developerToken,[se]:e.userToken||""});try{const d=yield fetch(e.iTunesBuyBase+"/account/web/infoRefresh",{credentials:"include",headers:n}),p=yield d.json();e.setCids(p)}catch(Lr){}}))()}me(){if(this.authorizationStatus<=De.DENIED)return Promise.reject("Not authorized: "+this.authorizationStatus);if(!this._me){var n=this;this._me=new Promise(function(){var d=_asyncToGenerator$1g((function*(d,p){const h=new Headers({Authorization:"Bearer "+n.developerToken,[se]:n.userToken||""}),y=addQueryParamsToURL(n.apiBase+"/me/account",_objectSpread$P({meta:"subscription"},n.meParameters));let m;try{m=yield fetch(y,{headers:h})}catch(Lr){return p(new MKError(MKError.NETWORK_ERROR,"Failed to fetch /me/account"))}if(m&&!m.ok)return n.realm!==e.SKRealm.TV&&n._reset(),p("Account error.");let g=yield m.json();if(g.errors)return p(g.errors);const{data:b,meta:_}=g;if(!_||!_.subscription)return p("Account error.");n.storefrontCountryCode=_.subscription.storefront;const P={meta:_,subscription:_.subscription};b&&b.length&&(P.attributes=b[0].attributes);try{let e=yield fetch(n.iTunesBuyBase+"/account/web/info",{credentials:"include",headers:h});if(g=yield e.json(),n.parentalControls=g.parentalControlsData,n.privacyAcknowledgements=g.privacyAcknowledgement,isEmpty(n.privacyAcknowledgements||{})){try{yield n.infoRefresh()}catch(Lr){d(P)}e=yield fetch(n.iTunesBuyBase+"/account/web/info",{credentials:"include",headers:h}),g=yield e.json(),n.parentalControls=g.parentalControlsData,n.privacyAcknowledgements=g.privacyAcknowledgement}P.info=g}catch(Lr){console.warn("Failed to fetch privacyAcknowledgements",Lr)}return d(P)}));return function(e,n){return d.apply(this,arguments)}}()).then(e=>{var n;return this._getIsActiveSubscription.updateCache((null===(n=e.subscription)||void 0===n?void 0:n.active)||!1),this._me=null,e}).catch(e=>(this._me=null,Promise.reject(e)))}return this._me}musicSubscriptionOffers(e,n=getLanguages()){var d=this;return _asyncToGenerator$1g((function*(){let p;if(d.hasAuthorized){p=(yield d.me()).info.storeFrontISO3A}else{if(!e){const p=yield Storefront.inferFromLanguages(d.developerToken,n);e=null==p?void 0:p.id}p=e&&ae[e.toUpperCase()]||"USA"}const h=function(e="en-US"){const n=oe[e.toLowerCase()];if(n)return n;if(e.includes("-")){const n=e.split("-")[0],d=oe[n.toLowerCase()];if(d)return d}return oe["en-us"]}(n[0]),y=ie[p];if(!h||!y)return[];const m=new Headers({"X-Apple-Store-Front":`${y}-${h},8`});d.userToken&&(m.set("Authorization","Bearer "+d.developerToken),m.set("Music-User-Token",d.userToken));const g=yield fetch(d.iTunesBuyBase+"/commerce/web/subscription/offers/music",{headers:m});if(!g.ok)return Promise.reject(g.status);return(yield g.json()).offers}))()}_getStorageItem(e){var n;if(e)return"cookie"===this.persist?getCookie(e):"localstorage"===this.persist?null===(n=this.storage)||void 0===n?void 0:n.getItem(`${this.storagePrefix}.${e}`):void 0}_processLocationHash(e){const n=/^\#([a-zA-Z0-9+\/]{200,}={0,2})$/;if(n.test(e)){const d=e.replace(n,"$1");try{const{itre:e,musicUserToken:n,cid:p}=JSON.parse(atob(d));this.restrictedEnabled=e&&"1"===e,this.userToken=n,this.cid=p}catch(Lr){}history.replaceState(null,document.title," ")}}_removeStorageItem(e){if("cookie"===this.persist)this._removeCookieFromDomains(e);else if("localstorage"===this.persist){var n;return null===(n=this.storage)||void 0===n?void 0:n.removeItem(`${this.storagePrefix}.${e}`)}}_removeCookieFromDomains(e,n=window){removeCookie(e);const{hostname:d}=n.location,p=d.split(".");if(p.length&&(p.shift(),p.length>2))for(let h=p.length;h>2;h--){const d=p.join(".");p.shift(),removeCookie(e,n,d)}}_reset(e=De.NOT_DETERMINED){this._authorizationStatus=e,this._cids={},this._dispatchedSubscribeView=!1,this._restrictedEnabled=void 0,this._storefrontCountryCode=void 0,this._getIsActiveSubscription.updateCache(void 0),Object.keys(ke).forEach(e=>{this._removeStorageItem(ke[e])}),this._removeStorageItem(Te.RESTRICTIONS_ENABLED),this._removeStorageItem(Te.USER_TOKEN),this._removeStorageItem(Te.STOREFRONT_COUNTRY_CODE),this._dynamicUserToken=void 0,this._me=null,this.privacyAcknowledgements=void 0}_setStorageItem(e,n){var d,p;return"cookie"===this.persist?(null===(d=this.authBridgeApp)||void 0===d||d.setCookieItem(e,n),setCookie(e,n,"/",180)):"localstorage"===this.persist?null===(p=this.storage)||void 0===p?void 0:p.setItem(`${this.storagePrefix}.${e}`,n):void 0}_webPlayerLogout(){var e=this;return _asyncToGenerator$1g((function*(){const n=e.logoutURL;if(!n)return;const d=new Headers({Authorization:"Bearer "+e.developerToken,Accept:"application/json","Content-Type":"application/json",["X-Apple-"+se]:""+e.userToken});d.delete("X-Apple-"+se),d.append(se,e.userToken||"");const p=yield fetch(n,{method:"POST",headers:d,credentials:"include"});return p&&!p.ok?Promise.reject(p.status):p.json()}))()}constructor(n,d){super([Ue.authorizationStatusDidChange,Ue.authorizationStatusWillChange,Ue.eligibleForSubscribeView,Ue.needsGDPRDidChange,Ue.storefrontCountryCodeDidChange,Ue.userTokenDidChange,Ue.storefrontIdentifierDidChange]),this.developerToken=n,this.apiBase="https://api.music.apple.com/v1",this.iTunesBuyBase=Ke,this.meParameters={},this.persist="localstorage",this.playBase=Ve,this.prefix="music",this.realm=e.SKRealm.MUSIC,this.storage=getLocalStorage(),this._authorizationStatus=De.NOT_DETERMINED,this._disableLogoutURL=!1,this._dispatchedSubscribeView=!1,this._me=null,this._cids={},this._gdprVersion=-1,this._needsGDPR=void 0,this._restrictedEnabledOverridden=!1,this._dynamicUserToken=getCookie(Te.USER_TOKEN),ge.info("StoreKit initialized"),d&&(d.apiBase&&(this.apiBase=d.apiBase),d.deeplink&&(this.deeplinkParameters=d.deeplink),d.meParameters&&(this.meParameters=d.meParameters),d.persist&&(this.persist=d.persist),d.prefix&&(this.prefix=d.prefix),void 0!==d.realm&&(this.realm=d.realm),void 0!==d.disableLogoutURL&&(this._disableLogoutURL=d.disableLogoutURL),this.bundleId=Ee[this.realm]),this.cidNamespace=ke[this.realm],this._developerToken=new DeveloperToken(n),this._serviceSetupView=new ServiceSetupView(n,{authenticateMethod:d&&d.authenticateMethod,iconURL:d&&d.iconURL,deeplinkParameters:this.deeplinkParameters}),this.storagePrefix=`${this.prefix}.${this._developerToken.teamId}`.toLocaleLowerCase(),this.updateUserTokenFromStorage(),this.developerToken&&this.userTokenIsValid&&(this._restrictedEnabled=this.restrictedEnabled,this.shouldDisplayPrivacyLink(this.bundleId).catch(()=>{})),this._storefrontCountryCode=this.storefrontCountryCode,this.whenAuthCompleted=Promise.resolve(),isNodeEnvironment$1()||(this._processLocationHash(window.location.hash),"cookie"!==this.persist||(null==d?void 0:d.disableAuthBridge)||(this.authBridgeApp=new AuthBridgeApp,this.authBridgeApp.authClearedFromOtherFrame=this.revokeUserToken.bind(this),this.whenAuthCompleted=this.authBridgeApp.whenAuthCompleted.then(()=>{this.updateUserTokenFromStorage()})))}}Ge([((e=300)=>(n,d,p)=>{if(void 0===p||"function"!=typeof p.value)throw new TypeError(`Only methods can be decorated with @CachedResult, but ${d} is not a method.`);return{configurable:!0,get(){const n=p.value,h=1e3*e;let y,m=-1;function cachedResultMethod(){return _cachedResultMethod.apply(this,arguments)}function _cachedResultMethod(){return(_cachedResultMethod=_asyncToGenerator$1k((function*(...e){const d=Date.now();return(void 0===y||-1===m||m>0&&d>m+h)&&(m=d,y=yield n.apply(this,e)),y}))).apply(this,arguments)}return cachedResultMethod.updateCache=function(e){m=Date.now(),y=e},cachedResultMethod.getCachedValue=()=>y,Object.defineProperty(this,d,{value:cachedResultMethod,configurable:!0,writable:!0}),cachedResultMethod}}})(900),Be("design:type",Function),Be("design:paramtypes",[])],StoreKit.prototype,"_getIsActiveSubscription",null);var He="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:{};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,n){return e(n={exports:{}},n.exports),n.exports}var qe=createCommonjsModule((function(e){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)})),ze=createCommonjsModule((function(e){var n=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=n)}));ze.version;var _isObject=function(e){return"object"==typeof e?null!==e:"function"==typeof e},_anObject=function(e){if(!_isObject(e))throw TypeError(e+" is not an object!");return e},_fails=function(e){try{return!!e()}catch(Lr){return!0}},We=!_fails((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),Ye=qe.document,Qe=_isObject(Ye)&&_isObject(Ye.createElement),Je=!We&&!_fails((function(){return 7!=Object.defineProperty((e="div",Qe?Ye.createElement(e):{}),"a",{get:function(){return 7}}).a;var e})),Xe=Object.defineProperty,Ze={f:We?Object.defineProperty:function(e,n,d){if(_anObject(e),n=function(e,n){if(!_isObject(e))return e;var d,p;if(n&&"function"==typeof(d=e.toString)&&!_isObject(p=d.call(e)))return p;if("function"==typeof(d=e.valueOf)&&!_isObject(p=d.call(e)))return p;if(!n&&"function"==typeof(d=e.toString)&&!_isObject(p=d.call(e)))return p;throw TypeError("Can't convert object to primitive value")}(n,!0),_anObject(d),Je)try{return Xe(e,n,d)}catch(Lr){}if("get"in d||"set"in d)throw TypeError("Accessors not supported!");return"value"in d&&(e[n]=d.value),e}},et=We?function(e,n,d){return Ze.f(e,n,function(e,n){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:n}}(1,d))}:function(e,n,d){return e[n]=d,e},tt={}.hasOwnProperty,_has=function(e,n){return tt.call(e,n)},rt=0,nt=Math.random(),_uid=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++rt+nt).toString(36))},it=createCommonjsModule((function(e){var n=qe["__core-js_shared__"]||(qe["__core-js_shared__"]={});(e.exports=function(e,d){return n[e]||(n[e]=void 0!==d?d:{})})("versions",[]).push({version:ze.version,mode:"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})})),at=it("native-function-to-string",Function.toString),ot=createCommonjsModule((function(e){var n=_uid("src"),d=(""+at).split("toString");ze.inspectSource=function(e){return at.call(e)},(e.exports=function(e,p,h,y){var m="function"==typeof h;m&&(_has(h,"name")||et(h,"name",p)),e[p]!==h&&(m&&(_has(h,n)||et(h,n,e[p]?""+e[p]:d.join(String(p)))),e===qe?e[p]=h:y?e[p]?e[p]=h:et(e,p,h):(delete e[p],et(e,p,h)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[n]||at.call(this)}))})),_ctx=function(e,n,d){if(function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!")}(e),void 0===n)return e;switch(d){case 1:return function(d){return e.call(n,d)};case 2:return function(d,p){return e.call(n,d,p)};case 3:return function(d,p,h){return e.call(n,d,p,h)}}return function(){return e.apply(n,arguments)}},$export=function(e,n,d){var p,h,y,m,g=e&$export.F,b=e&$export.G,_=e&$export.S,P=e&$export.P,T=e&$export.B,S=b?qe:_?qe[n]||(qe[n]={}):(qe[n]||{}).prototype,E=b?ze:ze[n]||(ze[n]={}),k=E.prototype||(E.prototype={});for(p in b&&(d=n),d)y=((h=!g&&S&&void 0!==S[p])?S:d)[p],m=T&&h?_ctx(y,qe):P&&"function"==typeof y?_ctx(Function.call,y):y,S&&ot(S,p,y,e&$export.U),E[p]!=y&&et(E,p,m),P&&k[p]!=y&&(k[p]=y)};qe.core=ze,$export.F=1,$export.G=2,$export.S=4,$export.P=8,$export.B=16,$export.W=32,$export.U=64,$export.R=128;var st,ct,lt=$export,ut={}.toString,dt=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==function(e){return ut.call(e).slice(8,-1)}(e)?e.split(""):Object(e)},_defined=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e},_toIobject=function(e){return dt(_defined(e))},pt=Math.ceil,ht=Math.floor,_toInteger=function(e){return isNaN(e=+e)?0:(e>0?ht:pt)(e)},yt=Math.min,ft=Math.max,mt=Math.min,gt=it("keys"),vt=(st=!1,function(e,n,d){var p,h,y=_toIobject(e),m=(p=y.length)>0?yt(_toInteger(p),9007199254740991):0,g=function(e,n){return(e=_toInteger(e))<0?ft(e+n,0):mt(e,n)}(d,m);if(st&&n!=n){for(;m>g;)if((h=y[g++])!=h)return!0}else for(;m>g;g++)if((st||g in y)&&y[g]===n)return st||g||0;return!st&&-1}),bt=gt[ct="IE_PROTO"]||(gt[ct]=_uid(ct)),_t="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Pt=Object.keys||function(e){return function(e,n){var d,p=_toIobject(e),h=0,y=[];for(d in p)d!=bt&&_has(p,d)&&y.push(d);for(;n.length>h;)_has(p,d=n[h++])&&(~vt(y,d)||y.push(d));return y}(e,_t)},Tt={f:Object.getOwnPropertySymbols},St={f:{}.propertyIsEnumerable},_toObject=function(e){return Object(_defined(e))},Et=Object.assign,kt=!Et||_fails((function(){var e={},n={},d=Symbol(),p="abcdefghijklmnopqrst";return e[d]=7,p.split("").forEach((function(e){n[e]=e})),7!=Et({},e)[d]||Object.keys(Et({},n)).join("")!=p}))?function(e,n){for(var d=_toObject(e),p=arguments.length,h=1,y=Tt.f,m=St.f;p>h;)for(var g,b=dt(arguments[h++]),_=y?Pt(b).concat(y(b)):Pt(b),P=_.length,T=0;P>T;)g=_[T++],We&&!m.call(b,g)||(d[g]=b[g]);return d}:Et;lt(lt.S+lt.F,"Object",{assign:kt}),ze.Object.assign;var wt="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==wt&&wt,Ot="URLSearchParams"in wt,It="Symbol"in wt&&"iterator"in Symbol,At="FileReader"in wt&&"Blob"in wt&&function(){try{return new Blob,!0}catch(Lr){return!1}}(),Rt="FormData"in wt,Ct="ArrayBuffer"in wt;if(Ct)var Mt=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Dt=ArrayBuffer.isView||function(e){return e&&Mt.indexOf(Object.prototype.toString.call(e))>-1};function normalizeName(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function normalizeValue(e){return"string"!=typeof e&&(e=String(e)),e}function iteratorFor(e){var n={next:function(){var n=e.shift();return{done:void 0===n,value:n}}};return It&&(n[Symbol.iterator]=function(){return n}),n}function Headers$1(e){this.map={},e instanceof Headers$1?e.forEach((function(e,n){this.append(n,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(n){this.append(n,e[n])}),this)}function consumed(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function fileReaderReady(e){return new Promise((function(n,d){e.onload=function(){n(e.result)},e.onerror=function(){d(e.error)}}))}function readBlobAsArrayBuffer(e){var n=new FileReader,d=fileReaderReady(n);return n.readAsArrayBuffer(e),d}function bufferClone(e){if(e.slice)return e.slice(0);var n=new Uint8Array(e.byteLength);return n.set(new Uint8Array(e)),n.buffer}function Body(){return this.bodyUsed=!1,this._initBody=function(e){var n;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:At&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:Rt&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:Ot&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():Ct&&At&&((n=e)&&DataView.prototype.isPrototypeOf(n))?(this._bodyArrayBuffer=bufferClone(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):Ct&&(ArrayBuffer.prototype.isPrototypeOf(e)||Dt(e))?this._bodyArrayBuffer=bufferClone(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Ot&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},At&&(this.blob=function(){var e=consumed(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=consumed(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(readBlobAsArrayBuffer)}),this.text=function(){var e,n,d,p=consumed(this);if(p)return p;if(this._bodyBlob)return e=this._bodyBlob,n=new FileReader,d=fileReaderReady(n),n.readAsText(e),d;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var n=new Uint8Array(e),d=new Array(n.length),p=0;p<n.length;p++)d[p]=String.fromCharCode(n[p]);return d.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},Rt&&(this.formData=function(){return this.text().then(decode)}),this.json=function(){return this.text().then(JSON.parse)},this}Headers$1.prototype.append=function(e,n){e=normalizeName(e),n=normalizeValue(n);var d=this.map[e];this.map[e]=d?d+", "+n:n},Headers$1.prototype.delete=function(e){delete this.map[normalizeName(e)]},Headers$1.prototype.get=function(e){return e=normalizeName(e),this.has(e)?this.map[e]:null},Headers$1.prototype.has=function(e){return this.map.hasOwnProperty(normalizeName(e))},Headers$1.prototype.set=function(e,n){this.map[normalizeName(e)]=normalizeValue(n)},Headers$1.prototype.forEach=function(e,n){for(var d in this.map)this.map.hasOwnProperty(d)&&e.call(n,this.map[d],d,this)},Headers$1.prototype.keys=function(){var e=[];return this.forEach((function(n,d){e.push(d)})),iteratorFor(e)},Headers$1.prototype.values=function(){var e=[];return this.forEach((function(n){e.push(n)})),iteratorFor(e)},Headers$1.prototype.entries=function(){var e=[];return this.forEach((function(n,d){e.push([d,n])})),iteratorFor(e)},It&&(Headers$1.prototype[Symbol.iterator]=Headers$1.prototype.entries);var jt=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Request(e,n){if(!(this instanceof Request))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var d,p,h=(n=n||{}).body;if(e instanceof Request){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,n.headers||(this.headers=new Headers$1(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,h||null==e._bodyInit||(h=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=n.credentials||this.credentials||"same-origin",!n.headers&&this.headers||(this.headers=new Headers$1(n.headers)),this.method=(d=n.method||this.method||"GET",p=d.toUpperCase(),jt.indexOf(p)>-1?p:d),this.mode=n.mode||this.mode||null,this.signal=n.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&h)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(h),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==n.cache&&"no-cache"!==n.cache)){var y=/([?&])_=[^&]*/;if(y.test(this.url))this.url=this.url.replace(y,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function decode(e){var n=new FormData;return e.trim().split("&").forEach((function(e){if(e){var d=e.split("="),p=d.shift().replace(/\+/g," "),h=d.join("=").replace(/\+/g," ");n.append(decodeURIComponent(p),decodeURIComponent(h))}})),n}function Response(e,n){if(!(this instanceof Response))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');n||(n={}),this.type="default",this.status=void 0===n.status?200:n.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===n.statusText?"":""+n.statusText,this.headers=new Headers$1(n.headers),this.url=n.url||"",this._initBody(e)}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})},Body.call(Request.prototype),Body.call(Response.prototype),Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers$1(this.headers),url:this.url})},Response.error=function(){var e=new Response(null,{status:0,statusText:""});return e.type="error",e};var xt=[301,302,303,307,308];Response.redirect=function(e,n){if(-1===xt.indexOf(n))throw new RangeError("Invalid status code");return new Response(null,{status:n,headers:{location:e}})};var $t=wt.DOMException;try{new $t}catch(al){($t=function(e,n){this.message=e,this.name=n;var d=Error(e);this.stack=d.stack}).prototype=Object.create(Error.prototype),$t.prototype.constructor=$t}function fetch$1(e,n){return new Promise((function(d,p){var h=new Request(e,n);if(h.signal&&h.signal.aborted)return p(new $t("Aborted","AbortError"));var y=new XMLHttpRequest;function abortXhr(){y.abort()}y.onload=function(){var e,n,p={status:y.status,statusText:y.statusText,headers:(e=y.getAllResponseHeaders()||"",n=new Headers$1,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var d=e.split(":"),p=d.shift().trim();if(p){var h=d.join(":").trim();n.append(p,h)}})),n)};p.url="responseURL"in y?y.responseURL:p.headers.get("X-Request-URL");var h="response"in y?y.response:y.responseText;setTimeout((function(){d(new Response(h,p))}),0)},y.onerror=function(){setTimeout((function(){p(new TypeError("Network request failed"))}),0)},y.ontimeout=function(){setTimeout((function(){p(new TypeError("Network request failed"))}),0)},y.onabort=function(){setTimeout((function(){p(new $t("Aborted","AbortError"))}),0)},y.open(h.method,function(e){try{return""===e&&wt.location.href?wt.location.href:e}catch(Lr){return e}}(h.url),!0),"include"===h.credentials?y.withCredentials=!0:"omit"===h.credentials&&(y.withCredentials=!1),"responseType"in y&&(At?y.responseType="blob":Ct&&h.headers.get("Content-Type")&&-1!==h.headers.get("Content-Type").indexOf("application/octet-stream")&&(y.responseType="arraybuffer")),!n||"object"!=typeof n.headers||n.headers instanceof Headers$1?h.headers.forEach((function(e,n){y.setRequestHeader(n,e)})):Object.getOwnPropertyNames(n.headers).forEach((function(e){y.setRequestHeader(e,normalizeValue(n.headers[e]))})),h.signal&&(h.signal.addEventListener("abort",abortXhr),y.onreadystatechange=function(){4===y.readyState&&h.signal.removeEventListener("abort",abortXhr)}),y.send(void 0===h._bodyInit?null:h._bodyInit)}))}fetch$1.polyfill=!0,wt.fetch||(wt.fetch=fetch$1,wt.Headers=Headers$1,wt.Request=Request,wt.Response=Response);const Lt=new Logger("player"),Nt=new Logger("paf"),Ut=new Logger("services"),Gt=StringDevFlag.register("mk-logging-levels"),Bt=BooleanDevFlag.register("mk-console-logging"),Ft=A.ERROR;let Kt=Ft;const Vt=new Logger("mk",{level:Kt,handlers:{console:new class{get hasConsole(){return void 0!==typeof console}process(e){if(!this.enabled||!this.hasConsole)return;let n="log";if(this.mapLevels){const p=this.levelMapping.get(e.level);void 0!==(d=p)&&d in console&&(n=p)}var d,p;const h=null!==(p=e.args)&&void 0!==p?p:[],y=this.format(e);console[n](y,...h)}constructor(e={}){var n,d,p,h;this.enabled=null===(n=e.enabled)||void 0===n||n,this.mapLevels=null===(d=e.mapLevels)||void 0===d||d,this.levelMapping=null!==(p=e.levelMapping)&&void 0!==p?p:x,this.format=null!==(h=e.formatter)&&void 0!==h?h:$}}({enabled:!1}),external:new CallbackHandler(()=>{})}});function applyLoggingLevels(e){!function(e,n){walk(e,(function(e){let d;const p=e.namespace;e.clearLevel(),void 0===e.parent&&void 0!==n["*"]?d=getLoggingLevel(n["*"]):void 0!==n[p]&&(d=getLoggingLevel(n[p])),void 0!==d&&e.setLevel(d)}))}(Vt,function(e){const n=getLoggingLevel(e.trim(),{allowShorthands:!0});if(void 0!==n)return{"*":n};const d={},p=e.split(",").filter(e=>""!==e.trim());for(const b of p){var h,y;const e=b.split("=",2);if(2!==e.length)continue;var m;const n=null!==(m=null===(h=e[0])||void 0===h?void 0:h.trim())&&void 0!==m?m:"";var g;const p=getLoggingLevel(null!==(g=null===(y=e[1])||void 0===y?void 0:y.trim())&&void 0!==g?g:"",{allowShorthands:!0});""!==n&&void 0!==p&&(d[n]=p)}return d}(e))}function clearLoggingLevels(){Vt.setLevel(Kt),function(e,n={includeRoot:!0}){walk(e,(function(e){(void 0!==e.parent||n.includeRoot)&&e.clearLevel()}))}(Vt,{includeRoot:!1})}function setConsoleOutput(e){Vt.handlers.console.enabled=null!=e&&e}function setRootLoggingLevel(e){var n;Kt=null!==(n=getLoggingLevel(e))&&void 0!==n?n:Kt}const Ht={getLogger:(e="*")=>Vt.getByNamespace(null!=e?e:"*"),setConsoleOutput(e){!0===e?(Bt.enable(),setConsoleOutput(!0),Vt.info("Console output is enabled with level "+Vt.levelName)):(Bt.disable(),setConsoleOutput(!1))},setLoggingLevels(e,n){""!==e.trim()?(Gt.set(e),applyLoggingLevels(e),Ht.setConsoleOutput(null==n||n)):Ht.clearLoggingLevels(null!=n&&n)},clearLoggingLevels(e=!1){Ht.setConsoleOutput(e),Gt.clear(),clearLoggingLevels()}};Bt.enabled&&Ht.setConsoleOutput(Bt.enabled),void 0!==Gt.value&&Ht.setLoggingLevels(Gt.value,Bt.enabled);const qt=isNodeEnvironment$1();class Browser{static supportsEs6(){if("undefined"==typeof Symbol)return!1;try{new Function('"use strict";class Foo {}')(),new Function('"use strict";var bar = (x) => x+1')()}catch(Lr){return!1}return!0}constructor(e){var n;e||(e="undefined"!=typeof window&&(null===window||void 0===window||null===(n=window.navigator)||void 0===n?void 0:n.userAgent)?window.navigator.userAgent:"");const d=e.toLowerCase();this.isEdge=/\sedge\//.test(d),this.isChrome=!this.isEdge&&/chrome/.test(d),this.isSafari=!this.isEdge&&!this.isChrome&&/safari/.test(d),this.isFirefox=!this.isEdge&&!this.isChrome&&!this.isSafari&&/firefox/.test(d),this.isIE=!this.isEdge&&!this.isChrome&&!this.isSafari&&!this.isFirefox&&/trident|msie/.test(d),this.isMobile=/mobile/.test(d),this.isAndroid=/android/.test(d),this.isiOS=this.isMobile&&/iphone|ipad|ipod/.test(d),this.isMacOs=!this.isMobile&&/macintosh/.test(d),this.isWebView=/(webview|(iphone|ipod|ipad)(?!.*safari\/)|android.*(wv|\.0\.0\.0)|\bfb[\w_]+\/(?:messenger)?|\binstagram|\btwitter)/.test(d),this.isEdge?this.engineVersion=d.match(/(?:edge).(\d+)/):(this.version=d.match(/(?:chrome|version|firefox|msie|rv).(\d+)\.(\d+)/),this.engineVersion=d.match(/(?:applewebkit|gecko|trident).(\d+)/)),this.version&&(this.majorVersion=parseInt(this.version[1],10),this.minorVersion=parseInt(this.version[2],10)),this.engineVersion&&(this.engineMajorVersion=parseInt(this.engineVersion[1],10))}}const zt=new Browser;var Wt;!function(e){e.NONE="none",e.FAIRPLAY="com.apple.fps",e.PLAYREADY="com.microsoft.playready",e.WIDEVINE="com.widevine.alpha"}(Wt||(Wt={}));const Yt={app:{},features:{},urls:{}},Qt="mk-player-tsid",Jt='audio/mp4;codecs="mp4a.40.2"',Xt=document.createElement("video"),Zt=[],er=[];function deferPlayback(){fillAvailableElements("audio",er),fillAvailableElements("video",Zt),Lt.debug(`dom-helpers: defer playback called.  There are ${Zt.length} available video elements and ${er.length} available audio elements.`)}function fillAvailableElements(e,n){let d=100-n.length;for(;d>0;){const p=document.createElement(e);p.load(),n.push(p),d--}}var tr,rr,nr;function asyncGeneratorStep$1f(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$1f(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$1f(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1f(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function findMediaKeySystemAccess(e,n){return _findMediaKeySystemAccess.apply(this,arguments)}function _findMediaKeySystemAccess(){return(_findMediaKeySystemAccess=_asyncToGenerator$1f((function*(e,n){for(let d=0;d<e.length;d++)try{const p=e[d];return[p,yield navigator.requestMediaKeySystemAccess(p,n)]}catch(Lr){}return[]}))).apply(this,arguments)}!function(e){e.playbackLicenseError="playbackLicenseError",e.playbackSessionError="playbackSessionError",e.manifestParsed="manifestParsed",e.audioCodecIdentified="audioCodecIdentified",e.audioTracksSwitched="audioTracksSwitched",e.audioTracksUpdated="audioTracksUpdated",e.textTracksSwitched="textTracksSwitched",e.textTracksUpdated="textTracksUpdated",e.inlineStylesParsed="inlineStylesParsed",e.levelUpdated="levelUpdated"}(tr||(tr={})),function(e){e.MP4="audio/mp4",e.AVC1="video/mp4"}(rr||(rr={})),function(e){e.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",e.PLAYREADY="com.microsoft.playready",e.FAIRPLAY="com.apple.streamingkeydelivery"}(nr||(nr={}));let ir;const{NONE:ar,FAIRPLAY:or,WIDEVINE:sr,PLAYREADY:cr}=Wt;function supportsDrm(){if(!ir)throw new Error("findKeySystemPreference has not been invoked");return ir!==ar}function potentialKeySystemsForAccess(){return function(){const e=getSessionStorage();return!!e&&"true"===e.getItem("mk-playready-cbcs-unsupported")}()?[sr]:Yt.features["prefer-playready"]?[cr,sr]:[sr,cr]}function findKeySystemPreference(){return _findKeySystemPreference.apply(this,arguments)}function _findKeySystemPreference(){return(_findKeySystemPreference=_asyncToGenerator$1f((function*(){var e,n;if(!qt){if(null===(e=window.WebKitMediaKeys)||void 0===e?void 0:e.isTypeSupported(or+".1_0",rr.AVC1))ir=or;else if(null===(n=window.MSMediaKeys)||void 0===n?void 0:n.isTypeSupported(cr,rr.AVC1))ir=cr;else{const e=Xt;if(hasMediaKeySupport()&&e.canPlayType('video/mp4;codecs="avc1.42E01E"')&&e.canPlayType(Jt)){const e=[{initDataTypes:["keyids","cenc"],distinctiveIdentifier:"optional",persistentState:"required",videoCapabilities:[{contentType:'video/mp4;codecs="avc1.42E01E"',robustness:"SW_SECURE_CRYPTO"}],audioCapabilities:[{contentType:Jt}]}],n=potentialKeySystemsForAccess(),[d]=yield findMediaKeySystemAccess(n,e);ir=d}}return ir=null!=ir?ir:ar,ir}ir=ar}))).apply(this,arguments)}function hasMediaKeySupport(){return!!(navigator&&navigator.requestMediaKeySystemAccess&&window.MediaKeys&&window.MediaKeySystemAccess)}const AsyncDebounce=(e=100,n)=>(d,p,h)=>{const y=h.value,m=asyncDebounce(y,e,n);h.value=m},asyncDebounce=(e,n=250,d={isImmediate:!1})=>{let p,h;function fulfill(e){return null==e?void 0:e.resolve(d.cancelledValue)}const clearLastPromise=()=>{p&&(p.resolved||(fulfill(p),p.timeoutId&&clearTimeout(p.timeoutId)),p=void 0)},invokeFn=(n,d,h,y)=>{e.apply(n,y).then(e=>{d(e),p&&(p.resolved=!0)}).catch(h)};return d.isImmediate?function(...e){const d=Date.now(),y=this;return h&&d>=h&&clearLastPromise(),h=Date.now()+n,p?fulfill(Promise):new Promise((n,d)=>{p={resolve:n,reject:d},invokeFn(y,n,d,e)})}:function(...e){const d=this;return p&&clearLastPromise(),new Promise((function(h,y){const m=setTimeout(invokeFn.bind(void 0,d,h,y,e),n);p={resolve:h,reject:y,timeoutId:m}}))}};let isMergeableObject=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){let n=Object.prototype.toString.call(e);return"[object RegExp]"===n||"[object Date]"===n||function(e){return e.$$typeof===lr}(e)}(e)};let lr="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function cloneUnlessOtherwiseSpecified(e,n){return!1!==n.clone&&n.isMergeableObject(e)?deepmerge((d=e,Array.isArray(d)?[]:{}),e,n):e;var d}function defaultArrayMerge(e,n,d){return e.concat(n).map((function(e){return cloneUnlessOtherwiseSpecified(e,d)}))}function getKeys(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(n){return e.propertyIsEnumerable(n)})):[]}(e))}function mergeObject(e,n,d){let p={};return d.isMergeableObject(e)&&getKeys(e).forEach((function(n){p[n]=cloneUnlessOtherwiseSpecified(e[n],d)})),getKeys(n).forEach((function(h){d.isMergeableObject(n[h])&&e[h]?p[h]=function(e,n){if(!n.customMerge)return deepmerge;let d=n.customMerge(e);return"function"==typeof d?d:deepmerge}(h,d)(e[h],n[h],d):p[h]=cloneUnlessOtherwiseSpecified(n[h],d)})),p}function deepmerge(e,n,d){(d=d||{}).arrayMerge=d.arrayMerge||defaultArrayMerge,d.isMergeableObject=d.isMergeableObject||isMergeableObject;let p=Array.isArray(n);return p===Array.isArray(e)?p?d.arrayMerge(e,n,d):mergeObject(e,n,d):cloneUnlessOtherwiseSpecified(n,d)}function _defineProperty$O(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$O(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$O(e,n,d[n])}))}return e}function _objectSpreadProps$x(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}function _objectWithoutProperties$4(e,n){if(null==e)return{};var d,p,h=function(e,n){if(null==e)return{};var d,p,h={},y=Object.keys(e);for(p=0;p<y.length;p++)d=y[p],n.indexOf(d)>=0||(h[d]=e[d]);return h}(e,n);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(p=0;p<y.length;p++)d=y[p],n.indexOf(d)>=0||Object.prototype.propertyIsEnumerable.call(e,d)&&(h[d]=e[d])}return h}var ur;deepmerge.all=function(e,n){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,d){return deepmerge(e,d,n)}),{})},function(e){e.dataRecordDidDelete="dataRecordDidDelete",e.dataRecordWillDelete="dataRecordWillDelete",e.dataRecordDidMaterialize="dataRecordDidMaterialize",e.dataRecordDidPopulate="dataRecordDidPopulate",e.dataRecordWillPopulate="dataRecordWillPopulate"}(ur||(ur={}));const isDataRecord=e=>!(!e||"function"!=typeof e.hasAttributes||"function"!=typeof e.hasRelationships||"function"!=typeof e.hasViews||"function"!=typeof e.serialize);class DataRecord{hasProperties(e){return!e||(e.attributes||e.relationships||e.views?!(e.attributes&&!this.hasAttributes(e.attributes))&&(!(e.relationships&&!this.hasRelationships(e.relationships))&&!(e.views&&!this.hasViews(e.views))):this.hasAttributes()||this.hasRelationships()||this.hasViews())}hasAttributes(e){return this._hasProperties(this._mjs.attributes,e)}hasRelationships(e){return this._hasProperties(this._mjs.relationships,e)}hasViews(e){return this._hasProperties(this._mjs.views,e)}meta(e){return e?this._meta[e]:this._meta}serialize(e=!0,n={},d={}){const p={id:this.id,type:this.type};return n[`${this.type}-${this.id}`]&&!d.allowFullDuplicateSerializations?p:(n[`${this.type}-${this.id}`]=!0,this.hasAttributes()&&(p.attributes=this._mjs.attributes.reduce((e,n)=>(e[n]=this[n],e),{})),this._mjs.relationships.length>0&&(p.relationships=this._serializeRelatedData(this._mjs.relationships,n,d)),this._mjs.views.length>0&&(p.views=this._serializeRelatedData(this._mjs.views,n,d)),e?{data:p}:p)}setProperty(e,n,d="attributes",p={}){function isMergeableObject(e){return!(!e||"object"!=typeof e||e instanceof DataRecord)}hasOwn(this,e)||(this._mjs[d]||(this._mjs[d]=[]),this._mjs[d].push(e));const setDescriptor=e=>({value:e,writable:!0,configurable:!0,enumerable:!0});this[e]&&n&&"object"==typeof this[e]&&"object"==typeof n?"attributes"===d?Object.defineProperty(this,e,setDescriptor(deepmerge(this[e],n,{arrayMerge:function(e,n,d){return n},isMergeableObject:isMergeableObject}))):"relationships"===d&&Array.isArray(this[e])&&p.extendRelationships?Object.defineProperty(this,e,setDescriptor(deepmerge(this[e],n,{isMergeableObject:isMergeableObject}))):Object.defineProperty(this,e,setDescriptor(n)):Object.defineProperty(this,e,setDescriptor(n))}removeRelative(e,n){this[e]&&(Array.isArray(this[e])?this[e]=this[e].filter(e=>e.id!==n):delete this[e])}setParent(e){const n=this._mjs.parents,d=n&&n.length>0;this._mjs.parents=d?n.concat(e):e}_hasProperties(e,n){return!!e&&(n?ensureArray(n).every(n=>e.includes(n)):e.length>0)}_serializeRelatedData(e,n={},d={}){return e.reduce((e,p)=>{if(d.excludeRelationships&&d.excludeRelationships.has(p))return e;if(d.includeRelationships&&!d.includeRelationships.has(p))return e;const h=this[p];return Array.isArray(h)?e[p]={data:h.map(e=>"function"==typeof e.serialize?e.serialize(!1,n,d):e)}:e[p]=h&&"function"==typeof h.serialize?h.serialize(!1,n,d):h,e},{})}constructor(e,n,d={}){this.type=e,this.id=n,this._mjs={attributes:[],relationships:[],views:[]},this._meta={},this._mjs=_objectSpread$O({},this._mjs,d)}}class DataStore extends Notifications{get mapping(){return this._mapping}set mapping(e){this._mapping=e}clear(){this._records={},this._expiryRecords=new Set}peek(e,n,d){if(this._checkForExpiredRecords(),!this._records[e])return n?null:[];if(!n)return Object.values(this._records[e]);if(Array.isArray(n))return n.map(n=>{const p=this._records[e][n];if(p&&p.hasProperties(d))return p});const p=this._records[e][n];return p&&p.hasProperties(d)?p:null}populateDataRecords(e,n={},d={}){if(!e.data)return[];if(!Array.isArray(e.data))return this.populateDataRecord(e.data,n,d);const p=[];return e.data.forEach((e,h)=>{const y=_objectSpreadProps$x(_objectSpread$O({},d),{parents:d.parents?[_objectSpreadProps$x(_objectSpread$O({},d.parents[0]),{position:h})]:[]});d.parents&&(d.parents[0].position=h);const m=this.populateDataRecord(e,n,y);p.push(m)}),p}populateDataRecord(e,n={},d){const p=d.filter||this.filter,h=d.mapping||this.mapping;if(p&&!p(e))return;if(h){let n="function"==typeof h?h(e):transform$9(h,e);Object.assign(e,n)}this._shouldDisableRecordReuse&&(n={});const y=this._materializeRecord(n,_objectSpread$O({id:e.id,type:e.type},d));return e.meta&&(y._meta=e.meta),e.attributes&&e.attributes.cachingPolicy&&e.attributes.cachingPolicy.maxAge&&(y._mjs.expiration=Date.now()+1e3*e.attributes.cachingPolicy.maxAge,this._removeOnExpiration&&this._expiryRecords.add(y)),this._populateDataAttributes(e,y),"object"==typeof e.relationships&&Object.keys(e.relationships).forEach(p=>{let m=e.relationships[p];m&&"data"in m&&(m=this.populateDataRecords(m,n,{mapping:h,parents:[{relationshipName:p,parentType:y.type,parentId:y.id}]}),y.setProperty(p,m,"relationships",d))}),"object"==typeof e.views&&Object.keys(e.views).forEach(d=>{const p=e.views[d];if(p.attributes||p.data){const e=new DataRecord("view",d);if(this._populateDataAttributes(p,e),p.data){const d=this.populateDataRecords(p,n,h);e.setProperty("data",d,"relationships")}y.setProperty(d,e,"views")}}),y}query(e,n){this._checkForExpiredRecords();let includeRecord=e=>!1;return"string"==typeof e&&n?includeRecord=d=>(null==d?void 0:d[e])===n:"function"==typeof e?includeRecord=n=>{try{return e(n)}catch(Lr){return!1}}:"object"==typeof e&&(includeRecord=n=>{const d=Object.keys(e);let p=0;return d.forEach(d=>{(null==n?void 0:n[d])===e[d]&&p++}),d.length===p}),Object.values(this._records).reduce((e,n)=>(Object.values(n).forEach(n=>{includeRecord(n)&&e.push(n)}),e),[])}remove(e,n){setTimeout(this._checkForExpiredRecords.bind(this),0);if(!hasOwn(this._records,e))return;const d=this.peek(e,n);d&&(this.dispatchEvent(ur.dataRecordWillDelete,[e,n]),d._mjs.parents&&d._mjs.parents.length>0&&d._mjs.parents.forEach(({relationshipName:e,parentType:n,parentId:p})=>{this.peek(n,p).removeRelative(e,d.id)}),delete this._records[e][n],this.dispatchEvent(ur.dataRecordDidDelete,[e,n]))}save(e,n={}){return setTimeout(this._checkForExpiredRecords.bind(this),0),this.populateDataRecords(e,this._records,n)}_populateDataAttributes(e,n){"object"==typeof e.attributes&&(this.dispatchEvent(ur.dataRecordWillPopulate,[n.type,n.id]),Object.keys(e.attributes).forEach(d=>{n.setProperty(d,e.attributes[d],"attributes")}),this.dispatchEvent(ur.dataRecordDidPopulate,[n.type,n.id]))}_materializeRecord(e,n){const{type:d,id:p}=n,h=_objectWithoutProperties$4(n,["type","id"]);return e[d]=e[d]||{},e[d][p]?e[d][p].setParent(h.parents||[]):e[d][p]=new DataRecord(d,p,h),this.dispatchEvent(ur.dataRecordDidMaterialize,[d,p]),e[d][p]}_checkForExpiredRecords(){const e=[];this._expiryRecords.forEach(n=>{Date.now()>n._mjs.expiration&&(e.push([n.type,n.id]),this._expiryRecords.delete(n))}),e.forEach(e=>{this.remove(...e)})}constructor(e={}){super([ur.dataRecordDidDelete,ur.dataRecordWillDelete,ur.dataRecordDidMaterialize,ur.dataRecordWillPopulate,ur.dataRecordDidPopulate]),this._removeOnExpiration=!1,this._shouldDisableRecordReuse=!0,this._records={},this._expiryRecords=new Set,this._removeOnExpiration=!!e.removeOnExpiration,this._mapping=e.mapping,this._shouldDisableRecordReuse=!!e.shouldDisableRecordReuse,this.filter=e.filter}}function deprecationWarning(e,n={}){var d;const p=null!==(d=n.message)&&void 0!==d?d:e+" has been deprecated",h=[];n.since&&h.push("since: "+n.since),n.until&&h.push("until: "+n.until),console.warn("Deprecation Warning: "+p+(h.length>0?` (${h.join(", ")})`:""))}class PubSub{publish(e,n){const d=this.getSubscribersForType(e);void 0!==d&&d.forEach(d=>{d(e,n)})}subscribe(e,n){this.getSubscribersForType(e,!0).push(n)}subscribeOnce(e,n){const onceCallback=(e,d)=>{this.unsubscribe(e,onceCallback),n(e,d)};this.subscribe(e,onceCallback)}unsubscribe(e,n){const d=this.getSubscribersForType(e);if(void 0!==d)for(const p in d)if(d[p]===n){delete d[p];break}}clear(e){void 0===e?this.events={}:delete this.events[e]}getSubscribersForType(e,n=!1){return!this.events.hasOwnProperty(e)&&n&&(this.events[e]=[]),this.events[e]}constructor(){this.events={}}}function asyncGeneratorStep$1e(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$1e(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$1e(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1e(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}const dr={},SerialAsync=e=>{let n=Promise.resolve();return(d,p,h)=>{const y=h.value;return h.value=_asyncToGenerator$1e((function*(...d){return e&&(n=(e=>{let n=dr[e];return n||(n=Promise.resolve(),dr[e]=n),n})(e)),n=n.catch(()=>{}).then(()=>y.apply(this,d)),e&&(dr[e]=n),n})),h}};var pr,hr,yr;e.PlaybackBitrate=void 0,(pr=e.PlaybackBitrate||(e.PlaybackBitrate={}))[pr.STANDARD=64]="STANDARD",pr[pr.HIGH=256]="HIGH",function(e){e.apiStorefrontChanged="apiStorefrontChanged",e.hlsLevelUpdated="hlsLevelUpdated",e.mediaContentComplete="mediaContentComplete",e.playbackPause="playbackPause",e.playbackPlay="playbackPlay",e.playbackScrub="playbackScrub",e.playbackSeek="playbackSeek",e.playbackSkip="playbackSkip",e.playbackStop="playbackStop",e.lyricsPlay="lyricsPlay",e.lyricsStop="lyricsStop",e.playerActivate="playerActivate",e.playerExit="playerExit",e.queueModified="queueModified",e.userActivityIntent="userActivityIntent",e.applicationActivityIntent="applicationActivityIntent"}(hr||(hr={})),function(e){e[e.ACCURATE=0]="ACCURATE",e[e.ROUND=1]="ROUND"}(yr||(yr={}));class TimingAccuracy{time(e=0){return this.mode===yr.ROUND?Math.round(e):e}constructor(e=!1){this.mode=e?yr.ACCURATE:yr.ROUND}}const fr={audioTrackAdded:"audioTrackAdded",audioTrackChanged:"audioTrackChanged",audioTrackRemoved:"audioTrackRemoved",bufferedProgressDidChange:"bufferedProgressDidChange",drmUnsupported:"drmUnsupported",forcedTextTrackChanged:"forcedTextTrackChanged",mediaCanPlay:"mediaCanPlay",mediaElementCreated:"mediaElementCreated",mediaPlaybackError:"mediaPlaybackError",nowPlayingItemDidChange:"nowPlayingItemDidChange",nowPlayingItemWillChange:"nowPlayingItemWillChange",metadataDidChange:"metadataDidChange",playbackBitrateDidChange:"playbackBitrateDidChange",playbackDurationDidChange:"playbackDurationDidChange",playbackProgressDidChange:"playbackProgressDidChange",playbackRateDidChange:"playbackRateDidChange",playbackStateDidChange:"playbackStateDidChange",playbackStateWillChange:"playbackStateWillChange",playbackTargetAvailableDidChange:"playbackTargetAvailableDidChange",playbackTargetIsWirelessDidChange:"playbackTargetIsWirelessDidChange",playbackTimeDidChange:"playbackTimeDidChange",playbackVolumeDidChange:"playbackVolumeDidChange",playerTypeDidChange:"playerTypeDidChange",presentationModeDidChange:"presentationModeDidChange",primaryPlayerDidChange:"primaryPlayerDidChange",textTrackAdded:"textTrackAdded",textTrackChanged:"textTrackChanged",textTrackRemoved:"textTrackRemoved",timedMetadataDidChange:"timedMetadataDidChange"};class BitrateCalculator{get bitrate(){return this._bitrate}set bitrate(e){this._bitrate!==e&&(this._bitrate=e,this._dispatcher.publish(fr.playbackBitrateDidChange,{bitrate:e}))}_calculateAverageDownlink(){return 0===this._downlinkSamples.length?0:this._downlinkSamples.reduce((e,n)=>e+n,0)/this._downlinkSamples.length||0}_recalculateBitrate(n){Lt.debug("_recalculateBitrate",n),this._downlinkSamples.push(n);this._calculateAverageDownlink()>e.PlaybackBitrate.STANDARD?(Lt.debug("setting bitrate to",e.PlaybackBitrate.HIGH),this.bitrate=e.PlaybackBitrate.HIGH):(Lt.debug("setting bitrate to",e.PlaybackBitrate.STANDARD),this.bitrate=e.PlaybackBitrate.STANDARD)}constructor(n,d=e.PlaybackBitrate.STANDARD){var p,h;this._downlinkSamples=[],this._bitrate=d,this._dispatcher=n,void 0!==(null===window||void 0===window||null===(p=window.navigator)||void 0===p||null===(h=p.connection)||void 0===h?void 0:h.downlink)&&this._recalculateBitrate(100*(window.navigator.connection.downlink||0))}}var mr,gr,vr,br,_r,Pr,Tr;!function(e){e.MUSICKIT="music_kit-integration",e.OTHER="other",e.MINI="mini",e.SONG="song",e.ALBUM="album",e.ALBUM_CLASSICAL="album-classical",e.ARTIST="artist",e.COMPILATION="compilation",e.COMPILATION_CLASSICAL="compilation-classical",e.PLAYLIST="playlist",e.PLAYLIST_CLASSICAL="playlist-classical",e.RADIO="radio",e.SEARCH="search",e.STATION="station"}(mr||(mr={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.RADIO=1]="RADIO",e[e.PLAYLIST=2]="PLAYLIST",e[e.ALBUM=3]="ALBUM",e[e.ARTIST=4]="ARTIST"}(gr||(gr={})),e.PlayActivityEndReasonType=void 0,(vr=e.PlayActivityEndReasonType||(e.PlayActivityEndReasonType={}))[vr.NOT_APPLICABLE=0]="NOT_APPLICABLE",vr[vr.OTHER=1]="OTHER",vr[vr.TRACK_SKIPPED_FORWARDS=2]="TRACK_SKIPPED_FORWARDS",vr[vr.PLAYBACK_MANUALLY_PAUSED=3]="PLAYBACK_MANUALLY_PAUSED",vr[vr.PLAYBACK_SUSPENDED=4]="PLAYBACK_SUSPENDED",vr[vr.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM=5]="MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM",vr[vr.PLAYBACK_PAUSED_DUE_TO_INACTIVITY=6]="PLAYBACK_PAUSED_DUE_TO_INACTIVITY",vr[vr.NATURAL_END_OF_TRACK=7]="NATURAL_END_OF_TRACK",vr[vr.PLAYBACK_STOPPED_DUE_TO_SESSION_TIMEOUT=8]="PLAYBACK_STOPPED_DUE_TO_SESSION_TIMEOUT",vr[vr.TRACK_BANNED=9]="TRACK_BANNED",vr[vr.FAILED_TO_LOAD=10]="FAILED_TO_LOAD",vr[vr.PAUSED_ON_TIMEOUT=11]="PAUSED_ON_TIMEOUT",vr[vr.SCRUB_BEGIN=12]="SCRUB_BEGIN",vr[vr.SCRUB_END=13]="SCRUB_END",vr[vr.TRACK_SKIPPED_BACKWARDS=14]="TRACK_SKIPPED_BACKWARDS",vr[vr.NOT_SUPPORTED_BY_CLIENT=15]="NOT_SUPPORTED_BY_CLIENT",vr[vr.QUICK_PLAY=16]="QUICK_PLAY",vr[vr.EXITED_APPLICATION=17]="EXITED_APPLICATION",function(e){e[e.Manual=0]="Manual",e[e.Interval=1]="Interval",e[e.SkipIntro=2]="SkipIntro"}(br||(br={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.NO_RIGHTS=1]="NO_RIGHTS",e[e.PURCHASED=2]="PURCHASED",e[e.UPLOADED=3]="UPLOADED",e[e.MATCHED=4]="MATCHED",e[e.ADDED=5]="ADDED",e[e.SUBSCRIBED=6]="SUBSCRIBED",e[e.NOT_SUPPORTED=7]="NOT_SUPPORTED"}(_r||(_r={})),function(e){e[e.NO_SELECTION_PLAY=0]="NO_SELECTION_PLAY",e[e.RESUME_LAST_PLAYED_SONG=1]="RESUME_LAST_PLAYED_SONG",e[e.RESUME_CURRENT_DEVICE_POSITION=2]="RESUME_CURRENT_DEVICE_POSITION"}(Pr||(Pr={})),function(e){e[e.NOT_APPLICABLE=0]="NOT_APPLICABLE",e[e.SIMILARITIES=1]="SIMILARITIES",e[e.ESSENTIALS=2]="ESSENTIALS",e[e.USER_LIBRARY=3]="USER_LIBRARY",e[e.ALGO_HEATSEEKER=4]="ALGO_HEATSEEKER",e[e.SEED_TRACK=5]="SEED_TRACK",e[e.GN_1M_TEMPORARY=6]="GN_1M_TEMPORARY",e[e.VECTOR=8]="VECTOR",e[e.ARTIST_SIMILARITIES=9]="ARTIST_SIMILARITIES",e[e.STORY_ALBUM_LISTENERS_ALSO_BOUGHT=10]="STORY_ALBUM_LISTENERS_ALSO_BOUGHT",e[e.STORY_ALBUM_SALES_LEADER=11]="STORY_ALBUM_SALES_LEADER",e[e.STORY_BILLBOARD=12]="STORY_BILLBOARD",e[e.STORY_COMPLETE_MY_ALBUM=13]="STORY_COMPLETE_MY_ALBUM",e[e.STORY_CRITICAL_PICK=14]="STORY_CRITICAL_PICK",e[e.STORY_ITUNES_ESSENTIAL=15]="STORY_ITUNES_ESSENTIAL",e[e.STORY_HEATSEEKER=16]="STORY_HEATSEEKER",e[e.STORY_IDENTITY=17]="STORY_IDENTITY",e[e.STORY_POWER_SONG=18]="STORY_POWER_SONG",e[e.STORY_SONG_SALES_LEADER=20]="STORY_SONG_SALES_LEADER",e[e.GENRE_SIMILARITIES=21]="GENRE_SIMILARITIES",e[e.STORY_IMIX=22]="STORY_IMIX",e[e.STORY_OTHER_MIX=23]="STORY_OTHER_MIX",e[e.EDITORIAL=24]="EDITORIAL",e[e.TOP_SONGS=25]="TOP_SONGS",e[e.SUBFORMAT_SONGS=26]="SUBFORMAT_SONGS",e[e.CRITICAL_PICKS=27]="CRITICAL_PICKS",e[e.US_ARTIST_SIMS=28]="US_ARTIST_SIMS",e[e.HEAVY_ROTATION=29]="HEAVY_ROTATION",e[e.STORY_FORMAT_STATION_HEAVY_ROTATION=30]="STORY_FORMAT_STATION_HEAVY_ROTATION",e[e.ARTIST_BASED_CORE_SIMILAR_ARTISTS=31]="ARTIST_BASED_CORE_SIMILAR_ARTISTS",e[e.ARTIST_BASED_FAMILIAR_SIMILAR_ARTISTS=32]="ARTIST_BASED_FAMILIAR_SIMILAR_ARTISTS",e[e.ARTIST_BASED_DISCOVERIES=33]="ARTIST_BASED_DISCOVERIES",e[e.ARTIST_BASED_HOT_SONGS=34]="ARTIST_BASED_HOT_SONGS",e[e.ARTIST_BASED_SEED_ARTIST=35]="ARTIST_BASED_SEED_ARTIST",e[e.ARTIST_BASED_COMPOSER=36]="ARTIST_BASED_COMPOSER",e[e.EDITORIAL_STATION_INTRO=37]="EDITORIAL_STATION_INTRO",e[e.EDITORIAL_RELATIVE_REPEAT=38]="EDITORIAL_RELATIVE_REPEAT",e[e.EDITORIAL_ABSOLUTE_REPEAT=39]="EDITORIAL_ABSOLUTE_REPEAT",e[e.EDITORIAL_SCHEDULED=40]="EDITORIAL_SCHEDULED",e[e.EDITORIAL_SUGGESTED_ARTIST=41]="EDITORIAL_SUGGESTED_ARTIST",e[e.FOR_YOU_FAMILIAR=42]="FOR_YOU_FAMILIAR",e[e.FOR_YOU_RECOMMENDED=43]="FOR_YOU_RECOMMENDED",e[e.FOR_YOU_FAVORITE_ARTIST=44]="FOR_YOU_FAVORITE_ARTIST",e[e.FOR_YOU_RECOMMENDED_ARTIST=45]="FOR_YOU_RECOMMENDED_ARTIST",e[e.EDITORIAL_POSITIONAL=46]="EDITORIAL_POSITIONAL",e[e.SIMILAR_SONGS=47]="SIMILAR_SONGS",e[e.SONG_ATTRIBUTE_FAVORITE_ARTIST=48]="SONG_ATTRIBUTE_FAVORITE_ARTIST",e[e.SONG_ATTRIBUTE_FAVORITE_ARTIST_DERIVED=49]="SONG_ATTRIBUTE_FAVORITE_ARTIST_DERIVED",e[e.SONG_ATTRIBUTE_FAVORITE_ARTIST_EDITORIAL=50]="SONG_ATTRIBUTE_FAVORITE_ARTIST_EDITORIAL",e[e.SONG_ATTRIBUTE_RECOMMENDED=51]="SONG_ATTRIBUTE_RECOMMENDED",e[e.SONG_ATTRIBUTE_RECOMMENDED_DERIVED=52]="SONG_ATTRIBUTE_RECOMMENDED_DERIVED",e[e.SONG_ATTRIBUTE_RECOMMENDED_EDITORIAL=53]="SONG_ATTRIBUTE_RECOMMENDED_EDITORIAL",e[e.SONG_ATTRIBUTE_NON_PERSONALIZED=54]="SONG_ATTRIBUTE_NON_PERSONALIZED",e[e.SONG_ATTRIBUTE_NON_PERSONALIZED_DERIVED=55]="SONG_ATTRIBUTE_NON_PERSONALIZED_DERIVED",e[e.SONG_ATTRIBUTE_NON_PERSONALIZED_EDITORIAL=56]="SONG_ATTRIBUTE_NON_PERSONALIZED_EDITORIAL",e[e.PERSONAL_STATION=57]="PERSONAL_STATION",e[e.PERSONAL_STATION_FAVORITE_ARTIST=58]="PERSONAL_STATION_FAVORITE_ARTIST",e[e.PERSONAL_STATION_RECOMMENDED=59]="PERSONAL_STATION_RECOMMENDED",e[e.NEW_MUSIC_STATION=60]="NEW_MUSIC_STATION",e[e.NEW_MUSIC_STATION_FAVORITE_ARTIST=61]="NEW_MUSIC_STATION_FAVORITE_ARTIST",e[e.NEW_MUSIC_STATION_RECOMMENDED=62]="NEW_MUSIC_STATION_RECOMMENDED"}(Tr||(Tr={}));var Sr,Er,kr,wr,Or,Ir,Ar,Rr,Cr,Mr,Dr,jr,xr,$r;
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */
function t(e,n){var d="function"==typeof Symbol&&e[Symbol.iterator];if(!d)return e;var p,h,y=d.call(e),m=[];try{for(;(void 0===n||n-- >0)&&!(p=y.next()).done;)m.push(p.value)}catch(e){h={error:e}}finally{try{p&&!p.done&&(d=y.return)&&d.call(y)}finally{if(h)throw h.error}}return m}!function(e){e[e.UNKNOWN_FORMAT=0]="UNKNOWN_FORMAT",e[e.STEREO=1]="STEREO",e[e.SPATIAL=2]="SPATIAL",e[e.PREFERENCE_FORMAT_UNSUPPORTED=3]="PREFERENCE_FORMAT_UNSUPPORTED"}(Sr||(Sr={})),function(e){e[e.UNKNOWN_QUALITY=0]="UNKNOWN_QUALITY",e[e.HIGH_EFFICIENCY=1]="HIGH_EFFICIENCY",e[e.HIGH_QUALITY=2]="HIGH_QUALITY",e[e.LOSSLESS=3]="LOSSLESS",e[e.HIGH_RESOLUTION_LOSSLESS=4]="HIGH_RESOLUTION_LOSSLESS",e[e.PREFERENCE_QUALITY_UNSUPPORTED=5]="PREFERENCE_QUALITY_UNSUPPORTED"}(Er||(Er={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.STATIC=1]="STATIC",e[e.LINE_BY_LINE=2]="LINE_BY_LINE",e[e.WORD_BY_WORD=3]="WORD_BY_WORD"}(kr||(kr={})),function(e){e[e.REPEAT_UNKNOWN=0]="REPEAT_UNKNOWN",e[e.REPEAT_OFF=1]="REPEAT_OFF",e[e.REPEAT_ONE=2]="REPEAT_ONE",e[e.REPEAT_ALL=3]="REPEAT_ALL"}(wr||(wr={})),function(e){e[e.SHUFFLE_UNKNOWN=0]="SHUFFLE_UNKNOWN",e[e.SHUFFLE_OFF=1]="SHUFFLE_OFF",e[e.SHUFFLE_ON=2]="SHUFFLE_ON"}(Or||(Or={})),function(e){e[e.AUTO_UNKNOWN=0]="AUTO_UNKNOWN",e[e.AUTO_OFF=1]="AUTO_OFF",e[e.AUTO_ON=2]="AUTO_ON",e[e.AUTO_ON_CONTENT_UNSUPPORTED=3]="AUTO_ON_CONTENT_UNSUPPORTED"}(Ir||(Ir={})),function(e){e[e.NOT_SPECIFIED=0]="NOT_SPECIFIED",e[e.CONTAINER_CHANGED=1]="CONTAINER_CHANGED"}(Ar||(Ar={})),function(e){e[e.PLAY_END=0]="PLAY_END",e[e.PLAY_START=1]="PLAY_START",e[e.LYRIC_DISPLAY=2]="LYRIC_DISPLAY"}(Rr||(Rr={})),function(e){e[e.INVALID=0]="INVALID",e[e.ITUNES_STORE_CONTENT=1]="ITUNES_STORE_CONTENT",e[e.NON_SONG_CLIP=2]="NON_SONG_CLIP",e[e.AD=3]="AD",e[e.STREAM=4]="STREAM",e[e.AUDIO_AD=5]="AUDIO_AD",e[e.VIDEO_AD=6]="VIDEO_AD",e[e.TIMED_METADATA_PING=7]="TIMED_METADATA_PING",e[e.ARTIST_UPLOADED_CONTENT=8]="ARTIST_UPLOADED_CONTENT",e[e.AGGREGATE_NON_CATALOG_PLAY_TIME=9]="AGGREGATE_NON_CATALOG_PLAY_TIME",e[e.ORIGINAL_CONTENT_MOVIES=10]="ORIGINAL_CONTENT_MOVIES",e[e.ORIGINAL_CONTENT_SHOWS=11]="ORIGINAL_CONTENT_SHOWS"}(Cr||(Cr={})),function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO"}(Mr||(Mr={})),function(e){e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL"}(Dr||(Dr={})),function(e){e[e.ORIGINATING_DEVICE=0]="ORIGINATING_DEVICE",e[e.PAIRED_WATCH=1]="PAIRED_WATCH",e[e.SONOS=2]="SONOS",e[e.CAR_PLAY=3]="CAR_PLAY",e[e.WEB_AUC=4]="WEB_AUC",e[e.TWITTER_AUC=5]="TWITTER_AUC",e[e.MUSIC_SDK=6]="MUSIC_SDK",e[e.ATV_REMOTE=7]="ATV_REMOTE",e[e.WEBPLAYER=8]="WEBPLAYER",e[e.WHOLE_HOUSE_AUDIO=9]="WHOLE_HOUSE_AUDIO",e[e.MUSICKIT=10]="MUSICKIT",e[e.VW=11]="VW",e[e.UNKNOWN_SOURCE_TYPE=12]="UNKNOWN_SOURCE_TYPE",e[e.AMAZON=13]="AMAZON",e[e.PORSCHE=14]="PORSCHE",e[e.CHROMECAST=15]="CHROMECAST",e[e.WEB_APP=16]="WEB_APP",e[e.MERCEDES_BENZ=17]="MERCEDES_BENZ",e[e.THIRD_PARTY_TV=18]="THIRD_PARTY_TV",e[e.SAMSUNG=18]="SAMSUNG",e[e.SEAT=19]="SEAT",e[e.CUPRA=20]="CUPRA"}(jr||(jr={})),function(e){e[e.EPISODE=1]="EPISODE",e[e.SHOUTCAST=2]="SHOUTCAST"}(xr||(xr={})),function(e){e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped"}($r||($r={}));var Lr={type:"xstate.init"};function r(e){return void 0===e?[]:[].concat(e)}function o(e){return{type:"xstate.assign",assignment:e}}function i(e,n){return"string"==typeof(e="string"==typeof e&&n&&n[e]?n[e]:e)?{type:e}:"function"==typeof e?{type:e.name,exec:e}:e}function a(e){return function(n){return e===n}}function u(e){return"string"==typeof e?{type:e}:e}function c(e,n){return{value:e,context:n,actions:[],changed:!1,matches:a(e)}}function f(e,n,d){var p=n,h=!1;return[e.filter((function(e){if("xstate.assign"===e.type){h=!0;var n=Object.assign({},p);return"function"==typeof e.assignment?n=e.assignment(p,d):Object.keys(e.assignment).forEach((function(h){n[h]="function"==typeof e.assignment[h]?e.assignment[h](p,d):e.assignment[h]})),p=n,!1}return!0})),p,h]}function s(e,n){void 0===n&&(n={});var d=t(f(r(e.states[e.initial].entry).map((function(e){return i(e,n.actions)})),e.context,Lr),2),p=d[0],h=d[1],y={config:e,_options:n,initialState:{value:e.initial,actions:p,context:h,matches:a(e.initial)},transition:function(n,d){var p,h,m="string"==typeof n?{value:n,context:e.context}:n,g=m.value,b=m.context,_=u(d),P=e.states[g];if(P.on){var T=r(P.on[_.type]);try{for(var S=function(e){var n="function"==typeof Symbol&&Symbol.iterator,d=n&&e[n],p=0;if(d)return d.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&p>=e.length&&(e=void 0),{value:e&&e[p++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(T),E=S.next();!E.done;E=S.next()){var k=E.value;if(void 0===k)return c(g,b);var w="string"==typeof k?{target:k}:k,O=w.target,I=w.actions,A=void 0===I?[]:I,R=w.cond,C=void 0===R?function(){return!0}:R,M=void 0===O,D=null!=O?O:g,j=e.states[D];if(C(b,_)){var x=t(f((M?r(A):[].concat(P.exit,A,j.entry).filter((function(e){return e}))).map((function(e){return i(e,y._options.actions)})),b,_),3),$=x[0],L=x[1],N=x[2],U=null!=O?O:g;return{value:U,context:L,actions:$,changed:O!==g||$.length>0||N,matches:a(U)}}}}catch(t){p={error:t}}finally{try{E&&!E.done&&(h=S.return)&&h.call(S)}finally{if(p)throw p.error}}}return c(g,b)}};return y}var l=function(e,n){return e.actions.forEach((function(d){var p=d.exec;return p&&p(e.context,n)}))};function v(e){var n=e.initialState,d=$r.NotStarted,p=new Set,h={_machine:e,send:function(h){d===$r.Running&&(n=e.transition(n,h),l(n,u(h)),p.forEach((function(e){return e(n)})))},subscribe:function(e){return p.add(e),e(n),{unsubscribe:function(){return p.delete(e)}}},start:function(p){if(p){var y="object"==typeof p?p:{context:e.config.context,value:p};n={value:y.value,actions:[],context:y.context,matches:a(y.value)}}return d=$r.Running,l(n,Lr),h},stop:function(){return d=$r.Stopped,p.clear(),h},get state(){return n},get status(){return d}};return h}const Nr=/(?:st|ra)\.([0-9]+)/,Ur=/st\.([0-9]+)/;function asyncGeneratorStep$1d(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _defineProperty$N(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$N(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$N(e,n,d[n])}))}return e}function _objectSpreadProps$w(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}function _objectWithoutProperties$3(e,n){if(null==e)return{};var d,p,h=function(e,n){if(null==e)return{};var d,p,h={},y=Object.keys(e);for(p=0;p<y.length;p++)d=y[p],n.indexOf(d)>=0||(h[d]=e[d]);return h}(e,n);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(p=0;p<y.length;p++)d=y[p],n.indexOf(d)>=0||Object.prototype.propertyIsEnumerable.call(e,d)&&(h[d]=e[d])}return h}const toTimeMeasuredData=e=>{var{timestamp:n}=e;return _objectSpreadProps$w(_objectSpread$N({},_objectWithoutProperties$3(e,["timestamp"])),{"milliseconds-since-play":Date.now()-n})};class PlayActivitySender{get accessToken(){return invoke(this._accessToken)}get musicUserToken(){return invoke(this._musicUserToken)}get url(){return this._isQA?"https://universal-activity-service.itunes.apple.com/qa/play":"https://universal-activity-service.itunes.apple.com/play"}send(e){var n,d=this;return(n=function*(){const n={client_id:d._clientId,event_type:d._eventType,data:ensureArray(e).map(toTimeMeasuredData)};if(0===n.data.length)throw new Error("send() called without any data");const p=d._generateFetchOptions({method:"POST",body:JSON.stringify(n),headers:d.headers()});return yield d._fetch(d.url,p),d._logInfo&&console.info("play activity:",d._sourceType===jr.AMAZON?JSON.stringify(n):n),n},function(){var e=this,d=arguments;return new Promise((function(p,h){var y=n.apply(e,d);function _next(e){asyncGeneratorStep$1d(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1d(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))})()}baseHeaders(){var e,n;const d=null!==(n=null===(e=this._fetchOptions)||void 0===e?void 0:e.headers)&&void 0!==n?n:{};return d instanceof this._headersClass?new this._headersClass(Array.from(d.entries())):new this._headersClass(d)}headers(){const e=this._preferDSID?"X-Dsid":"media-user-token",n=this.baseHeaders();return n.set("Authorization","Bearer "+this.accessToken),n.set("Content-Type","application/json"),n.set(e,""+this.musicUserToken),this._isQA&&void 0!==this._traceTag&&n.set("Data-Trace-Tag",this._traceTag),n}_generateFetchOptions(e){return _objectSpread$N({},this._fetchOptions,e)}constructor(e){var n,d,p,h;this.mode=Dr.AUTO,this._isQA=!1,this._logInfo=!1,this._preferDSID=!1,this._accessToken=e.accessToken,this._clientId=e.clientId,this._eventType=e.eventType,this._fetch=null!==(n=e.fetch)&&void 0!==n?n:fetch,this._fetchOptions=null!==(d=e.fetchOptions)&&void 0!==d?d:{},this._headersClass=null!==(p=e.headersClass)&&void 0!==p?p:Headers,this._isQA=null!==(h=e.isQA)&&void 0!==h&&h,this._logInfo=e.logInfo||this._isQA,this._musicUserToken=e.musicUserToken,this._preferDSID=e.preferDSID,this._sourceType=e.sourceType,this._traceTag=e.traceTag}}const fullAppId=(e,n)=>{if(void 0===(null==n?void 0:n.name))return"MusicKitApp/1.0";if(void 0!==e)return e;return`${function(e){return e.toLowerCase().replace(/[-_]+/g," ").replace(/[^\w\s]/g,"").replace(/\b./g,e=>e.toUpperCase()).replace(/\s/g,"")}(n.name)}/${(null==n?void 0:n.version)||"1.0"}`},os=e=>{var n,d;const p=e.toLowerCase();let h,y="Unidentified OS";const m=/mobile/.test(p);var g;m&&/android|adr/.test(p)?(y="Android",h=p.match(/(?:android|adr)\ ((\d+[._])+\d+)/)):m&&/iphone|ipad|ipod/.test(p)?(y="iOS",h=p.match(/os\ ((\d+[._])+\d+)\ like\ mac\ os\ x/)):/tizen/.test(p)?(y="Tizen",h=p.match(/tizen (.*)/)):/web0s|webos/.test(p)?(y="WebOS",h=p.match(/[web0s|webos] (.*)/)):!m&&/cros/.test(p)?y="ChromeOS":!m&&/macintosh/.test(p)?(y="macOS",h=p.match(/os\ x\ ((\d+[._])+\d+)\b/)):!m&&/linux/.test(p)?y="Linux":!m&&/windows/.test(p)&&(y="Windows",h=p.match(/windows ([^\)]*)/));return`${y}/${null!==(g=null==h||null===(n=h[1])||void 0===n||null===(d=n.replace)||void 0===d?void 0:d.call(n,/_/g,"."))&&void 0!==g?g:"0.0"}`},model=e=>"model/"+((null==e?void 0:e.platform)||"Unavailable"),build=e=>{const n=null==e?void 0:e.build;return void 0===n||""===n?"build/0.0.0":"build/"+n};function asyncGeneratorStep$1c(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _defineProperty$M(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$M(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$M(e,n,d[n])}))}return e}function _objectSpreadProps$v(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}const Gr={platform:"",userAgent:""};class PlayActivityBase{get accessToken(){return invoke(this._accessToken)}get appID(){return void 0===this._appId&&(this._appId=fullAppId(this._appId,this._appInfo)),this._appId}get deviceName(){return this._deviceName}get musicUserToken(){return invoke(this._musicUserToken)}get navigator(){var e;return null!==(e=this._navigator)&&void 0!==e?e:"undefined"==typeof navigator?Gr:navigator}get storefrontId(){return invoke(this._storefrontId)}get userAgent(){var e;return null!==(e=this._userAgent)&&void 0!==e?e:this.navigator.userAgent}get userIsSubscribed(){return invoke(this._userIsSubscribed)}get allowReportingId(){return invoke(this._allowReportingId)}get utcOffsetInSeconds(){if(void 0===this._utcOffsetInSeconds&&void 0!==this._utcOffset&&!isNaN(this._utcOffset)){const e=60*this._utcOffset;this._utcOffsetInSeconds=e<=0?Math.abs(e):-e}return void 0===this._utcOffsetInSeconds||isNaN(this._utcOffsetInSeconds)?-1:this._utcOffsetInSeconds}send(e){var n,d=this;return(n=function*(){return d.sender.send(e)},function(){var e=this,d=arguments;return new Promise((function(p,h){var y=n.apply(e,d);function _next(e){asyncGeneratorStep$1c(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1c(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))})()}buildDescriptorForPlayParams(e,n,d,p,h){const y="stream"===e.format?Cr.STREAM:Cr.ITUNES_STORE_CONTENT;return _objectSpread$M(_objectSpreadProps$v(_objectSpread$M({},e),{container:d,duration:null!=p?p:0,eventType:n,itemType:y}),h)}buildForPlayParams(e,n,d,p=0,h={},y=!1){return this.build(this.buildDescriptorForPlayParams(e,n,d,p,h),y)}constructor(e,n,d,p){var h,y,m,g;(this._accessToken=e,this._musicUserToken=n,this._storefrontId=d,this.privateEnabled=!1,this.siriInitiated=!1,this.clientId="JSCLIENT",this.eventType="JSPLAY",this.internalBuild=!1,this.preferDSID=!1,this.sourceType=jr.MUSICKIT,this._utcOffset=(new Date).getTimezoneOffset(),this._userIsSubscribed=!0,this._allowReportingId=!1,p)&&(this._appInfo=p.app,this._navigator=p.navigator,this._userAgent=p.userAgent,hasOwn(p,"utcOffset")&&isNaN(p.utcOffset)?this._utcOffsetInSeconds=-1:hasOwn(p,"utcOffset")&&(this._utcOffset=p.utcOffset),this.clientId=p.clientId||"JSCLIENT",this._deviceName=p.deviceName,this.guid=p.guid,this.metricsClientId=p.metricsClientId,this.preferDSID=null!==(y=p.preferDSID)&&void 0!==y&&y,this.sourceType=void 0!==p.sourceType&&"number"==typeof p.sourceType?p.sourceType:jr.MUSICKIT,this._userIsSubscribed=null===(m=p.userIsSubscribed)||void 0===m||m,this._allowReportingId=null!==(g=p.allowReportingId)&&void 0!==g&&g);this.buildVersion=((e,n,d,p)=>[fullAppId(e,n),os(p),model(d),build(n)].join(" "))(this._appId,this._appInfo,this.navigator,this.userAgent),this.sender=new PlayActivitySender({accessToken:this._accessToken,clientId:this.clientId,eventType:this.eventType,fetch:null==p?void 0:p.fetch,fetchOptions:null==p?void 0:p.fetchOptions,headersClass:null==p||null===(h=p.fetch)||void 0===h?void 0:h.Headers,isQA:null==p?void 0:p.isQA,logInfo:null==p?void 0:p.logInfo,musicUserToken:this._musicUserToken,preferDSID:this.preferDSID,sourceType:this.sourceType,traceTag:null==p?void 0:p.traceTag})}}const DEFAULT_CACHE_KEY_FUNCTION=(e,n)=>`${n}${e}`;class NetworkCache{getItem(e){const n=this.cacheKeyForPath(e),d=this.storage.getItem(n);if(null!==d){const{x:e,d:p}=JSON.parse(d);if(e>Date.now())return p;this.storage.removeItem(n)}}setItem(e,n,d=this.ttl){const p=this.cacheKeyForPath(e);this.storage.setItem(p,JSON.stringify({x:Date.now()+d,d:n}))}removeItem(e){const n=this.cacheKeyForPath(e);this.storage.removeItem(n)}removeItemsMatching(e,n=!0){const d=this.cacheKeyForPath(e);this.removeItemsMatchingCacheKey(d,n)}clear(){this.removeItemsMatchingCacheKey(this.prefix,!1)}removeItemsMatchingCacheKey(e,n){const d=new RegExp(`^${e}${n?"$":""}`);(this.storage instanceof GenericStorage?this.storage.keys:Object.keys(this.storage)).forEach(e=>{e&&d.test(e)&&this.storage.removeItem(e)})}cacheKeyForPath(e){return this.cacheKeyFunction(e,this.prefix)}constructor(e={}){this.storage=e.storage||new GenericStorage,this.prefix=e.prefix||"",this.ttl=e.ttl||3e5,this.cacheKeyFunction=e.cacheKeyFunction||DEFAULT_CACHE_KEY_FUNCTION}}function asyncGeneratorStep$1b(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _defineProperty$L(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$L(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$L(e,n,d[n])}))}return e}var Br;!function(e){e.JSON="application/json",e.FORM="application/x-www-form-urlencoded"}(Br||(Br={}));class TokenSession extends class{clearCacheForRequest(e,n){"object"==typeof e&&(n=e,e=void 0);const d=this.constructURL(e,n);this.networkCache.removeItemsMatching(d)}request(e,n,d){var p,h=this;return(p=function*(){d||"object"!=typeof e||(d=n||{},n=e,e=void 0);let p={};"object"==typeof(d=_objectSpread$L({method:h.method,headers:h.headers,reload:!1},h._fetchOptions,d)).queryParameters?(p=d.queryParameters,delete d.queryParameters):"GET"!==d.method&&"DELETE"!==d.method||(p=n);const y=h.constructURL(e,p),{method:m,reload:g=!1,useRawResponse:b}=d;if(d.headers=h.buildHeaders(d),delete d.reload,delete d.useRawResponse,"GET"===m&&!g){const e=h.getCacheItem(y);if(e)return Promise.resolve(e)}n&&Object.keys(n).length&&("POST"===m||"PUT"===m)&&(d.body=d.body||n,d.contentType===Br.FORM?(d.body=urlEncodeParameters(d.body),d.headers.set("Content-Type",Br.FORM)):(d.body=JSON.stringify(d.body),d.headers.set("Content-Type",Br.JSON)));const _=yield h._fetchFunction(y,d);if(!_.ok)return Promise.reject(_);let P;try{P=yield _.json()}catch(Lr){P={}}if(P.errors)return Promise.reject(P.errors);const T=b?P:P.results||P.data||P;if("GET"===m){var S;const e=null!==(S=getMaxAgeFromHeaders(_.headers))&&void 0!==S?S:h.ttl;h.setCacheItem(y,T,e)}return T},function(){var e=this,n=arguments;return new Promise((function(d,h){var y=p.apply(e,n);function _next(e){asyncGeneratorStep$1b(y,d,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1b(y,d,h,_next,_throw,"throw",e)}_next(void 0)}))})()}buildHeaders({headers:e,reload:n=!1}={}){void 0===e&&(e=this.headers);const d=(e=>new e.constructor(e))(e);return n&&d.set("Cache-Control","no-cache"),d}constructURL(e,n){return((e,n,d)=>addQueryParamsToURL(addPathToURL(e,n),d))(this.url,e,n)}getCacheItem(e){const n=this.networkCache.storage,d=`${this.prefix}${this.prefix}cache-mut`,p=n.getItem(d)||null,h=this.headers.get("Music-User-Token")||this.headers.get("Media-User-Token")||null;return h!==p&&(this.networkCache.clear(),null===h?n.removeItem(d):n.setItem(d,h)),this.networkCache.getItem(e)}setCacheItem(e,n,d=this.ttl){this.networkCache.setItem(e,n,d)}clearNetworkCache(){this.networkCache.clear()}_key(e,n){const d=function(e){try{const[n,d]=e.split("?",2);if(void 0===d)return n;const p=d.split("&").map(e=>e.split("=",2)),h=[...Array(p.length).keys()];h.sort((e,n)=>{const d=p[e],h=p[n];return d<h?-1:d>h?1:e-n});const y=h.map(e=>p[e]);return`${n}?${y.map(([e,n])=>void 0!==n?`${e}=${n}`:e).join("&")}`}catch(Lr){return e}}(e).toLowerCase().replace(this.url,"");return`${this.prefix}${d.replace(/[^-_0-9a-z]{1,}/g,".")}`}constructor(e,n){if(this.prefix="",this.method="GET",this.url=e,(n=n||{}).storage&&n.underlyingStorage)throw new Error("only pass storage OR underlyingStorage in sessionOptions to URLSession");const d=n.underlyingStorage||{};if(this.storage=n.storage||new GenericStorage(d),this.networkCache=new NetworkCache({storage:this.storage,prefix:this.prefix,cacheKeyFunction:this._key.bind(this)}),this.ttl=n.ttl||3e5,this._fetchOptions=_objectSpread$L({},n.fetchOptions),"function"!=typeof n.fetch&&"function"!=typeof fetch)throw new Error("window.fetch is not defined");var p;this._fetchFunction=null!==(p=n.fetch)&&void 0!==p?p:fetch.bind(window),this.headers=this._fetchOptions.headers||new Headers,delete this._fetchOptions.headers}}{get developerToken(){return this._developerToken.token}constructor(e,n,d){super(e,d),this._developerToken=new DeveloperToken(n),this.headers.set("Authorization","Bearer "+this.developerToken),d=d||{},this.userToken=d.userToken,this.userToken&&this.headers.set("Media-User-Token",this.userToken)}}const Fr=Date.now();var Kr;const Vr=isNodeEnvironment$1()?()=>{const[e,n]=process.hrtime();return Math.floor(1e3*e+1e-6*n)}:()=>{var e;return null!==(Kr=null===performance||void 0===performance||null===(e=performance.now)||void 0===e?void 0:e.call(performance))&&void 0!==Kr?Kr:Date.now()-Fr},formatByte=e=>("0"+(255&e).toString(16)).slice(-2),Hr=new Map([["play",Rr.PLAY_START],["playbackstarted",Rr.PLAY_START],["stop",Rr.PLAY_END],["playbackstopped",Rr.PLAY_END]]);function mapEventTypeString(e){return"number"==typeof e?e:null!==(n=Hr.get(e))&&void 0!==n?n:Rr.PLAY_END;var n}const qr=new Map([["exit",e.PlayActivityEndReasonType.EXITED_APPLICATION],["next",e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS],["pause",e.PlayActivityEndReasonType.PLAYBACK_MANUALLY_PAUSED],["playbackfinished",e.PlayActivityEndReasonType.NATURAL_END_OF_TRACK],["playbackstopped",e.PlayActivityEndReasonType.PLAYBACK_MANUALLY_PAUSED],["previous",e.PlayActivityEndReasonType.TRACK_SKIPPED_BACKWARDS],["scrub_begin",e.PlayActivityEndReasonType.SCRUB_BEGIN],["scrub_end",e.PlayActivityEndReasonType.SCRUB_END],["stop",e.PlayActivityEndReasonType.NATURAL_END_OF_TRACK]]);function normalizePlayActivityDescriptor(e){const n=deepClone(e),d=function(e){var n;const d=null!==(n=e.eventType)&&void 0!==n?n:Rr.PLAY_START;if("number"==typeof d)return{eventType:d};return{eventTypeString:d,eventType:mapEventTypeString(d)}}(e);return n.eventType=d.eventType,n.eventTypeString=d.eventTypeString,void 0===n.endReasonType&&void 0!==d.eventTypeString&&(n.endReasonType=function(e){if(void 0!==e)return qr.get(e)}(d.eventTypeString)),!1!==n.reporting&&(n.reporting=!0),n}function _defineProperty$K(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpreadProps$u(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}const createHelper=(e,n)=>(d,p,h)=>{const{helpers:y}=h.cache;return e in y||(y[e]=n(d,p,h)),y[e]};const returnAsField=(e,n)=>(...d)=>function(e,n){if(void 0!==n)return{[e]:n}}(e,n(...d)),createFieldFn=(e,n)=>(d,p,h)=>{const{fields:y}=h.cache;var m;return e in y||(h.cache.fields=_objectSpreadProps$u(function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$K(e,n,d[n])}))}return e}({},y),{[e]:(m=n(d,p,h),null==m?void 0:{[e]:m})})),h.cache.fields[e]},createClientFieldFn=(e,n)=>createFieldFn(e,(e,d,{client:p})=>p[n]),zr=createFieldFn("event-type",(e,n,d)=>{return void 0===e.eventType?Rr.PLAY_START:e.itemType===Cr.TIMED_METADATA_PING&&void 0!==e.timedMetadata?Rr.PLAY_END:null!==(p=e.eventType)&&void 0!==p?p:Rr.PLAY_START;var p}),Wr=createHelper("should-include-audio-quality",(e,n,d)=>{var p,h;const y=e.userPreference;return zr(e,n,d)["event-type"]===Rr.PLAY_END&&void 0!==(null===(p=e.audioQuality)||void 0===p?void 0:p.provided)&&void 0!==(null===(h=e.audioQuality)||void 0===h?void 0:h.targeted)&&void 0!==(null==y?void 0:y.audioQuality)&&void 0!==(null==y?void 0:y.playbackFormat)}),Yr=createFieldFn("audio-quality-provided",(e,n,d)=>{if(!Wr(e,n,d))return;const p=e.audioQuality;if(void 0===(null==p?void 0:p.provided))return;const{provided:h}=p;var y,m,g;return{"audio-sample-rate-in-hz":null!==(y=h.audioSampleRateHz)&&void 0!==y?y:0,"audio-bit-depth":null!==(m=h.audioBitDepth)&&void 0!==m?m:0,"bit-rate-in-bps":null!==(g=h.bitRateBps)&&void 0!==g?g:0,codec:h.codec,"audio-channel-type":h.audioChannelType,"playback-format":h.playbackFormat}}),Qr=createFieldFn("audio-quality-targeted",(e,n,d)=>{if(!Wr(e,n,d))return;const p=e.audioQuality;if(void 0===(null==p?void 0:p.targeted))return;const{targeted:h}=p;var y,m,g;return{"audio-sample-rate-in-hz":null!==(y=h.audioSampleRateHz)&&void 0!==y?y:0,"audio-bit-depth":null!==(m=h.audioBitDepth)&&void 0!==m?m:0,"bit-rate-in-bps":null!==(g=h.bitRateBps)&&void 0!==g?g:0,codec:h.codec,"audio-channel-type":h.audioChannelType,"playback-format":h.playbackFormat}}),Jr=createClientFieldFn("build-version","buildVersion"),Xr=["uploadedVideo","uploadedAudio","uploaded-videos","uploaded-audios"],Zr=createHelper("is-auc",({kind:e})=>void 0!==e&&Xr.includes(e)),en=createHelper("should-send-timed-metadata",({endReasonType:n,eventType:d,itemType:p,timedMetadata:h})=>void 0!==h&&(p===Cr.TIMED_METADATA_PING||d===Rr.PLAY_START||n===e.PlayActivityEndReasonType.PLAYBACK_MANUALLY_PAUSED)),tn=createFieldFn("type",(e,n,d)=>{const{id:p,reporting:h}=e;var y;if("-1"===p||!h)switch(null===(y=zr(e,n,d))||void 0===y?void 0:y["event-type"]){case Rr.PLAY_END:return Cr.AGGREGATE_NON_CATALOG_PLAY_TIME;case Rr.PLAY_START:if("-1"===p)return Cr.INVALID}const{format:m,itemType:g}=e;return en(e,n,d)?g===Cr.TIMED_METADATA_PING?g:Cr.STREAM:"stream"===m?Cr.STREAM:Zr(e,n,d)?Cr.ARTIST_UPLOADED_CONTENT:null!=g?g:Cr.ITUNES_STORE_CONTENT}),rn=createFieldFn("container-type",(e,n,d)=>{var p;if((null===(p=tn(e,n,d))||void 0===p?void 0:p.type)===Cr.AGGREGATE_NON_CATALOG_PLAY_TIME)return;const{container:h}=e;if(void 0===h)return gr.UNKNOWN;var y;const m=null!==(y=h.type)&&void 0!==y?y:h.kind;if("number"==typeof m)return m;switch(m){case"album":case"albums":case"library-albums":return gr.ALBUM;case"artist":case"artists":case"library-artists":return gr.ARTIST;case"playlist":case"playlists":case"library-playlists":return gr.PLAYLIST;case"radio":case"radioStation":case"station":case"stations":return gr.RADIO;default:return gr.UNKNOWN}});function _defineProperty$J(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}const nn=[returnAsField("album-adam-id",(e,n,d)=>{var p;if((null===(p=rn(e,n,d))||void 0===p?void 0:p["container-type"])!==gr.ALBUM)return;const{container:h}=e,y=null==h?void 0:h.id;return void 0===y||T(y)?void 0:y}),returnAsField("cloud-album-id",(e,n,d)=>{var p;if((null===(p=rn(e,n,d))||void 0===p?void 0:p["container-type"])!==gr.ALBUM)return;const{container:h}=e,y=null==h?void 0:h.id;return void 0!==y&&T(y)?y:void 0}),returnAsField("global-playlist-id",(e,n,d)=>{var p;if((null===(p=rn(e,n,d))||void 0===p?void 0:p["container-type"])!==gr.PLAYLIST)return;const{container:h}=e;var y;const m=null!==(y=null==h?void 0:h.catalogId)&&void 0!==y?y:null==h?void 0:h.globalId;return(null==h?void 0:h.isLibrary)&&m?m:T(null==h?void 0:h.id)||null==h?void 0:h.id}),returnAsField("playlist-version-hash",(e,n,d)=>{var p;if((null===(p=rn(e,n,d))||void 0===p?void 0:p["container-type"])!==gr.PLAYLIST)return;const{container:h}=e,y=null==h?void 0:h.versionHash;return void 0!==y&&""!==y?y:void 0}),returnAsField("station-hash",(e,n,d)=>{var p,h;if((null===(p=rn(e,n,d))||void 0===p?void 0:p["container-type"])!==gr.RADIO)return;const y=null===(h=e.container)||void 0===h?void 0:h.stationHash;return void 0!==y&&""!==y?y:void 0}),returnAsField("station-id",(e,n,d)=>{var p,h;if((null===(p=rn(e,n,d))||void 0===p?void 0:p["container-type"])===gr.RADIO)return null===(h=e.container)||void 0===h?void 0:h.id}),returnAsField("station-personalized-id",(e,n,d)=>{var p,h;if((null===(p=rn(e,n,d))||void 0===p?void 0:p["container-type"])!==gr.RADIO)return;const y=null===(h=e.container)||void 0===h?void 0:h.id;return void 0!==y&&Ur.test(y)?parseInt(y.replace(Ur,"$1"),10):void 0}),returnAsField("universal-library-id",(e,n,d)=>{var p;if((null===(p=rn(e,n,d))||void 0===p?void 0:p["container-type"])!==gr.PLAYLIST)return;const{container:h}=e;var y;const m=null!==(y=null==h?void 0:h.catalogId)&&void 0!==y?y:null==h?void 0:h.globalId,g=null==h?void 0:h.id;if(void 0!==g)if((null==h?void 0:h.isLibrary)&&m){if(""!==g)return g}else if(T(g))return g})],an=createFieldFn("container-ids",(e,n,d)=>{var p;if((null===(p=tn(e,n,d))||void 0===p?void 0:p.type)===Cr.AGGREGATE_NON_CATALOG_PLAY_TIME)return;const h=nn.reduce((p,h)=>function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$J(e,n,d[n])}))}return e}({},p,h(e,n,d)),Object.create(null));return isEmpty(h)?void 0:h}),on=createClientFieldFn("developer-token","accessToken"),sn=createClientFieldFn("device-name","deviceName"),cn=createFieldFn("display-type",(e,n,d)=>{var p,h;if((null===(p=zr(e,n,d))||void 0===p?void 0:p["event-type"])===Rr.LYRIC_DISPLAY)return null===(h=e.lyricDescriptor)||void 0===h?void 0:h.displayType}),ln=createHelper("initial-start-position-in-milliseconds",({position:e=0,startPositionInMilliseconds:n})=>n||Math.round(1e3*e)),un=createFieldFn("end-position-in-milliseconds",(e,n,d)=>{var p;switch(null===(p=zr(e,n,d))||void 0===p?void 0:p["event-type"]){case Rr.LYRIC_DISPLAY:var h;if(void 0===(null===(h=e.lyricDescriptor)||void 0===h?void 0:h.duration))return;return Math.round(e.lyricDescriptor.duration);case Rr.PLAY_START:return;default:if(n&&void 0===n.position)return;return e.endPositionInMilliseconds||ln(e,n,d)}}),dn=createHelper("is-private",({id:e,reporting:n})=>"-1"===e||!n),pn=createFieldFn("end-reason-type",(n,d,p)=>{var h;if(!d||void 0!==(null==d?void 0:d.position))return(null===(h=tn(n,d,p))||void 0===h?void 0:h.type)===Cr.TIMED_METADATA_PING&&void 0!==n.timedMetadata||dn(n,d,p)&&n.eventType===Rr.PLAY_END?e.PlayActivityEndReasonType.NOT_APPLICABLE:n.endReasonType}),{CONTAINER_CHANGED:hn,NOT_SPECIFIED:yn}=Ar,fn=createFieldFn("event-reason-hint-type",(e,n,d)=>{var p,h;if((null===(p=zr(e,n,d))||void 0===p?void 0:p["event-type"])!==Rr.PLAY_START)return;const y=e.container;return void 0===y?yn:!1===n?d.isAlexa?yn:hn:(null==n||null===(h=n.container)||void 0===h?void 0:h.id)!==y.id?hn:yn}),mn=createFieldFn("feature-name",(e,n,d)=>{var p,h,y;if((null===(p=tn(e,n,d))||void 0===p?void 0:p.type)===Cr.AGGREGATE_NON_CATALOG_PLAY_TIME)return;return""+(null!==(y=null===(h=e.container)||void 0===h?void 0:h.name)&&void 0!==y?y:mr.MUSICKIT)}),gn=createClientFieldFn("guid","guid"),vn=createHelper("should-have-auc-adam-id",Zr),bn=createHelper("should-have-radio-adam-id",({id:e,container:n})=>Nr.test(e)||"radioStation"===(null==n?void 0:n.kind)),_n=createHelper("is-library-item-or-library-type",({id:e,isLibrary:n},d,p)=>n||T(e)),Pn=createHelper("catalog-id",({catalogId:e,container:n})=>null!=e?e:null==n?void 0:n.catalogId),Tn=createHelper("is-library-item-with-catalog-id",(e,n,d)=>e.isLibrary&&!!Pn(e,n,d));function _defineProperty$I(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}const Sn=[returnAsField("auc-adam-id",(e,n,d)=>{if(!dn(e,n,d)&&!bn(e,n,d))return vn(e,n,d)?e.id:void 0}),returnAsField("cloud-id",(e,n,d)=>{var p;const{id:h}=e,y=void 0!==h&&""!==h;return dn(e,n,d)&&(null===(p=zr(e,n,d))||void 0===p?void 0:p["event-type"])===Rr.PLAY_START&&y&&"-1"!==h?h:bn(e,n,d)||vn(e,n,d)?e.cloudId:Tn(e,n,d)&&y||_n(e,n,d)?h:e.cloudId}),returnAsField("lyric-id",(e,n,d)=>{var p,h;if((null===(p=zr(e,n,d))||void 0===p?void 0:p["event-type"])===Rr.LYRIC_DISPLAY)return null===(h=e.lyricDescriptor)||void 0===h?void 0:h.id}),returnAsField("purchased-adam-id",(e,n,d)=>e.purchasedId),returnAsField("reporting-adam-id",(e,n,d)=>{if(!0!==d.client.allowReportingId)return;var p;return(null!==(p=zr(e,n,d))&&void 0!==p?p:{})["event-type"],_n(e,n,d)?e.reportingId:void 0}),returnAsField("radio-adam-id",(e,n,d)=>{if(dn(e,n,d))return;const{container:p,id:h}=e;return Nr.test(h)||"radioStation"===(null==p?void 0:p.kind)?parseInt((""+h).replace(Nr,"$1"),10):void 0}),returnAsField("subscription-adam-id",(e,n,d)=>{if(!(dn(e,n,d)||bn(e,n,d)||vn(e,n,d))){if(Tn(e,n,d))return Pn(e,n,d);if(!_n(e,n,d))return e.id}})],En=createFieldFn("ids",(e,n,d)=>{var p;if((null===(p=tn(e,n,d))||void 0===p?void 0:p.type)===Cr.AGGREGATE_NON_CATALOG_PLAY_TIME)return;const h=Sn.reduce((p,h)=>function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$I(e,n,d[n])}))}return e}({},p,h(e,n,d)),Object.create(null));return isEmpty(h)?void 0:h}),kn=createClientFieldFn("internal-build","internalBuild"),wn=createFieldFn("lyric-language",(e,n,d)=>{var p,h;if((null===(p=zr(e,n,d))||void 0===p?void 0:p["event-type"])===Rr.LYRIC_DISPLAY)return null===(h=e.lyricDescriptor)||void 0===h?void 0:h.language}),On=createHelper("has-episode-streaming-kind",({streamingKind:e},n,d)=>e===xr.EPISODE),In=createHelper("is-stream",(e,n,d)=>{var p;return(null===(p=tn(e,n,d))||void 0===p?void 0:p.type)===Cr.STREAM}),An=createHelper("is-live-stream",(e,n,d)=>In(e,n,d)&&!On(e,n,d)),Rn=createFieldFn("media-duration-in-milliseconds",(e,n,d)=>{var p;const h=null===(p=zr(e,n,d))||void 0===p?void 0:p["event-type"];if(h===Rr.LYRIC_DISPLAY)return 0;if(An(e,n,d))return 0;const y=Math.round(1e3*e.duration);if(h===Rr.PLAY_START)return y;var m,g;const b=null!==(g=e.startPositionInMilliseconds)&&void 0!==g?g:Math.round(1e3*(null!==(m=e.position)&&void 0!==m?m:0));return b>1e3*e.duration?b:y}),{AUDIO:Cn,VIDEO:Mn}=Mr,Dn=createFieldFn("media-type",(e,n,d)=>{var p;if((null===(p=zr(e,n,d))||void 0===p?void 0:p["event-type"])===Rr.LYRIC_DISPLAY)return Cn;const{kind:h,mediaType:y}=e;if("number"==typeof y)return y;const m="string"==typeof y?y:h;return m&&/video/i.test(m)?Mn:Cn}),jn=createClientFieldFn("metrics-client-id","metricsClientId"),xn=createFieldFn("offline",()=>!1),$n=createFieldFn("persistent-id",()=>generateUUID()),Ln=createFieldFn("play-mode",(e,n,d)=>{var p,h,y,m,g;if((null===(p=zr(e,n,d))||void 0===p?void 0:p["event-type"])===Rr.LYRIC_DISPLAY||(null===(h=tn(e,n,d))||void 0===h?void 0:h.type)===Cr.AGGREGATE_NON_CATALOG_PLAY_TIME)return{"auto-play-mode":null!==(y=Ln.autoplayMode)&&void 0!==y?y:0,"repeat-play-mode":null!==(m=Ln.repeatPlayMode)&&void 0!==m?m:0,"shuffle-play-mode":null!==(g=Ln.shufflePlayMode)&&void 0!==g?g:0};const b=invoke(e.playMode);var _,P,T;return void 0!==b?{"auto-play-mode":null!==(_=b.autoplayMode)&&void 0!==_?_:0,"repeat-play-mode":null!==(P=b.repeatPlayMode)&&void 0!==P?P:0,"shuffle-play-mode":null!==(T=b.shufflePlayMode)&&void 0!==T?T:0}:void 0}),Nn=createClientFieldFn("private-enabled","privateEnabled"),Un=createFieldFn("reco-data",(e,n,d)=>{var p,h;if((null===(p=zr(e,n,d))||void 0===p?void 0:p["event-type"])!==Rr.LYRIC_DISPLAY&&(null===(h=tn(e,n,d))||void 0===h?void 0:h.type)!==Cr.AGGREGATE_NON_CATALOG_PLAY_TIME)return e.recoData}),Gn=createClientFieldFn("sb-enabled","userIsSubscribed"),Bn=createClientFieldFn("siri-initiated","siriInitiated"),Fn=createClientFieldFn("source-type","sourceType"),Kn=createFieldFn("start-position-in-milliseconds",(e,n,d)=>{var p,h;const y=null===(p=zr(e,n,d))||void 0===p?void 0:p["event-type"];return y===Rr.LYRIC_DISPLAY||(null===(h=tn(e,n,d))||void 0===h?void 0:h.type)===Cr.AGGREGATE_NON_CATALOG_PLAY_TIME||An(e,n,d)?0:y===Rr.PLAY_START?ln(e,n,d):null!==(g=null!==(m=e.startPositionInMilliseconds)&&void 0!==m?m:previousPosition(n))&&void 0!==g?g:0;var m,g}),previousPosition=e=>e&&void 0!==e.position?Math.round(1e3*e.position):0,Vn=createClientFieldFn("store-front","storefrontId"),Hn=createFieldFn("timed-metadata",(e,n,d)=>{const p=e.timedMetadata;if(void 0!==p&&shouldSendTimedMetadata(e,n,d))return((e,n=8)=>{if(!(e instanceof Uint8Array))return"";const d=Array.prototype.map.call(e,formatByte).join("");return 0===n?d:d.replace(new RegExp(`(.{1,${n}})`,"g"),"$1 ").trim()})(p,0)}),shouldSendTimedMetadata=(e,n,d)=>{var p,h;return(null===(p=tn(e,n,d))||void 0===p?void 0:p.type)===Cr.TIMED_METADATA_PING||(null===(h=zr(e,n,d))||void 0===h?void 0:h["event-type"])!==Rr.LYRIC_DISPLAY},qn=createFieldFn("timestamp",({timestamp:e},n,d)=>null!=e?e:Date.now()),zn=createClientFieldFn("user-agent","userAgent"),Wn=createFieldFn("user-preference-audio-quality",(e,n,d)=>{var p;if(Wr(e,n,d))return null===(p=e.userPreference)||void 0===p?void 0:p.audioQuality}),Yn=createFieldFn("user-preference-playback-format",(e,n,d)=>{var p;if(Wr(e,n,d))return null===(p=e.userPreference)||void 0===p?void 0:p.playbackFormat}),Qn=createFieldFn("user-token",(e,n,{client:d})=>{if(!d.preferDSID)return d.musicUserToken}),Jn=createFieldFn("utc-offset-in-seconds",(e,n,d)=>{var p;return(null===(p=tn(e,n,d))||void 0===p?void 0:p.type)===Cr.AGGREGATE_NON_CATALOG_PLAY_TIME?0:d.client.utcOffsetInSeconds}),Xn={"audio-quality-provided":Yr,"audio-quality-targeted":Qr,"build-version":Jr,"container-ids":an,"container-type":rn,"developer-token":on,"device-name":sn,"display-type":cn,"end-position-in-milliseconds":un,"end-reason-type":pn,"event-reason-hint-type":fn,"event-type":zr,"feature-name":mn,guid:gn,ids:En,"internal-build":kn,"lyric-language":wn,"media-duration-in-milliseconds":Rn,"media-type":Dn,"metrics-client-id":jn,offline:xn,"persistent-id":$n,"play-mode":Ln,"private-enabled":Nn,"reco-data":Un,"sb-enabled":Gn,"siri-initiated":Bn,"source-type":Fn,"start-position-in-milliseconds":Kn,"store-front":Vn,"timed-metadata":Hn,timestamp:qn,type:tn,"user-agent":zn,"user-preference-audio-quality":Wn,"user-preference-playback-format":Yn,"user-token":Qn,"utc-offset-in-seconds":Jn};function _defineProperty$H(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$H(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$H(e,n,d[n])}))}return e}function _objectSpreadProps$t(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}let Zn=0;function _defineProperty$G(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpreadProps$s(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}const buildPlayActivityData$1=(e,n,d,p=!1)=>{const h=((e,...n)=>_objectSpreadProps$t(_objectSpread$H({},e,Object.assign({},...n)),{cache:{fields:Object.assign({},...n.map(e=>{var n;return null==e||null===(n=e.cache)||void 0===n?void 0:n.fields})),helpers:Object.assign({},...n.map(e=>{var n;return null==e||null===(n=e.cache)||void 0===n?void 0:n.helpers}))}}))("boolean"==typeof p?((e={},n)=>_objectSpread$H({id:(Zn++).toFixed(0),client:n,isAlexa:!1},e))({isAlexa:p},e):_objectSpreadProps$s(function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$G(e,n,d[n])}))}return e}({},p),{client:e}));return n=normalizePlayActivityDescriptor(n),d&&(d=normalizePlayActivityDescriptor(d)),Object.assign(Object.create(null),...Object.values(Xn).map(e=>null==e?void 0:e(n,d,h)))};function _defineProperty$F(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$F(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$F(e,n,d[n])}))}return e}function _objectSpreadProps$r(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}function _defineProperty$E(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$E(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$E(e,n,d[n])}))}return e}function _objectSpreadProps$q(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}function asyncGeneratorStep$1a(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$1a(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$1a(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1a(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$D(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpreadProps$p(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}class LyricsPlayActivity extends PlayActivityBase{get state(){return this._machine.state.value}play(e){var n=this;return _asyncToGenerator$1a((function*(){var d;if("playing"===n.state)throw Error("lyrics are already being displayed. Did you forget to stop them?");if(void 0===e)throw Error("Missing descriptor for lyrics play");Nt.info(`Staring tracking: lyricsId=${null===(d=e.lyricDescriptor)||void 0===d?void 0:d.id}, itemId=${e.id}, catalogId=${e.catalogId}`),n.startDescriptor=e,n._machine.send({type:"play"})}))()}stop(){var e=this;return _asyncToGenerator$1a((function*(){var n;if("playing"!==e.state)throw Error("lyrics are not being displayed. Did you forget to display them?");if(void 0===e.startDescriptor)throw Error("Missing start descriptor for lyrics stop");Nt.info(`Stopping tracking: lyricsId=${null===(n=e.startDescriptor.lyricDescriptor)||void 0===n?void 0:n.id}, itemId=${e.startDescriptor.id}, catalogId=${e.startDescriptor.catalogId}`),e._machine.send({type:"stop"});const d=e._machine.state.context.duration,p=JSON.parse(JSON.stringify(e.startDescriptor));p.lyricDescriptor=_objectSpreadProps$p(function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$D(e,n,d[n])}))}return e}({},p.lyricDescriptor),{duration:Math.round(d)}),Nt.debug("Clearing tracked descriptor"),e.startDescriptor=void 0;const h=e.build(p,!1);try{Nt.debug("Sending PAF request with data payload"),yield e.send(h),Nt.debug("Done sending PAF request")}catch(Y){console.error("Error sending Lyrics PAF request: "+Y.message),Nt.error("Error sending Lyrics PAF request: "+Y.message)}}))()}exit(){return _asyncToGenerator$1a((function*(){}))()}build(e,n){return((e,n,d)=>{if(void 0===n)throw new Error("called without a play activity descriptor");const p=_objectSpreadProps$r(_objectSpread$F({},n),{eventType:Rr.LYRIC_DISPLAY});return((e,...n)=>n.reduce((e,n)=>n(e),e))(_objectSpreadProps$r(_objectSpread$F({},buildPlayActivityData$1(e,p,d,!1)),{"media-duration-in-milliseconds":0,"media-type":Mr.AUDIO,"start-position-in-milliseconds":0,"play-mode":{"auto-play-mode":0,"repeat-play-mode":0,"shuffle-play-mode":0}}),e=>exceptFields(e,"character-display-count","event-reason-hint-type","reco-data"))})(this,e,n)}constructor(e,n,d,p){super(e,n,d,p),this._machine=v(s({id:"lpaf",initial:"idle",context:{initialShowTime:-1,duration:-1},states:{idle:{entry:o(e=>_objectSpreadProps$q(_objectSpread$E({},e),{initialShowTime:void 0,duration:Vr()-e.initialShowTime})),on:{play:"playing"}},playing:{entry:o(e=>_objectSpreadProps$q(_objectSpread$E({},e),{initialShowTime:Vr()})),on:{stop:"idle"}}}})).start()}}var ei;!function(e){e[e.ALEXA=13]="ALEXA"}(ei||(ei={}));const createCookieJar=e=>{switch(void 0===e&&(e="browser"),e){case"browser":return{get:getCookie,set:setCookie};case"memory":return((e={})=>({get(n){if(void 0!==n)return e[n]},set(n,d){e[n]=d}}))();default:return e}},empty=(e,n)=>write(e,n,[],"/",0),read=(e,n)=>{const d=e.get(n);if(void 0===d||""===d)return[];return ensureArray(JSON.parse(atob(d)))},write=(e,n,d,p,h,y)=>e.set(n,btoa(JSON.stringify(d)),p,h,y);function asyncGeneratorStep$19(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$19(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$19(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$19(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}const{AUTO:ti}=Dr;class PlayActivityBatchableSender{flush(){var e=this;return _asyncToGenerator$19((function*(){const n=read(e.jar,"amupaee");if(void 0!==n&&0!==n.length)try{yield e.sender.send(n),empty(e.jar,"amupaee")}catch({message:d}){throw new Error("flush: "+d)}}))()}send(n){var d=this;return _asyncToGenerator$19((function*(){if(d.mode===ti&&(Array.isArray(n)||n["end-reason-type"]!==e.PlayActivityEndReasonType.EXITED_APPLICATION))return d.sender.send(n);((e,n,d,p,h,y)=>{write(e,n,[...read(e,n),d],p,h,y)})(d.jar,"amupaee",n,"/")}))()}constructor(e,n){this.sender=e,this.jar=n,this.mode=ti}}function asyncGeneratorStep$18(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$18(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$18(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$18(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}class Timeline{get events(){return this._events}get first(){return this.at(0)}get keys(){return this._keys}get last(){return this.at(this.length-1)}get length(){return this._keys.length}get second(){return this.at(1)}at(e){if(e>this.length-1)throw new Error("Invalid timeline index");const n=this._keys[e];return this._events[n]}before(e){if("number"!=typeof e){const n=[];for(const e in this._events)hasOwn(this._events,e)&&n.push(this._events[e]);e=this._keys[n.indexOf(e)]}const n=this._keys.indexOf(e);if(-1===n)throw new Error("Key not found");if(n>0)return this._events[this._keys[n-1]]}drain(){const e=this._keys.map(e=>this._events[e]);return this.reset(),e}reset(){this._events={},this._keys=[]}pop(){var e=this;return _asyncToGenerator$18((function*(){const n=e._keys.pop();if(void 0===n)return Promise.reject("TIMELINE IS EMPTY");const d=e._events[n];return delete e._events[n],Promise.resolve(d)}))()}add(e,n){var d=this;return _asyncToGenerator$18((function*(){return d.push(e,n)}))()}push(e,n=Date.now()){var d=this;return _asyncToGenerator$18((function*(){for(;-1!==d._keys.indexOf(n);)n++;return d._events[n]=e,d._keys.push(n),Promise.resolve(n)}))()}shift(){var e=this;return _asyncToGenerator$18((function*(){const n=e._keys.shift();if(void 0===n)return Promise.reject("TIMELINE IS EMPTY");const d=e._events[n];return delete e._events[n],Promise.resolve(d)}))()}unshift(e,n=Date.now()){var d=this;return _asyncToGenerator$18((function*(){for(;-1!==d._keys.indexOf(n);)n++;return d._events[n]=e,d._keys.unshift(n),Promise.resolve(n)}))()}constructor(){this._events={},this._keys=[]}}function asyncGeneratorStep$17(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}class TimedMetadataTracker{get currentValue(){return this._currentValue}clear(){this._currentValue=void 0}ping(e,n){var d,p=this;return(d=function*(){p.timedMetadataChanged(e)&&(void 0!==p._currentValue&&(yield p.client.pingTimedMetadata(n,p._currentValue)),p._currentValue=void 0===e?void 0:e.slice(0))},function(){var e=this,n=arguments;return new Promise((function(p,h){var y=d.apply(e,n);function _next(e){asyncGeneratorStep$17(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$17(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))})()}timedMetadataChanged(e){const{_currentValue:n}=this;return void 0===n?void 0!==e:void 0===e||(e.length!==n.length||n.some((n,d)=>n!==e[d]))}constructor(e,n){this.client=e,this._currentValue=n}}const transitionEvent=e=>({type:e});function deriveTransitionEvent(n){if(n.itemType===Cr.TIMED_METADATA_PING)return!1;if(function(e){return e.eventType===Rr.PLAY_START}(n))return transitionEvent("play");if(function(e){if(e.eventType!==Rr.PLAY_END)return!1;if(void 0===e.endReasonType)throw new Error("PLAY_END activity descriptor requires an endReasonType value");return!0}(n)){const d=n.endReasonType;if(d===e.PlayActivityEndReasonType.SCRUB_BEGIN)return transitionEvent("scrubBegin");if(d===e.PlayActivityEndReasonType.SCRUB_END)return transitionEvent("scrubEnd");if(d===e.PlayActivityEndReasonType.EXITED_APPLICATION)return!1}return transitionEvent("stop")}function _defineProperty$C(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$C(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$C(e,n,d[n])}))}return e}function _objectSpreadProps$o(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}function _objectWithoutProperties$2(e,n){if(null==e)return{};var d,p,h=function(e,n){if(null==e)return{};var d,p,h={},y=Object.keys(e);for(p=0;p<y.length;p++)d=y[p],n.indexOf(d)>=0||(h[d]=e[d]);return h}(e,n);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(p=0;p<y.length;p++)d=y[p],n.indexOf(d)>=0||Object.prototype.propertyIsEnumerable.call(e,d)&&(h[d]=e[d])}return h}class MPAFStateMachine{get currentState(){return this.machineService.state}get currentStateName(){return this.currentState.value}matches(e){return this.machineService.state.matches(e)}transition(e,n){const d=deriveTransitionEvent(e);if(!1===d)return this.currentStateName;if(this.machineService.send(d),this.matches("error"))throw new Error(this.machineService.state.context.errorMessage);return this.currentStateName}constructor(){this.machine=s({id:"mpaf",initial:"idle",context:{},states:{error:{},idle:{on:{play:"playing",stop:"idle",scrubBegin:{target:"scrubbing",actions:o(e=>_objectSpreadProps$o(_objectSpread$C({},e),{stateBeforeScrub:"idle"}))},scrubEnd:{target:"error",actions:["clearStateBeforeScrub","setScrubEndError"]}}},playing:{on:{scrubBegin:{target:"scrubbing",actions:o(e=>_objectSpreadProps$o(_objectSpread$C({},e),{stateBeforeScrub:"playing"}))},stop:"idle",scrubEnd:{target:"error",actions:["clearStateBeforeScrub","setScrubEndError"]}}},scrubbing:{on:{scrubEnd:[{target:"idle",cond:({stateBeforeScrub:e})=>"idle"===e,actions:["clearStateBeforeScrub"]},{target:"playing",actions:["clearStateBeforeScrub"]}]}}}},{actions:{clearStateBeforeScrub:o(e=>_objectWithoutProperties$2(e,["stateBeforeScrub"])),setScrubEndError:o(e=>_objectSpreadProps$o(_objectSpread$C({},e),{errorMessage:"The scrub() method was called with the SCRUB_END action without a previous SCRUB_START descriptor"}))}}),this.machineService=v(this.machine).start()}}function asyncGeneratorStep$16(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$16(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$16(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$16(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$B(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$B(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$B(e,n,d[n])}))}return e}function _objectSpreadProps$n(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}class StatelessPlayActivity extends PlayActivityBase{build(e,n){return buildPlayActivityData$1(this,e,n,"JSCLIENT"!==this.clientId)}constructor(e,n,d,p){super(e,n,d,p)}}class PlayActivity{get mode(){return this.sender.mode}set mode(e){this.sender.mode=e}get privateEnabled(){return this._paf.privateEnabled}set privateEnabled(e){this._paf.privateEnabled=e}get timedMetadata(){return this._timedMetadataTracker.currentValue}clearTimedMetadata(){return this._timedMetadataTracker.clear()}setTimedMetadata(e,n){var d=this;return _asyncToGenerator$16((function*(){yield d._timedMetadataTracker.ping(e,n)}))()}activate(n=!1){var d=this;return _asyncToGenerator$16((function*(){if(n)try{yield d.flush()}catch(h){if(!(e=>(e=>{switch(typeof e){case"string":return e;case"object":return e.message?"string"!=typeof e.message?"":e.message:"";default:return""}})(e).includes("send() called without any data"))(h))throw h}const p=d.timeline.last;if(p&&p.endReasonType===e.PlayActivityEndReasonType.EXITED_APPLICATION)return d.timeline.pop()}))()}exit(n=0){var d=this;return _asyncToGenerator$16((function*(){yield d.stop(n,e.PlayActivityEndReasonType.EXITED_APPLICATION)}))()}pause(n=0){var d=this;return _asyncToGenerator$16((function*(){yield d.stop(n,e.PlayActivityEndReasonType.PLAYBACK_MANUALLY_PAUSED)}))()}pingTimedMetadata(n,d,p=this.previousDescriptor){var h=this;return _asyncToGenerator$16((function*(){yield h._addToTimeline(_objectSpreadProps$n(_objectSpread$B({},p),{position:n,endReasonType:e.PlayActivityEndReasonType.NOT_APPLICABLE,eventType:Rr.PLAY_END,itemType:Cr.TIMED_METADATA_PING,timedMetadata:d}))}))()}play(e,n=0){var d=this;return _asyncToGenerator$16((function*(){const p=d.timeline.length>0;if(void 0===e){if(!p)return;const e=d.previousDescriptor;return e.eventType===Rr.PLAY_END&&delete e.endReasonType,void(yield d._addToTimeline(_objectSpreadProps$n(_objectSpread$B({},d.sanitizePreviousDescriptor(e)),{eventType:Rr.PLAY_START})))}if(p){const e=d.previousDescriptor;if(d._machine.matches("playing")&&!(({id:e,reporting:n=!0,eventType:d})=>("-1"===e||!n)&&d===Rr.PLAY_END)(e))return Promise.reject(new Error("The play() method was called without a previous stop() or pause() call."))}yield d._addToTimeline(_objectSpreadProps$n(_objectSpread$B({},e),{eventType:Rr.PLAY_START,position:n}))}))()}scrub(n=0,d=e.PlayActivityEndReasonType.SCRUB_BEGIN){var p=this;return _asyncToGenerator$16((function*(){yield p._addToTimeline(_objectSpreadProps$n(_objectSpread$B({},p.sanitizePreviousDescriptor(p.previousDescriptor)),{eventType:Rr.PLAY_END,endReasonType:d,position:n}))}))()}skip(n,d=e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS,p=0){var h=this;return _asyncToGenerator$16((function*(){yield h.stop(p,d),yield h.play(n)}))()}stop(n=0,d=e.PlayActivityEndReasonType.NATURAL_END_OF_TRACK){var p=this;return _asyncToGenerator$16((function*(){let h=p.previousDescriptor;if(h.endReasonType===e.PlayActivityEndReasonType.EXITED_APPLICATION&&(yield p.timeline.pop(),empty(p._cookieJar,"amupaee"),h=p.previousDescriptor),p._machine.matches("playing")){const e=_objectSpreadProps$n(_objectSpread$B({},p.sanitizePreviousDescriptor(h)),{eventType:Rr.PLAY_END,endReasonType:d,position:n,timedMetadata:p._timedMetadataTracker.currentValue});yield p._addToTimeline(e)}}))()}build(e,n){if(void 0===e&&void 0===n&&Nt.warn("You are calling build() from a stateful PAF client. Please, use a stateless client or exit(), pause(), play(), scrub(), skip() or stop() instead."),void 0===e){if(0===this.timeline.length)throw new Error("build() called without a play activity descriptor");e=this.timeline.last}if(void 0===n){if(void 0===(n=this.timeline.before(e))&&e.eventType===Rr.PLAY_END)throw new Error("Cannot build() for PLAY_END descriptors without previous descriptors");n=null!=n&&n}return this._paf.build(_objectSpreadProps$n(_objectSpread$B({},e),{timedMetadata:this.timedMetadata}),n)}addForPlayParams(e,n,d,p=0,h={}){var y=this;return _asyncToGenerator$16((function*(){yield y._addToTimeline(y.buildDescriptorForPlayParams(e,n,d,p,h))}))()}buildDescriptorForPlayParams(e,n,d,p=0,h={}){const y="stream"===e.format?Cr.STREAM:Cr.ITUNES_STORE_CONTENT;return normalizePlayActivityDescriptor(_objectSpread$B(_objectSpreadProps$n(_objectSpread$B({},e),{container:d,duration:p,eventType:n,itemType:y}),h))}flush(){return this.sender.flush()}_addToTimeline(e){var n=this;return _asyncToGenerator$16((function*(){e=_objectSpreadProps$n(_objectSpread$B({},e),{timestamp:Date.now()});const d=n.timeline.length>0&&n.timeline.last;yield n.timeline.add(e);const p=n.build(e,d);yield n.send(p,e)}))()}get previousDescriptor(){const e=this.timeline.last;if(void 0===e)throw new Error("A method was called without a previous descriptor");return exceptFields(e,"timestamp")}buildForPlayParams(e,n,d,p=0,h={},y=!1){return Nt.warn("You are using buildsForPlayParams from a stateful PlayActivity. Please, use StatelessPlayActivity instead"),this._paf.buildForPlayParams(e,n,d,p,h,y)}send(e,n){e=ensureArray(e);const d=normalizePlayActivityDescriptor(n);return e.forEach(e=>this._machine.transition(d,e)),this.sender.send(e)}sanitizePreviousDescriptor(e){let n=deepClone(e);return n.itemType===Cr.TIMED_METADATA_PING&&(n=exceptFields(n,"itemType")),n}constructor(e,n,d,p){this.timeline=new Timeline,this._paf=new StatelessPlayActivity(e,n,d,p),this._cookieJar=createCookieJar(null==p?void 0:p.cookieJar),this.sender=new PlayActivityBatchableSender(this._paf.sender,this._cookieJar),this._machine=new MPAFStateMachine,this._timedMetadataTracker=new TimedMetadataTracker(this)}}const Bind=()=>(e,n,d)=>{if(void 0===d||"function"!=typeof d.value)throw new TypeError(`Only methods can be decorated with @Bind, but ${n} is not a method.`);return{configurable:!0,get(){const e=d.value.bind(this);return Object.defineProperty(this,n,{value:e,configurable:!0,writable:!0}),e}}},ri=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],ni=["fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement"],ii=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],noop=()=>Promise.resolve(),ai=(e=>{if(void 0===e)return noop;const n=ri.find(n=>"function"==typeof e.prototype[n]);return"string"!=typeof n?noop:(e=self.document)=>{var d;return null==e||null===(d=e[n])||void 0===d?void 0:d.call(e)}})(HTMLDocument),oi=(e=>{if(void 0===e)return()=>!1;const n=ni.find(n=>n in e.prototype);return"string"!=typeof n?()=>!1:(e=self.document)=>!!e[n]})(HTMLDocument),si=(e=>{if(void 0===e)return noop;const n=ii.find(n=>"function"==typeof e.prototype[n]);return"string"!=typeof n?noop:e=>null==e?void 0:e[n]()})(HTMLElement);function asyncGeneratorStep$15(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$15(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$15(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$15(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}class Fullscreen{exit(){var e=this;return _asyncToGenerator$15((function*(){if(e.isInFullscreen())return e.stopDispatchingEvents(()=>e.exitFullscreen())}))()}request(e){var n=this;return _asyncToGenerator$15((function*(){if(void 0!==e)return n.stopDispatchingEvents(()=>n.requestFullscreenForElement(e))}))()}stopDispatchingEvents(e){var n=this;return _asyncToGenerator$15((function*(){return n.player.windowHandlers.stopListeningToVisibilityChanges(e)}))()}exitFullscreen(){return ai()}isInFullscreen(){return oi()}requestFullscreenForElement(e){return si(e)}constructor(e){this.player=e}}function asyncGeneratorStep$14(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}class UnsupportedSeeker{start(){Lt.warn("seeker.start is not supported in this playback method")}end(){Lt.warn("seeker.end is not supported in this playback method")}seekToTime(e){return Lt.warn("seekToTime is not supported in this playback method"),Promise.resolve()}constructor(){this.ended=!1}}class PlayerSeeker{get ended(){return this._ended}get isEngagedInPlayback(){return this._player.isEngagedInPlayback}get stillPlayingSameItem(){return this._currentItem===this._player.nowPlayingItem}end(){Lt.debug("seeker: end"),-1!==this._startTime?this._ended?Lt.warn("seeker: Cannot end the same seeker twice."):(this.dispatchStartEvent(),this.dispatchEndEvent()):Lt.warn("seeker: Cannot end a seeker before starting it.")}seekToTime(e){var n,d=this;return(n=function*(){if(Lt.debug("seeker: seekToTime",e),!d.ended)return d.stillPlayingSameItem||(d._currentItem=d._player.nowPlayingItem,d._startTime=0),d._lastSeekedTime=e,d._player.seekToTime(e);Lt.warn("seeker: Cannot seek once the seeker has ended")},function(){var e=this,d=arguments;return new Promise((function(p,h){var y=n.apply(e,d);function _next(e){asyncGeneratorStep$14(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$14(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))})()}start(){Lt.debug("seeker: start"),-1===this._startTime?(this._currentItem=this._player.nowPlayingItem,this._startTime=this._player.currentPlaybackTime,this._lastSeekedTime=this._startTime):Lt.warn("seeker: Cannot start same seeker twice")}dispatch(e,n){this.isEngagedInPlayback?(Lt.debug("seeker: dispatch",e),this._player.dispatch(e,n)):Lt.debug("seeker: do not dispatch because isEngagedInPlayback",this.isEngagedInPlayback)}dispatchStartEvent(){this.stillPlayingSameItem||(this._startTime=0,this._lastSeekedTime=0),this.dispatch(hr.playbackScrub,{item:this._currentItem,position:this._startTime})}dispatchEndEvent(){this._ended=!0,this.dispatch(hr.playbackScrub,{item:this._currentItem,position:this._lastSeekedTime,endReasonType:e.PlayActivityEndReasonType.SCRUB_END})}constructor(e){this._ended=!1,this._lastSeekedTime=-1,this._startTime=-1,Lt.debug("seeker: new"),this._player=e}}function asyncGeneratorStep$13(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}var ci={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},li={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};const{visibilityChangeEvent:ui,visibilityState:di,unloadEventName:pi}=(()=>{let e="visibilitychange",n="visibilityState";void 0!==document.mozHidden?(e="mozvisibilitychange",n="mozVisibilityState"):void 0!==document.msHidden?(e="msvisibilitychange",n="msVisibilityState"):document.webkitHidden&&(e="webkitvisibilitychange",n="webkitVisibilityState");return{visibilityChangeEvent:e,visibilityState:n,unloadEventName:"onpagehide"in window?"pagehide":"unload"}})();class WindowHandlers{activate(e=self,n=self.document){n.addEventListener(ui,this.visibilityChanged),e.addEventListener("storage",this.storage,!1),e.addEventListener(pi,this.windowUnloaded)}deactivate(){document.removeEventListener(ui,this.visibilityChanged),window.removeEventListener("storage",this.storage),window.addEventListener(pi,this.windowUnloaded)}stopListeningToVisibilityChanges(e){var n,d=this;return(n=function*(){d.dispatchVisibilityChanges=!1;const n=yield e();return d.dispatchVisibilityChanges=!0,n},function(){var e=this,d=arguments;return new Promise((function(p,h){var y=n.apply(e,d);function _next(e){asyncGeneratorStep$13(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$13(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))})()}dispatch(e,n={}){this.player.dispatch(e,n)}storage({key:e,newValue:n}){e===Qt&&this.player.tsidChanged(n)}visibilityChanged(e){const n=e.target[di];Lt.info("dc visibilityState",n,e,oi()),this.browser.isiOS&&this.dispatchVisibilityChanges&&("hidden"===n?this.dispatch(hr.playerExit,{item:this.player.nowPlayingItem,position:this.player.currentPlaybackTime}):"visible"===n&&this.dispatch(hr.playerActivate))}windowUnloaded(){this.player.isPlaying&&this.dispatch(hr.playerExit,{item:this.player.nowPlayingItem,position:this.player.currentPlaybackTime})}constructor(e,n=zt){this.dispatchVisibilityChanges=!0,this.player=e,this.browser=n}}function asyncGeneratorStep$12(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$12(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$12(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$12(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$A(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$A(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$A(e,n,d[n])}))}return e}ci([Bind(),li("design:type",Function),li("design:paramtypes",[void 0])],WindowHandlers.prototype,"storage",null),ci([Bind(),li("design:type",Function),li("design:paramtypes",["undefined"==typeof Event?Object:Event])],WindowHandlers.prototype,"visibilityChanged",null),ci([Bind(),li("design:type",Function),li("design:paramtypes",[])],WindowHandlers.prototype,"windowUnloaded",null);var hi={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},yi={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};const{bufferedProgressDidChange:fi,mediaCanPlay:mi,mediaElementCreated:gi,mediaPlaybackError:vi,nowPlayingItemDidChange:bi,nowPlayingItemWillChange:_i,metadataDidChange:Pi,primaryPlayerDidChange:Ti,playbackDurationDidChange:Si,playbackProgressDidChange:Ei,playbackStateDidChange:ki,playbackRateDidChange:wi,playbackStateWillChange:Oi,playbackTargetAvailableDidChange:Ii,playbackTargetIsWirelessDidChange:Ai,playbackTimeDidChange:Ri,playbackVolumeDidChange:Ci}=fr,Mi=["canplay","durationchange","ended","error","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","timeupdate","volumechange","waiting"],Di=["NotAllowedError","NotSupportedError"],{ended:ji,loading:xi,paused:$i,playing:Li,seeking:Ni,stopped:Ui,waiting:Gi}=e.PlaybackStates;class BasePlayer{get bitrate(){return this._bitrateCalculator.bitrate}get currentBufferedProgress(){return this._currentBufferedProgress}get _currentDuration(){return this._targetElement.duration}get _currentTime(){const e=this._targetElement.currentTime,n=this._buffer;var d;return e-(null!==(d=null==n?void 0:n.currentTimestampOffset)&&void 0!==d?d:0)}get currentPlaybackDuration(){const n=this.nowPlayingItem;if(!n)return 0;const d=n.playbackType===e.PlaybackType.encryptedFull||n.playbackType===e.PlaybackType.unencryptedFull,p=n.playbackDuration;return d&&p?this.calculateTime(p/1e3):this.calculateTime(this._currentDuration)}get currentPlaybackTime(){return this.calculateTime(this._currentTime)}calculateTime(e){return this._timing.time(e)}get currentPlaybackTimeRemaining(){return this.currentPlaybackDuration-this.currentPlaybackTime}get currentPlaybackProgress(){return this._currentPlaybackProgress||0}get hasMediaElement(){return this._targetElement instanceof HTMLElement&&null!==this._targetElement.parentNode}get isEngagedInPlayback(){return!this._stopped&&!this.isPaused()}get isPlaying(){return this.playbackState===Li}get isPrimaryPlayer(){return this._isPrimaryPlayer}set isPrimaryPlayer(e){var n;e!==this._isPrimaryPlayer&&(this._isPrimaryPlayer=e,this._isPrimaryPlayer?null===(n=getLocalStorage())||void 0===n||n.setItem(Qt,this._serial):(this._dispatcher.publish(Ti,{target:this}),this.pause({userInitiated:!1})))}get isReady(){return 0!==this._targetElement.readyState}get nowPlayingItem(){return this._nowPlayingItem}set nowPlayingItem(e){const n=this._dispatcher;if(void 0===e)return n.publish(_i,{item:e}),this._nowPlayingItem=e,void n.publish(bi,{item:e});const d=this._nowPlayingItem,p=this._buffer;(null==d?void 0:d.isEqual(e))||(n.publish(_i,{item:e}),this.isPlaying&&(null==p?void 0:p.currentItem)!==e&&this._pauseMedia(),d&&(Lt.debug("setting state to ended on ",d.title),d.state=G.ended,d.endMonitoringStateDidChange(),d.endMonitoringStateWillChange()),this._nowPlayingItem=e,Lt.debug("setting state to playing on ",e.title),e.state=G.playing,e&&e.info&&this._setTargetElementTitle(e.info),n.publish(bi,{item:e}),n.publish(Si,{currentTarget:this._targetElement,duration:this.currentPlaybackDuration,target:this._targetElement,type:"durationchange"}))}get playbackRate(){return this._targetElement.playbackRate}set playbackRate(e){this._targetElement.playbackRate=e}get playbackState(){return this._playbackState}setPlaybackState(e,n){const d=this._playbackState;if(e===d)return;const p={oldState:d,state:e,nowPlayingItem:n};Lt.debug("BasePlayer.playbackState is changing",p),this._dispatcher.publish(Oi,p),this._playbackState=e,this._dispatcher.publish(ki,p)}get playbackTargetAvailable(){return void 0!==window.WebKitPlaybackTargetAvailabilityEvent&&this._playbackTargetAvailable}set playbackTargetAvailable(e){e!==this._playbackTargetAvailable&&(this._playbackTargetAvailable=e,this._dispatcher.publish(Ii,{available:e}))}get playbackTargetIsWireless(){return void 0!==window.WebKitPlaybackTargetAvailabilityEvent&&this._playbackTargetIsWireless}set playbackTargetIsWireless(e){e!==this._playbackTargetIsWireless&&(this._playbackTargetIsWireless=e,this._dispatcher.publish(Ai,{playing:e}))}get volume(){return this._targetElement.volume}set volume(e){this._targetElement.volume=e}get isDestroyed(){return this._isDestroyed}clearNextManifest(){var e;null===(e=this._buffer)||void 0===e||e.clearNextManifest()}initialize(){var e=this;return _asyncToGenerator$12((function*(){Lt.debug("BasePlayer.initialize"),e.isPlayerSupported()?(yield e.initializeMediaElement(),yield e.initializeExtension(),e.initializeEventHandlers(),e._dispatcher.publish(gi,e._targetElement)):Lt.warn("{this.constructor.name} not supported")}))()}initializeEventHandlers(){if(this.windowHandlers.activate(),!this.hasMediaElement)return;const e=this._targetElement;window.WebKitPlaybackTargetAvailabilityEvent&&(e.addEventListener("webkitplaybacktargetavailabilitychanged",e=>{this.playbackTargetAvailable="available"===e.availability}),e.addEventListener("webkitcurrentplaybacktargetiswirelesschanged",e=>{this.playbackTargetIsWireless=e.target===this._targetElement&&!this.playbackTargetIsWireless})),Mi.forEach(n=>e.addEventListener(n,this)),this._dispatcher.publish(hr.playerActivate)}removeEventHandlers(){Mi.forEach(e=>this._targetElement.removeEventListener(e,this)),this.windowHandlers.deactivate()}isPaused(){return this._paused}exitFullscreen(){return this.fullscreen.exit()}requestFullscreen(e){return this.fullscreen.request(e)}newSeeker(){var e;return null===(e=this._seeker)||void 0===e||e.end(),this._seeker=new PlayerSeeker(this),this._seeker}stop(e){var n=this;return _asyncToGenerator$12((function*(){Lt.debug("BasePlayer.stop",e),yield n._waitForPendingPlay(),n.isPlaying&&(Lt.debug("BasePlayer.play dispatching playbackStop"),n.dispatch(hr.playbackStop,_objectSpread$A({item:n.nowPlayingItem,position:n.currentPlaybackTime,startPosition:n.initialBufferPosition,playingDate:n.currentPlayingDate,startPlayingDate:n.initialPlayingDate},e))),yield n.stopMediaAndCleanup()}))()}stopMediaAndCleanup(e=Ui){var n=this;return _asyncToGenerator$12((function*(){Lt.debug("stopMediaAndCleanup"),yield n._stopMediaElement(),n._stopped=!0,n._paused=!1;const d=n.nowPlayingItem;n.nowPlayingItem=void 0,n.initialBufferPosition=void 0,n.initialPlayingDate=void 0,n.setPlaybackState(e,d)}))()}onPlaybackError(n,d){this.resetDeferredPlay(),this.stop({endReasonType:e.PlayActivityEndReasonType.FAILED_TO_LOAD,userInitiated:!1})}calculatePlaybackProgress(){const e=Math.round(100*(this.currentPlaybackTime/this.currentPlaybackDuration||0))/100;this._currentPlaybackProgress!==e&&(this._currentPlaybackProgress=e,this._dispatcher.publish(Ei,{progress:this._currentPlaybackProgress}))}calculateBufferedProgress(e){const n=Math.round(e/this.currentPlaybackDuration*100);this._currentBufferedProgress!==n&&(this._currentBufferedProgress=n,this._dispatcher.publish(fi,{progress:n}))}destroy(){var e,n;if(Lt.debug("BasePlayer.destroy"),this._isDestroyed=!0,this._dispatcher.unsubscribe(vi,this.onPlaybackError),!this.hasMediaElement)return;const d=this._targetElement;null===(e=this.extension)||void 0===e||e.destroy(d),this.removeEventHandlers(),this.cleanupElement(),null===(n=d.parentNode)||void 0===n||n.removeChild(d)}handleEvent(n){var d=this;return _asyncToGenerator$12((function*(){"timeupdate"!==n.type&&Lt.debug("BasePlayer.handleEvent: ",n.type,n,d.isPaused(),d._stopped);const{nowPlayingItem:p}=d;switch(n.type){case"canplay":d._dispatcher.publish(mi,n),d._playbackState!==Gi||d._targetElement.paused||d.setPlaybackState(Li,p);break;case"durationchange":d._targetElement.duration!==1/0&&(n.duration=d.currentPlaybackDuration,d._dispatcher.publish(Si,n),d.calculatePlaybackProgress());break;case"ended":{var h;if(Lt.debug('media element "ended" event'),null===(h=d.nowPlayingItem)||void 0===h?void 0:h.isLinearStream)return void Lt.warn("ignoring ended event for linear stream",n);if(d.isElementCleaned()){Lt.debug('media element already cleaned, ignoring "ended" event');break}const p=d.nowPlayingItem,y=d.currentPlaybackTime,m=d.currentPlayingDate;yield d.stopMediaAndCleanup(ji),d.dispatch(hr.playbackStop,{item:p,position:y,playingDate:m,endReasonType:e.PlayActivityEndReasonType.NATURAL_END_OF_TRACK});break}case"error":Lt.error("Playback Error",n,d._targetElement.error),d._dispatcher.publish(vi,new MKError(MKError.MEDIA_PLAYBACK,"Playback Error"));break;case"loadedmetadata":d._dispatcher.publish(Pi,n);break;case"loadstart":d.setPlaybackState(xi,p);break;case"pause":d.setPlaybackState(d._stopped?Ui:$i,p);break;case"play":case"playing":d._paused=!1,d._stopped=!1,d.isPrimaryPlayer=!0,d.setPlaybackState(Li,p);break;case"progress":{const e=d._targetElement.buffered;d.handleBufferStart(),1===e.length&&0===e.start(0)&&d.calculateBufferedProgress(e.end(0));break}case"ratechange":d._dispatcher.publish(wi,n);break;case"seeked":d._stopped?d.setPlaybackState(Ui,p):d._paused?d.setPlaybackState($i,p):d.playbackState!==ji&&d.setPlaybackState(Li,p);break;case"seeking":d.playbackState===$i?d._paused=!0:d.playbackState===Ui&&(d._stopped=!0),d.playbackState!==ji&&d.setPlaybackState(Ni,p);break;case"timeupdate":{d._dispatcher.publish(Ri,{currentPlaybackDuration:d.currentPlaybackDuration,currentPlaybackTime:d.currentPlaybackTime,currentPlaybackTimeRemaining:d.currentPlaybackTimeRemaining}),d.calculatePlaybackProgress();const e=d._buffer;e&&(e.currentTime=d.currentPlaybackTime);break}case"volumechange":d._dispatcher.publish(Ci,n);break;case"waiting":d.setPlaybackState(Gi,p)}}))()}handleBufferStart(){const{_targetElement:e}=this;void 0!==this.initialBufferPosition||e.paused||0===e.buffered.length||(this.initialBufferPosition=e.buffered.start(0),this.initialPlayingDate=this.currentPlayingDate,Lt.debug("BasePlayer.handleBufferStart: setting initial buffer position ",this.initialBufferPosition))}pause(e={}){var n=this;return _asyncToGenerator$12((function*(){yield n._waitForPendingPlay(),n.isPlaying&&(yield n._pauseMedia(),n._paused=!0,n.dispatch(hr.playbackPause,_objectSpread$A({item:n.nowPlayingItem,position:n.currentPlaybackTime,playingDate:n.currentPlayingDate},e)))}))()}play(e=!0){var n=this;return _asyncToGenerator$12((function*(){if(Lt.debug("BasePlayer.play()"),n.nowPlayingItem)try{yield n._playMedia(),Lt.debug("BasePlayer.play dispatching playbackPlay"),n.dispatch(hr.playbackPlay,{userInitiated:e,item:n.nowPlayingItem,position:n.currentPlaybackTime,playingDate:n.currentPlayingDate})}catch(Lr){if(Lr&&Di.includes(Lr.name)&&Lt.error("BasePlayer.play() rejected due to",Lr),"NotAllowedError"===(null==Lr?void 0:Lr.name))throw new MKError(MKError.USER_INTERACTION_REQUIRED,"Playback of media content requires user interaction first and cannot be automatically started on page load.")}}))()}preload(){return this._loadMedia()}showPlaybackTargetPicker(){this.playbackTargetAvailable&&this._targetElement.webkitShowPlaybackTargetPicker()}dispatch(e,n){void 0===n.item&&(n.item=this.nowPlayingItem),hasOwn(n,"isPlaying")||(n.isPlaying=this.isPlaying),this._dispatcher.publish(e,n)}tsidChanged(e){void 0!==e&&""!==e&&(this.isPrimaryPlayer=e===this._serial)}_waitForPendingPlay(){var e=this;return _asyncToGenerator$12((function*(){e._deferredPlay&&(yield e._deferredPlay.promise,e._deferredPlay=void 0)}))()}_loadMedia(){var e=this;return _asyncToGenerator$12((function*(){Lt.debug("BasePlayer._loadMedia",e._targetElement),e._targetElement.load()}))()}_pauseMedia(){var e=this;return _asyncToGenerator$12((function*(){e._targetElement.pause()}))()}_playAssetURL(e,n){var d=this;return _asyncToGenerator$12((function*(){Lt.debug("BasePlayer._playAssetURL",e),d._targetElement.src=e;const p=d._loadMedia();if(n)return Lt.debug("BasePlayer.loadOnly"),void(yield p);yield d._playMedia()}))()}playItemFromUnencryptedSource(e,n,d){var p=this;return _asyncToGenerator$12((function*(){return(null==d?void 0:d.startTime)&&(e+="#t="+d.startTime),n||p.startPlaybackSequence(),yield p._playAssetURL(e,n),p.finishPlaybackSequence()}))()}_playMedia(){var e=this;return _asyncToGenerator$12((function*(){Lt.debug("BasePlayer._playMedia",e._targetElement,e.extension);try{yield e._targetElement.play(),e._playbackDidStart=!0}catch(Y){throw Lt.error("BasePlayer._playMedia: targetElement.play() rejected",Y),Y}}))()}_setTargetElementTitle(e){this.hasMediaElement&&(this._targetElement.title=e)}resetDeferredPlay(){this._deferredPlay=void 0}_stopMediaElement(){var e=this;return _asyncToGenerator$12((function*(){e.hasMediaElement&&(e._targetElement.pause(),e.cleanupElement())}))()}cleanupElement(){const e=this._targetElement;e&&!this.isElementCleaned()&&(e.currentTime=0,e.removeAttribute("src"),e.removeAttribute("title"))}isElementCleaned(){const e=this._targetElement;return!e||0===e.currentTime&&""===e.src&&""===e.title}finishPlaybackSequence(){var e;Lt.debug("BasePlayer.finishPlaybackSequence",this._deferredPlay);const n=null===(e=this._deferredPlay)||void 0===e?void 0:e.resolve(void 0);return this._deferredPlay=void 0,n}startPlaybackSequence(){return Lt.debug("BasePlayer.startPlaybackSequence",this._deferredPlay),this._deferredPlay&&(Lt.warn("Previous playback sequence not cleared"),this.finishPlaybackSequence()),this._deferredPlay=function(){let e,n;return{promise:new Promise((function(d,p){e=d,n=p})),resolve(n){null==e||e(n)},reject(e){null==n||n(e)}}}(),this._deferredPlay.promise}constructor(n){var d;this.privateEnabled=!1,this.siriInitiated=!1,this._currentBufferedProgress=0,this._paused=!1,this._playbackState=e.PlaybackStates.none,this._stopped=!1,this._playbackDidStart=!1,this._currentPlaybackProgress=0,this._isPrimaryPlayer=!0,this._playbackTargetAvailable=!1,this._playbackTargetIsWireless=!1,this._serial=Date.now().toString(),this._isDestroyed=!1,this._dispatcher=n.services.dispatcher,this._timing=n.services.timing,this._context=n.context||{},this.privateEnabled=n.privateEnabled||!1,this.siriInitiated=n.siriInitiated||!1,this._bitrateCalculator=n.services.bitrateCalculator,this.windowHandlers=new WindowHandlers(this),this.fullscreen=new Fullscreen(this),null===(d=getLocalStorage())||void 0===d||d.setItem(Qt,this._serial),this._dispatcher.subscribe(vi,this.onPlaybackError)}}function generateAssetUrl(e,n){if("Preview"===e.type&&isStringNotEmpty(e.previewURL))return e.previewURL;let d=e.assetURL;if(!d)throw new Error("Cannot generate asset URL");return n&&(n.startOver&&(d=addQueryParamsToURL(d,{startOver:!0})),n.bingeWatching&&(d=addQueryParamsToURL(d,{bingeWatching:!0}))),e.supportsLinearScrubbing&&(d=addQueryParamsToURL(d,{linearScrubbingSupported:!0})),d.match(/xapsub=accepts-css/)||(d=addQueryParamsToURL(d,{xapsub:"accepts-css"})),d}function restoreSelectedTrack(e,n){Lt.debug("MEDIA_TRACKS restoreSelectedTrack");const d=e.getPersistedTrack(),p=e.fields,h=n.currentTrack;if(!d)return void Lt.debug("MEDIA_TRACKS no persisted track");if(h&&trackEquals(h,d,p))return void Lt.debug("MEDIA_TRACKS persisted track is equal to current track, not setting");const y=n.tracks;if(y&&y.length)for(let m=0;m<y.length;m++){const e=y[m];if(Lt.debug(`MEDIA_TRACKS testing track ${e.label} against persisted track ${JSON.stringify(d)}`),trackEquals(e,d,p)){Lt.debug("MEDIA_TRACKS found matching track "+e.label),n.currentTrack=e;break}}}function trackEquals(e,n,d){let p=!0;for(let h=0;h<d.length;h++){const y=d[h];if(e[y]!==n[y]){p=!1;break}}return p}hi([Bind(),yi("design:type",Function),yi("design:paramtypes",[String,void 0===MKError?Object:MKError])],BasePlayer.prototype,"onPlaybackError",null);class TrackPersistence{getPersistedTrack(){var e;if(!hasLocalStorage())return!1;const n=(null===(e=getLocalStorage())||void 0===e?void 0:e.getItem(this.storageKey))||"";try{return JSON.parse(n)}catch(Lr){return Lt.warn("MEDIA_TRACK could not parse persisted value "+n),!1}}setPersistedTrack(e){var n,d;if(!hasLocalStorage())return;if(Lt.debug(`MEDIA_TRACK setPersistedTrack ${e.language},${e.label},${e.kind} with keys ${this.fields}`),!e)return void(null===(d=getLocalStorage())||void 0===d||d.setItem(this.storageKey,""));const p=JSON.stringify(this.extractFieldValuesFromTrack(e));Lt.debug("MEDIA_TRACK Extracted values "+p),null===(n=getLocalStorage())||void 0===n||n.setItem(this.storageKey,p)}extractFieldValuesFromTrack(e){const n={};return this.fields.forEach(d=>{const p=e[d];null==p&&Lt.warn(`MEDIA_TRACK No value for field ${d} on track ${JSON.stringify(e)}`),n[d]=p}),n}constructor(e,n){this.storageKey=e,this.fields=n}}var Bi;!function(e){e.Home="com.apple.amp.appletv.home-team-radio",e.Away="com.apple.amp.appletv.away-team-radio"}(Bi||(Bi={}));class TrackManagerStub{get currentTrack(){return{}}set currentTrack(e){}get tracks(){return[]}destroy(){}restoreSelectedTrack(){}}const{audioTrackAdded:Fi,audioTrackChanged:Ki,audioTrackRemoved:Vi}=fr,{audioTracksSwitched:Hi,audioTracksUpdated:qi}=tr;class AudioTrackManager{get currentTrack(){return this.tracks.find(e=>e.enabled)}set currentTrack(e){e&&(Lt.debug("MEDIA_TRACK Setting audio track "+e.label),this.extensionTracks?(Lt.debug(`MEDIA_TRACK Setting track on extension ${e.id}-${e.label}`),this.extensionTracks.audioTrack=e):(Lt.debug("MEDIA_TRACK disabling all audio tracks"),Array.from(this.mediaElement.audioTracks).forEach(n=>{n!==e&&(n.enabled=!1)}),Lt.debug("MEDIA_TRACK enabling",e),e.enabled=!0),function(e){return void 0!==e.characteristics&&e.characteristics.includes("com.apple.amp.appletv.home-team-radio")}(e)||function(e){return void 0!==e.characteristics&&e.characteristics.includes("com.apple.amp.appletv.away-team-radio")}(e)||this.trackPersistence.setPersistedTrack(e))}get tracks(){return this.extensionTracks?this._extensionTracks||this.extensionTracks.audioTracks||[]:Array.from(this.mediaElement.audioTracks)}destroy(){if(this.extensionTracks){const e=this.extensionTracks;e.removeEventListener(qi,this.onExtensionAudioTracksUpdated),e.removeEventListener(Hi,this.onExtensionAudioTrackSwitched)}else{if(!this.mediaElement.audioTracks)return;this.mediaElement.audioTracks.removeEventListener("addtrack",this.onAudioTrackAdded),this.mediaElement.audioTracks.removeEventListener("change",this.onAudioTrackChanged),this.mediaElement.audioTracks.removeEventListener("removetrack",this.onAudioTrackRemoved)}}restoreSelectedTrack(){return restoreSelectedTrack(this.trackPersistence,this)}onExtensionAudioTracksUpdated(e){Lt.debug("MEDIA_TRACK Extension audio tracks updated "+JSON.stringify(e)),this._extensionTracks=e,this.restoreSelectedTrack(),this.dispatcher.publish(Fi,e)}onExtensionAudioTrackSwitched(e){if(Lt.debug("MEDIA_TRACK Extension audio track switched "+JSON.stringify(e)),this._extensionTracks){const preserveSelectedTrack=n=>{n.enabled=e.selectedId===n.id};this._extensionTracks.forEach(preserveSelectedTrack)}this.dispatcher.publish(Ki,e)}onAudioTrackAdded(e){!function(e,n,d){const p=n.getPersistedTrack();p&&trackEquals(e,p,n.fields)&&(Lt.debug("MEDIA_TRACK onTrackAdded with track that matches persisted track "+e.label),d.currentTrack=e)}(e.track,this.trackPersistence,this),this.dispatcher.publish(Fi,e)}onAudioTrackChanged(e){this.dispatcher.publish(Ki,e)}onAudioTrackRemoved(e){this.dispatcher.publish(Vi,e)}constructor(e,n,d){if(this.mediaElement=e,this.dispatcher=n,this.extensionTracks=d,this._extensionTracks=[],this.trackPersistence=new TrackPersistence("mk-audio-track",["label","language","kind"]),this.extensionTracks){Lt.debug("MEDIA_TRACK Initializing audio track manager for hls track events"),this.onExtensionAudioTracksUpdated=this.onExtensionAudioTracksUpdated.bind(this),this.onExtensionAudioTrackSwitched=this.onExtensionAudioTrackSwitched.bind(this);const e=this.extensionTracks;e.addEventListener(qi,this.onExtensionAudioTracksUpdated),e.addEventListener(Hi,this.onExtensionAudioTrackSwitched)}else{if(!e.audioTracks)return;Lt.debug("MEDIA_TRACK Initializing audio track manager for native track events"),this.onAudioTrackAdded=this.onAudioTrackAdded.bind(this),this.onAudioTrackChanged=this.onAudioTrackChanged.bind(this),this.onAudioTrackRemoved=this.onAudioTrackRemoved.bind(this),e.audioTracks.addEventListener("addtrack",this.onAudioTrackAdded),e.audioTracks.addEventListener("change",this.onAudioTrackChanged),e.audioTracks.addEventListener("removetrack",this.onAudioTrackRemoved)}}}const zi=BooleanDevFlag.register("mk-load-manifest-once"),shouldLoadManifestOnce=()=>!zi.configured||zi.enabled;var Wi=createCommonjsModule((function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isValidScrollSetting=n.isValidPositionAlignSetting=n.isValidLineAlignSetting=n.isValidLineAndPositionSetting=n.isValidDirectionSetting=n.isValidAlignSetting=n.isValidPercentValue=void 0,n.isValidPercentValue=function(e){return"number"==typeof e&&e>=0&&e<=100},n.isValidAlignSetting=function(e){return"string"==typeof e&&["start","center","end","left","right","middle"].includes(e)},n.isValidDirectionSetting=function(e){return"string"==typeof e&&["","rl","lr"].includes(e)},n.isValidLineAndPositionSetting=function(e){return"number"==typeof e||"auto"===e},n.isValidLineAlignSetting=function(e){return"string"==typeof e&&["start","center","end"].includes(e)},n.isValidPositionAlignSetting=function(e){return"string"==typeof e&&["line-left","center","line-right","auto","left","start","middle","end","right"].includes(e)},n.isValidScrollSetting=function(e){return["","up"].includes(e)}}));unwrapExports(Wi),Wi.isValidScrollSetting,Wi.isValidPositionAlignSetting,Wi.isValidLineAlignSetting,Wi.isValidLineAndPositionSetting,Wi.isValidDirectionSetting,Wi.isValidAlignSetting,Wi.isValidPercentValue;var Yi=createCommonjsModule((function(e,n){Object.defineProperty(n,"__esModule",{value:!0});const d={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"","&rlm;":"","&nbsp;":""},p={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},h={v:"title",lang:"lang"},y={rt:"ruby"},m={"text-combine-upright":"-webkit-text-combine:horizontal; text-orientation: mixed;"};class ParserUtility{static parseTimeStamp(e){function computeSeconds(e){const[n,d,p,h]=e.map(e=>e?parseInt(""+e):0);return 3600*n+60*d+p+h/1e3}const n=/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/.exec(e);return n?n[3]?computeSeconds([n[1],n[2],n[3].substring(1),n[4]]):parseInt(n[1])>59?computeSeconds([n[1],n[2],null,n[4]]):computeSeconds([null,n[1],n[2],n[4]]):null}static parseContent(e,n,g){let b=n.text;function nextToken(){if(!b)return null;const e=/^([^<]*)(<[^>]+>?)?/.exec(b);return n=e[1]?e[1]:e[2],b=b.substr(n.length),n;var n}function unescape1(e){return d[e]}function unescape(e){return e.replace(/&(amp|lt|gt|lrm|rlm|nbsp);/g,unescape1)}function shouldAdd(e,n){return!y[n.dataset.localName]||y[n.dataset.localName]===e.dataset.localName}function createElement(n,d,y){const b=p[n];if(!b)return null;const _=e.document.createElement(b);_.dataset.localName=b;const P=h[n];if(P&&y&&(_[P]=y.trim()),d)if(g[d]){const e=function(e){let n="";for(const d in e)n+=m[d]?m[d]:d+":"+e[d]+";";return n}(g[d]);_.setAttribute("style",e)}else console.info(`WebVTT: parseContent: Style referenced, but no style defined for '${d}'!`);return _}const _=e.document.createElement("div"),P=[];let T,S,E=_;for(;null!==(T=nextToken());)if("<"!==T[0])E.appendChild(e.document.createTextNode(unescape(T)));else{if("/"===T[1]){P.length&&P[P.length-1]===T.substr(2).replace(">","")&&(P.pop(),E=E.parentNode);continue}const n=ParserUtility.parseTimeStamp(T.substr(1,T.length-2));let d;if(n){d=e.document.createProcessingInstruction("timestamp",n.toString()),E.appendChild(d);continue}if(S=/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/.exec(T),!S)continue;if(d=createElement(S[1],S[2],S[3]),!d)continue;if(!shouldAdd(E,d))continue;S[2],P.push(S[1]),E.appendChild(d),E=d}return _}}n.default=ParserUtility}));unwrapExports(Yi);var Qi=createCommonjsModule((function(e,n){var d=He&&He.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m};Object.defineProperty(n,"__esModule",{value:!0}),n.VTTCue=void 0;let p=class{get id(){return this._id}set id(e){this._id=""+e}get pauseOnExit(){return this._pauseOnExit}set pauseOnExit(e){this._pauseOnExit=!!e}get startTime(){return this._startTime}set startTime(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number: "+e);this._startTime=e,this.hasBeenReset=!0}get endTime(){return this._endTime}set endTime(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number: "+e);this._endTime=e,this.hasBeenReset=!0}get text(){return this._text}set text(e){this._text=""+e,this.hasBeenReset=!0}get region(){return this._region}set region(e){this._region=e,this.hasBeenReset=!0}get vertical(){return this._vertical}set vertical(e){if(!Wi.isValidDirectionSetting(e))throw new SyntaxError("An invalid or illegal string was specified for vertical: "+e);this._vertical=e,this.hasBeenReset=!0}get snapToLines(){return this._snapToLines}set snapToLines(e){this._snapToLines=!!e,this.hasBeenReset=!0}get line(){return this._line}set line(e){if(!Wi.isValidLineAndPositionSetting(e))throw new SyntaxError("An invalid number or illegal string was specified for line: "+e);this._line=e,this.hasBeenReset=!0}get lineAlign(){return this._lineAlign}set lineAlign(e){if(!Wi.isValidLineAlignSetting(e))throw new SyntaxError("An invalid or illegal string was specified for lineAlign: "+e);this._lineAlign=e,this.hasBeenReset=!0}get position(){return this._position}set position(e){if(!Wi.isValidLineAndPositionSetting(e))throw new Error("Position must be between 0 and 100 or auto: "+e);this._position=e,this.hasBeenReset=!0}get positionAlign(){return this._positionAlign}set positionAlign(e){if(!Wi.isValidPositionAlignSetting(e))throw new SyntaxError("An invalid or illegal string was specified for positionAlign: "+e);this._positionAlign=e,this.hasBeenReset=!0}get size(){return this._size}set size(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100: "+e);this._size=e,this.hasBeenReset=!0}get align(){return this._align}set align(e){if(!Wi.isValidAlignSetting(e))throw new SyntaxError("An invalid or illegal string was specified for align: "+e);this._align=e,this.hasBeenReset=!0}getCueAsHTML(){return Yi.default.parseContent(window,this,{})}static create(e){if(!e.hasOwnProperty("startTime")||!e.hasOwnProperty("endTime")||!e.hasOwnProperty("text"))throw new Error("You must at least have start time, end time, and text.");const n=new this(e.startTime,e.endTime,e.text);return Object.keys(e).forEach(d=>{n.hasOwnProperty(d)&&(n[d]=e[d])}),n}static fromJSON(e){return this.create(JSON.parse(e))}toJSON(){const e={};return Object.keys(this).forEach(n=>{this.hasOwnProperty(n)&&"getCueAsHTML"!==n&&"hasBeenReset"!==n&&"displayState"!==n&&(e[n]=this[n])}),e}constructor(e,n,d){this._id="",this._pauseOnExit=!1,this._region=null,this._vertical="",this._snapToLines=!0,this._line="auto",this._lineAlign="start",this._position="auto",this._positionAlign="auto",this._size=100,this._align="center",this.hasBeenReset=!1,this._startTime=e,this._endTime=n,this._text=d}};p=d([function(e){let n=e;"undefined"!=typeof window&&null!=window.VTTCue&&(n=window.VTTCue,n.create=e.create,n.fromJSON=e.fromJSON,n.prototype.toJSON=e.prototype.toJSON);return n}],p),n.VTTCue=p}));unwrapExports(Qi),Qi.VTTCue;var Ji=createCommonjsModule((function(e,n){var d=He&&He.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m};Object.defineProperty(n,"__esModule",{value:!0}),n.VTTRegion=void 0;let p=class{get id(){return this._id}set id(e){if("string"!=typeof e)throw new Error("ID must be a string.");this._id=e}get lines(){return this._lines}set lines(e){if("number"!=typeof e)throw new TypeError("Lines must be set to a number.");this._lines=e}get regionAnchorX(){return this._regionAnchorX}set regionAnchorX(e){if(!Wi.isValidPercentValue(e))throw new TypeError("RegionAnchorX must be between 0 and 100.");this._regionAnchorX=e}get regionAnchorY(){return this._regionAnchorY}set regionAnchorY(e){if(!Wi.isValidPercentValue(e))throw new TypeError("RegionAnchorY must be between 0 and 100.");this._regionAnchorY=e}get scroll(){return this._scroll}set scroll(e){if("string"==typeof e){const n=e.toLowerCase();if(Wi.isValidScrollSetting(n))return void(this._scroll=n)}throw new SyntaxError("An invalid or illegal string was specified.")}get viewportAnchorX(){return this._viewportAnchorX}set viewportAnchorX(e){if(!Wi.isValidPercentValue(e))throw new TypeError("ViewportAnchorX must be between 0 and 100.");this._viewportAnchorX=e}get viewportAnchorY(){return this._viewportAnchorY}set viewportAnchorY(e){if(!Wi.isValidPercentValue(e))throw new TypeError("ViewportAnchorY must be between 0 and 100.");this._viewportAnchorY=e}get width(){return this._width}set width(e){if(!Wi.isValidPercentValue(e))throw new TypeError("Width must be between 0 and 100.");this._lines=e}toJSON(){const e={};return Object.keys(this).forEach(n=>{this.hasOwnProperty(n)&&(e[n]=this[n])}),e}static create(e){const n=new this;return Object.keys(e).forEach(d=>{n.hasOwnProperty(d)&&(n[d]=e[d])}),n}static fromJSON(e){return this.create(JSON.parse(e))}constructor(){this._id="",this._lines=3,this._regionAnchorX=0,this._regionAnchorY=100,this._scroll="",this._viewportAnchorX=0,this._viewportAnchorY=100,this._width=100}};p=d([function(e){let n=e;"undefined"!=typeof window&&null!=window.VTTRegion&&(n=window.VTTRegion,n.create=e.create,n.fromJSON=e.fromJSON,n.prototype.toJSON=e.prototype.toJSON);return n}],p),n.VTTRegion=p}));unwrapExports(Ji),Ji.VTTRegion;var Xi=createCommonjsModule((function(e,n){Object.defineProperty(n,"__esModule",{value:!0})}));unwrapExports(Xi);var Zi=createCommonjsModule((function(e,n){var d=He&&He.__createBinding||(Object.create?function(e,n,d,p){void 0===p&&(p=d),Object.defineProperty(e,p,{enumerable:!0,get:function(){return n[d]}})}:function(e,n,d,p){void 0===p&&(p=d),e[p]=n[d]}),p=He&&He.__exportStar||function(e,n){for(var p in e)"default"===p||n.hasOwnProperty(p)||d(n,e,p)};Object.defineProperty(n,"__esModule",{value:!0}),n.VTTRegion=n.VTTCue=n.WebVTTParser=n.ParsingError=void 0,Object.defineProperty(n,"VTTCue",{enumerable:!0,get:function(){return Qi.VTTCue}}),Object.defineProperty(n,"VTTRegion",{enumerable:!0,get:function(){return Ji.VTTRegion}});class ParsingError extends Error{constructor(e,n){super(),this.name="ParsingError",this.code="number"==typeof e?e:e.code,n?this.message=n:e instanceof ParsingError&&(this.message=e.message)}}n.ParsingError=ParsingError,ParsingError.Errors={BadSignature:new ParsingError(0,"Malformed WebVTT signature."),BadTimeStamp:new ParsingError(1,"Malformed time stamp.")};class Settings{set(e,n){this.get(e)||""===n||(this.values[e]=n)}get(e,n,d){return"object"==typeof n&&"string"==typeof d?this.has(e)?this.values[e]:n[d]:this.has(e)?this.values[e]:n}has(e){return e in this.values}alt(e,n,d){for(let p=0;p<d.length;++p)if(n===d[p]){this.set(e,n);break}}integer(e,n){/^-?\d+$/.test(n)&&this.set(e,parseInt(n,10))}percent(e,n){if(n.match(/^([\d]{1,3})(\.[\d]*)?%$/))try{const d=parseFloat(n);if(d>=0&&d<=100)return this.set(e,d),!0}catch(al){return!1}return!1}constructor(){this.values={}}}class WebVTTParser{static StringDecoder(){return{decode:e=>{if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}}reportOrThrowError(e){if(!(e instanceof ParsingError&&"function"==typeof this.onparsingerror))throw e;this.onparsingerror(e)}parseOptions(e,n,d,p){const h=p?e.split(p):[e];for(const y of h){if("string"!=typeof y)continue;const e=y.split(d);if(2!==e.length)continue;n(e[0],e[1])}}parseCue(e,n,d){const p=e,consumeTimeStamp=()=>{const n=Yi.default.parseTimeStamp(e);if(null===n)throw new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed timestamp: "+p);return e=e.replace(/^[^\sa-zA-Z-]+/,""),n},skipWhitespace=()=>{e=e.replace(/^\s+/,"")};if(skipWhitespace(),n.startTime=consumeTimeStamp(),skipWhitespace(),"--\x3e"!==e.substr(0,3))throw new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+p);e=e.substr(3),skipWhitespace(),n.endTime=consumeTimeStamp(),skipWhitespace(),((e,n)=>{const p=new Settings;this.parseOptions(e,(e,n)=>{let h,y;switch(e){case"region":for(let h=d.length-1;h>=0;h--)if(d[h].id===n){p.set(e,d[h].region);break}break;case"vertical":p.alt(e,n,["rl","lr"]);break;case"line":h=n.split(","),y=h[0],p.integer(e,y),p.percent(e,y)&&p.set("snapToLines",!1),p.alt(e,y,["auto"]),2===h.length&&p.alt("lineAlign",h[1],["start","middle","center","end"]);break;case"position":if(h=n.split(","),p.percent(e,h[0]),2===h.length){let e=["line-left","line-right","center","auto","left","start","middle","end","right"];p.alt("positionAlign",h[1],e)}break;case"size":p.percent(e,n);break;case"align":let m=["start","center","end","left","right","middle"];p.alt(e,n,m)}},/:/,/\s/),n.region=p.get("region",null),n.vertical=p.get("vertical",""),n.line=p.get("line",void 0===n.line?"auto":n.line);const h=p.get("lineAlign","start");n.lineAlign="center"===h||"middle"===h?this.middleOrCenter:h,n.snapToLines=p.get("snapToLines",!0),n.size=p.get("size",100);const y=p.get("align","center");n.align="center"===y||"middle"===y?this.middleOrCenter:y,n.position=p.get("position","auto");let m=p.get("positionAlign",{start:"start",left:"start",center:"center",middle:"middle",right:"end",end:"end"},n.align);n.positionAlign="center"===m||"middle"===m?this.middleOrCenter:{start:"start","line-left":"start",left:"start",center:"center",middle:"middle","line-right":"end",right:"end",end:"end"}[m]})(e,n)}parseRegion(e){const n=new Settings;if(this.parseOptions(e,(e,d)=>{switch(e){case"id":n.set(e,d);break;case"width":n.percent(e,d);break;case"lines":n.integer(e,d);break;case"regionanchor":case"viewportanchor":{const p=d.split(",");if(2!==p.length)break;const h=new Settings;if(h.percent("x",p[0]),h.percent("y",p[1]),!h.has("x")||!h.has("y"))break;n.set(e+"X",h.get("x")),n.set(e+"Y",h.get("y"));break}case"scroll":n.alt(e,d,["up"])}},/=/,/\s/),n.has("id")){const e=new Ji.VTTRegion;e.width=n.get("width",100),e.lines=n.get("lines",3),e.regionAnchorX=n.get("regionanchorX",0),e.regionAnchorY=n.get("regionanchorY",100),e.viewportAnchorX=n.get("viewportanchorX",0),e.viewportAnchorY=n.get("viewportanchorY",100),e.scroll=n.get("scroll",""),this.onregion&&this.onregion(e),this.regionList.push({id:n.get("id"),region:e})}}parseStyle(e){const parseStyles=e=>{const n={},d=e.split(";");for(let p=0;p<d.length;p++)if(d[p].includes(":")){const e=d[p].split(":",2),h=e[0].trim(),y=e[1].trim();""!==h&&""!==y&&(n[h]=y)}return n},n=e.split("}");n.pop();for(const d of n){let e=null,n=null;const p=d.split("{");p[0]&&(e=p[0].trim()),p[1]&&(n=parseStyles(p[1])),e&&n&&(this._styles[e]=n)}this.onStylesParsedCallback&&this.onStylesParsedCallback(this._styles)}parseHeader(e){this.parseOptions(e,(function(e,n){switch(e){case"Region":this.parseRegion(n)}}),/:/)}parse(e){e&&(this.buffer+=this.decoder.decode(e,{stream:!0}));const collectNextLine=()=>{const e=this.buffer;let n=0;const calculateBreakPosition=(e,n)=>{const d={start:-1,length:-1};if("\r"===e[n])d.start=n,d.length=1;else if("\n"===e[n])d.start=n,d.length=1;else if("<"===e[n]&&n+1<e.length&&"b"===e[n+1]&&n+2<e.length&&"r"===e[n+2]){let p=n+2;for(;p<e.length&&">"!==e[p++];);d.start=n,d.length=p-n}return d};let d={start:e.length,length:0};for(;n<e.length;){const p=calculateBreakPosition(e,n);if(p.length>0){d=p;break}++n}const p=e.substr(0,d.start);return this.buffer=e.substr(d.start+d.length),p};try{let e;if("INITIAL"===this.state){if(!/\r\n|\n/.test(this.buffer))return this;this.alreadyCollectedLine="",e=collectNextLine();const n=/^()?WEBVTT([ \t].*)?$/.exec(e);if(!n||!n[0])throw new ParsingError(ParsingError.Errors.BadSignature);this.state="HEADER"}for(;this.buffer;){if(!/\r\n|\n/.test(this.buffer))return this;switch(this.alreadyCollectedLine?(e=this.alreadyCollectedLine,this.alreadyCollectedLine=""):e=collectNextLine(),this.state){case"HEADER":e.includes(":")?this.parseHeader(e):e||(this.state="ID");continue;case"NOTE":e||(this.state="ID");continue;case"STYLE":e?this.styleCollector+=e:(this.parseStyle(this.styleCollector),this.state="ID",this.styleCollector="");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){this.state="NOTE";break}if(/^STYLE($|[ \t])/.test(e)){this.state="STYLE";break}if(!e)continue;if(this.cue=new Qi.VTTCue(0,0,""),this.state="CUE",!e.includes("--\x3e")){this.cue.id=e;continue}case"CUE":try{this.parseCue(e,this.cue,this.regionList)}catch(Lr){this.reportOrThrowError(Lr),this.cue=null,this.state="BADCUE";continue}this.state="CUETEXT";continue;case"CUETEXT":{const n=e.includes("--\x3e");if(!e||n){this.alreadyCollectedLine=e,this.oncue&&this.oncue(this.cue),this.cue=null,this.state="ID";continue}this.cue.text&&(this.cue.text+="\n"),this.cue.text+=e;continue}case"BADCUE":e||(this.state="ID");continue}}}catch(Lr){this.reportOrThrowError(Lr),"CUETEXT"===this.state&&this.cue&&this.oncue&&this.oncue(this.cue),this.cue=null,this.state="INITIAL"===this.state?"BADWEBVTT":"BADCUE"}return this}flush(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new ParsingError(ParsingError.Errors.BadSignature)}catch(Lr){this.reportOrThrowError(Lr)}return this.onflush&&this.onflush(),this}styles(){return this._styles}constructor(e,n,d){this.window=e,this.state="INITIAL",this.styleCollector="",this.buffer="",this.decoder=n||new TextDecoder("utf8"),this.regionList=[],this.alreadyCollectedLine="",this.onStylesParsedCallback=d,this._styles={},this.middleOrCenter="center";const p=new Qi.VTTCue(0,0,"middleOrCenter");try{p.align="center","center"!==p.align&&(this.middleOrCenter="middle")}catch(Lr){this.middleOrCenter="middle"}}}n.default=WebVTTParser,n.WebVTTParser=WebVTTParser,p(Xi,n)}));unwrapExports(Zi),Zi.VTTRegion,Zi.VTTCue,Zi.WebVTTParser,Zi.ParsingError;var ea=createCommonjsModule((function(e,n){var d=He&&He.__createBinding||(Object.create?function(e,n,d,p){void 0===p&&(p=d),Object.defineProperty(e,p,{enumerable:!0,get:function(){return n[d]}})}:function(e,n,d,p){void 0===p&&(p=d),e[p]=n[d]}),p=He&&He.__exportStar||function(e,n){for(var p in e)"default"===p||n.hasOwnProperty(p)||d(n,e,p)};Object.defineProperty(n,"__esModule",{value:!0}),n.VTTCue=n.WebVTTRenderer=n.BoxPosition=n.CueStyleBox=n.StyleBox=void 0,Object.defineProperty(n,"VTTCue",{enumerable:!0,get:function(){return Qi.VTTCue}});const h=[/^(::cue\()(\..*)(\))/,/^(::cue\()(#.*)(\))/,/^(::cue\()(c|i|b|u|ruby|rt|v|lang)(\))/],y=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];class StyleBox{applyStyles(e,n){n=n||this.div;for(const d in e)e.hasOwnProperty(d)&&(n.style[d]=e[d])}formatStyle(e,n){return 0===e?"0":e+n}}n.StyleBox=StyleBox;class CueStyleBox extends StyleBox{determineBidi(e){let n,d=[],p="";if(!e||!e.childNodes)return"ltr";function pushNodes(e,n){for(let d=n.childNodes.length-1;d>=0;d--)e.push(n.childNodes[d])}function nextTextNode(e){if(!e||!e.length)return null;let n=e.pop(),d=n.textContent||n.innerText;if(d){const n=/^.*(\n|\r)/.exec(d);return n?(e.length=0,n[0]):d}return"ruby"===n.tagName?nextTextNode(e):n.childNodes?(pushNodes(e,n),nextTextNode(e)):void 0}function isContainedInCharacterList(e,n){for(const d of n)if(e>=d[0]&&e<=d[1])return!0;return!1}for(pushNodes(d,e);p=nextTextNode(d);)for(let e=0;e<p.length;e++)if(n=p.charCodeAt(e),isContainedInCharacterList(n,y))return"rtl";return"ltr"}parseOpacity(e){if(!e||"string"!=typeof e)return null;const n=(e=e.replace(/ /g,"").replace("rgba(","").replace(")","")).split(",");return n&&n.length>=4?n[3]:null}directionSettingToWritingMode(e){return""===e?"horizontal-tb":"lr"===e?"vertical-lr":"vertical-rl"}move(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}constructor(e,n,d,p,h){super(),this.cue=n;let y={start:"left","line-left":"left",left:"left",center:"center",middle:"center","line-right":"right",right:"right",end:"right"}[n.positionAlign]||n.align;"middle"===y&&(y="center");let m={textAlign:y,whiteSpace:"pre-line",position:"absolute"};m.direction=this.determineBidi(this.cueDiv),m.writingMode=this.directionSettingToWritingMode(n.vertical),m.unicodeBidi="plaintext",this.div=e.document.createElement("div"),this.applyStyles(m),m={backgroundColor:p.backgroundColor,display:"inline-block"},this.parseOpacity(m.backgroundColor)&&(m.padding="5px",m.borderRadius="5px"),this.backgroundDiv=e.document.createElement("div"),this.applyStyles(m,this.backgroundDiv),m={color:d.color,backgroundColor:d.backgroundColor,textShadow:d.textShadow,fontSize:d.fontSize,fontFamily:d.fontFamily,position:"relative",left:"0",right:"0",top:"0",bottom:"0",display:"inline-block",textOrientation:"upright"},m.writingMode=this.directionSettingToWritingMode(n.vertical),m.unicodeBidi="plaintext",this.cueDiv=Yi.default.parseContent(e,n,h),this.applyStyles(m,this.cueDiv),this.backgroundDiv.appendChild(this.cueDiv),this.div.appendChild(this.backgroundDiv);let g=0;if("number"==typeof n.position){let e=n.positionAlign||n.align;if(e)switch(e){case"start":case"left":g=n.position;break;case"center":case"middle":g=n.position-n.size/2;break;case"end":case"right":g=n.position-n.size}}""===n.vertical?this.applyStyles({left:this.formatStyle(g,"%"),width:this.formatStyle(n.size,"%")}):this.applyStyles({top:this.formatStyle(g,"%"),height:this.formatStyle(n.size,"%")})}}n.CueStyleBox=CueStyleBox;class BoxPosition{calculateNewLines(e){let n=1;for(let d=0;d<e.length;d++)"\n"===e[d]&&n++;return n}move(e,n){switch(n=void 0!==n?n:this.singleLineHeight,e){case"+x":this.left+=n,this.right+=n;break;case"-x":this.left-=n,this.right-=n;break;case"+y":this.top+=n,this.bottom+=n;break;case"-y":this.top-=n,this.bottom-=n}}overlaps(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top}overlapsAny(e){for(const n of e)if(this.overlaps(n))return!0;return!1}within(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right}moveIfOutOfBounds(e,n){switch(n){case"+x":this.left<e.left&&(this.left=e.left,this.right=this.left+this.width);break;case"-x":this.right>e.right&&(this.right=e.right,this.left=this.right-this.width);break;case"+y":this.top<e.top&&(this.top=e.top,this.bottom=this.top+this.height);break;case"-y":this.bottom>e.bottom&&(this.bottom=e.bottom,this.top=this.bottom-this.height)}}toCSSCompatValues(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}}static getSimpleBoxPosition(e){let n=null;e instanceof StyleBox&&e.div?n=e.div:e instanceof HTMLElement&&(n=e);let d=n.offsetHeight||0,p=n.offsetWidth||0,h=n.offsetTop||0,y=h+d,m=n.getBoundingClientRect();const{left:g,right:b}=m;return m.top&&(h=m.top),m.height&&(d=m.height),m.width&&(p=m.width),m.bottom&&(y=m.bottom),{left:g,right:b,top:h,height:d,bottom:y,width:p}}static getBoxPosition(e,n){if(e&&e.length>0){let d=0,p=e[0][n];for(let h=0;h<e.length;h++)n in["top","right"]?e[h][n]>p&&(d=h,p=e[h][n]):n in["bottom","left"]&&e[h][n]<p&&(d=h,p=e[h][n]);return e[d]}return null}static moveToMinimumDistancePlacement(e,n,d){"height"===e.property?"+y"===n?(e.top=d.topMostBoxPosition.bottom+0,e.bottom=e.top+e.height):"-y"===n&&(e.bottom=d.bottomMostBoxPosition.top-0,e.top=e.bottom-e.height):"width"===e.property&&("+x"===n?(e.left=d.rightMostBoxPosition.right+0,e.right=e.left+e.width):"-x"===n&&(e.right=d.leftMostBoxPosition.left-0,e.left=e.right-e.width))}static moveBoxToLinePosition(e,n,d){const p=e.cue;let h,y=new BoxPosition(e),m=function(e){if("number"==typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;let n=0;const d=e.track,p=d.textTrackList;for(let h=0;h<p.length&&p[h]!==d;h++)"showing"===p[h].mode&&n++;return-1*++n}(p),g=[];if(p.snapToLines){let e=0;switch(p.vertical){case"":g=["+y","-y"],h="height";break;case"rl":g=["+x","-x"],h="width";break;case"lr":g=["-x","+x"],h="width"}const d=y.lineHeight,b=n[h]+d,_=g[0];if(m<0){let h=0;switch(p.vertical){case"":h=n.height-d-.05*n.height;break;case"rl":case"lr":h=-n.width+d+.05*n.width}e=h,g=g.reverse()}else{switch(p.vertical){case"":e=d*Math.round(m);break;case"rl":e=n.width-d*Math.round(m);break;case"lr":e=d*Math.round(m)}Math.abs(e)>b&&(e=e<0?-1:1,e*=Math.ceil(b/d)*d)}y.move(_,e)}else{const d=""===p.vertical?n.height:n.width,h=y.lineHeight/d*100;switch(p.lineAlign){case"center":case"middle":m-=h/2;break;case"end":m-=h}switch(p.vertical){case"":e.applyStyles({top:e.formatStyle(m,"%")});break;case"rl":e.applyStyles({right:e.formatStyle(m,"%")});break;case"lr":e.applyStyles({left:e.formatStyle(m,"%")})}g=["+y","-y","+x","-x"],"+y"===p.axis?g=["+y","-y","+x","-x"]:"-y"===p.axis&&(g=["-y","+y","+x","-x"]),y=new BoxPosition(e)}const b=function(e,p){let h;for(let y=0;y<p.length;y++){e.moveIfOutOfBounds(n,p[y]);let m=0,g=!1;for(;e.overlapsAny(d)&&!(m>9);)g?e.move(p[y]):(d&&d.length>0&&(h||(h={topMostBoxPosition:BoxPosition.getBoxPosition(d,"top"),bottomMostBoxPosition:BoxPosition.getBoxPosition(d,"bottom"),leftMostBoxPosition:BoxPosition.getBoxPosition(d,"left"),rightMostBoxPosition:BoxPosition.getBoxPosition(d,"right")}),BoxPosition.moveToMinimumDistancePlacement(e,p[y],h)),g=!0),m++}return e}(y,g);e.move(b.toCSSCompatValues(n))}constructor(e){var n;let d,p,h,y,m,g;if(e instanceof CueStyleBox&&e.cue?(n=e.cue)&&""!==n.vertical?this.property="width":this.property="height":e instanceof BoxPosition&&(this.property=e.property||"height"),e instanceof CueStyleBox&&e.div){h=e.div.offsetHeight,y=e.div.offsetWidth,m=e.div.offsetTop;const n=e.div.firstChild;if(g=n?n.getBoundingClientRect():e.div.getBoundingClientRect(),d=g&&g[this.property]||null,n&&n.firstChild){const e=n.firstChild;if(e&&"string"==typeof e.textContent){p=d/this.calculateNewLines(e.textContent)}}}else e instanceof BoxPosition&&(g=e);this.left=g.left,this.right=g.right,this.top=g.top||m,this.height=g.height||h,this.bottom=g.bottom||m+(g.height||h),this.width=g.width||y,this.lineHeight=null!==d?d:g.lineHeight,this.singleLineHeight=null!==p?p:g.singleLineHeight,this.singleLineHeight||(this.singleLineHeight=41)}}n.BoxPosition=BoxPosition;class WebVTTRenderer{initSubtitleCSS(){const e=[new Qi.VTTCue(0,0,"String to init CSS - Won't be visible to user")];this.paddedOverlay.style.opacity="0",this.processCues(e),this.processCues([]),this.paddedOverlay.style.opacity="1"}convertCueToDOMTree(e){return e?Yi.default.parseContent(this.window,e,this.globalStyleCollection):null}setStyles(e){function applyStyles(e,n,d){for(const p in n)n.hasOwnProperty(p)&&(!0===d&&void 0!==e[p]||!1===d)&&(e[p]=n[p])}for(const n in e){let d=!1,p=null;"::cue"===n?(p=this.foregroundStyleOptions,d=!0):"::-webkit-media-text-track-display"===n&&(p=this.backgroundStyleOptions,d=!0);const y=e[n];if(!0===d)applyStyles(p,y,d);else for(let e=0;e<h.length;e++){const p=h[e].exec(n);if(p&&4===p.length){const e=p[2],n={};applyStyles(n,y,d),this.globalStyleCollection[e]=n}}}this.initSubtitleCSS(),this.loggingEnabled&&(console.log("WebVTTRenderer setStyles foregroundStyleOptions: "+JSON.stringify(this.foregroundStyleOptions)),console.log("WebVTTRenderer setStyles backgroundStyleOptions: "+JSON.stringify(this.backgroundStyleOptions)),console.log("WebVTTRenderer setStyles globalStyleCollection: "+JSON.stringify(this.globalStyleCollection)))}processCues(e){if(!e)return;for(;this.paddedOverlay.firstChild;)this.paddedOverlay.removeChild(this.paddedOverlay.firstChild);if(!function(e){for(let n=0;n<e.length;n++)if(e[n].hasBeenReset||!e[n].displayState)return!0;return!1}(e)){for(let n=0;n<e.length;n++)this.paddedOverlay.appendChild(e[n].displayState);return}const n=[],d=BoxPosition.getSimpleBoxPosition(this.paddedOverlay);e.length>1&&(e=function(e){const n=[];let d=0;for(let p=0;p<e.length;p++){let h=e[p];if("number"!=typeof h.line)return e;d+=h.line,n.push(h)}return d/=e.length,d>50?(n.forEach((function(e){e.axis="-y"})),n.sort((e,n)=>n.line-e.line)):(n.forEach((function(e){e.axis="+y"})),n.sort((e,n)=>e.line-n.line)),n}(e));for(let p=0;p<e.length;p++){let h=e[p],y=new CueStyleBox(this.window,h,this.foregroundStyleOptions,this.backgroundStyleOptions,this.globalStyleCollection);this.paddedOverlay.appendChild(y.div),BoxPosition.moveBoxToLinePosition(y,d,n),h.displayState=y.div,n.push(BoxPosition.getSimpleBoxPosition(y))}}setSize(e,n){e&&(this.overlay.style.width=e+"px"),n&&(this.overlay.style.height=n+"px")}getOverlay(){return this.overlay}constructor(e,n,d=!0){if(!e)return null;this.window=e,this.overlay=n,this.loggingEnabled=d,this.foregroundStyleOptions={fontFamily:"Helvetica",fontSize:"36px",color:"rgba(255, 255, 255, 1)",textShadow:"",backgroundColor:"rgba(0, 0, 0, 0)"},this.backgroundStyleOptions={backgroundColor:"rgba(0, 0, 0, 0.5)"},this.globalStyleCollection={};const p=e.document.createElement("div");p.style.position="absolute",p.style.left="0",p.style.right="0",p.style.top="0",p.style.bottom="0",p.style.margin="1.5%",this.paddedOverlay=p,n.appendChild(this.paddedOverlay),this.initSubtitleCSS()}}n.default=WebVTTRenderer,n.WebVTTRenderer=WebVTTRenderer,p(Xi,n)}));unwrapExports(ea),ea.VTTCue,ea.WebVTTRenderer,ea.BoxPosition,ea.CueStyleBox,ea.StyleBox;var ta=createCommonjsModule((function(e,n){var d=He&&He.__createBinding||(Object.create?function(e,n,d,p){void 0===p&&(p=d),Object.defineProperty(e,p,{enumerable:!0,get:function(){return n[d]}})}:function(e,n,d,p){void 0===p&&(p=d),e[p]=n[d]}),p=He&&He.__exportStar||function(e,n){for(var p in e)"default"===p||n.hasOwnProperty(p)||d(n,e,p)};Object.defineProperty(n,"__esModule",{value:!0}),p(Zi,n),p(ea,n)}));unwrapExports(ta);var ra=ta.WebVTTRenderer;const{audioTrackAdded:na,audioTrackChanged:ia,forcedTextTrackChanged:aa,textTrackAdded:oa,textTrackChanged:sa,textTrackRemoved:ca}=fr,{textTracksSwitched:la,textTracksUpdated:ua,inlineStylesParsed:da}=tr;class TextTrackManager{get currentTrack(){return this.tracks.find(e=>"showing"===e.mode)}set currentTrack(e){if(!e)return;let n;this.trackPersistence.setPersistedTrack(e),this.extensionTracks?(Lt.debug("MEDIA_TRACK Setting track on extension "+e.label),"Off"===e.label?(this.clearCurrentlyPlayingTrack(),n=this.extensionTracks.selectForcedTrack(),void 0===n&&this.onExtensionTextTrackSwitched({track:e})):this.extensionTracks.textTrack=e):(Lt.debug("MEDIA_TRACK Setting track on element "+e.label),this._tracks.forEach(n=>{n!==e&&"showing"===n.mode&&(n.mode="disabled")}),e&&(Lt.debug("MEDIA_TRACK setting track mode to showing for "+e.label),this.isTrackOff(e)?(this._tracks[0].mode="showing",n=this.selectNativeForcedTrack(this.mediaElement.audioTracks)):e.mode="showing")),this.dispatcher.publish(fr.forcedTextTrackChanged,n)}get tracks(){return this._tracks}destroy(){if(this.clearCurrentlyPlayingTrack(),this.extensionTracks){const e=this.extensionTracks;e.removeEventListener(ua,this.onExtensionTextTracksAdded),e.removeEventListener(la,this.onExtensionTextTrackSwitched),e.removeEventListener(da,this.onExtensionInlineStylesParsed)}else this.mediaElement.textTracks.removeEventListener("addtrack",this.onTextTrackAdded),this.mediaElement.textTracks.removeEventListener("change",this.onTextTrackChanged),this.mediaElement.textTracks.removeEventListener("removetrack",this.onTextTrackRemoved),this.mediaElement.removeEventListener("playing",this.onPlayStart);this.dispatcher.unsubscribe(ia,this.onAudioTrackAddedOrChanged),this.dispatcher.unsubscribe(na,this.onAudioTrackAddedOrChanged)}restoreSelectedTrack(){return restoreSelectedTrack(this.trackPersistence,this)}onExtensionInlineStylesParsed(e){Lt.debug("MEDIA_TRACK Extension inline styles parsed",e),this.renderer.setStyles(e.styles)}onExtensionTextTracksAdded(e){Lt.debug("MEDIA_TRACK Extension text tracks updated "+JSON.stringify(e)),this._tracks.push(...e),this.restoreSelectedTrack(),this.dispatcher.publish(oa,e)}onExtensionTextTrackSwitched(e){Lt.debug("MEDIA_TRACKS Extension text track switched "+e),this.handleVTT(e);const n=e.track;if(this._tracks){const preserveSelectedTrack=d=>{e.track?n.forced&&"Off"===d.label||"Off"===n.label&&"Off"===d.label?d.mode="showing":d.mode=e.track.persistentID===d.id?"showing":"disabled":d.mode="Off"===d.label?"showing":"disabled"};this._tracks.forEach(preserveSelectedTrack)}this.dispatcher.publish(sa,e)}handleVTT(e){const n=e&&e.track&&e.track.id;if(void 0!==n&&n>=0){const e=this.filterSelectableTextTracks(this.mediaElement.textTracks)[n];this.onNativeTrackChange(e)}else this.clearCurrentlyPlayingTrack()}onAudioTrackAddedOrChanged(e,n){if(Lt.debug("MEDIA_TRACKS text track manager detects audio track change"),this.shouldForceSubtitle())if(this.extensionTracks){Lt.debug("MEDIA_TRACKS selecting forced text track via extension");const e=this.extensionTracks.selectForcedTrack();e?this.dispatcher.publish(aa,e):this.clearCurrentlyPlayingTrack()}else Lt.debug("MEDIA_TRACKS selecting forced text track natively"),this.currentTrack=this._tracks[0]}onTextTrackAdded(e){this._tracks.push(e.track),this.dispatcher.publish(oa,e)}onPlayStart(){this.restoreSelectedTrack()}onTextTrackRemoved(e){this.dispatcher.publish(ca,e)}onTextTrackChanged(e){const n=this.findNativeSelectedTextTrack();let d=this.trackPersistence.getPersistedTrack();if(d||(d=this._tracks[0]),n&&!trackEquals(n,d,this.trackPersistence.fields))if(this.isTrackOff(d)&&"forced"!==n.kind)this.currentTrack=d;else{const e=this.findNativeTrack(d);e&&(this.currentTrack=e)}else this.dispatcher.publish(sa,e)}findNativeSelectedTextTrack(){for(let e=0;e<this.mediaElement.textTracks.length;e++){const n=this.mediaElement.textTracks[e];if("showing"===n.mode)return n}}findNativeTrack(e){for(let n=0;n<this.mediaElement.textTracks.length;n++){const d=this.mediaElement.textTracks[n];if(trackEquals(d,e,this.trackPersistence.fields))return d}}selectNativeForcedTrack(e){for(let n=0;n<e.length;n++){const d=e[n];if(d.enabled){const e=this.findNativeForcedTrack(d);return e&&"showing"!==e.mode&&(e.mode="showing"),e}}}findNativeForcedTrack(e){const n=this.mediaElement.textTracks;for(let d=0;d<n.length;d++){const p=n[d];if("forced"===p.kind&&p.language===e.language)return p}}onNativeTrackChange(e){this.clearCurrentlyPlayingTrack(),this._currentlyPlayingTrack=e,e.addEventListener("cuechange",this.onCueChange)}clearCurrentlyPlayingTrack(){var e;void 0!==this._currentlyPlayingTrack&&("string"==typeof(e=this._currentlyPlayingTrack).id&&"removeEventListener"in e)&&(this._currentlyPlayingTrack.removeEventListener("cuechange",this.onCueChange),this.renderer.processCues({}),delete this._currentlyPlayingTrack)}onCueChange(e){const n=e&&e.target&&e.target.activeCues;n&&this.renderer.processCues(n)}filterSelectableTextTracks(e){const n=[];for(let d=0;d<e.length;d++){const p=e[d];("captions"===p.kind||"subtitles"===p.kind||"metadata"===p.kind&&p.customTextTrackCueRenderer)&&n.push(p)}return n}shouldForceSubtitle(){Lt.debug("MEDIA_TRACKS Determining whether to select forced text track");const e=this.trackPersistence.getPersistedTrack();return!e||this.isTrackOff(e)}isTrackOff(e){return"Off"===e.label||"Auto"===e.label}constructor(e,n,d){this.mediaElement=e,this.dispatcher=n,this.extensionTracks=d,this._tracks=[],this.trackPersistence=new TrackPersistence("mk-text-track",["label","language","kind"]);const p=this.trackPersistence.getPersistedTrack();if(this._tracks.push({id:-2,label:"Off",language:"",kind:"subtitles",mode:!p||this.isTrackOff(p)?"showing":"disabled"}),this.extensionTracks){Lt.debug("MEDIA_TRACK Initializing text track manager for HLS.js track events");const n=e.parentElement;this.renderer=new ra(window,n,!1),this.renderer.setStyles({"::cue":{fontSize:"calc(1vw + 1em)"}}),this.onExtensionTextTracksAdded=this.onExtensionTextTracksAdded.bind(this),this.onExtensionTextTrackSwitched=this.onExtensionTextTrackSwitched.bind(this),this.onExtensionInlineStylesParsed=this.onExtensionInlineStylesParsed.bind(this),this.onCueChange=this.onCueChange.bind(this);const d=this.extensionTracks;d.addEventListener(ua,this.onExtensionTextTracksAdded),d.addEventListener(la,this.onExtensionTextTrackSwitched),d.addEventListener(da,this.onExtensionInlineStylesParsed)}else Lt.debug("MEDIA_TRACK Initializing text track manager for native track events"),this.onTextTrackAdded=this.onTextTrackAdded.bind(this),this.onTextTrackChanged=this.onTextTrackChanged.bind(this),this.onTextTrackRemoved=this.onTextTrackRemoved.bind(this),this.onPlayStart=this.onPlayStart.bind(this),e.textTracks.addEventListener("addtrack",this.onTextTrackAdded),e.textTracks.addEventListener("change",this.onTextTrackChanged),e.textTracks.addEventListener("removetrack",this.onTextTrackRemoved),e.addEventListener("playing",this.onPlayStart);this.onAudioTrackAddedOrChanged=debounce(this.onAudioTrackAddedOrChanged.bind(this)),n.subscribe(ia,this.onAudioTrackAddedOrChanged),n.subscribe(na,this.onAudioTrackAddedOrChanged)}}function asyncGeneratorStep$11(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$11(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$11(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$11(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$z(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}var pa={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},ha={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};const ya={"picture-in-picture":e.PresentationMode.pictureinpicture,inline:e.PresentationMode.inline},fa={};fa[e.PresentationMode.pictureinpicture]="picture-in-picture",fa[e.PresentationMode.inline]="inline";const{presentationModeDidChange:ma}=fr,{playbackLicenseError:ga}=tr,{stopped:va}=e.PlaybackStates;class VideoPlayer extends BasePlayer{get audioTracks(){return this._audioTrackManager.tracks}get containerElement(){return this._context.videoContainerElement?this._context.videoContainerElement:document.getElementById("apple-music-video-container")}get currentAudioTrack(){return this._audioTrackManager.currentTrack}set currentAudioTrack(e){this._audioTrackManager.currentTrack=e}get currentTextTrack(){return this._textTrackManager.currentTrack}set currentTextTrack(e){this._textTrackManager.currentTrack=e}get _targetElement(){return this.video||function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$z(e,n,d[n])}))}return e}({},document.createElement("video"))}get textTracks(){return this._textTrackManager.tracks}initializeExtension(){var e=this;return _asyncToGenerator$11((function*(){e.restrictPlatforms&&zt.isAndroid?Lt.warn("videoPlayer.initializeExtension Not supported on the current platform"):e.video||Lt.warn("videoPlayer.initializeExtension No video element, not initializing extension")}))()}onPlaybackLicenseError(e){this.resetDeferredPlay(),this._dispatcher.publish(ga,e)}setupTrackManagers(e){var n,d,p,h;null===(n=this._textTrackManager)||void 0===n||null===(d=n.destroy)||void 0===d||d.call(n),this._textTrackManager=new TextTrackManager(this._targetElement,this._dispatcher,e),null===(p=this._audioTrackManager)||void 0===p||null===(h=p.destroy)||void 0===h||h.call(p),this._audioTrackManager=new AudioTrackManager(this._targetElement,this._dispatcher,e)}destroy(){this.finishPlaybackSequence(),this._textTrackManager.destroy(),this._audioTrackManager.destroy(),super.destroy()}initializeEventHandlers(){var e=this,_superprop_get_initializeEventHandlers=()=>super.initializeEventHandlers;return _asyncToGenerator$11((function*(){_superprop_get_initializeEventHandlers().call(e),e.hasMediaElement&&(e._targetElement.addEventListener("webkitpresentationmodechanged",e.pipEventHandler),e._targetElement.addEventListener("enterpictureinpicture",e.pipEventHandler),e._targetElement.addEventListener("leavepictureinpicture",e.pipEventHandler))}))()}removeEventHandlers(){if(super.removeEventHandlers(),!this.hasMediaElement)return;const{_targetElement:e}=this;e.removeEventListener("webkitpresentationmodechanged",this.pipEventHandler),e.removeEventListener("enterpictureinpicture",this.pipEventHandler),e.removeEventListener("leavepictureinpicture",this.pipEventHandler)}initializeMediaElement(){var e=this;return _asyncToGenerator$11((function*(){Lt.debug("videoPlayer.initializeMediaElement Initializing media element");const n=e.containerElement;n?(e.video=function(){let e=Zt.pop();return e?Lt.debug(`dom-helpers: retrieving video tag, ${Zt.length} remain`):(Lt.debug("dom-helpers: no available video tags, creating one"),e=document.createElement("video")),e}(),e.video.autoplay=!1,e.video.controls=!1,e.video.playsInline=!0,e.video.id="apple-music-video-player",n.appendChild(e.video)):Lt.warn("videoPlayer.initializeMediaElement No video element; no container defined")}))()}isPlayerSupported(){return Browser.supportsEs6()}_stopMediaElement(){var e=this,_superprop_get__stopMediaElement=()=>super._stopMediaElement;return _asyncToGenerator$11((function*(){yield _superprop_get__stopMediaElement().call(e),e.destroy()}))()}pipEventHandler(n){switch(n.type){case"enterpictureinpicture":this._dispatcher.publish(ma,{mode:e.PresentationMode.pictureinpicture});break;case"leavepictureinpicture":this._dispatcher.publish(ma,{mode:e.PresentationMode.inline});break;case"webkitpresentationmodechanged":{const e=this._targetElement;this._dispatcher.publish(ma,{mode:this._translateStringToPresentationMode(e.webkitPresentationMode)});break}}}playItemFromEncryptedSource(n,d=!1,p={}){var h=this;return _asyncToGenerator$11((function*(){if(Lt.debug("videoPlayer.playItemFromEncryptedSource",n,d),h.playbackState===va)return void Lt.debug("video-player.playItemFromEncryptedSource aborting playback because player is stopped");n.playbackType=e.PlaybackType.encryptedFull,h.nowPlayingItem=n,n.state=G.loading,h.userInitiated=d;const y=generateAssetUrl(n,p);yield h.playHlsStream(y,n,p)}))()}playItemFromUnencryptedSource(e,n,d){var p=this;return _asyncToGenerator$11((function*(){if(Lt.debug("videoPlayer.playItemFromUnencryptedSource",e,n),p.playbackState===va)return void Lt.debug("videoPlayer.playItemFromUnencryptedSource aborting playback because player is stopped");const[d]=e.split("?");d.endsWith("m3u")||d.endsWith("m3u8")?yield p.playHlsStream(e):yield p._playAssetURL(e,n)}))()}setPresentationMode(n){var d=this;return _asyncToGenerator$11((function*(){const p=d._targetElement;if(p.webkitSupportsPresentationMode&&"function"==typeof p.webkitSetPresentationMode)return p.webkitSetPresentationMode(d._translatePresentationModeToString(n));if(p.requestPictureInPicture&&document.exitPictureInPicture){if(n===e.PresentationMode.pictureinpicture)return p.requestPictureInPicture();if(n===e.PresentationMode.inline)return document.exitPictureInPicture()}}))()}_translateStringToPresentationMode(n){let d=ya[n];return void 0===d&&(Lt.warn(`videoPlayer._translateStringToPresentationMode ${n} is not a valid presentation mode, setting to inline`),d=e.PresentationMode.inline),d}_translatePresentationModeToString(e){let n=fa[e];return void 0===n&&(Lt.warn(`videoPlayer._translatePresentationModeToString ${e} is not a valid presentation mode, setting to inline`),n="inline"),n}setNextSeamlessItem(e){return _asyncToGenerator$11((function*(){}))()}constructor(e){super(e),this.mediaPlayerType="video",this._textTrackManager=new TrackManagerStub,this._audioTrackManager=new TrackManagerStub,this._shouldLoadManifestsOnce=!1,this.userInitiated=!1,this.restrictPlatforms=!("restrict-platforms"in Yt.features)||Yt.features["restrict-platforms"],this.pipEventHandler=this.pipEventHandler.bind(this),this._shouldLoadManifestsOnce=shouldLoadManifestOnce()}}pa([Bind(),ha("design:type",Function),ha("design:paramtypes",[void 0])],VideoPlayer.prototype,"onPlaybackLicenseError",null);const decayingOperation=(e,n,d,p=0)=>e().catch(h=>{const y=p+1;function possiblyRetry(p){if(p&&y<3){const p=1e3*y;return new Promise((h,m)=>{setTimeout(()=>{decayingOperation(e,n,d,y).then(h,m)},p)})}throw h}const m=n(h);return"boolean"==typeof m?possiblyRetry(m):m.then(possiblyRetry)});let ba={developerToken:"developerTokenNotSet",musicUserToken:"musicUserTokenNotSet",cid:"cidNotSet"};function asyncGeneratorStep$10(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$10(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$10(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$10(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$y(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$y(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$y(e,n,d[n])}))}return e}function createHlsOffersLicenseChallengeBody(e){return{"adam-id":e.id,id:1}}function createStreamingKeysLicenseChallengeBody(e,n,d=0){var p;return _objectSpread$y({id:d,"lease-action":n},null!==(p=e.keyServerQueryParameters)&&void 0!==p?p:{})}function createLicenseChallengeBody(e,n,d,p,h,y,m){let g;const b={challenge:p.challenge||Ce(p.licenseChallenge),"key-system":h,uri:p.keyuri};return m&&(b["extended-lease"]=m),g=d.isUTS?e.startsWith("https://play.itunes.apple.com/WebObjects/MZPlay.woa/web/video/subscription/license")?_objectSpread$y({},b,function(e,n="start"){return{"extra-server-parameters":e.keyServerQueryParameters,"license-action":n}}(d,n)):{"streaming-request":{version:1,"streaming-keys":[_objectSpread$y({},b,createStreamingKeysLicenseChallengeBody(d,n))]}}:d.isLiveRadioStation?_objectSpread$y({},b,function(e){return{event:e.isLiveAudioStation?"beats1":"amtv"}}(d)):d.hasOffersHlsUrl?{"license-requests":[_objectSpread$y({},b,createHlsOffersLicenseChallengeBody(d))]}:_objectSpread$y({},b,function(e,n=!1){return{adamId:e.songId,isLibrary:e.isCloudItem,"user-initiated":n}}(d,y)),g}class License{fetch(e){const n={Authorization:"Bearer "+ba.developerToken,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+ba.musicUserToken};this.keySystem===Wt.WIDEVINE&&(n["X-Apple-Renewal"]=!0);const d=new Headers(n);return decayingOperation(()=>fetch(this.licenseUrl,{method:"POST",body:JSON.stringify(e),headers:d}),e=>e instanceof TypeError,"license fetch")}reset(){this.licenseUrl=void 0,this.playableItem=void 0,this.data=void 0,this.initiated=void 0,this.keySystem=void 0,this.startResponse=void 0}start(e,n,d,p,h=!1,y=!1){var m=this;return _asyncToGenerator$10((function*(){m.licenseUrl=e,m.playableItem=n,m.data=d,m.keySystem=p,m.initiated=h;const g=d.isRenewalRequest?"renew":"start",b=createLicenseChallengeBody(e,g,n,d,p,h,y);n.hasOffersHlsUrl&&(m.licenseUrl+="/"+g),m.startResponse=m.fetch(b);try{var _,P,T;const e=yield m.startResponse;if(!e.ok){let n;try{n=yield e.json()}catch(Lr){}m.processJsonError(n)}const n=yield e.json();let d=n;var S;return(null==n||null===(_=n["streaming-response"])||void 0===_||null===(P=_["streaming-keys"])||void 0===P?void 0:P.length)?d=n["streaming-response"]["streaming-keys"][0]:(null==n||null===(T=n["license-responses"])||void 0===T?void 0:T.length)&&(d=n["license-responses"][0]),d.status=null!==(S=d.status)&&void 0!==S?S:d.errorCode,0!==d.status&&m.processJsonError(d),d}catch(Y){throw m.startResponse=void 0,Y}}))()}processJsonError(e){let n=new MKError(MKError.MEDIA_LICENSE,"Error acquiring license");if((null==e?void 0:e.errorCode)&&(e.status=e.errorCode),-1021===(null==e?void 0:e.status)&&(e.status=190121),e&&0!==e.status){if(!e.message)switch(e.status){case-1004:e.message=MKError.DEVICE_LIMIT;break;case-1017:e.message=MKError.GEO_BLOCK;break;default:e.message=MKError.MEDIA_LICENSE}n=MKError.serverError(e),n.data=e,n.errorCode===MKError.PLAYREADY_CBC_ENCRYPTION_ERROR&&function(){const e=getSessionStorage();e&&e.setItem("mk-playready-cbcs-unsupported","true")}()}throw n}stop(){var e=this;return _asyncToGenerator$10((function*(){if(e.startResponse)try{yield e.startResponse}catch(Y){}if(!e.playableItem||!e.data||!e.licenseUrl)return;if(!e.playableItem.isUTS)return;const n=createLicenseChallengeBody(e.licenseUrl,"stop",e.playableItem,e.data,e.keySystem,e.initiated),d=e.fetch(n);e.reset();try{yield d}catch(Y){Lt.warn("license.stop request error",Y)}}))()}}function asyncGeneratorStep$$(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$$(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$$(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$$(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}var _a={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},Pa={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};class KeySession extends Notifications{get extID(){if(this.extURI)return this.extURI.replace("data:;base64,","")}get isFairplay(){return this.keySystem===Wt.FAIRPLAY}get isPlayReady(){return this.keySystem===Wt.PLAYREADY}get isWidevine(){return this.keySystem===Wt.WIDEVINE}acquirePlaybackLicense(e,n,d,p){var h=this;return _asyncToGenerator$$((function*(){if(!h.keyServerURL||!h.developerToken||!h.userToken)return;const{keyServerURL:d,keySystem:y}=h,m=p.item;try{return yield h.license.start(d,m,{challenge:n,keyuri:e},y,h.initiated,h.isLegacyEme&&m.isUTS)}catch(Lr){h.dispatchEvent(tr.playbackLicenseError,Lr)}}))()}startLicenseSession(e){var n=this;return _asyncToGenerator$$((function*(){let d;Lt.debug("Starting License Session",e);const{message:p,target:h,messageType:y}=e;if(n.keySystem!==Wt.FAIRPLAY&&"license-request"!==y)return void Lt.debug("not making license request for",y);if(n.isPlayReady){const e=String.fromCharCode.apply(null,new Uint16Array(p.buffer||p));d=(new DOMParser).parseFromString(e,"application/xml").getElementsByTagName("Challenge")[0].childNodes[0].nodeValue}else d=Ce(new Uint8Array(p));const m=h.extURI||n.extURI,g=n.mediaKeySessions[m];if(!g)return void Lt.debug("no key session info, aborting license request");const b=n.acquirePlaybackLicense(m,d,n.initiated,g);if(g.delayCdmUpdate)g["license-json"]=b;else{const e=yield b;yield n.handleLicenseJson(e,h,m)}}))()}setKeyURLs(e){this.keyCertURL=e[this.isFairplay?"hls-key-cert-url":"widevine-cert-url"],this.keyServerURL=e["hls-key-server-url"]}dispatchKeyError(e){var n,d;this.isFairplay&&4294955417===(null==e||null===(n=e.target)||void 0===n||null===(d=n.error)||void 0===d?void 0:d.systemCode)?Lt.error("Ignoring error",e):(console.error(MKError.MEDIA_KEY+" error in dispatchKeyError:",e),this.dispatchEvent(tr.playbackSessionError,new MKError(MKError.MEDIA_KEY,e)))}dispatchSessionError(e){this.dispatchEvent(tr.playbackSessionError,new MKError(MKError.MEDIA_SESSION,e))}loadCertificateBuffer(){var e=this;return _asyncToGenerator$$((function*(){if(!e.keyCertURL)return Promise.reject(new MKError(MKError.MEDIA_SESSION,"No certificate URL"));let n;try{n=yield fetch(`${e.keyCertURL}?t=${Date.now()}`)}catch(Y){throw e.dispatchKeyError(Y),Y}const d=yield n.arrayBuffer(),p=String.fromCharCode.apply(String,new Uint8Array(d));return/^\<\?xml/.test(p)?Promise.reject(new MKError(MKError.MEDIA_CERTIFICATE,"Invalid certificate.")):d}))()}handleSessionCreation(e){var n=this;return _asyncToGenerator$$((function*(){return n.createSession(e).catch(e=>{n.dispatchSessionError(e)})}))()}handleLicenseJson(e,n,d){var p=this;return _asyncToGenerator$$((function*(){if(Lt.debug(`updating session ${d} with license response`,e),null==e?void 0:e.license){const d=Ie(e.license);try{yield n.update(d)}catch(Lr){Lt.error("Failed to updated media keys",Lr),p.dispatchKeyError(Lr)}}}))()}addMediaKeySessionInfo(e,n,d,p=!1){const h=this.mediaKeySessions[e];h?(Lt.debug(`keySession info exists for ${d.title}, making existing session ${h.session.sessionId} the old session`),h.oldSession=h.session,h.session=n):(Lt.debug("creating key session info for "+d.title),this.mediaKeySessions[e]={session:n,item:d,delayCdmUpdate:p})}stopLicenseSession(){Lt.info("key session sending license stop"),this.license.stop()}constructor(){super([tr.playbackLicenseError,tr.playbackSessionError]),this.initiated=!0,this.isLibrary=!1,this.keySystem=Wt.FAIRPLAY,this.isLegacyEme=!1,this.mediaKeySessions={},this.boundDispatchKeyError=this.dispatchKeyError.bind(this),this.boundDispatchSessionError=this.dispatchSessionError.bind(this),this.boundHandleSessionCreation=this.handleSessionCreation.bind(this),this.boundStartLicenseSession=this.startLicenseSession.bind(this),this.license=new License}}function asyncGeneratorStep$_(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$_(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$_(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$_(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}_a([Bind(),Pa("design:type",Function),Pa("design:paramtypes",[void 0])],KeySession.prototype,"startLicenseSession",null);var Ta={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},Sa={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};class FairplayEncryptedSession extends KeySession{attachMedia(e,n){var d=this;return _asyncToGenerator$_((function*(){d.keySystem=n.keySystem,d._keySystemAccess=n,e.addEventListener("encrypted",d.boundHandleSessionCreation,!1)}))()}detachMedia(e){e.removeEventListener("encrypted",this.boundHandleSessionCreation);const n=this._mediaKeySessions,d=this._mediaKeySessionRenewals;Object.values(n).forEach(e=>{e.removeEventListener("message",this.boundStartLicenseSession),asAsync(e.close())}),this._mediaKeySessions={},Object.values(d).forEach(e=>clearTimeout(e)),this._mediaKeySessionRenewals={}}createSession(e){var n=this;return _asyncToGenerator$_((function*(){Lt.debug("fairplay eme:  createSession",e);const d=n._keySystemAccess;if(!d)return;const{initData:p,target:h,initDataType:y}=e;n._mediaKeysPromise||(n._mediaKeysPromise=new Promise(function(){var e=_asyncToGenerator$_((function*(e,p){const y=yield d.createMediaKeys();try{yield h.setMediaKeys(y),n._mediaKeys=y;const e=yield n.loadCertificateBuffer();yield y.setServerCertificate(e)}catch(Y){n.dispatchKeyError(Y),p(Y)}e(y)}));return function(n,d){return e.apply(this,arguments)}}()));const m=yield n._mediaKeysPromise,g=new Uint8Array(p),b=String.fromCharCode.apply(void 0,Array.from(g));if(n.mediaKeySessions[b])return void Lt.error("fairplay eme: not creating new session for extURI",b);const _=m.createSession();Lt.debug("fairplay eme: creating new key session for",b),n.addMediaKeySessionInfo(b,_,n.item),_.addEventListener("message",n.startFairplayLicenseSession),_.extURI=b,yield _.generateRequest(y,p),n._mediaKeySessions[_.sessionId]=_,Lt.debug("fairplay eme: created session",_)}))()}startFairplayLicenseSession(e){const{message:n,target:d}=e,p=Ce(new Uint8Array(n)),h=d.extURI||this.extURI,y=this.mediaKeySessions[h];if(y)return this.acquirePlaybackLicense(h,p,this.initiated,y).then(e=>this.handleLicenseJson(e,d,h));Lt.debug("fairplay eme: no key session info, aborting license request",h)}handleLicenseJson(e,n,d){var p=this,_superprop_get_handleLicenseJson=()=>super.handleLicenseJson;return _asyncToGenerator$_((function*(){if(!e)return;const h=p.mediaKeySessions[d];if(!h)return void Lt.debug("fairplay eme: media key session does not exist, not updating");const y=e["renew-after"];if(e.license&&y){Lt.debug("fairplay eme: got renew after value",y,d);const e=p._mediaKeySessionRenewals,m=e[n.sessionId];m&&clearTimeout(m),e[n.sessionId]=setTimeout(()=>p._renewMediaKeySession(h,d),1e3*y)}yield _superprop_get_handleLicenseJson().call(p,e,n,d)}))()}_renewMediaKeySession(e,n){delete this._mediaKeySessionRenewals[e.session.sessionId],Lt.debug("fairplay eme: renewing session",e),e.session.update(Ae("renew"))}applyDelayedCdmUpdates(){}loadKeys(e){return _asyncToGenerator$_((function*(){}))()}clearSessions(){return _asyncToGenerator$_((function*(){}))()}constructor(...e){super(...e),this._mediaKeySessions={},this._mediaKeySessionRenewals={}}}function asyncGeneratorStep$Z(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$Z(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$Z(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$Z(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}Ta([Bind(),Sa("design:type",Function),Sa("design:paramtypes",[void 0])],FairplayEncryptedSession.prototype,"startFairplayLicenseSession",null);const Ea=/^(?:.*)(skd:\/\/.+)$/i;class WebKitSession extends KeySession{attachMedia(e,n){return this.target=e,e.addEventListener("webkitneedkey",this.boundHandleSessionCreation,!1),e.addEventListener("webkitkeyerror",this.boundDispatchKeyError),e}detachMedia(e){e&&(e.removeEventListener("webkitneedkey",this.boundHandleSessionCreation,!1),e.removeEventListener("webkitkeyerror",this.boundDispatchKeyError))}destroy(){Lt.debug("FPS destroy"),this.detachMedia(this.target),this.session&&(this.session.removeEventListener("webkitkeyerror",this.boundDispatchKeyError),this.session.removeEventListener("webkitkeymessage",this.boundStartLicenseSession))}createSession(e){Lt.debug("FPS createSession",e);const{initData:n,target:d}=e,{item:p}=this;if(!p)return Lt.error("Cannot createSession without item"),Promise.resolve();const h=this._extractAssetId(n);if(Lt.debug("extURI",h),!d.webkitKeys&&window.WebKitMediaKeys){const e=new window.WebKitMediaKeys(this.keySystem);d.webkitSetMediaKeys(e)}return this.loadCertificateBuffer().then(e=>{const y=this._concatInitDataIdAndCertificate(n,h,e),m="VIDEO"===d.tagName?rr.AVC1:rr.MP4,g=d.webkitKeys.createSession(m,y);this.addMediaKeySessionInfo(h,g,p),this.session=g,g.extURI=h,g.addEventListener("webkitkeyerror",this.boundDispatchKeyError),g.addEventListener("webkitkeymessage",this.boundStartLicenseSession)})}_extractAssetId(e){let n=String.fromCharCode.apply(null,new Uint16Array(e.buffer||e));const d=n.match(Ea);return d&&d.length>=2&&(n=d[1]),Lt.debug("Extracted assetId from EXT-X-KEY URI",n),n}_concatInitDataIdAndCertificate(e,n,d){"string"==typeof n&&(n=Re(n)),d=new Uint8Array(d);let p=0;const h=new ArrayBuffer(e.byteLength+4+n.byteLength+4+d.byteLength),y=new DataView(h);new Uint8Array(h,p,e.byteLength).set(e),p+=e.byteLength,y.setUint32(p,n.byteLength,!0),p+=4;const m=new Uint8Array(h,p,n.byteLength);m.set(n),p+=m.byteLength,y.setUint32(p,d.byteLength,!0),p+=4;return new Uint8Array(h,p,d.byteLength).set(d),new Uint8Array(h,0,h.byteLength)}applyDelayedCdmUpdates(){}loadKeys(e){return _asyncToGenerator$Z((function*(){}))()}clearSessions(){return _asyncToGenerator$Z((function*(){}))()}constructor(...e){super(...e),this.isLegacyEme=!0}}function asyncGeneratorStep$Y(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$Y(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$Y(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$Y(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}class MSSession extends KeySession{attachMedia(e,n){return this.keySystem=n.keySystem,e.addEventListener("msneedkey",this.boundHandleSessionCreation,!1),e.addEventListener("mskeyerror",this.boundDispatchKeyError),e}detachMedia(e){e.removeEventListener("msneedkey",this.boundHandleSessionCreation,!1),e.removeEventListener("mskeyerror",this.boundDispatchKeyError)}createSession(e){const{initData:n,target:d}=e;if(!d.msKeys){const e=new MSMediaKeys(this.keySystem);d.msSetMediaKeys(e)}const p=d.msKeys.createSession(rr.MP4,n);return p.addEventListener("mskeyerror",this.dispatchKeyError),p.addEventListener("mskeymessage",this.startLicenseSession.bind(this)),p}applyDelayedCdmUpdates(){}loadKeys(e){return _asyncToGenerator$Y((function*(){}))()}clearSessions(){return _asyncToGenerator$Y((function*(){}))()}}const ka={[Wt.WIDEVINE]:nr.WIDEVINE,[Wt.FAIRPLAY]:nr.FAIRPLAY,[Wt.PLAYREADY]:nr.PLAYREADY},wa=[0,0,1,222,112,115,115,104,0,0,0,0,154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149,0,0,1,190],Oa=[190,1,0,0,1,0,1,0,180,1];function concatenate(e,...n){let d=0;for(const y of n)d+=y.length;const p=new e(d);let h=0;for(const y of n)p.set(y,h),h+=y.length;return p}const{WIDEVINE:Ia,PLAYREADY:Aa}=Wt,Ra={};Ra[Ia]=e=>{Lt.debug("generating Widevine pssh for keyId");const n=new Uint8Array([0,0,0,52,112,115,115,104,0,0,0,0,237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237,0,0,0,20,8,1,18,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);for(let d=0;d<e.length;d++)n[n.length-16+d]=e[d];return Lt.debug("generatePSSH",n),n},Ra[Aa]=e=>{Lt.debug("generating Playready pssh for keyId"),(e=>{const swap=(e,n,d)=>{const p=e[n];e[n]=e[d],e[d]=p};swap(e,0,3),swap(e,1,2),swap(e,4,5),swap(e,6,7)})(e);const n=Ce(e),d='<WRMHEADER xmlns="http://schemas.microsoft.com/DRM/2007/03/PlayReadyHeader" version="4.3.0.0"><DATA><PROTECTINFO><KIDS><KID ALGID="AESCTR" VALUE="[KEYID]"></KID></KIDS></PROTECTINFO></DATA></WRMHEADER>'.replace("[KEYID]",n),p=Re(d),h=new Uint8Array(p.buffer,p.byteOffset,p.byteLength);return concatenate(Uint8Array,wa,Oa,h)};function asyncGeneratorStep$X(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$X(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$X(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$X(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}class PreloadingEncryptedSession extends KeySession{attachMedia(e,n){this.keySystem=n.keySystem,this._keySystemAccess=n,this._target=e}detachMedia(){asAsync(this.clearSessions())}createSession(e){return _asyncToGenerator$X((function*(){}))()}_mediaKeysSetup(){var e=this;return _asyncToGenerator$X((function*(){const n=e._keySystemAccess;n&&(e._mediaKeysPromise||(e._mediaKeysPromise=new Promise(function(){var d=_asyncToGenerator$X((function*(d,p){const h=yield n.createMediaKeys();try{var y;yield null===(y=e._target)||void 0===y?void 0:y.setMediaKeys(h),e._mediaKeys=h}catch(Y){e.dispatchKeyError(Y),p(Y)}if(e.isWidevine){const n=yield e.loadCertificateBuffer();yield h.setServerCertificate(n)}d(h)}));return function(e,n){return d.apply(this,arguments)}}())),yield e._mediaKeysPromise)}))()}createSessionAndGenerateRequest(e,n,d){var p=this;return _asyncToGenerator$X((function*(){var h;const y=!!(null==d?void 0:d.isRenewal),m=!!(null==d?void 0:d.delayCdmUpdate);if(!y&&p.mediaKeySessions[e])return;Lt.debug(`createSessionAndGenerateRequest for item ${n.title}, isRenewal ${y}`);const g=null===(h=p._mediaKeys)||void 0===h?void 0:h.createSession(),{keySystem:b}=p;if(!g)return;p.addMediaKeySessionInfo(e,g,n,m);const _=(e=>{if(e.includes("data")){const[n,d]=e.split(",");return d}return e})(e),P=Ie(_),T=p.isWidevine&&n.isSong||16===P.length;let S;var E;return Lt.debug("extracted uri",e),p.isPlayReady&&!T?(Lt.debug("handling Playready object"),g.extURI=e,E=P,S=concatenate(Uint8Array,new Uint8Array(wa),E)):T?(Lt.debug("handling keyId only initData"),g.extURI="data:;base64,"+Ce(P),S=((e,n)=>{const d=Ra[n];if(!d)return Lt.warn("No pssh generator for ",n),e;return d(Uint8Array.from(e))})(P,b)):(Lt.debug("handling pssh initData"),g.extURI=e,S=P),g.addEventListener("message",p.startLicenseSession),g.generateRequest("cenc",S).catch(e=>{if(e.message.match(/generateRequest.*\(75\)/))return g.generateRequest("cenc",S);throw e})}))()}handleLicenseJson(e,n,d){var p=this,_superprop_get_handleLicenseJson=()=>super.handleLicenseJson;return _asyncToGenerator$X((function*(){var h;if(!e)return;const y=p.mediaKeySessions[d];if(!y)return void Lt.debug("media key session does not exist, not updating");const m=e["renew-after"];if(e.license&&m){Lt.debug("Got renew after value",m,d);const e=p._mediaKeySessionRenewals,h=e[n.sessionId];h&&clearTimeout(h),e[n.sessionId]=setTimeout(()=>p._renewMediaKeySession(y,d),1e3*m)}yield _superprop_get_handleLicenseJson().call(p,e,n,d);const g=null===(h=p.mediaKeySessions[d])||void 0===h?void 0:h.oldSession;g&&(Lt.debug("removing old key session after updating",d),yield p._removeAndCloseSession(g),delete p.mediaKeySessions[d].oldSession,delete p._mediaKeySessionRenewals[g.sessionId])}))()}_renewMediaKeySession(e,n){delete this._mediaKeySessionRenewals[e.session.sessionId],asAsync(this.createSessionAndGenerateRequest(n,e.item,{isRenewal:!0}))}applyDelayedCdmUpdates(){var e=this;return _asyncToGenerator$X((function*(){Lt.debug("applying delayed CDM updates");const n=Object.entries(e.mediaKeySessions);for(const d of n){const[n,p]=d;if(p.delayCdmUpdate){const d=yield p["license-json"];Lt.debug("delayed update of license",d),p.delayCdmUpdate=!1,yield e.handleLicenseJson(d,p.session,n)}}}))()}loadKeys(e,n,d){var p=this;return _asyncToGenerator$X((function*(){yield p._mediaKeysSetup();const h=p.filterKeyValues(e);for(const e of h){const{dataUri:h}=e;yield p.createSessionAndGenerateRequest(h,n,d)}if(null==n?void 0:n.isLiveAudioStation){const e=Object.keys(p.mediaKeySessions),n=h.reduce((e,n)=>(e[n.dataUri]=!0,e),{});for(const d of e)n[d]||(yield p._scheduleRemoveSession(d))}}))()}filterKeyValues(e){let n;if(1===e.length)n=e;else{const d=ka[this.keySystem];n=e.filter(e=>e.keyFormat===d)}return n}clearSessions(e){var n=this;return _asyncToGenerator$X((function*(){const d=n.mediaKeySessions;if(null==e?void 0:e.length){const d=n.filterKeyValues(e);for(const e of d){const d=e.dataUri;clearTimeout(n._sessionRemovalTimeouts[d]),yield n._removeSessionImmediately(d)}}else{Object.values(n._sessionRemovalTimeouts).forEach(e=>clearTimeout(e)),Lt.debug("clearing key sessions",d);for(const e of Object.keys(d))yield n._removeSessionImmediately(e)}}))()}_scheduleRemoveSession(e){var n=this;return _asyncToGenerator$X((function*(){if(!n.mediaKeySessions[e])return void Lt.warn("no session for dataUri, not scheduling remove",e);if(n._sessionRemovalTimeouts[e])return;const d=setTimeout(()=>{asAsync(n._removeSessionImmediately(e))},6e4);Lt.debug("deferring removal of keysession for dataUri",e),n._sessionRemovalTimeouts[e]=d}))()}_removeSessionImmediately(e){var n=this;return _asyncToGenerator$X((function*(){const d=n.mediaKeySessions[e];if(!d)return void Lt.warn("no session for dataUri, not removing",e);Lt.debug("removing keysession for",e);const{session:p,oldSession:h}=d;n._clearSessionRenewal(p),delete n.mediaKeySessions[e],yield n._removeAndCloseSession(p),h&&(yield n._removeAndCloseSession(h))}))()}_removeAndCloseSession(e){var n=this;return _asyncToGenerator$X((function*(){e.removeEventListener("message",n.startLicenseSession),Lt.debug("tearing down session",e.sessionId);try{yield e.remove()}catch(Lr){Lt.warn("Error invoking session.remove()",Lr)}finally{try{yield e.close()}catch(Lr){Lt.warn("Error invoking session.close()",Lr)}}}))()}_clearSessionRenewal(e){const n=this._mediaKeySessionRenewals[e.sessionId];n&&(Lt.debug("clearing scheduled license renewal for session",e.sessionId),clearTimeout(n),delete this._mediaKeySessionRenewals[e.sessionId])}constructor(...e){super(...e),this._sessionRemovalTimeouts={},this._mediaKeySessionRenewals={}}}function asyncGeneratorStep$W(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$W(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$W(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$W(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}const Ca=BooleanDevFlag.register("mk-safari-modern-eme");class MediaExtension extends Notifications{get hasMediaKeySupport(){return hasMediaKeySupport()}get hasMediaSession(){return void 0!==this._session}get isFairplay(){return this._session.isFairplay}set extURI(e){this._session.extURI=e}set initiated(e){this._session.initiated=e}get session(){return this._session}clearSessions(e){var n=this;return _asyncToGenerator$W((function*(){var d;return null===(d=n.session)||void 0===d?void 0:d.clearSessions(e)}))()}initializeKeySystem(){var e=this;return _asyncToGenerator$W((function*(){yield e._attachSession();const{_session:n}=e;n&&[tr.playbackLicenseError,tr.playbackSessionError].forEach(d=>{n.addEventListener(d,n=>{e.dispatchEvent(d,n)})})}))()}_requestModernFairplayAccess(){var e=this;return _asyncToGenerator$W((function*(){const{contentType:n}=e,d=[{initDataTypes:["skd"],audioCapabilities:[{contentType:n,robustness:""}],videoCapabilities:[{contentType:n,robustness:""}],distinctiveIdentifier:"not-allowed",persistentState:"not-allowed",sessionTypes:["temporary"]}],[,p]=yield findMediaKeySystemAccess([Wt.FAIRPLAY],d);return p}))()}_attachSession(){var e=this;return _asyncToGenerator$W((function*(){var n,d;const{mediaElement:p,contentType:h}=e;if(null===(n=window.WebKitMediaKeys)||void 0===n?void 0:n.isTypeSupported(Wt.FAIRPLAY+".1_0",rr.MP4)){let n;Ca.enabled&&e.hasMediaKeySupport&&(n=yield e._requestModernFairplayAccess()),n?(Lt.warn("media-extension: Using Fairplay modern EME"),e._session=new FairplayEncryptedSession,e._session.attachMedia(p,n)):(Lt.warn("media-extension: Using Fairplay legacy EME"),e._session=new WebKitSession,e._session.attachMedia(p,{keySystem:Wt.FAIRPLAY}))}else if(null===(d=window.MSMediaKeys)||void 0===d?void 0:d.isTypeSupported(Wt.PLAYREADY,rr.MP4))e._session=new MSSession,e._session.attachMedia(p,{keySystem:Wt.PLAYREADY});else if(e.hasMediaKeySupport&&p.canPlayType(h)){e._session=new PreloadingEncryptedSession;const n=[{initDataTypes:["cenc","keyids"],audioCapabilities:[{contentType:h}],distinctiveIdentifier:"optional",persistentState:"required"}],d=potentialKeySystemsForAccess(),[,m]=yield findMediaKeySystemAccess(d,n);var y;if(m)null===(y=e._session)||void 0===y||y.attachMedia(p,m);else Lt.warn("media-extension: No keysystem detected!")}}))()}setMediaItem(e){!function(e,n){n.keyURLs&&(e.developerToken=ba.developerToken,e.userToken=ba.musicUserToken,e.item=n,e.adamId=n.songId,e.isLibrary=n.isCloudItem,e.setKeyURLs(n.keyURLs))}(this._session,e)}destroy(e){var n;null===(n=this._session)||void 0===n||n.detachMedia(e)}constructor(e,n){super([tr.playbackLicenseError,tr.playbackSessionError]),this.mediaElement=e,this.contentType=n}}const Ma=BooleanDevFlag.register("mk-force-audio-mse"),shouldForceAudioMse=()=>Ma.enabled;function asyncGeneratorStep$V(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}class ByteRangeSegment{load(){var e,n=this;return(e=function*(){const{url:e,range:d}=n;if(!e)return new Uint8Array;const p=new Headers;p.append("Range",d);const h=yield fetch(e,{headers:p}),y=yield h.arrayBuffer();return new Uint8Array(y)},function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$V(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$V(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))})()}constructor({url:e,startByte:n,length:d,isInitSegment:p=!1}){this.url=e,this.isInitSegment=p,this.startByte=parseInt(n,10),this.length=parseInt(d,10),this.endByte=this.startByte+this.length-1,this.range=`bytes=${this.startByte}-${this.endByte}`}}function asyncGeneratorStep$U(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}class ContinuousSegment{load(){var e,n=this;return(e=function*(){const{url:e}=n;if(!e)return new Uint8Array;const d=yield fetch(e),p=yield d.arrayBuffer();return new Uint8Array(p)},function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$U(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$U(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))})()}constructor(e,n=!1){this.url=e,this.isInitSegment=n}}const Da=/^#EXT-X-BYTERANGE:([^\n]+)\n/gim,ja=/^#EXT-X-MAP:([^\n]+)\n/im,xa=/#EXTINF:\d*\.\d*\,[\n](.+)|^#EXT-X-MAP:URI="([^"]*)"/gim,$a=/#EXTINF:\d*\.\d*,\s*#EXT-X-BITRATE:\d{1,3}[\n](.+)|^#EXT-X-MAP:URI="([^"]*)"/gim;class SegmentList{get segments(){return this._segments}addSegment(e,n){this._addedSegments[n]||(Lt.debug("Adding segment",n),this._segments.push(e),this._addedSegments[n]=!0)}extractLiveRadioSegments(e,n){this._extractContinuousSegments(xa,e,n)}extractHlsOffersSegments(e,n){this._extractContinuousSegments($a,e,n)}_extractContinuousSegments(e,n,d){if(!n||!e.test(n))return;let p;for(e.lastIndex=0;p=e.exec(n);){const e=p[0].startsWith("#EXT-X-MAP")?p[2]:p[1],n=rewriteLastUrlPath(d,e),h=p[0].startsWith("#EXT-X-MAP");this.addSegment(new ContinuousSegment(n,h),e)}}extractByteRangeSegments(e,n){if(!e||!Da.test(e))return;const d=function(e){if(!e||!ja.test(e))return;const[,n]=e.match(ja);return n.split(",").reduce((e,n)=>{const[d,p]=n.split("=");return e[d.toLowerCase()]=p.replace(/\"/gi,""),e},{})}(e);var p;const h=null!==(p=n.split("/").pop())&&void 0!==p?p:"",y=n.replace(h,d.uri),[m,g]=d.byterange.split("@"),b=new ByteRangeSegment({url:y,startByte:g,length:m});var _;this.addSegment(b,b.range),(null!==(_=e.match(Da))&&void 0!==_?_:[]).forEach(e=>{const[,n,d]=e.match(/^#EXT-X-BYTERANGE:(\d+)@(\d+)\n/),p=new ByteRangeSegment({url:y,startByte:d,length:n});this.addSegment(p,p.range)})}constructor(){this._segments=[],this._addedSegments={}}}var La;function asyncGeneratorStep$T(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$T(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$T(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$T(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}!function(e){e.keysParsed="keysParsed"}(La||(La={}));var Na={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},Ua={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};const Ga=/^#EXT-X-TARGETDURATION:(\d+)/im,Ba=/^#EXT-X-KEY:[^\n]+URI="([^"]+)"/im,Fa=/^#EXT-X-KEY:[^\n]+URI="([^"]+)",KEYFORMAT="([^"]+)"/gim;function loadManifestData(e){return _loadManifestData.apply(this,arguments)}function _loadManifestData(){return(_loadManifestData=_asyncToGenerator$T((function*(e){return(yield fetch(e)).text()}))).apply(this,arguments)}class Manifest extends Notifications{parse(){const e=this._item,n=this._data;if(ir!==Wt.FAIRPLAY||shouldForceAudioMse())if(this._detectKeyTags(),e.hasOffersHlsUrl)this._segmentList.extractHlsOffersSegments(n,e.assetURL);else if(e.isLiveRadioStation){this._segmentList.extractLiveRadioSegments(n,e.assetURL);const[,d]=this._data.match(Ga);Lt.debug(`manifest: setting up manifest refresh interval at ${d} seconds`);const p=1e3*parseInt(d,10);this._manifestRefreshInterval=setInterval(this.liveRadioRefresh,p)}else this._segmentList.extractByteRangeSegments(n,e.assetURL)}static load(e,n=!0){var d=this;return _asyncToGenerator$T((function*(){Lt.debug("loading manifest for item",e.title);const p=e.assetURL;let h;const y=getSessionStorage(),m=!!y&&n;if(m&&(h=null==y?void 0:y.getItem(p),h))return new d(h,e);const g=(new Date).getTime();h=yield loadManifestData(p);const b=new d(h,e);return b.downlink=function(e,n){return 8*n.length/(((new Date).getTime()-e)/1e3)/1024}(g,h),m&&(null==y||y.setItem(p,h)),Promise.resolve(b)}))()}get downlink(){return this._downlink}set downlink(e){this._downlink=e}get mediaItem(){return this._item}liveRadioRefresh(){var e=this;return _asyncToGenerator$T((function*(){const n=yield loadManifestData(e._url);e._data=n,e._detectKeyTags(),e._segmentList.extractLiveRadioSegments(n,e._url),e.dispatchEvent(tr.manifestParsed)}))()}segmentsForTimeRange(e){const n=Math.floor(e.start/10)+1,d=Math.floor(e.end/10)+1,{segments:p}=this;return[p[0],...p.slice(n,d+1)]}get segments(){return this._segmentList.segments}get extURI(){if(!this._extURI){const e=this._data.match(Ba);Lt.debug("manifest: EXT_X_KEY_URI matches",e),this._extURI=e&&e[1]||void 0}return this._extURI}get keyValues(){let e=this._modernKeys;return e.length||(e=this._legacyKeys),e}_detectKeyTags(){const e=this.keyValues;e.length&&this.dispatchEvent(La.keysParsed,{item:this.mediaItem,keys:e})}get _legacyKeys(){const e=this._data.match(Ba);Lt.debug("manifest: EXT_X_KEY_URI matches",e);const n=e&&e[1]||void 0;this._extURI=n;const d=[];return n&&d.push({keyFormat:nr.WIDEVINE,dataUri:n}),d}get _modernKeys(){let e;Fa.lastIndex=0;const n=[];for(;e=Fa.exec(this._data);){const[d,p,h]=e;n.push({keyFormat:h,dataUri:p})}return n}stop(){this._manifestRefreshInterval&&clearInterval(this._manifestRefreshInterval)}constructor(e,n){super([tr.manifestParsed,La.keysParsed]),this._downlink=0,this._segmentList=new SegmentList,this._data=e,this._item=n,this._url=n.assetURL}}Na([Bind(),Ua("design:type",Function),Ua("design:paramtypes",[])],Manifest.prototype,"liveRadioRefresh",null);const Ka="seamlessAudioTransition",Va="bufferTimedMetadataDidChange",Ha="loadSegmentError",qa=isNodeEnvironment$1()?require("util").TextDecoder:self.TextDecoder;function encodedArrayToString(e,n="utf-8"){if("iso-8859-1"===n)return String.fromCharCode(...e);return new qa(n).decode(e)}function readNullTerminatedString(e,n=0,d){const p=[];d=null!=d?d:e.length;for(let h=n;h<d;h++){const n=e[h];if("\0"===String.fromCharCode(n))break;p.push(String.fromCharCode(n))}return[p.join(""),p.length]}function isBitAtPositionOn(e,n){return 0!=(e&1<<n)}class BaseMp4Box{get size(){return this.end-this.start}get rawBytes(){return this.data.slice(this.start,this.end)}constructor(e,n,d,p){this.id=e,this.data=n,this.start=d,this.end=p}}const za=[237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237];class PsshBox extends BaseMp4Box{get systemId(){const{data:e,start:n}=this,d=n+12;return e.slice(d,d+16)}get dataSize(){return this.view.getUint32(28)}get psshData(){const{data:e,start:n,dataSize:d}=this,p=n+32;return e.slice(p,p+d)}get keyBytes(){const{psshData:e}=this;return e.slice(2,18)}get isWidevine(){return arrayEquals(this.systemId,za)}constructor(e,n,d){super("pssh",e,n,d),this.view=new DataView(e.buffer,n)}}class TencBox extends BaseMp4Box{get isProtected(){const{data:e,start:n}=this;return e[n+14]}get defaultKeyId(){const{data:e,start:n}=this;return e.slice(n+16,n+32)}set defaultKeyId(e){const{data:n,start:d}=this;for(let p=0;p<e.length;p++)n[p+d+16]=e[p]}constructor(e,n,d){super("tenc",e,n,d),this.data=e,this.start=n,this.end=d}}function findBox(e,n,d=[]){for(let p=n;p<e.length;){if(0===d.length)return;const n=new DataView(e.buffer,p).getUint32(0),h=encodedArrayToString(e.subarray(p+4,p+8)),y=p+n;if(1===d.length&&h===d[0])return new BaseMp4Box(h,e,p,y);if(h===d[0])return findBox(e,p+8,d.slice(1));p+=n}}const rewriteDefaultKid=e=>{const[n]=function(e){const n=findBox(e,0,["moov","trak","mdia","minf","stbl","stsd"]),d=[];if(!n)return d;for(let p=n.start+16;p<n.end;){let h=findBox(e,p,["enca"]),y=36;if(h||(h=findBox(e,p,["encv"]),y=86),!h)return d;const m=findBox(e,h.start+y,["sinf","schi","tenc"]);m?(d.push(new TencBox(m.data,m.start,m.end)),p=m.end):p=n.end}return d}(e);if(!n)return;const d=function(e){const n=findBox(e,0,["moov"]),d=[];if(!n)return d;const p=new DataView(e.buffer,0);for(let h=n.start+8;h<n.size;){const n=p.getUint32(h);"pssh"===encodedArrayToString(e.subarray(h+4,h+8))&&d.push(new PsshBox(e,h,h+n)),h+=n}return d}(e).find(e=>e.isWidevine);d&&(n.defaultKeyId=d.keyBytes)};function readSynchSafeUint32(e){return 2097152*(127&e[0])+16384*(127&e[1])+128*(127&e[2])+(127&e[3])}const Wa={0:"iso-8859-1",1:"utf-16",2:"utf-16be",3:"utf-8"},Ya={TPE1:!0,TIT2:!0,WXXX:!0,PRIV:!0,TALB:!0,CHAP:!0};class ID3{_parseID3Flags(e){this.unsynchronized=isBitAtPositionOn(e,7),this.hasExtendedHeader=isBitAtPositionOn(e,6),this.isExperimental=isBitAtPositionOn(e,5),this.hasFooter=isBitAtPositionOn(e,4)}_parseID3Frames(e,n,d,p){const h=new DataView(n.buffer,0,p),{minor:y}=this;for(;d+8<=p;){const m=Oe(n.subarray(d,d+4));d+=4;const g=4===y?readSynchSafeUint32(n.subarray(d,d+4)):h.getUint32(d);if(d+=4,n[d++],n[d++],Ya[m]){const h=d,y=this._extractID3FramePayload(n,m,g,h,p);if(y){const n=this.decodeID3Frame(y);n&&e.frames.push(n)}d+=g}else d+=g}}_extractID3FramePayload(e,n,d,p,h){const y=p+d;let m;return y<=h&&(m={type:n,size:d,data:e.slice(p,y)}),m}decodeID3Frame(e){if("TXXX"!==e.type)return"WXXX"===e.type?this.decodeWxxxFrame(e):"PRIV"===e.type?this.decodePrivFrame(e):"CHAP"===e.type?this.decodeChapFrame(e):"T"===e.type[0]?this.decodeTextFrame(e):{key:e.type,data:e.data}}decodeChapFrame(e){const{data:n}=e,d=new DataView(n.buffer),p={key:"CHAP",frames:[]};let[h,y]=readNullTerminatedString(n,0,n.length);return p.id=h,y++,p.startTime=d.getUint32(y),y+=4,p.endTime=d.getUint32(y),y+=4,y+=4,y+=4,this._parseID3Frames(p,n,y,n.length),p}decodeTextFrame(e){const{data:n}=e,d=Wa[n[0]],p=encodedArrayToString(n.subarray(1),d);return{key:e.type,text:p}}decodeWxxxFrame(e){const{data:n}=e,d=Wa[n[0]];let p=1;const h=encodedArrayToString(n.subarray(p),d);p+=h.length+1;return{key:"WXXX",description:h,text:encodedArrayToString(n.subarray(p))}}decodePrivFrame(e){const n=encodedArrayToString(e.data);if(!n)return;return{key:"PRIV",info:n,data:e.data.slice(n.length+1)}}constructor(e){this.frames=[],this.unsynchronized=!1,this.hasExtendedHeader=!1,this.hasFooter=!1,this.isExperimental=!1;let n=0;const d=Oe(e.subarray(n,n+3));if(n+=3,"ID3"!==d)return;this.minor=e[n++],this.revision=e[n++];const p=e[n++];this._parseID3Flags(p);const h=readSynchSafeUint32(e.subarray(n,n+4));n+=4,this.frameLength=h;const y=n+h;if(this.endPos=y,this.hasExtendedHeader){n+=readSynchSafeUint32(e.subarray(n,n+4))}this.minor>2&&this._parseID3Frames(this,e,n,y)}}var Qa;function checkBoxName(e,n,d){return!(n+4>e.length)&&(e[n]===d[0]&&e[n+1]===d[1]&&e[n+2]===d[2]&&e[n+3]===d[3])}function findEmsgs(e){const n=e.length,d=[];if(function(e){return(null==e?void 0:e.length)>=8&&checkBoxName(e,4,[102,116,121,112])}(e))return d;for(let p=0;p<n;p++){if(checkBoxName(e,p,[109,111,111,102]))return d;if(checkBoxName(e,p,[101,109,115,103])){const n=p-4,h=new DataView(e.buffer,n).getUint32(0),y=e.subarray(n,n+h);p=p+h-1,d.push(y)}}return d}!function(e){e[e.THREE=51]="THREE",e[e.C_A=65]="C_A",e[e.C_C=67]="C_C",e[e.C_D=68]="C_D",e[e.C_H=72]="C_H",e[e.C_I=73]="C_I",e[e.C_P=80]="C_P",e[e.A=97]="A",e[e.C=99]="C",e[e.D=100]="D",e[e.E=101]="E",e[e.F=102]="F",e[e.G=103]="G",e[e.H=104]="H",e[e.I=105]="I",e[e.K=107]="K",e[e.M=109]="M",e[e.O=111]="O",e[e.P=112]="P",e[e.S=115]="S",e[e.T=116]="T",e[e.V=118]="V",e[e.Y=121]="Y"}(Qa||(Qa={}));const Ja={TALB:"album",TIT2:"title",TPE1:"performer"},Xa=["performer","title","album"];class TimedMetadata{resolveAdamIdFromStorefront(e){const n=this.storefrontToIds[e];this._adamId=n}get adamId(){return this._adamId}equals(e){if(!Xa.every(n=>this[n]===e[n]))return!1;const{links:n}=this,d=e.links;if(n.length!==d.length)return!1;for(let p=0;p<n.length;p++){const e=n[p].description===d[p].description,h=n[p].url===d[p].url;if(!e||!h)return!1}return!0}constructor(e){this.links=[],this.storefrontToIds={},e.forEach(e=>{const{key:n}=e,d=Ja[n];var p;if(d)this[d]=null===(p=e.text)||void 0===p?void 0:p.replace(/\0/g,"");else if("WXXX"===e.key){if(e.description){const[n,d]=e.description.split("\0");this.links.push({description:n,url:d})}}else if("PRIV"===e.key){var h;const n=null===(h=e.info)||void 0===h?void 0:h.split("\0");if(n&&n.length&&n[0].startsWith("com.apple.radio.adamid")){n[1].split(",").forEach(e=>{const[n,d]=e.split(":");n&&d&&"0"!==d&&!hasOwn(this.storefrontToIds,n)&&(this.storefrontToIds[n]=d)})}}})}}class Emsg{get length(){return this.data.length}get elementPresentationTime(){const{presentationTime:e,timeScale:n}=this;return e&&n?Math.round(e/n):NaN}get timedMetadata(){var e;if(this._timedMetadata)return this._timedMetadata;const n=null===(e=this.id3)||void 0===e?void 0:e.frames;return n?(this._timedMetadata=new TimedMetadata(n),this._timedMetadata):void 0}constructor(e){this.data=e;const n=new DataView(e.buffer);let d=8;if(1!==e[d])return;d+=4,this.timeScale=n.getUint32(d),d+=4;const p=n.getUint32(d);d+=4;const h=n.getUint32(d);if(d+=4,this.presentationTime=Math.pow(2,32)*p+h,!Number.isSafeInteger(this.presentationTime))throw this.presentationTime=Number.MAX_SAFE_INTEGER,new Error("Failed to create 64 bit integer");this.eventDuration=n.getUint32(d),d+=4,this.id=n.getUint32(d),d+=4;const[y,m]=readNullTerminatedString(e,d);d+=m+1,this.schemeIdUri=y;const[g,b]=readNullTerminatedString(e,d);d+=b+1,this.payload=e.subarray(d,e.byteLength),this.id3=new ID3(this.payload)}}class TimedMetadataManager{processEmsgs(e){const n=findEmsgs(e);n.length&&(this._currentEmsgInterval||(this._currentEmsgInterval=setInterval(this._getCurrentEmsg,1e3)),n.forEach(e=>{const n=new Emsg(e);this._emsgLookup[n.elementPresentationTime]=n}))}stop(){const{_currentEmsgInterval:e}=this;e&&clearInterval(e)}_getCurrentEmsg(){const{_currentTime:e,_emsgLookup:n}=this,d=Math.round(e()),p=[],h=Object.keys(n);for(let m=0;m<h.length;m++){const e=parseInt(h[m],10);if(!(e<d))break;p.push(e)}const y=p.pop();if(y){const e=n[y];if(!e)return;const{_currentEmsg:d,_onDidChange:p}=this,h=null==d?void 0:d.payload,m=e.payload;h&&arrayEquals(h,m)||(this._currentEmsg=e,p(e)),this._cleanupEmsgs(y)}}_cleanupEmsgs(e){const{_emsgLookup:n}=this;Object.keys(n).forEach(d=>{parseInt(d,10)<e&&delete n[d]})}constructor(e,n){this._currentTime=e,this._onDidChange=n,this._emsgLookup={},this._getCurrentEmsg=this._getCurrentEmsg.bind(this)}}class SegmentProcessor{process(e,n){const{_item:d}=this;try{d.isLiveRadioStation?this._processLiveRadioSegment(n):d.hasOffersHlsUrl&&this._processHlsOffersSegment(e,n)}catch(Lr){Lt.error("Error processing segment",Lr)}}stop(){this._timedMetadataManager.stop()}_processHlsOffersSegment(e,n){e.isInitSegment&&rewriteDefaultKid(n)}_processLiveRadioSegment(e){this._timedMetadataManager.processEmsgs(e)}constructor(e,n,d){this._item=e,this._timedMetadataManager=new TimedMetadataManager(()=>n.currentTime,e=>{d.publish(Va,e.timedMetadata)})}}function asyncGeneratorStep$S(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$S(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$S(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$S(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}var Za={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},eo={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};const to=Lt.createChild("mse"),ro=BooleanDevFlag.get("mk-mse-buffer"),{manifestParsed:no}=tr;class MseBuffer{onSourceOpen(){to.debug("mediaSource open handler");const{mediaSource:e}=this;if(e.activeSourceBuffers.length>0)return void to.debug("not adding new source buffer");to.debug("adding new source buffer");const n=e.addSourceBuffer(Jt);this.sourceBuffer=n,n.addEventListener("updateend",this.updateEndHandler);const{clip:d,hasAppendWindowSupport:p}=this;d&&(p?(to.debug("appendWindowStart/End",d.start,d.end),n.appendWindowStart=d.start,n.appendWindowEnd=d.end):(to.debug("seeking for clip",d.start),asAsync(this.seek(d.start)))),this.updateSegmentToFetch(0,!0)}setNextManifest(e){to.debug("setting next manifest for ",e.mediaItem.title),this.nextSeamlessTransition?(to.debug("abandoning transition scheduled for "+this.nextSeamlessTransition),this.revertSeamlessTransition(!0),this.playbackTimeline.next={manifest:e}):(this.playbackTimeline.next={manifest:e},this.isFullyBuffered&&(to.debug("current song is fully buffered, beginning transition to next"),this.transitionToNextManifest()))}isItemPlaying(e){var n,d;const{playbackTimeline:p}=this,h=this.nextSeamlessTransition?null===(n=p.previous)||void 0===n?void 0:n.manifest.mediaItem:null===(d=p.current)||void 0===d?void 0:d.manifest.mediaItem;return!!h&&(to.debug(`isItemPlaying ${e.title}, ${h.title}, ${e.id===h.id}`),e.id===h.id)}get currentItem(){return this.manifest.mediaItem}get playableUrl(){let e=this._playableUrl;return e||(e=window.URL.createObjectURL(this.mediaSource),to.debug("created url",e),this._playableUrl=e,e)}get segments(){const{manifest:e,clip:n}=this;return n?e.segmentsForTimeRange(n):e.segments||[]}get currentTime(){return this._currentTime}set currentTime(e){if(e+=this.currentTimestampOffset,this._currentTime===e)return;const{nextSeamlessTransition:n}=this;if(n&&e>=n){var d,p;to.debug("setting offset to",n),this.currentTimestampOffset=n||0,this.nextSeamlessTransition=void 0,this.duration=this.manifest.mediaItem.playbackDuration/1e3,to.debug("buffer setting duration to",this.duration);const e={previous:null===(d=this.playbackTimeline.previous)||void 0===d||null===(p=d.manifest)||void 0===p?void 0:p.mediaItem,current:this.manifest.mediaItem};to.debug("dispatching seamless audio transition",e),this.dispatcher.publish(Ka,e)}this._currentTime=e;const{isOverBufferLimit:h,timeToTrim:y}=this,m=e>this.timeToTrim;h&&m&&(to.debug("buffer over limit, trimming to ",y),this.removeToTime(y),this.timeToTrim+=10)}get hasAppendWindowSupport(){var e;return void 0!==(null===(e=this.sourceBuffer)||void 0===e?void 0:e.appendWindowStart)}seek(e){var n=this;return _asyncToGenerator$S((function*(){const{duration:d,seekWhenUpdated:p,sourceBuffer:h}=n;if(n.resolveSeekPromise(!1),to.debug("seek to ",e),(e=+e)>d&&(to.debug("rounding seek time to duration",e,d),e=d),!h)return!1;if(n.revertSeamlessTransition(),h.updating)return to.debug("sourcebuffer updating, deferring seek"),new Promise(d=>{p&&p.resolve(!1),n.seekWhenUpdated={seek:n.seek.bind(n,e),resolve:d}});n.currentlyLoadingSegmentIndex=void 0,n.updateSegmentToFetch(0,!0),n.removeToTime(e),n.timeToTrim=10*Math.floor(e/10);const y=n.getSegmentForTime(e);0!==y&&(yield n.firstSegmentLoadPromise),to.debug("seeking to",e,"segment",y),n.updateSegmentToFetch(y,!0);const m=new Promise(d=>{n.seekResolver={time:e,resolve:d}});return n.checkSeekBuffered(),m}))()}clearNextManifest(){this.revertSeamlessTransition(!0),this.playbackTimeline.next=void 0}revertSeamlessTransition(e=!1){const{playbackTimeline:n,nextSeamlessTransition:d}=this;if(!d||!n.previous)return void to.debug("no need to revert, no transition");this.isAtEndOfStream=e,to.debug("reverting seamless transition with discardNextManifest",e),e?this.clearBufferToEnd(d):this.clearBuffer(),to.debug("abandoning transition to "+this.manifest.mediaItem.title),n.next=e?void 0:n.current,n.current=n.previous,n.previous=void 0;const p=this.manifest.mediaItem;to.debug("current item reverted to "+p.title),this.nextSeamlessTransition=void 0,this.duration=p.playbackDuration/1e3,to.debug("reverted duration to "+this.duration),e||(this.currentTimestampOffset=0,this.timestampOffsetAdjustment=0,to.debug("reverted currentTimestampOffset and timestampOffsetAdjustment to 0")),this.printInfo(),this.segmentIndexToFetch=-1}get streamHasEnding(){return!this.manifest.mediaItem.isLiveRadioStation}stop(){this.segmentProcessor.stop(),this.setEndOfStream(),this.remove()}remove(){var e;to.debug("removing sourceBuffer and mediaSource");const{sourceBuffer:n,mediaSource:d}=this;null===(e=this.seekResolver)||void 0===e||e.resolve(!1),this.manifest.removeEventListener(no,this.onManifestParsed);const p=this._playableUrl;p&&(to.debug("revoking url",p),window.URL.revokeObjectURL(p)),d.removeEventListener("sourceopen",this.onSourceOpen),n&&(n.removeEventListener("updateend",this.updateEndHandler),this.sourceBuffer=void 0)}onManifestParsed(){const e=this.segmentIndexToFetch+1;to.debug("manifestParsed, loading segment",e),this.updateSegmentToFetch(e,!0)}updateEndHandler(){if(this.kickstartBuffer(),this.clearDeferredRemove())return;if(to.debug("update end",this.seekWhenUpdated),this.seekWhenUpdated){to.debug("updateEndHandler resolving seekWhenUpdated");const{seekWhenUpdated:e}=this;return asAsync(e.seek().then(e.resolve)),void(this.seekWhenUpdated=void 0)}this.checkSeekBuffered();const{clip:e,sourceBuffer:n,hasAppendWindowSupport:d}=this;if(e&&n&&!d){const{buffered:d}=n;if(this.isTimeBuffered(e.end+1)){const p=d.end(d.length-1);return to.debug("clipping sourcebuffer to",e.end,p),void n.remove(e.end,p)}}if(this.isAtEndOfStream)return to.debug("buffer is at end of stream"),this.streamHasEnding&&(to.debug("isAtEndOfStream, not fetching any more segments"),this.playbackTimeline.next||this.setEndOfStream(),this.transitionToNextManifest()),void(this.isAtEndOfStream=!1);to.debug("updateEndHandler invoking loadSegment"),asAsync(this.loadSegment())}clearDeferredRemove(){var e;if(0===this.deferredRemoves.length)return!1;const n=this.deferredRemoves.shift();return null===(e=this.sourceBuffer)||void 0===e||e.remove(n.start,n.end),!0}transitionToNextManifest(){var e;to.debug("beginning transition to next manifest");const{playbackTimeline:n,sourceBuffer:d}=this;if(!n.next||!d)return void to.debug("no next manifest");const p=this.endOfBufferTime||this.currentTimestampOffset;to.debug("setting seamless transition at",p),this.nextSeamlessTransition=p,this.timestampOffsetAdjustment=p,this.playbackTimeline.current.endTime=p,n.previous=n.current,to.debug("previous manifest set to",null===(e=n.previous)||void 0===e?void 0:e.manifest.mediaItem.title),n.current=n.next,to.debug("current manifest set to",n.current.manifest.mediaItem.title),n.next=void 0,this.updateSegmentToFetch(0,!0),this.printInfo()}updateSegmentToFetch(e,n=!1){this.segments.length&&e<this.segments.length&&e!==this.segmentIndexToFetch&&(this.segmentIndexToFetch=e,n&&(to.debug("updateSegmentToFetch invoking loadSegment"),asAsync(this.loadSegment())))}loadSegment(){var e=this;return _asyncToGenerator$S((function*(){const n=e.segmentIndexToFetch,d=e.segments[n];if(n!==e.currentlyLoadingSegmentIndex){if(d)try{to.debug("begin loadSegment "+n),e.currentlyLoadingSegmentIndex=n;const h=d.load();0===n&&(e.firstSegmentLoadPromise=h);const y=yield h;if(0!==n&&n!==e.segmentIndexToFetch)return void to.debug("load segment index to fetch changed, not processing bytes for segment",n);e.segmentProcessor.process(d,y),to.debug("loadSegment processed: "+n);const{sourceBuffer:m,timestampOffsetAdjustment:g}=e;if(!m)return;try{"number"==typeof g&&(to.debug("adjusting timestampOffset of sourcebuffer to",g),m.timestampOffset=g,e.timestampOffsetAdjustment=void 0),m.appendBuffer(y),e.isFullyBuffered=!1,e.isOverBufferLimit=!1,to.debug("appended to buffer",y.length),e.printBufferTimes(),n===e.segments.length-1?e.isAtEndOfStream=!0:n===e.segmentIndexToFetch&&(to.debug("loadSegment bumping segment index to fetch to ",n+1),e.updateSegmentToFetch(n+1))}catch(p){"QuotaExceededError"===p.name?(e.isOverBufferLimit=!0,to.debug("reached buffer limit")):to.warn("Error appending to source buffer",p)}}catch(Lr){to.error("Error loading segment",Lr),e.dispatcher.publish(Ha,Lr)}finally{e.currentlyLoadingSegmentIndex=void 0}}else to.debug(`segment ${n} is currently loading, not loading it again`)}))()}setEndOfStream(){const{sourceBuffer:e,mediaSource:n}=this;e&&"ended"!==n.readyState&&(e.updating||"open"!==n.readyState?to.error("Could not end of stream (updating, readyState)",e.updating,n.readyState):(to.debug("mediaSource.endOfStream"),n.endOfStream(),this.isFullyBuffered=!0))}removeToTime(e){to.debug("removing to time",e),e>0&&(this.isTimeBuffered(e)||this.isOverBufferLimit)&&this.safeSourceBufferRemove(0,e)}safeSourceBufferRemove(e,n){const{sourceBuffer:d}=this;d&&(d.updating?this.deferredRemoves.push({start:e,end:n}):d.remove(e,n))}get previousOffset(){var e,n;return(null===(e=this.playbackTimeline)||void 0===e||null===(n=e.previous)||void 0===n?void 0:n.endTime)||0}get manifest(){var e;return null===(e=this.playbackTimeline.current)||void 0===e?void 0:e.manifest}checkSeekBuffered(){const{seekResolver:e,currentTimestampOffset:n}=this;if(!e)return;const{time:d}=e,p=d+n,h=this.isTimeBuffered(p);to.debug("resolving seek for time, adjustedTime, isBuffered",d,p,h),this.printBufferTimes(),h&&(to.debug("resolving seek to true for time:",p),this.element.currentTime=p,this.resolveSeekPromise(!0))}resolveSeekPromise(e){this.seekResolver&&(this.seekResolver.resolve(e),this.seekResolver=void 0)}get endOfBufferTime(){var e;const n=null===(e=this.sourceBuffer)||void 0===e?void 0:e.buffered;return!(!n||!n.length)&&n.end(n.length-1)}isTimeBuffered(e){var n;const d=null===(n=this.sourceBuffer)||void 0===n?void 0:n.buffered;if(!d)return!1;for(let p=0;p<d.length;p++)if(to.debug("isTimeBuffered",d.start(p),e,d.end(p)),e>=d.start(p)&&e<=d.end(p))return!0;return!1}clearBufferToEnd(e){const{sourceBuffer:n}=this;if(!n||!n.buffered)return;const d=n.buffered.end(n.buffered.length-1);this.safeSourceBufferRemove(e,d)}clearBuffer(){const{sourceBuffer:e}=this;if(!e||!e.buffered)return;const n=e.buffered;for(let d=0;d<n.length;d++)this.safeSourceBufferRemove(n.start(d),n.end(d))}get bufferTimesString(){var e;const n=null===(e=this.sourceBuffer)||void 0===e?void 0:e.buffered;if(!n)return"";const d=[];for(let p=0;p<n.length;p++)d.push(`start ${n.start(p)} end: ${n.end(p)}`);return d.join(",")}printBufferTimes(){ro&&to.debug("buffer times",this.bufferTimesString)}getSegmentForTime(e){return Math.floor(e/10)+1}kickstartBuffer(){const{hasKickstarted:e,element:n,clip:d}=this,{buffered:p}=n;e||(this.manifest.mediaItem.isSong?d&&this.isTimeBuffered(d.start)&&(n.currentTime=d.start,this.hasKickstarted=!0):p.length&&(n.currentTime=p.start(0),this.hasKickstarted=!0))}printInfo(){var e,n;const{playbackTimeline:d}=this;to.info("---- Buffer Info ----"),to.info("currently buffering item",d.current.manifest.mediaItem.title),to.info("next item to buffer",null===(e=d.next)||void 0===e?void 0:e.manifest.mediaItem.title),to.info("previously buffered item",null===(n=d.previous)||void 0===n?void 0:n.manifest.mediaItem.title),to.info("currentTimestampOffset",this.currentTimestampOffset),to.info("currentTime",this.currentTime),to.info("duration",this.duration),to.info("nextSeamlessTransition",this.nextSeamlessTransition),to.info("timestampOffsetAdjustment",this.timestampOffsetAdjustment),to.info("buffered times",this.bufferTimesString),to.info("isAtEndOfStream",this.isAtEndOfStream),to.info("isFullyBuffered",this.isFullyBuffered),to.info("segmentIndexToFetch",this.segmentIndexToFetch),to.info("segments.length",this.segments.length),to.info("---- End Buffer Info ----")}constructor({dispatcher:e,element:n,manifest:d,currentTime:p,duration:h,clip:y}){this.firstSegmentLoadPromise=Promise.resolve(),this.hasKickstarted=!1,this.segmentIndexToFetch=-1,this.timeToTrim=10,this.isAtEndOfStream=!1,this.isFullyBuffered=!1,this.deferredRemoves=[],this.currentTimestampOffset=0,this.dispatcher=e,this.clip=y,this.element=n,this.mediaSource=new MediaSource,this.mediaSource.addEventListener("sourceopen",this.onSourceOpen),this.segmentProcessor=new SegmentProcessor(d.mediaItem,n,e),this.playbackTimeline={current:{manifest:d}},d.addEventListener(no,this.onManifestParsed),this._currentTime=p||0,this.duration=h,window.mseBuffer=this}}function asyncGeneratorStep$R(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$R(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$R(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$R(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}Za([Bind(),eo("design:type",Function),eo("design:paramtypes",[])],MseBuffer.prototype,"onSourceOpen",null),Za([Bind(),eo("design:type",Function),eo("design:paramtypes",[])],MseBuffer.prototype,"onManifestParsed",null),Za([Bind(),eo("design:type",Function),eo("design:paramtypes",[])],MseBuffer.prototype,"updateEndHandler",null);var io={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},ao={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};const{mediaPlaybackError:oo}=fr;class AudioPlayer extends BasePlayer{destroy(){var e=this,_superprop_get_destroy=()=>super.destroy;return _asyncToGenerator$R((function*(){_superprop_get_destroy().call(e),e._dispatcher.unsubscribe(Ha,e.onLoadSegmentError)}))()}onLoadSegmentError(e){this._dispatcher.publish(oo,new MKError(MKError.MEDIA_SESSION,e)),this.destroy()}get currentPlayingDate(){}get isPlayingAtLiveEdge(){return!1}get seekableTimeRanges(){return this.currentPlaybackDuration?[{start:0,end:this.currentPlaybackDuration}]:void 0}get supportsPreviewImages(){return!1}get _targetElement(){return this.audio}initializeExtension(){var e=this;return _asyncToGenerator$R((function*(){e.extension=new MediaExtension(e.audio,Jt),yield e.extension.initializeKeySystem(),e.extension.addEventListener(tr.playbackLicenseError,n=>{e.resetDeferredPlay(),e._dispatcher.publish(oo,n)}),e.extension.addEventListener(tr.playbackSessionError,n=>{e._dispatcher.publish(oo,new MKError(MKError.MEDIA_SESSION,n)),e.destroy()})}))()}initializeMediaElement(){var e=this;return _asyncToGenerator$R((function*(){const n=function(){let e=er.pop();return e?Lt.debug(`dom-helpers: retrieving audio tag, ${er.length} remain`):(Lt.debug("dom-helpers: no available audio tags, creating one"),e=document.createElement("audio")),e}();n.autoplay=!1,n.id="apple-music-player",n.controls=!1,n.muted=!1,n.playbackRate=1,n.preload="metadata",n.volume=1,e.audio=n,document.body.appendChild(n),Lt.debug("initializedMediaElement",n)}))()}removeEventHandlers(){this._targetElement.removeEventListener("timeupdate",this.onTimeUpdate),this._targetElement.removeEventListener("timeupdate",this.delayedCdmUpdateCheck),super.removeEventHandlers()}isPlayerSupported(){return!0}_stopMediaElement(){var e=this,_superprop_get__stopMediaElement=()=>super._stopMediaElement;return _asyncToGenerator$R((function*(){var n;yield _superprop_get__stopMediaElement().call(e),yield e.tearDownManifests(),null===(n=e._buffer)||void 0===n||n.stop(),e._buffer=void 0}))()}setNextSeamlessItem(e){var n=this;return _asyncToGenerator$R((function*(){const{extension:d,nextManifest:p}=n,h=n._buffer;if(!h||!d)return;if((null==p?void 0:p.mediaItem.id)===e.id)return void Lt.debug("already have next manifest for ",e.title);n._targetElement.removeEventListener("timeupdate",n.onTimeUpdate),n._targetElement.addEventListener("timeupdate",n.onTimeUpdate),Lt.debug("player preparing next manifest for",e.title);const y=yield n.loadAndParseManifest(e,!1);h.setNextManifest(y),d.setMediaItem(e),d.extURI=y.extURI,n.nextManifest=y}))()}playItemFromEncryptedSource(n,d=!1,p){var h=this;return _asyncToGenerator$R((function*(){const y=h._paused&&!d;Lt.debug("playItemFromEncryptedSource",n.title);const m=y?void 0:h.startPlaybackSequence();if(n.playRawAssetURL)return n.playbackType=e.PlaybackType.unencryptedFull,h.nowPlayingItem=n,yield h._playAssetURL(n.assetURL,y),h.finishPlaybackSequence();const{extension:g}=h;var b,_;h.delaySeamlessCdmUpdates&&(null===(b=h.extension)||void 0===b||null===(_=b.session)||void 0===_||_.applyDelayedCdmUpdates());if(!g)return m;g.initiated=d,g.setMediaItem(n),n.playbackType=e.PlaybackType.encryptedFull,h.nowPlayingItem=n,n.state=G.loading;const P=yield h.getManifestForItem(n);h.manifest=P;const T=shouldForceAudioMse();if((n.isSong||g.isFairplay&&T)&&(g.extURI=P.extURI),n.state=G.ready,g.isFairplay&&!T){let e=n.assetURL;(null==p?void 0:p.startTime)&&(e+="#t="+p.startTime),yield h._playAssetURL(e,y)}else{const e=h._buffer;e&&h.isSeamlessAudioTransitionsEnabled&&e.isItemPlaying(P.mediaItem)?Lt.debug("already have buffer, continuing playback"):yield h.beginNewBufferForItem(y,P,p)}return h.finishPlaybackSequence()}))()}getManifestForItem(e){var n=this;return _asyncToGenerator$R((function*(){var d,p;Lt.debug("reconciling item to play against playing item");const{nextManifest:h,manifest:y,isSeamlessAudioTransitionsEnabled:m}=n,g=n._buffer;if(!g||!y)return Lt.debug("no buffer or manifest, creating manifest [title, buffer, manifest]",e.title,!!g,!!y),n.loadAndParseManifest(e);if(!m)return Lt.debug("seamless transitions disabled, stopping and creating manifest for",e.title),yield n.tearDownManifests(),n.loadAndParseManifest(e);const b=!g.isItemPlaying(e);let _;return Lt.debug("itemMismatch",b),h&&!b?(Lt.debug(`replacing manifest for ${y.mediaItem.title} with next manifest ${h.mediaItem.title}`),_=h,n.nextManifest=void 0,Lt.debug("cease listening for keys on manifest for",y.mediaItem.title),yield n.tearDownManifest(y)):b?(null==h?void 0:h.mediaItem.id)!==e.id?(Lt.debug(`item to play ${e.title} does not match playing or next items, tearing down all manifests`),yield n.tearDownManifests(),_=yield n.loadAndParseManifest(e)):(Lt.debug(`item to play ${e.title} matches next item, tearing down current manifest`),yield n.tearDownManifest(y),_=h):(Lt.debug("item is already playing, returning existing manifest"),_=y),Lt.debug("getManifestForItem loading keys for",y.mediaItem.title),null===(d=n.extension)||void 0===d||null===(p=d.session)||void 0===p||p.loadKeys(_.keyValues,_.mediaItem),_}))()}seekToTime(e){var n=this;return _asyncToGenerator$R((function*(){const d=n._buffer;if(d){Lt.debug("audio-player: buffer seek to",e);if(!(yield d.seek(e)))return;n.isSeamlessAudioTransitionsEnabled&&n.onTimeUpdate()}else Lt.debug("audio-player: media element seek to",e),n._targetElement.currentTime=e}))()}tearDownManifests(){var e=this;return _asyncToGenerator$R((function*(){e.manifest=yield e.tearDownManifest(e.manifest),e.nextManifest=yield e.tearDownManifest(e.nextManifest)}))()}tearDownManifest(e){var n=this;return _asyncToGenerator$R((function*(){const{extension:d}=n;e&&(Lt.debug("tearing down manifest for",e.mediaItem.title),e.stop(),d&&(yield d.clearSessions(e.keyValues)),e.removeEventListener(La.keysParsed,n.loadKeysHandler))}))()}loadAndParseManifest(e,n=!0){var d=this;return _asyncToGenerator$R((function*(){let p;Lt.debug(`will load and parse manifest for ${e.title}, loadKeys ${n}`);try{p=yield Manifest.load(e,!1)}catch(Y){d.resetDeferredPlay();const n=new MKError(MKError.NETWORK_ERROR,"Could not fetch manifest");throw n.data=Y,d._dispatcher.publish(oo,n),n}return n&&p.addEventListener(La.keysParsed,d.loadKeysHandler),p.parse(),p}))()}onTimeUpdate(){if(!this._buffer)return;const{currentPlaybackTimeRemaining:e,nextManifest:n,delaySeamlessCdmUpdates:d}=this;if(n&&e<15){var p,h,y,m;if(Lt.debug("player loading keys for",n.mediaItem.title,d),d)null===(p=this.extension)||void 0===p||null===(h=p.session)||void 0===h||h.loadKeys(n.keyValues,n.mediaItem,{delayCdmUpdate:!0}),this._targetElement.addEventListener("timeupdate",this.delayedCdmUpdateCheck);else null===(y=this.extension)||void 0===y||null===(m=y.session)||void 0===m||m.loadKeys(n.keyValues,n.mediaItem);this._targetElement.removeEventListener("timeupdate",this.onTimeUpdate)}}delayedCdmUpdateCheck(){var e;const n=null===(e=this.nowPlayingItem)||void 0===e?void 0:e.playbackDuration,d=n?n/1e3:this.currentPlaybackDuration,p=this._currentTime,h=Number((d-p).toFixed(3));if(h<1){const e=1e3*h;Lt.debug("delayed CDM update in ",e),setTimeout(()=>{var e,n;Lt.debug("applying delayed CDM update"),null===(e=this.extension)||void 0===e||null===(n=e.session)||void 0===n||n.applyDelayedCdmUpdates()},e),this._targetElement.removeEventListener("timeupdate",this.delayedCdmUpdateCheck)}}loadKeysHandler(e){var n,d;null===(n=this.extension)||void 0===n||null===(d=n.session)||void 0===d||d.loadKeys(e.keys,e.item)}beginNewBufferForItem(e,n,d){var p=this;return _asyncToGenerator$R((function*(){if(Lt.debug("creating new MseBuffer for item",n.mediaItem.title,e),p._buffer&&(Lt.debug("stopping old buffer"),p._buffer.stop()),p._buffer=new MseBuffer({dispatcher:p._dispatcher,element:p._targetElement,duration:n.mediaItem.playbackDuration/1e3,manifest:n}),yield p._playAssetURL(p._buffer.playableUrl,!0),!e){let e=Promise.resolve();return(null==d?void 0:d.startTime)&&(e=p.seekToTime(d.startTime)),e.then(()=>p._playMedia())}}))()}setPresentationMode(e){return _asyncToGenerator$R((function*(){return Promise.resolve()}))()}loadPreviewImage(e){return _asyncToGenerator$R((function*(){}))()}constructor(e){var n,d;super(e),this.currentAudioTrack=void 0,this.currentTextTrack=void 0,this.textTracks=[],this.audioTracks=[],this.isSeamlessAudioTransitionsEnabled=!1,this.delaySeamlessCdmUpdates=!1,this.mediaPlayerType="audio";const p=null!==(d=null===(n=e.bag)||void 0===n?void 0:n.features)&&void 0!==d?d:{};this.isSeamlessAudioTransitionsEnabled=!!p["seamless-audio-transitions"],this.delaySeamlessCdmUpdates=!!p["delay-seamless-cdm-updates"],window.audioPlayer=this,this._dispatcher.subscribe(Ha,this.onLoadSegmentError)}}io([Bind(),ao("design:type",Function),ao("design:paramtypes",[void 0])],AudioPlayer.prototype,"onLoadSegmentError",null),io([AsyncDebounce(250),ao("design:type",Function),ao("design:paramtypes",[Number])],AudioPlayer.prototype,"seekToTime",null),io([Bind(),ao("design:type",Function),ao("design:paramtypes",[])],AudioPlayer.prototype,"onTimeUpdate",null),io([Bind(),ao("design:type",Function),ao("design:paramtypes",[])],AudioPlayer.prototype,"delayedCdmUpdateCheck",null),io([Bind(),ao("design:type",Function),ao("design:paramtypes",[void 0])],AudioPlayer.prototype,"loadKeysHandler",null);class VoidMediaElement extends HTMLElement{set volume(e){e!==this._volume&&(this._volume=e,this.dispatchMediaEvent("volumechange"),this.muted=0===e)}get volume(){return this._volume}set currentTime(e){e!==this._currentTime&&(this._currentTime=e,this.dispatchMediaEvent("timeupdate"))}get currentTime(){return this._currentTime}pause(){this.paused=!0,this.dispatchMediaEvent("pause")}play(){this.paused=!1,this.dispatchMediaEvent("play")}dispatchMediaEvent(e){const n=new CustomEvent(e,{detail:{type:e}});this.dispatchEvent(n)}constructor(){super(),this.muted=!1,this.paused=!0,this._volume=1,this._currentTime=0}}function asyncGeneratorStep$Q(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$Q(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$Q(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$Q(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}class VoidPlayer extends BasePlayer{get currentPlayingDate(){}get isPlayingAtLiveEdge(){return!1}get seekableTimeRanges(){return this.currentPlaybackDuration?[{start:0,end:this.currentPlaybackDuration}]:void 0}get supportsPreviewImages(){return!1}get nowPlayingItem(){return this._nowPlayingItem}set nowPlayingItem(e){if(e===this.nowPlayingItem)return;const n=this._dispatcher;n.publish(fr.nowPlayingItemWillChange,{item:e}),this._nowPlayingItem=e,e&&(e.state=G.playing),n.publish(fr.nowPlayingItemDidChange,{item:e}),n.publish(fr.playbackDurationDidChange,{currentTarget:this._targetElement,duration:this.currentPlaybackDuration,target:this._targetElement,type:"durationchange"})}get _targetElement(){return this.element}initializeMediaElement(){var e=this;return _asyncToGenerator$Q((function*(){const n=document.createElement("mk-void-media-element");n.id="apple-music-player",e.element=n,document.body.appendChild(n),Lt.debug("initializedMediaElement",n)}))()}removeEventHandlers(){super.removeEventHandlers()}isPlayerSupported(){return!0}seekToTime(e){var n=this;return _asyncToGenerator$Q((function*(){n._targetElement.currentTime=e}))()}setPresentationMode(e){return _asyncToGenerator$Q((function*(){return Promise.resolve()}))()}loadPreviewImage(e){return _asyncToGenerator$Q((function*(){}))()}playItemFromEncryptedSource(){return _asyncToGenerator$Q((function*(){return Promise.resolve()}))()}initializeExtension(){return _asyncToGenerator$Q((function*(){}))()}setNextSeamlessItem(e){return _asyncToGenerator$Q((function*(){}))()}constructor(e){super(e),this.currentAudioTrack=void 0,this.currentTextTrack=void 0,this.textTracks=[],this.audioTracks=[],this.mediaPlayerType="void";void 0!==customElements.get("mk-void-media-element")||customElements.define("mk-void-media-element",VoidMediaElement)}}function asyncGeneratorStep$P(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$P(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$P(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$P(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}class EncryptedSession extends KeySession{attachMedia(e,n){var d=this;return _asyncToGenerator$P((function*(){d.keySystem=n.keySystem,d._keySystemAccess=n,e.addEventListener("encrypted",d.boundHandleSessionCreation,!1)}))()}detachMedia(e){e.removeEventListener("encrypted",this.boundHandleSessionCreation)}createSession(e){var n=this;return _asyncToGenerator$P((function*(){Lt.debug("Encrypted createSession",e);const d=n._keySystemAccess;if(!d)return;const{initData:p,initDataType:h,target:y}=e;return n._mediaKeysPromise||(n._mediaKeysPromise=new Promise(function(){var e=_asyncToGenerator$P((function*(e,p){const h=yield d.createMediaKeys();try{yield y.setMediaKeys(h)}catch(Y){n.dispatchKeyError(Y),p(Y)}const m=yield n.loadCertificateBuffer();yield h.setServerCertificate(m),n._mediaKeysServerCertificate=m,e(h)}));return function(n,d){return e.apply(this,arguments)}}())),yield n._mediaKeysPromise,n._mediaKeysServerCertificate?n._createSession(y,p,h):void 0}))()}generatePSSH(e){const n=new Uint8Array([0,0,0,52,112,115,115,104,0,0,0,0,237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237,0,0,0,20,8,1,18,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),d=Ie(e);for(let p=0;p<d.length;p++)n[n.length-16+p]=d[p];return Lt.debug("generatePSSH",n),n}_createSession(e,n,d){const p=e.mediaKeys.createSession(),{item:h}=this;if(!h)return;this._teardownCurrentSession(),Lt.debug("creating media key session",p);let y;if(this.isWidevine&&h.isSong)y=this.generatePSSH(this.extID);else{const e=function(e){const n=[],d=new DataView(e.buffer);for(let p=0;p<e.length;){const h=d.getUint32(p);n.push(new PsshBox(e,p,p+h)),p+=h}return n}(new Uint8Array(n)).find(e=>e.isWidevine),d=null==e?void 0:e.rawBytes,h=Ce(d);Lt.debug("extracted uri",h),p.extURI=h,y=n}return p.addEventListener("message",this.startLicenseSession),this._currentSession=p,p.generateRequest(d,y).catch(e=>{if(e.message.match(/generateRequest.*\(75\)/))return p.generateRequest(d,y);throw e})}_teardownCurrentSession(){this._currentSession&&(Lt.debug("tearing down media key session",this._currentSession),this._currentSession.removeEventListener("message",this.startLicenseSession),this._currentSession=void 0)}applyDelayedCdmUpdates(){}loadKeys(e,n,d){return _asyncToGenerator$P((function*(){}))()}clearSessions(){return _asyncToGenerator$P((function*(){}))()}}function asyncGeneratorStep$O(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$O(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$O(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$O(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}class MediaExtensionStub extends Notifications{destroy(e){}setMediaItem(e){}initializeKeySystem(){var e=this;return _asyncToGenerator$O((function*(){e.session=new EncryptedSession}))()}clearSessions(){return _asyncToGenerator$O((function*(){}))()}constructor(e){super(e),this.audioTracks=[],this.textTracks=[],this.extURI="",this.hasMediaKeySupport=!0,this.initiated=!0,this.isFairplay=!0,this.hasMediaKeySupport=!0,this.hasMediaSession=!0}}function asyncGeneratorStep$N(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$N(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$N(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$N(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}class PlayerStub{get hasMediaElement(){return!0}get isEngagedInPlayback(){return!this.paused}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._dispatcher.publish(fr.playbackRateDidChange,new Event("ratechange"))}get volume(){return this._volume}set volume(e){this._volume=e,this._dispatcher.publish(fr.playbackVolumeDidChange,new Event("volumeChange"))}destroy(){}dispatch(){}exitFullscreen(){return _asyncToGenerator$N((function*(){}))()}loadPreviewImage(e){return _asyncToGenerator$N((function*(){}))()}initialize(){return _asyncToGenerator$N((function*(){}))()}isPaused(){return this.paused}calculateTime(e){return e}clearNextManifest(){}mute(){}newSeeker(){return new PlayerSeeker(this)}pause(e){return _asyncToGenerator$N((function*(){}))()}play(){return _asyncToGenerator$N((function*(){}))()}playItemFromEncryptedSource(e,n,d){return _asyncToGenerator$N((function*(){}))()}playItemFromUnencryptedSource(e,n,d){return _asyncToGenerator$N((function*(){}))()}preload(){return _asyncToGenerator$N((function*(){}))()}prepareToPlay(e,n,d){return _asyncToGenerator$N((function*(){}))()}seekToTime(e){return _asyncToGenerator$N((function*(){}))()}requestFullscreen(){return _asyncToGenerator$N((function*(){}))()}setPlaybackState(e,n){}setPresentationMode(e){return _asyncToGenerator$N((function*(){}))()}showPlaybackTargetPicker(){}stop(e){return _asyncToGenerator$N((function*(){}))()}stopMediaAndCleanup(){return _asyncToGenerator$N((function*(){}))()}supportsPictureInPicture(){return!1}tsidChanged(){}setNextSeamlessItem(e){return _asyncToGenerator$N((function*(){}))()}constructor(n){this.bitrate=e.PlaybackBitrate.STANDARD,this.audioTracks=[],this.currentBufferedProgress=0,this.currentPlaybackDuration=0,this.currentPlaybackProgress=0,this.currentPlaybackTime=0,this.currentPlaybackTimeRemaining=0,this.currentPlayingDate=void 0,this.isPlayingAtLiveEdge=!1,this.isPlaying=!1,this.isPrimaryPlayer=!0,this.isReady=!1,this.paused=!1,this.playbackState=e.PlaybackStates.none,this.playbackTargetAvailable=!1,this.playbackTargetIsWireless=!1,this.previewOnly=!1,this.supportsPreviewImages=!1,this.textTracks=[],this.extension=new MediaExtensionStub([]),this.hasAuthorization=!0,this.isDestroyed=!1,this._volume=1,this._playbackRate=1,this._dispatcher=n.services.dispatcher,this.windowHandlers=new WindowHandlers(this)}}e.version="2.2326.1";const so=e.version.split("."),co=so[0],lo=so[so.length-1];var uo;so[0]="3",so[so.length-1]=lo+"-prerelease",so[0]=co,so[so.length-1]=lo,e.version=so.join("."),e.PlaybackActions=void 0,(uo=e.PlaybackActions||(e.PlaybackActions={})).REPEAT="REPEAT",uo.SHUFFLE="SHUFFLE",uo.AUTOPLAY="AUTOPLAY";const po={configured:"musickitconfigured",loaded:"musickitloaded",audioTrackAdded:fr.audioTrackAdded,audioTrackChanged:fr.audioTrackChanged,audioTrackRemoved:fr.audioTrackRemoved,authorizationStatusDidChange:Ue.authorizationStatusDidChange,authorizationStatusWillChange:Ue.authorizationStatusWillChange,bufferedProgressDidChange:fr.bufferedProgressDidChange,capabilitiesChanged:"capabilitiesChanged",autoplayEnabledDidChange:"autoplayEnabledDidChange",drmUnsupported:fr.drmUnsupported,eligibleForSubscribeView:Ue.eligibleForSubscribeView,forcedTextTrackChanged:fr.forcedTextTrackChanged,mediaCanPlay:fr.mediaCanPlay,mediaElementCreated:fr.mediaElementCreated,mediaItemStateDidChange:I.mediaItemStateDidChange,mediaItemStateWillChange:I.mediaItemStateWillChange,mediaPlaybackError:fr.mediaPlaybackError,mediaSkipAvailable:"mediaSkipAvailable",mediaRollEntered:"mediaRollEntered",mediaUpNext:"mediaUpNext",metadataDidChange:fr.metadataDidChange,needsGDPRDidChange:"needsGDPRDidChange",nowPlayingItemDidChange:fr.nowPlayingItemDidChange,nowPlayingItemWillChange:fr.nowPlayingItemWillChange,playbackBitrateDidChange:fr.playbackBitrateDidChange,playbackDurationDidChange:fr.playbackDurationDidChange,playbackProgressDidChange:fr.playbackProgressDidChange,playbackRateDidChange:fr.playbackRateDidChange,playbackStateDidChange:fr.playbackStateDidChange,playbackStateWillChange:fr.playbackStateWillChange,playbackTargetAvailableDidChange:fr.playbackTargetAvailableDidChange,playbackTargetIsWirelessDidChange:fr.playbackTargetIsWirelessDidChange,playbackTimeDidChange:fr.playbackTimeDidChange,playbackVolumeDidChange:fr.playbackVolumeDidChange,playerTypeDidChange:fr.playerTypeDidChange,presentationModeDidChange:fr.presentationModeDidChange,primaryPlayerDidChange:fr.primaryPlayerDidChange,queueIsReady:"queueIsReady",queueItemsDidChange:"queueItemsDidChange",queueItemForStartPosition:"queueItemForStartPosition",queuePositionDidChange:"queuePositionDidChange",shuffleModeDidChange:"shuffleModeDidChange",repeatModeDidChange:"repeatModeDidChange",storefrontCountryCodeDidChange:Ue.storefrontCountryCodeDidChange,storefrontIdentifierDidChange:Ue.storefrontIdentifierDidChange,textTrackAdded:fr.textTrackAdded,textTrackChanged:fr.textTrackChanged,textTrackRemoved:fr.textTrackRemoved,timedMetadataDidChange:fr.timedMetadataDidChange,userTokenDidChange:Ue.userTokenDidChange,webComponentsLoaded:"musickitwebcomponentsloaded"},ho="sharePlay.playbackStateChanged",yo="sharePlay.volumeChanged",fo="sharePlay.nextItem",mo="sharePlay.previousItem",go="sharePlay.shuffleModeChanged",vo="sharePlay.repeatModeChanged",bo="sharePlay.autoPlayChanged",_o="sharePlay.progressChanged",Po="sharePlay.mediaStateUpdate";function asyncGeneratorStep$M(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}var To={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},So={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};class SpanWatcher{startMonitor(){this.dispatcher.unsubscribe(po.playbackTimeDidChange,this.handleTimeChange),this.dispatcher.subscribe(po.playbackTimeDidChange,this.handleTimeChange)}stopMonitor(){this.dispatcher.unsubscribe(po.playbackTimeDidChange,this.handleTimeChange)}handleTimeChange(e,{currentPlaybackTime:n}){var d,p=this;return(d=function*(){!Number.isFinite(n)||n<p.start||n>p.stop?p.inWatchSpan=!1:p.inWatchSpan||(p.allowMultiple||p.stopMonitor(),p.inWatchSpan=!0,yield p.callback(n,p))},function(){var e=this,n=arguments;return new Promise((function(p,h){var y=d.apply(e,n);function _next(e){asyncGeneratorStep$M(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$M(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))})()}constructor(e,n,d,p,h=!1){this.dispatcher=e,this.callback=n,this.start=d,this.stop=p,this.allowMultiple=h,this.inWatchSpan=!1}}To([Bind(),So("design:type",Function),So("design:paramtypes",[void 0,void 0])],SpanWatcher.prototype,"handleTimeChange",null);var Eo={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},ko={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};class PlaybackMonitor{activate(){this.isActive=!0,this.startMonitor()}deactivate(){this.isActive=!1,this.clearMonitor()}clearMonitor(){this.isMonitoring&&(this.watchers.forEach(e=>e.stopMonitor()),this.isMonitoring=!1)}shouldMonitor(){return this.isActive}startMonitor(){this.shouldMonitor()&&(this.watchers.forEach(e=>e.startMonitor()),this.isMonitoring=!0)}handleMediaItemChange(){this.isActive&&(this.clearMonitor(),this.shouldMonitor()&&this.startMonitor())}constructor(e){this.isActive=!1,this.isMonitoring=!1,this.watchers=[],this.handlePlaybackThreshold=this.handlePlaybackThreshold.bind(this),this.playbackController=e.controller,this.dispatcher=e.services.dispatcher,this.dispatcher.subscribe(po.nowPlayingItemDidChange,this.handleMediaItemChange),this.apiManager=e.services.apiManager}}function asyncGeneratorStep$L(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}Eo([Bind(),ko("design:type",Function),ko("design:paramtypes",[])],PlaybackMonitor.prototype,"handleMediaItemChange",null);class RollMonitor extends PlaybackMonitor{handlePlaybackThreshold(e,n){var d,p=this;return(d=function*(){if(!p.rollMap.has(n))return;const e=p.rollMap.get(n);p.dispatcher.publish(po.mediaRollEntered,e),p.rollMap.delete(n)},function(){var e=this,n=arguments;return new Promise((function(p,h){var y=d.apply(e,n);function _next(e){asyncGeneratorStep$L(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$L(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))})()}shouldMonitor(){if(!super.shouldMonitor())return!1;return this.getRollMetadata().length>0}startMonitor(){this.setupWatchers(this.getRollMetadata()),super.startMonitor()}getRollMetadata(){const e=this.playbackController.nowPlayingItem;return void 0===e?[]:function(e,n=["pre-roll","mid-roll","post-roll"]){if(void 0===e.hlsMetadata)return[];const d=[];return n.forEach(n=>{const p=parseInt(e.hlsMetadata[n+".count"],10);if(!isNaN(p))for(let h=0;h<p;h++){const p=`${n}.${h}`,y={index:h,type:n,skippable:"true"===e.hlsMetadata[p+".skippable"],"adam-id":e.hlsMetadata[p+".adam-id"],start:Math.round(parseFloat(e.hlsMetadata[p+".start"])),duration:Math.round(parseFloat(e.hlsMetadata[p+".duration"]))},m=p+".dynamic-slot.data-set-id";void 0!==e.hlsMetadata[m]&&(y["dynamic-id"]=e.hlsMetadata[m]),d.push(y)}}),d}(e,["pre-roll","post-roll"])}setupWatchers(e){const n=[];e.forEach(e=>{const{start:d,duration:p}=e,h=new SpanWatcher(this.dispatcher,this.handlePlaybackThreshold,d,d+p);n.push(h),this.rollMap.set(h,e)}),this.watchers=n}constructor(e){super(e),this.rollMap=new Map}}function asyncGeneratorStep$K(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}class SkipAvailable extends PlaybackMonitor{handlePlaybackThreshold(e,n){var d,p=this;return(d=function*(){if(!p.skipMap.has(n))return;const e=p.skipMap.get(n);p.dispatcher.publish(po.mediaSkipAvailable,e),p.skipMap.delete(n)},function(){var e=this,n=arguments;return new Promise((function(p,h){var y=d.apply(e,n);function _next(e){asyncGeneratorStep$K(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$K(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))})()}shouldMonitor(){if(!super.shouldMonitor())return!1;return this.getNowPlayingMetadata().length>0}startMonitor(){this.setupWatchers(this.getNowPlayingMetadata()),super.startMonitor()}getNowPlayingMetadata(){const e=this.playbackController.nowPlayingItem;return void 0===e?[]:function(e){const n=parseInt(e.hlsMetadata["skip.count"],10),d=[];if(isNaN(n)||0===n)return d;for(let p=0;p<n;p++)d.push({start:parseFloat(e.hlsMetadata[`skip.${p}.start`]),duration:parseFloat(e.hlsMetadata[`skip.${p}.duration`]),target:parseFloat(e.hlsMetadata[`skip.${p}.target`]),label:e.hlsMetadata[`skip.${p}.label`]});return d}(e)}setupWatchers(e){const n=[];e.forEach(e=>{const{start:d,duration:p}=e,h=new SpanWatcher(this.dispatcher,this.handlePlaybackThreshold,d,d+p);n.push(h),this.skipMap.set(h,e)}),this.watchers=n}constructor(e){super(e),this.skipMap=new Map}}const wo=BooleanDevFlag.register("mk-send-manifest-headers");function asyncGeneratorStep$J(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$J(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$J(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$J(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}const Oo=["https://play.itunes.apple.com/","https://linear.tv.apple.com/","https://play-edge.itunes.apple.com"];const Io=new class{fetchManifest(e){var n=this;return _asyncToGenerator$J((function*(){return Lt.info("fetching manifest at",e),shouldLoadManifestOnce()?n.fetchForCache(e):n.fetchOnly(e)}))()}getManifest(e){return this.cache.get(e)}clear(e){e?this.cache.delete(e):this.cache.clear()}fetchForCache(e){var n=this;return _asyncToGenerator$J((function*(){const d=function(e){const n={};Oo.some(n=>e.startsWith(n))&&ba.musicUserToken&&wo.configured&&wo.enabled&&(n["media-user-token"]=ba.musicUserToken,n.Authorization="Bearer "+ba.developerToken);return n}(e),p=yield n.fetch(e,{headers:new Headers(d)});let h=yield p.text();var y;h=((e,n)=>{Lt.info("converting manifest URIs to absolute paths");const d=new URL(e);let p=n.replace(/URI="([^"]*)"/g,(function(e,n){return`URI="${new URL(n,d).href}"`}));return p=p.replace(/^(#EXT-X-STREAM-INF:[^\n]*\n)(.*$)/gim,(function(e,n,p){return`${n}${new URL(p,d).href}`})),p})(e,h);const m={url:e,content:h,contentType:null!==(y=p.headers.get("content-type"))&&void 0!==y?y:void 0};return n.cache.set(e,m),m}))()}fetchOnly(e){var n=this;return _asyncToGenerator$J((function*(){const d=yield n.fetch(e),p=yield d.text();var h;return{url:e,content:p,contentType:null!==(h=d.headers.get("content-type"))&&void 0!==h?h:void 0}}))()}constructor(e={}){var n,d;this.fetch=null!==(n=e.fetch)&&void 0!==n?n:fetch.bind(globalThis),this.cache=null!==(d=e.cache)&&void 0!==d?d:new Map}};function asyncGeneratorStep$I(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _defineProperty$x(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}const hasContentCompletionThresholdData=e=>!isNaN(getUpNextStart(e))&&!isNaN(getWatchedTime(e)),getUpNextStart=e=>parseFloat(e.hlsMetadata["up-next.start"]),getWatchedTime=e=>parseFloat(e.hlsMetadata["watched.time"]),Ao=function(){var e,n=(e=function*(e,n){if(e.isUTS&&e.assetURL)try{const d=generateAssetUrl(e,n),p=yield Io.fetchManifest(d);e.hlsMetadata=function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$x(e,n,d[n])}))}return e}({},e.hlsMetadata,function(e,n={}){const d=/^(?:#EXT-X-SESSION-DATA:?)DATA-ID="([^"]+)".+VALUE="([^"]+)".*$/,p={};for(const h of e.split("\n")){const e=h.match(d);if(e){let d=e[1];e[1].startsWith("com.apple.hls.")&&!1!==n.stripPrefix&&(d=e[1].slice("com.apple.hls.".length));const h=e[2];p[d]=h}}return p}(p.content))}catch(Y){Ut.error(Y.message,Y)}},function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$I(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$I(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))});return function(e,d){return n.apply(this,arguments)}}();function asyncGeneratorStep$H(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}var Ro={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},Co={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};class UpNextMonitor extends PlaybackMonitor{handlePlaybackThreshold(){var e,n=this;return(e=function*(){n.dispatcher.publish(po.mediaUpNext)},function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$H(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$H(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))})()}shouldMonitor(){if(!super.shouldMonitor())return!1;const e=this.playbackController.nowPlayingItem;return void 0!==e&&hasContentCompletionThresholdData(e)}startMonitor(){this.setupWatchers(),super.startMonitor()}setupWatchers(){const e=this.playbackController.nowPlayingItem;e&&hasContentCompletionThresholdData(e)&&(this.watchers=[new SpanWatcher(this.dispatcher,this.handlePlaybackThreshold,Math.round(this.getStartTime(e)),Number.POSITIVE_INFINITY)])}getStartTime(e){const n=getUpNextStart(e);return isNaN(n)?getWatchedTime(e):n}constructor(e){super(e)}}Ro([Bind(),Co("design:type",Function),Co("design:paramtypes",[])],UpNextMonitor.prototype,"handlePlaybackThreshold",null);const Mo=getHlsJsCdnConfig(),Do={app:{},autoplay:{maxQueueSizeForAutoplay:50,maxQueueSizeInRequest:10,maxUpcomingTracksToMaintain:10},features:{xtrick:!0,isWeb:!0,bookmarking:!1,"seamless-audio-transitions":!0,"enhanced-hls":!1},urls:{hls:Mo.hls,rtc:Mo.rtc,mediaApi:"https://amp-api.music.apple.com/v1",webPlayback:`https://${getCommerceHostname("play")}/WebObjects/MZPlay.woa/wa/webPlayback`}},jo=JsonDevFlag.register("mk-offers-key-urls").get();function asyncGeneratorStep$G(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$G(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$G(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$G(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$w(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpreadProps$m(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}let xo;jo&&(Do.urls.hlsOffersKeyUrls=jo);class Store{get authorizationStatus(){return this.storekit.authorizationStatus}get cid(){return this.storekit.cid}get developerToken(){return this.storekit.developerToken}get hasAuthorized(){return this._hasAuthorized}get isAuthorized(){return this.storekit.hasAuthorized}get isRestricted(){return this.storekit.authorizationStatus===De.RESTRICTED}get metricsClientId(){return this._metricsClientId}set metricsClientId(e){this._metricsClientId=e}get musicUserToken(){return this.storekit.userToken}set musicUserToken(e){this.storekit.userToken=e}updateUserTokenFromStorage(){return this.storekit.updateUserTokenFromStorage()}set dynamicMusicUserToken(e){this.storekit.dynamicUserToken=e}get needsGDPR(){Ut.error("needsGDPR has been deprecated. Plesae migrate to shouldDisplayPrivacyLink()")}get realm(){return this.storekit.realm}set requestUserToken(e){this._providedRequestUserToken=!0,this.storekit.requestUserToken=e}get restrictedEnabled(){return this.storekit.restrictedEnabled}set restrictedEnabled(e){this.storekit.overrideRestrictEnabled(e)}get storefrontCountryCode(){var e;return this.isAuthorized?this.storekit.storefrontCountryCode:null!==(e=this._defaultStorefrontCountryCode)&&void 0!==e?e:this.storekit.storefrontCountryCode}get storefrontId(){return this._apiStorefrontId||this.storekit.storefrontCountryCode}set storefrontId(e){e&&(e=e.toLowerCase()),e!==this._apiStorefrontId&&(this._apiStorefrontId=e,this._dispatcher.publish(hr.apiStorefrontChanged,{storefrontId:e}))}get subscribeURL(){return this.storekit.deeplinkURL({p:"subscribe"})}get subscribeFamilyURL(){return this.storekit.deeplinkURL({p:"subscribe-family"})}get subscribeIndividualURL(){return this.storekit.deeplinkURL({p:"subscribe-individual"})}get subscribeStudentURL(){return this.storekit.deeplinkURL({p:"subscribe-student"})}get userToken(){return this.musicUserToken}authorize(){var e=this;return _asyncToGenerator$G((function*(){if(e.storekit.userTokenIsValid)return e.storekit.userToken;let n;try{n=yield e.storekit.requestUserToken()}catch(Y){try{yield e.unauthorize()}catch(Lr){}throw new MKError(MKError.AUTHORIZATION_ERROR,"Unauthorized")}return e._providedRequestUserToken&&(e.storekit.userToken=n),e.storekit.userTokenIsValid?(yield e.storekit.requestStorefrontCountryCode().catch(function(){var n=_asyncToGenerator$G((function*(n){return yield e.unauthorize(),Promise.reject(n)}));return function(e){return n.apply(this,arguments)}}()),n):void 0}))()}shouldDisplayPrivacyLink(e){var n=this;return _asyncToGenerator$G((function*(){return n.storekit.shouldDisplayPrivacyLink(e)}))()}unauthorize(){var e=this;return _asyncToGenerator$G((function*(){return e.storekit.revokeUserToken()}))()}validateAgeVerification(n){var d=this;return _asyncToGenerator$G((function*(){var p;if(d.storekit.realm!==e.SKRealm.TV)return;const h=yield d.storekit.me();if(h.info){var y;if(h.info.webAgeVerificationData&&!h.info.webAgeVerificationData.isVerified&&d._ageVerificationRequired(n.type,null!==(y=null===(p=n.defaultPlayable)||void 0===p?void 0:p.rating)&&void 0!==y?y:n.rating)&&!n.isLinearStream)return Promise.reject(new MKError(MKError.AGE_VERIFICATION,"Age verification required"));if(n.rating&&h.info.parentalControlsData&&h.info.parentalControlsData.videoContentRestrictions){const e=n.rating.system.replace(/[^a-z0-9]+/i,"-");if(h.info.parentalControlsData.videoContentRestrictions[e]<n.rating.value)return Promise.reject(new MKError(MKError.CONTENT_RESTRICTED,"Content restricted"))}}}))()}constructor(n,d={}){this._hasAuthorized=!1,this._providedRequestUserToken=!1,this._ageVerificationRequired=(e,n)=>!0,this._dispatcher=d.services.dispatcher,d.precache&&(this.precache=d.precache),d.storefrontId&&(this.storefrontId=d.storefrontId),this._defaultStorefrontCountryCode=d.storefrontCountryCode,(d.affiliateToken||d.campaignToken)&&(d.linkParameters=_objectSpreadProps$m(function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$w(e,n,d[n])}))}return e}({},d.linkParameters||{}),{at:d.affiliateToken,ct:d.campaignToken})),d.ageVerificationRequired&&(this._ageVerificationRequired=d.ageVerificationRequired),this.storekit=new StoreKit(n,{apiBase:Do.urls.mediaApi,authenticateMethod:Do.features["legacy-authenticate-method"]?"POST":"GET",deeplink:d.linkParameters,disableAuthBridge:d.disableAuthBridge,iconURL:Do.app.icon,meParameters:d.meParameters,persist:d.persist,realm:d.realm||e.SKRealm.MUSIC,disableLogoutURL:d.disableLogoutURL}),this.storekit.addEventListener(po.authorizationStatusDidChange,e=>{const{authorizationStatus:n}=e;this._hasAuthorized=[De.AUTHORIZED,De.RESTRICTED].includes(n)})}}function formattedSeconds(e){return{hours:Math.floor(e/3600),minutes:Math.floor(e%3600/60)}}function asyncGeneratorStep$F(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$F(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$F(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$F(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function hasAuthorization(e){return void 0===e&&(e=xo&&xo.storekit),void 0!==e&&e.hasAuthorized&&e.userTokenIsValid}function hasMusicSubscription(e){return _hasMusicSubscription.apply(this,arguments)}function _hasMusicSubscription(){return(_hasMusicSubscription=_asyncToGenerator$F((function*(e){return void 0===e&&(e=xo&&xo.storekit),e.hasMusicSubscription()}))).apply(this,arguments)}var $o,Lo={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},No={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};class MediaSessionManager{onCapabilitiesChanged(){this._resetHandlers(),this._setMediaSessionHandlers()}onNowPlayingItemDidChange(e,{item:n}){this._setMediaSessionMetadata(n)}_setMediaSessionMetadata(e){var n,d;this.session&&"MediaMetadata"in window&&e&&(this.session.metadata=new window.MediaMetadata({title:e.title,artist:null!==(d=e.artistName)&&void 0!==d?d:null===(n=e.attributes)||void 0===n?void 0:n.showTitle,album:e.albumName,artwork:e.artwork?[96,128,192,256,384,512].map(n=>({src:formatArtworkURL(e.artwork,n,n),sizes:`${n}x${n}`,type:"image/jpeg"})):[]}))}_setMediaSessionHandlers(){this.session&&(this._resetHandlers(),this.session.setActionHandler("play",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.play()}),this.capabilities.canPause?this.session.setActionHandler("pause",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.pause()}):this.session.setActionHandler("pause",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.stop()}),this.capabilities.canSeek&&(this.session.setActionHandler("seekforward",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.seekForward()}),this.session.setActionHandler("seekbackward",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.seekBackward()})),this.capabilities.canSkipToNextItem&&this.session.setActionHandler("nexttrack",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.skipToNextItem()}),this.capabilities.canSkipToPreviousItem&&this.session.setActionHandler("previoustrack",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.skipToPreviousItem()}))}_resetHandlers(){this.session&&(this.session.setActionHandler("play",void 0),this.session.setActionHandler("pause",void 0),this.session.setActionHandler("seekforward",void 0),this.session.setActionHandler("seekbackward",void 0),this.session.setActionHandler("nexttrack",void 0),this.session.setActionHandler("previoustrack",void 0))}constructor(e,n){this.capabilities=e,this.dispatcher=n,this.session=navigator.mediaSession,this.session&&(this.dispatcher.subscribe(po.nowPlayingItemDidChange,this.onNowPlayingItemDidChange),this.dispatcher.subscribe(po.capabilitiesChanged,this.onCapabilitiesChanged),this._setMediaSessionHandlers())}}Lo([Bind(),No("design:type",Function),No("design:paramtypes",[])],MediaSessionManager.prototype,"onCapabilitiesChanged",null),Lo([Bind(),No("design:type",Function),No("design:paramtypes",[void 0,void 0])],MediaSessionManager.prototype,"onNowPlayingItemDidChange",null),function(e){e[e.PAUSE=0]="PAUSE",e[e.EDIT_QUEUE=1]="EDIT_QUEUE",e[e.SEEK=2]="SEEK",e[e.REPEAT=3]="REPEAT",e[e.SHUFFLE=4]="SHUFFLE",e[e.SKIP_NEXT=5]="SKIP_NEXT",e[e.SKIP_PREVIOUS=6]="SKIP_PREVIOUS",e[e.SKIP_TO_ITEM=7]="SKIP_TO_ITEM"}($o||($o={}));class Capabilities{set controller(e){this._mediaSession.controller=e}updateChecker(e){this._checkCapability!==e&&(this._checkCapability=e,this._dispatcher.publish(po.capabilitiesChanged))}get canEditPlaybackQueue(){return this._checkCapability($o.EDIT_QUEUE)}get canPause(){return this._checkCapability($o.PAUSE)}get canSeek(){return this._checkCapability($o.SEEK)}get canSetRepeatMode(){return this._checkCapability($o.REPEAT)}get canSetShuffleMode(){return this._checkCapability($o.SHUFFLE)}get canSkipToNextItem(){return this._checkCapability($o.SKIP_NEXT)}get canSkipToMediaItem(){return this._checkCapability($o.SKIP_TO_ITEM)}get canSkipToPreviousItem(){return this._checkCapability($o.SKIP_PREVIOUS)}constructor(e){this._dispatcher=e,this._checkCapability=e=>!1,this._mediaSession=new MediaSessionManager(this,e)}}function _defineProperty$v(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function transform$7(e){return function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$v(e,n,d[n])}))}return e}({attributes:{}},transform$9({id:"metadata.itemId",type:"metadata.itemType","attributes.contentRating"(){var n;if(1===(null==e||null===(n=e.metadata)||void 0===n?void 0:n.isExplicit))return"explicit"},"attributes.playParams"(){var n,d,p;return 0!==(null==e||null===(n=e.metadata)||void 0===n?void 0:n.isPlayable)&&{id:null==e||null===(d=e.metadata)||void 0===d?void 0:d.itemId,kind:null==e||null===(p=e.metadata)||void 0===p?void 0:p.itemType}},"container.id":"metadata.containerId","container.name":"metadata.containerName","container.type":"metadata.containerType"},e))}function _defineProperty$u(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$u(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$u(e,n,d[n])}))}return e}function _objectSpreadProps$l(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}const Uo={condition:()=>!0,toOptions:(e,n,d)=>[_objectSpreadProps$l(_objectSpread$u({},e),{context:d})]};function _defineProperty$t(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$t(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$t(e,n,d[n])}))}return e}function _objectSpreadProps$k(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}const Go={condition:e=>{var n;return"stations"===e.type&&(null===(n=e.attributes)||void 0===n?void 0:n.isLive)},toOptions:(e,n,d)=>[_objectSpreadProps$k(_objectSpread$t({},e),{context:d,container:{attributes:e.attributes,id:e.id,type:e.type,name:null==d?void 0:d.featureName}})]},hasRelationship=e=>n=>{var d,p;return!!(null===(d=n.relationships)||void 0===d||null===(p=d[e])||void 0===p?void 0:p.data)},typeIs=(...e)=>({type:n})=>e.includes(n),withBagPrefix=e=>{if(void 0===e||""===e)return;const{prefix:n}=Do;return n?`${n}:${e}`:e};function _defineProperty$s(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpreadProps$j(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}var Bo;const getContainerName$1=(e,n)=>{var d;return null!==(Bo=null!=n?n:null==e||null===(d=e.container)||void 0===d?void 0:d.name)&&void 0!==Bo?Bo:mr.SONG},Fo={toOptions:(e,n,d)=>{const p=_objectSpreadProps$j(function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$s(e,n,d[n])}))}return e}({id:e.id},n),{name:withBagPrefix(getContainerName$1(e,null==d?void 0:d.featureName))});return[{relationships:e.relationships,attributes:e.attributes,id:e.id,type:e.type,container:p,context:d}]},condition:typeIs("songs","library-songs","music-videos")};function _defineProperty$r(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$r(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$r(e,n,d[n])}))}return e}function _objectSpreadProps$i(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}const parseAssets=({type:e,attributes:{assetTokens:n}})=>e.includes("udio")?(e=>{if(void 0===e)return;const[n]=Object.keys(e);return e[n]})(n):(e=>{if(void 0===e)return;const n=Object.keys(e);return e[n[n.length-1]]})(n),Ko={condition:typeIs("uploaded-audios","uploadedAudio","uploaded-videos","uploadedVideo"),toOptions:(e,n,d)=>{var p,h;const y=_objectSpreadProps$i(_objectSpread$r({},e),{context:d,attributes:_objectSpreadProps$i(_objectSpread$r({},e.attributes),{assetUrl:parseAssets(e),playParams:null!==(h=null==e||null===(p=e.attributes)||void 0===p?void 0:p.playParams)&&void 0!==h?h:{id:e.id,kind:e.type}})});return void 0!==n&&(y.container=n),void 0!==(null==d?void 0:d.featureName)&&(y.container=_objectSpreadProps$i(_objectSpread$r({},y.container),{name:null==d?void 0:d.featureName})),[y]}};function _defineProperty$q(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpreadProps$h(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}const Vo={toOptions:(e,n,d)=>e.relationships.episodes.data.map(e=>_objectSpreadProps$h(function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$q(e,n,d[n])}))}return e}({},e),{context:d})),condition:hasRelationship("episodes"),requiredRelationships:["episodes"]};function asyncGeneratorStep$E(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$E(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$E(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$E(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$p(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$p(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$p(e,n,d[n])}))}return e}function formatRatingsContentType(e,n){return T(n)&&S(n)?e.replace(/^library-/,""):T(n)&&!/^library-/.test(e)?"library-"+e:e}function normalizeAdamId(e){return e.replace(/^a\./,"")}function makeRequest(e,n,d){return _makeRequest.apply(this,arguments)}function _makeRequest(){return(_makeRequest=_asyncToGenerator$E((function*(e,n,d,p={}){let h,y=n;const m=d&&d.ids;p=_objectSpread$p({},p);const{shouldCacheResults:g=!0,returnRawJSONApiRecords:b=!1,includePagination:_=e.defaultIncludePaginationMetadata,includeResponseMeta:P=!1}=p;delete p.shouldCacheResults,delete p.returnRawJSONApiRecords,delete p.includePagination,delete p.includeResponseMeta,"string"==typeof m&&(y=`${n}/${encodeURIComponent(m)}`,d&&delete d.ids);try{(_||P)&&(p.useRawResponse=!0),h=yield e.request(y,d,p)}catch(T){return"status"in T?404===T.status?Promise.reject(new MKError(MKError.CONTENT_UNAVAILABLE,"The requested content is not available.")):Promise.reject(MKError.responseError(T)):Promise.reject(MKError.internalError(T))}try{const n=h.results||h.data||h;if("object"==typeof h&&"results"in h&&"meta"in h&&(n.meta=h.meta),0===n.length)return Promise.reject(new MKError(MKError.CONTENT_UNAVAILABLE,"The requested content is not available."));const y=b?n:e.parseResultData(g,n);if(!_&&!P)return y;if("results"in h){for(const n in h.results)"meta"!==n&&(y[n]=paginateResultSet(h.results[n],y[n],e,d,p));return y}return paginateResultSet(h,y,e,d,p)}catch(Y){return Promise.reject(MKError.parseError(Y))}}))).apply(this,arguments)}function paginateResultSet(e,n,d,p,h={}){let y,m;h.includePagination=!0;const g=_objectSpread$p({},h);return delete g.offset,e.next&&(y=()=>makeRequest(d,formatPaginatedUrl(d.url,e.next),p,g)),e.previous&&(m=()=>makeRequest(d,formatPaginatedUrl(d.url,e.previous),p,g)),{data:n,next:y,previous:m,meta:e.meta}}function mapRequestResult(e,n){return"data"in e?(e.data=n(e.data),e):n(e)}function formatPaginatedUrl(e,n){if("function"!=typeof URL)throw new Error("formatPaginatedUrl requires an implementation of URL");const{pathname:d}=new URL(e),p=new RegExp(`^${d}/`);return n.replace(p,"")}const getFeatureName=(e,n)=>{if(n)return n;const d=function(e=[]){return 0!==e.length&&e.filter(({attributes:e})=>!!e&&(e.workName||e.movementName||e.movementCount||e.movementNumber)).length>0}(e.relationships.tracks.data);return"albums"===e.type||"library-albums"===e.type?d?mr.ALBUM_CLASSICAL:mr.ALBUM:"playlists"===e.type||"library-playlists"===e.type?d?mr.PLAYLIST_CLASSICAL:mr.PLAYLIST:void 0},Ho=[{toOptions:(e,n,d)=>{const p={attributes:e.attributes,id:e.id,type:e.type,name:withBagPrefix(getFeatureName(e,null==d?void 0:d.featureName))};return e.relationships.tracks.data.map(e=>({attributes:e.attributes,id:e.id,type:e.type,container:p,context:d}))},condition:hasRelationship("tracks"),requiredRelationships:["tracks"]},Vo,Fo,Go,Ko],qo=Ho.reduce((e,n)=>{const d=n.requiredRelationships;return d&&e.push(...d),e},[]),zo=new Set(qo),isArrayOf=(e,n)=>Array.isArray(e)&&(0===e.length||n(e[0])),isMediaAPIResource=e=>e&&void 0!==e.id&&void 0!==e.type,isMediaItem=e=>e&&void 0!==e.id,isMPMediaItem=e=>e&&void 0!==e.contentId&&void 0!==e.metadata&&void 0!==e.metadata.itemId&&void 0!==e.metadata.itemType,isQueueItems=e=>e&&e.items&&Array.isArray(e.items),isQueueLoaded=e=>e&&e.loaded,isQueueURLOption=e=>e&&e.url;function _defineProperty$o(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}const Wo=Vt.linkChild(new Logger("queue")),descriptorToMediaItems=e=>{if(!isQueueItems(e)&&!isQueueLoaded(e))return[];const n=isQueueLoaded(e)?loadedDescriptorToMediaItem(e):unloadedDescriptorToMediaItem(e);return n.forEach(n=>n.context=function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$o(e,n,d[n])}))}return e}({},e.context,n.context)),n},unloadedDescriptorToMediaItem=({items:e})=>isArrayOf(e,isMPMediaItem)?e.map(e=>new MediaItem(transform$7(e))):isArrayOf(e,isMediaItem)?e.map(e=>new MediaItem(e)):[],loadedDescriptorToMediaItem=e=>{const n=[],{loaded:d,container:p,context:h}=e;return void 0===d?[]:isArrayOf(d,isDataRecord)?(d.forEach(e=>{n.push(...dataRecordToMediaItems(e,p,h))}),n):isArrayOf(d,isMediaAPIResource)?(d.forEach(e=>{n.push(...resourceToMediaItem(e,p,h))}),n):isDataRecord(d)?dataRecordToMediaItems(d,p,h):isMediaAPIResource(d)?resourceToMediaItem(d,p,h):[]},dataRecordToMediaItems=(e,n,d={})=>{const{data:p}=e.serialize(!0,void 0,{includeRelationships:zo,allowFullDuplicateSerializations:!0});return resourceToMediaItem(p,n,d)},resourceToMediaItem=(e,n,d={})=>(Wo.debug("_resourceToMediaItem",e),((e,n,d={})=>{var p,h,y;n=null!==(h=null==n||null===(p=n.serialize)||void 0===p?void 0:p.call(n).data)&&void 0!==h?h:n;return(null!==(y=Ho.find(p=>p.condition(e,n,d)))&&void 0!==y?y:Uo).toOptions(e,n,d).map(e=>new MediaItem(e))})(e,n,d));class BaseModifiableQueue{append(e){Ut.warn("Append is not supported for this type of playback")}clear(){Ut.warn("Clear is not supported for this type of playback")}insertAt(e,n){Ut.warn("InsertAt is not supported for this type of playback")}prepend(e,n=!1){Ut.warn("Prepend is not supported for this type of playback")}constructor(){this.canModifyQueue=!1}}class ModifiableQueue{append(e){const n=descriptorToMediaItems(e);this.queue.splice(this.queue.appendTargetIndex,0,n)}clear(){this.queue.length&&(this.queue.splice(0,this.queue.length),this.queue.reset())}insertAt(e,n){const d=descriptorToMediaItems(n);this.queue.splice(e,0,d)}prepend(e,n=!1){const d=descriptorToMediaItems(e),p=this.queue.position+1;n&&this.queue.splice(p,this.queue.length),this.queue.splice(p,0,d)}constructor(e,n){this.canModifyQueue=!0,this.queue=e,this._mediaItemPlayback=n}}var Yo;e.PlayerRepeatMode=void 0,(Yo=e.PlayerRepeatMode||(e.PlayerRepeatMode={}))[Yo.none=0]="none",Yo[Yo.one=1]="one",Yo[Yo.all=2]="all";class BaseRepeatable{get repeatMode(){return e.PlayerRepeatMode.none}set repeatMode(e){e!==this.repeatMode&&Ut.warn("setting repeatMode is not supported in this playback method")}constructor(){this.canSetRepeatMode=!1}}class Repeatable{get repeatMode(){return this._repeatMode}set repeatMode(n){n in e.PlayerRepeatMode&&n!==this._repeatMode&&(this._repeatMode=n,this.dispatcher.publish(po.repeatModeDidChange,this._repeatMode))}constructor(n,d=e.PlayerRepeatMode.none){this.canSetRepeatMode=!0,this.dispatcher=n,this._repeatMode=d}}function _defineProperty$n(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function asyncGeneratorStep$D(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$D(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$D(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$D(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}!function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$n(e,n,d[n])}))}}({},{NEXT_ITEM:"NEXT"},e.PlayActivityEndReasonType);const Qo=["EditorialVideoClip","uploaded-videos","uploadedVideo","musicVideo"],Jo=function(){var e=_asyncToGenerator$D((function*(){}));return function(){return e.apply(this,arguments)}}();class BaseSeekable{getSeekSeconds(e){return Ut.warn("Seeking by predetermined amounts are not supported in this playback method"),{BACK:0,FORWARD:0}}seekBackward(e=Jo){Ut.warn("seekBackward is not supported in this playback method")}seekForward(e=Jo){Ut.warn("seekForward is not supported in this playback method")}seekToTime(e,n){return _asyncToGenerator$D((function*(){Ut.warn("seekToTime is not supported in this playback method")}))()}constructor(e){this.mediaItemPlayback=e,this.canSeek=!1}}class Seekable{getSeekSeconds(e){return(e=>(null==e?void 0:e.isUTS)||Qo.includes(null==e?void 0:e.type)?{FORWARD:10,BACK:10}:{FORWARD:30,BACK:15})(e)}seekBackward(e=this._seekToBeginning){var n=this;return _asyncToGenerator$D((function*(){if(void 0===n.mediaItemPlayback.nowPlayingItem)return void Ut.warn("Cannot seekBackward when nowPlayingItem is not yet set.");const d=n.mediaItemPlayback.currentPlaybackTime-n.getSeekSeconds(n.mediaItemPlayback.nowPlayingItem).BACK;d<0?yield e.call(n):yield n.seekToTime(d,br.Interval)}))()}seekForward(e=this._seekToEnd){var n=this;return _asyncToGenerator$D((function*(){if(void 0===n.mediaItemPlayback.nowPlayingItem)return void Ut.warn("Cannot seekForward when nowPlayingItem is not yet set.");const d=n.mediaItemPlayback.currentPlaybackTime+n.getSeekSeconds(n.mediaItemPlayback.nowPlayingItem).FORWARD;d>n.mediaItemPlayback.currentPlaybackDuration?yield e.call(n):yield n.seekToTime(d,br.Interval)}))()}seekToTime(e,n=br.Manual){var d=this;return _asyncToGenerator$D((function*(){if(void 0===d.mediaItemPlayback.nowPlayingItem)return void Ut.warn("Cannot seekToTime when nowPlayingItem is not yet set.");const p=d.mediaItemPlayback.nowPlayingItem,h=d.mediaItemPlayback.currentPlaybackTime,y=d.mediaItemPlayback.currentPlayingDate,m=Math.min(Math.max(0,e),d.mediaItemPlayback.currentPlaybackDuration-1);let g;if(p.isLinearStream&&void 0!==y){const e=1e3*(m-h);g=new Date(y.getTime()+e)}yield d.mediaItemPlayback.seekToTime(m,n),d._dispatcher.publish(hr.playbackSeek,{item:p,startPosition:h,position:m,playingDate:g,startPlayingDate:y,seekReasonType:n})}))()}_seekToBeginning(){var e=this;return _asyncToGenerator$D((function*(){yield e.seekToTime(0,br.Interval)}))()}_seekToEnd(){var e=this;return _asyncToGenerator$D((function*(){yield e.seekToTime(e.mediaItemPlayback.currentPlaybackDuration,br.Interval)}))()}constructor(e,n){this._dispatcher=e,this.mediaItemPlayback=n,this.canSeek=!0}}const shuffleCollection=e=>{const n=[...e],{length:d}=n;for(let p=0;p<d;++p){const e=p+Math.floor(Math.random()*(d-p)),h=n[e];n[e]=n[p],n[p]=h}return n};function _objectWithoutProperties$1(e,n){if(null==e)return{};var d,p,h=function(e,n){if(null==e)return{};var d,p,h={},y=Object.keys(e);for(p=0;p<y.length;p++)d=y[p],n.indexOf(d)>=0||(h[d]=e[d]);return h}(e,n);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(p=0;p<y.length;p++)d=y[p],n.indexOf(d)>=0||Object.prototype.propertyIsEnumerable.call(e,d)&&(h[d]=e[d])}return h}const Xo=Vt.createChild("queue");class QueueItem{restrict(){return this.item.restrict()}constructor(e,n){var d;this.isAutoplay=!1,this.item=e,this.isAutoplay=null!==(d=null==n?void 0:n.isAutoplay)&&void 0!==d&&d}}function toQueueItems(e,n){return e.map(e=>new QueueItem(e,n))}function toMediaItems(e){return e.map(e=>e.item)}const parseQueueURLOption=e=>{if(!isQueueURLOption(e))return e;const{url:n}=e,d=_objectWithoutProperties$1(e,["url"]),{contentId:p,kind:h,storefrontId:y}=formattedMediaURL(n);return d[h]=p,xo.storefrontId=y,Xo.debug("parseQueueURLOption",d),d},{queueItemsDidChange:Zo,queuePositionDidChange:es}=po;class Queue{get isEmpty(){return 0===this.length}set isRestricted(e){this._isRestricted=e,this._isRestricted&&this._queueItems&&this._queueItems.forEach(e=>{e.restrict()})}get isRestricted(){return this._isRestricted}get appendTargetIndex(){let e=this.length;const n=this._queueItems.findIndex(e=>e.isAutoplay);return-1!==n&&this.position<n&&(e=n),e}get items(){return toMediaItems(this._queueItems)}get autoplayItems(){return toMediaItems(this._queueItems.filter(e=>e.isAutoplay))}get unplayedAutoplayItems(){return toMediaItems(this._unplayedQueueItems.filter(e=>e.isAutoplay))}get userAddedItems(){return toMediaItems(this._queueItems.filter(e=>!e.isAutoplay))}get unplayedUserItems(){return toMediaItems(this._unplayedQueueItems.filter(e=>!e.isAutoplay))}get playableItems(){return toMediaItems(this._queueItems.filter(e=>canPlay(e.item)))}get unplayedPlayableItems(){return toMediaItems(this._unplayedQueueItems.filter(e=>canPlay(e.item)))}get length(){return this._queueItems.length}get nextPlayableItem(){if(-1!==this.nextPlayableItemIndex)return this.item(this.nextPlayableItemIndex)}get nextPlayableItemIndex(){return this._nextPlayableItemIndex=this.findPlayableIndexForward(),this._nextPlayableItemIndex}get position(){return this._position}set position(e){this._updatePosition(e)}get isInitiated(){return this.position>=0}get previousPlayableItem(){if(-1!==this.previousPlayableItemIndex)return this.item(this.previousPlayableItemIndex)}get previousPlayableItemIndex(){return this.findPlayableIndexBackward()}removeQueueItems(e){for(let n=this.length-1;n>=0;n--)e(this.queueItem(n),n)&&this.spliceQueueItems(n,1)}indexForItem(e){return("string"==typeof e?this._itemIDs:this.items).indexOf(e)}item(e){var n;return null===(n=this.queueItem(e))||void 0===n?void 0:n.item}get currentItem(){return this.item(this.position)}queueItem(e){var n;return null===(n=this._queueItems)||void 0===n?void 0:n[e]}updateItems(e){this._queueItems=toQueueItems(e),this._reindex(),this._dispatcher.publish(po.queueItemsDidChange,this.items)}get currentQueueItem(){return this.queueItem(this.position)}remove(e){if(deprecationWarning("remove",{message:"The queue remove function has been deprecated"}),e===this.position)throw new MKError(MKError.INVALID_ARGUMENTS);this.splice(e,1)}append(e=[]){return this.appendQueueItems(toQueueItems(e))}appendQueueItems(e=[]){return this.spliceQueueItems(this.appendTargetIndex,0,e)}splice(e,n,d=[]){return toMediaItems(this.spliceQueueItems(e,n,toQueueItems(d)))}spliceQueueItems(e,n,d=[],p=!0){d=d.filter(e=>isPlayable(null==e?void 0:e.item));const h=this._queueItems.splice(e,n,...d);return this._itemIDs.splice(e,n,...d.map(e=>e.item.id)),p&&(this._dispatcher.publish(hr.queueModified,{start:e,added:toMediaItems(d),removed:toMediaItems(h)}),this._dispatcher.publish(Zo,this.items)),h}reset(){const e=this.position;this._position=-1,this._dispatcher.publish(es,{oldPosition:e,position:this.position})}_isSameItems(e){if(e.length!==this.length)return!1;const n=e.map(e=>e.id).sort(),d=[...this._itemIDs].sort();let p,h;try{p=JSON.stringify(n),h=JSON.stringify(d)}catch(Lr){return!1}return p===h}_reindex(){this._queueItems&&(this._itemIDs=this._queueItems.map(e=>e.item.id))}_updatePosition(e){if(e===this._position)return;const n=this._position;this._position=e;const d=this.item(e);d&&canPlay(d)||(this._position=this.findPlayableIndexForward(e)),this._position!==n&&this._dispatcher.publish(es,{oldPosition:n,position:this._position})}findPlayableIndexForward(n=this.position){var d;if(this.isEmpty)return-1;if(this.isInitiated&&!indexInBounds([0,this.position],n))return-1;const p=null===(d=this.repeatable)||void 0===d?void 0:d.repeatMode;if(n<this.length)for(let e=n+1;e<this.length;e++){if(canPlay(this.item(e)))return e}if(p===e.PlayerRepeatMode.all)for(let e=0;e<=n;e++){if(canPlay(this.item(e)))return e}return-1}findPlayableIndexBackward(n=this.position){var d;if(this.isEmpty)return-1;if(!indexInBounds([0,this.position],n))return-1;const p=null===(d=this.repeatable)||void 0===d?void 0:d.repeatMode;if(n>0)for(let e=n-1;e>=0;e--){if(canPlay(this.item(e)))return e}if(p===e.PlayerRepeatMode.all)for(let e=this.length-1;e>=n;e--){if(canPlay(this.item(e)))return e}return-1}get _unplayedQueueItems(){const e=this.position<0?0:this.position;return this._queueItems.slice(e)}_getStartItemPosition(e){if(void 0===e)return-1;if("object"==typeof e&&"id"in e&&(e=e.id),"string"==typeof e)return this.indexForItem(e);const n=parseInt(""+e,10);return n>=0&&n<this.length?n:-1}constructor(e){if(this.hasAutoplayStation=!1,this._itemIDs=[],this._queueItems=[],this._isRestricted=!1,this._nextPlayableItemIndex=-1,this._position=-1,this._dispatcher=e.services.dispatcher,!e.descriptor)return;const n=descriptorToMediaItems(e.descriptor).filter(e=>isPlayable(e));this._queueItems=toQueueItems(n),this._reindex(),void 0!==e.descriptor.startWith&&(this.position=this._getStartItemPosition(e.descriptor.startWith))}}function isPlayable(e){return e.isPlayable||void 0!==e.previewURL}function canPlay(e){return isPlayable(e)&&!function(e){return e.isRestricted}(e)&&!function(e){return e.isUnavailable}(e)}function indexInBounds(e,n){return e[0]<=n&&n<=e[1]}var ts,rs={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},ns={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};e.PlayerShuffleMode=void 0,(ts=e.PlayerShuffleMode||(e.PlayerShuffleMode={}))[ts.off=0]="off",ts[ts.songs=1]="songs";const is="Shuffling is not supported in this playback method.";class BaseShuffler{set shuffle(e){Ut.warn(is)}get shuffleMode(){return e.PlayerShuffleMode.off}set shuffleMode(e){Ut.warn(is)}checkAndReshuffle(e){Ut.warn(is)}constructor(){this.canSetShuffleMode=!1}}class Shuffler{get queue(){return this._queue}set queue(e){this._queue=e,this._unshuffledIDs=e.userAddedItems.map(e=>e.id),this.checkAndReshuffle(!1)}queueModifiedHandler(e,n){if(this._isSpliceFromShuffle)return void(this._isSpliceFromShuffle=!1);const{start:d,added:p,removed:h}=n;if(h.length>0){const e=h.map(e=>e.id);this._unshuffledIDs=this._unshuffledIDs.filter(n=>!e.includes(n))}p.length>0&&this._unshuffledIDs.splice(d,0,...p.map(e=>e.id))}set shuffle(n){this.shuffleMode=n?e.PlayerShuffleMode.songs:e.PlayerShuffleMode.off}get shuffleMode(){return this.mode}set shuffleMode(n){n!==this.shuffleMode&&n in e.PlayerShuffleMode&&(Ut.debug(`mk: set shuffleMode from ${this.shuffleMode} to ${n}`),this.mode=n,this.mode===e.PlayerShuffleMode.songs?this.shuffleQueue():this.unshuffleQueue(),this.controller.nowPlayingItem&&(this._queue.position=this._queue.indexForItem(this.controller.nowPlayingItem.id)),this.dispatcher.publish(po.shuffleModeDidChange,this.shuffleMode))}checkAndReshuffle(n=!1){this.shuffleMode===e.PlayerShuffleMode.songs&&this.shuffleQueue(n)}shuffleQueue(e=!0){const{userAddedItems:n}=this._queue;if(n.length<=1)return n;const d=n.slice(0),p=this._queue.position>-1?d.splice(this._queue.position,1):[];let h=[];do{h=shuffleCollection(d)}while(d.length>1&&arrayEquals(h,d));const y=[...p,...h];this._isSpliceFromShuffle=!0,this._queue.spliceQueueItems(0,y.length,toQueueItems(y),e)}unshuffleQueue(e=!0){let n=[];const d=this._unshuffledIDs.reduce((e,n,d)=>(e[n]=d,e),{}),p=[];let h=0;const y=this._queue.item(this._queue.position);this._queue.userAddedItems.forEach(e=>{const m=d[e.id];void 0===m&&p.push(e),n[m]=e,e.id===(null==y?void 0:y.id)&&(h=m)}),n=n.filter(Boolean);const m=n.concat(p);this._isSpliceFromShuffle=!0,this._queue.spliceQueueItems(0,m.length,toQueueItems(m),e),this._queue.position=h}constructor(n,{dispatcher:d}){this.controller=n,this.canSetShuffleMode=!0,this.mode=e.PlayerShuffleMode.off,this._unshuffledIDs=[],this._isSpliceFromShuffle=!1,this.dispatcher=d,this.dispatcher.subscribe(hr.queueModified,this.queueModifiedHandler),this._queue=n.queue}}function asyncGeneratorStep$C(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$C(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$C(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$C(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$m(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$m(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$m(e,n,d[n])}))}return e}function _objectSpreadProps$g(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}rs([Bind(),ns("design:type",Function),ns("design:paramtypes",[String,Object])],Shuffler.prototype,"queueModifiedHandler",null);var as,ss={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},cs={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};!function(e){e.continuous="continuous",e.serial="serial"}(as||(as={}));const{queueItemsDidChange:ls}=po;class PlaybackController{updateAutoplay(e,n){this.autoplayEnabled=n}constructContext(e,n){let d=e.context;var p;return void 0!==e.featureName&&void 0===(null==d?void 0:d.featureName)&&(Ut.warn("featureName is deprecated, pass it inside context"),d||(d={}),d.featureName=e.featureName),null!==(p=null!=d?d:n)&&void 0!==p?p:{}}get context(){return this._context}get continuous(){return this._continuous||this.hasAuthorization}set continuous(e){this._continuous=e}get autoplayEnabled(){return this._autoplayEnabled}set autoplayEnabled(e){this._autoplayEnabled=e}get previewOnly(){return this._mediaItemPlayback.previewOnly}get _dispatcher(){return this._services.dispatcher}get hasAuthorization(){return hasAuthorization(this.storekit)}get isPlaying(){return this._mediaItemPlayback.isPlaying}get isPrimaryPlayer(){return this._mediaItemPlayback.isPrimaryPlayer}set isPrimaryPlayer(e){this._mediaItemPlayback.isPrimaryPlayer=e}get isReady(){return this._mediaItemPlayback.isReady}get _mediaItemPlayback(){return this._services.mediaItemPlayback}get nowPlayingItem(){return this._mediaItemPlayback.nowPlayingItem}get nowPlayingItemIndex(){return this.queue?this.queue.position:-1}get queue(){return this._queue}set queue(e){this._prepareQueue(e),this._queue=e,this._shuffler.queue=this._queue,this._queueModifier.queue=this._queue,this._dispatcher.publish(ls,e.items)}get repeatMode(){return this._repeatable.repeatMode}set repeatMode(e){this._repeatable.repeatMode=e}get seekSeconds(){const{nowPlayingItem:e}=this;if(void 0!==e)return this._seekable.getSeekSeconds(e)}set shuffle(e){this._shuffler.shuffle=e}get shuffleMode(){return this._shuffler.shuffleMode}set shuffleMode(e){this._shuffler.shuffleMode=e}get storekit(){return this._storekit}set storekit(n){if(n){var d=this;n.addEventListener(Ue.authorizationStatusWillChange,function(){var n=_asyncToGenerator$C((function*({authorizationStatus:n,newAuthorizationStatus:p}){n>De.DENIED&&p<De.RESTRICTED?yield d.stop({endReasonType:e.PlayActivityEndReasonType.PLAYBACK_SUSPENDED,userInitiated:!1}):yield d.stop({userInitiated:!1})}));return function(e){return n.apply(this,arguments)}}()),this._storekit=n}}append(e){var n=this;return _asyncToGenerator$C((function*(){const d=yield n._dataForQueueOptions(e);return n._queueModifier.append(d),n.queue}))()}insertAt(e,n){var d=this;return _asyncToGenerator$C((function*(){const p=yield d._dataForQueueOptions(n);return d._queueModifier.insertAt(e,p),d.queue}))()}_dataForQueueOptions(e){var n=this;return _asyncToGenerator$C((function*(){const d=n.constructContext(e,n.context);return _objectSpreadProps$g(_objectSpread$m({},e),{context:d})}))()}clear(){var e=this;return _asyncToGenerator$C((function*(){return e._queueModifier.clear(),e.queue}))()}changeToMediaAtIndex(e=0){var n=this;return _asyncToGenerator$C((function*(){var d,p,h;yield n.stop();const y=null===(d=n.queue.item(e))||void 0===d?void 0:d.id,m=null===(p=n._mediaItemPlayback)||void 0===p||null===(h=p.playOptions)||void 0===h?void 0:h.get(y);let g=(null==m?void 0:m.startTime)||0;const b=yield n._changeToMediaAtIndex(e,{userInitiated:!0});b&&(b.id!==y&&(g=0),n._dispatcher.publish(hr.playbackPlay,{item:b,position:g}))}))()}changeToMediaItem(e){var n=this;return _asyncToGenerator$C((function*(){const d=n.queue.indexForItem(e);return-1===d?Promise.reject(new MKError(MKError.MEDIA_DESCRIPTOR)):n.changeToMediaAtIndex(d)}))()}activate(){Ut.debug("mk: base controller - activate"),this._dispatcher.unsubscribe(po.playbackStateDidChange,this.onPlaybackStateDidChange),this._dispatcher.subscribe(po.playbackStateDidChange,this.onPlaybackStateDidChange),this._skipIntro.activate(),this._upNext.activate(),this._rollMonitor.activate()}deactivate(){var e=this;return _asyncToGenerator$C((function*(){yield e.stop(),e._dispatcher.unsubscribe(po.playbackStateDidChange,e.onPlaybackStateDidChange),e._skipIntro.deactivate(),e._upNext.deactivate(),e._rollMonitor.deactivate()}))()}destroy(){var e=this;return _asyncToGenerator$C((function*(){yield e.deactivate(),e._dispatcher.unsubscribe(po.autoplayEnabledDidChange,e.updateAutoplay)}))()}hasCapabilities(e){switch(e){case $o.SEEK:return this._seekable.canSeek;case $o.REPEAT:return this._repeatable.canSetRepeatMode;case $o.SHUFFLE:return this._shuffler.canSetShuffleMode;case $o.EDIT_QUEUE:return this._queueModifier.canModifyQueue;case $o.PAUSE:case $o.SKIP_NEXT:case $o.SKIP_TO_ITEM:return!0;case $o.SKIP_PREVIOUS:default:return!1}}pause(e){var n=this;return _asyncToGenerator$C((function*(){return n._mediaItemPlayback.pause(e)}))()}play(){var e=this;return _asyncToGenerator$C((function*(){if(e.nowPlayingItem)return e._mediaItemPlayback.play();if(!e._queue||e._queue.isEmpty)return;if(e.nowPlayingItemIndex>=0)return e.changeToMediaAtIndex(e.nowPlayingItemIndex);const{queue:n}=e;if(-1!==n.nextPlayableItemIndex)return e.changeToMediaAtIndex(n.nextPlayableItemIndex);n.isRestricted&&n.items.every(e=>e.isRestricted)&&e._dispatcher.publish(po.mediaPlaybackError,new MKError(MKError.CONTENT_RESTRICTED,"Content restricted"))}))()}playSingleMediaItem(e,n){var d=this;return _asyncToGenerator$C((function*(){yield Ao(e,n),d._dispatcher.publish(po.queueItemsDidChange,[e]);const p=yield d._mediaItemPlayback.startMediaItemPlayback(e,!0);if(p){var h;const e={item:p,position:null!==(h=d._mediaItemPlayback.currentPlaybackTime)&&void 0!==h?h:0,playingDate:d._mediaItemPlayback.currentPlayingDate,userInitiated:!0};Ut.debug("playSingleMediaItem: Dispatching DispatchTypes.playbackPlay event",e),d._dispatcher.publish(hr.playbackPlay,e)}}))()}onPlaybackStateDidChange(n,d){var p=this;return _asyncToGenerator$C((function*(){d.state===e.PlaybackStates.ended&&(p.continuous||p.repeatMode===e.PlayerRepeatMode.one)&&(Ut.debug("controller detected track ended event, moving to next item."),p._dispatcher.publish(hr.applicationActivityIntent,{endReasonType:e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS,userInitiated:!1}),yield p._next())}))()}preload(){var e=this;return _asyncToGenerator$C((function*(){return e._mediaItemPlayback.preload()}))()}prepend(e,n){var d=this;return _asyncToGenerator$C((function*(){const p=yield d._dataForQueueOptions(e);return d._queueModifier.prepend(p,n),d.queue}))()}prepareToPlay(e){var n=this;return _asyncToGenerator$C((function*(){return n._mediaItemPlayback.prepareToPlay(e)}))()}showPlaybackTargetPicker(){this._mediaItemPlayback.showPlaybackTargetPicker()}seekBackward(){var e=this;return _asyncToGenerator$C((function*(){return e._seekable.seekBackward()}))()}seekForward(){var e=this;return _asyncToGenerator$C((function*(){return e._seekable.seekForward(e.skipToNextItem.bind(e))}))()}skipToNextItem(){var e=this;return _asyncToGenerator$C((function*(){return e._next({userInitiated:!0})}))()}getNewSeeker(){return this._mediaItemPlayback.getNewSeeker()}seekToTime(e,n){var d=this;return _asyncToGenerator$C((function*(){yield d._seekable.seekToTime(e,n)}))()}setQueue(e){var n=this;return _asyncToGenerator$C((function*(){return yield n.extractGlobalValues(e),yield n._mediaItemPlayback.stop(),n.returnQueueForOptions(e)}))()}extractGlobalValues(e){var n=this;return _asyncToGenerator$C((function*(){n._context=n.constructContext(e),void 0!==e.featureName&&e.context&&(Ut.warn("featureName is deprecated, pass it inside context"),e.context.featureName=e.featureName)}))()}stop(e){var n=this;return _asyncToGenerator$C((function*(){yield n._mediaItemPlayback.stop(e)}))()}_changeToMediaAtIndex(e=0,n={}){var d=this;return _asyncToGenerator$C((function*(){if(d.queue.isEmpty)return;d.queue.position=e;const p=d.queue.item(d.queue.position);if(!p)return;var h;const y=yield d._mediaItemPlayback.startMediaItemPlayback(p,null!==(h=n.userInitiated)&&void 0!==h&&h);if(y||p.state!==G.unsupported)return y;yield d.skipToNextItem()}))()}_next(e={}){var n=this;return _asyncToGenerator$C((function*(){return n._nextAtIndex(n.queue.nextPlayableItemIndex,e)}))()}_nextAtIndex(n,d={}){var p=this;return _asyncToGenerator$C((function*(){if(p.queue.isEmpty)return;const{_mediaItemPlayback:h}=p;var y;const m=null!==(y=d.userInitiated)&&void 0!==y&&y;if(n<0)return Ut.debug("controller/index._next no next item available, stopping playback"),yield p.stop({userInitiated:m,seamlessAudioTransition:d.seamlessAudioTransition}),void(h.playbackState=e.PlaybackStates.completed);const g=p.isPlaying,b=h.currentPlaybackTime,_=yield p._changeToMediaAtIndex(n,{userInitiated:m});var P;return p._notifySkip(g,_,{userInitiated:m,seamlessAudioTransition:null!==(P=d.seamlessAudioTransition)&&void 0!==P&&P,position:b,direction:e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS}),_}))()}_notifySkip(n,d,p){const{userInitiated:h,direction:y,position:m,seamlessAudioTransition:g=!1}=p,b=this._dispatcher;g?(Ut.debug("seamlessAudioTransition transition, PAF play"),b.publish(hr.playbackPlay,{item:d,position:0,endReasonType:e.PlayActivityEndReasonType.NATURAL_END_OF_TRACK})):n?d?b.publish(hr.playbackSkip,{item:d,userInitiated:h,direction:y,position:m}):b.publish(hr.playbackStop,{item:d,userInitiated:h,position:m}):d&&b.publish(hr.playbackPlay,_objectSpread$m({item:d,position:0},h?{endReasonType:e.PlayActivityEndReasonType.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM}:{}))}_prepareQueue(e){Ut.debug("mk: _prepareQueue"),this.hasAuthorization&&(e.isRestricted=this.storekit.restrictedEnabled||!1),e.repeatable=this._repeatable}constructor(e){var n;this._context={},this.onPlaybackStateDidChange=this.onPlaybackStateDidChange.bind(this),this._autoplayEnabled=null!==(n=null==e?void 0:e.autoplayEnabled)&&void 0!==n&&n,this._services=e.services,this._playerOptions=e,this.storekit=e.storekit,this._skipIntro=new SkipAvailable({controller:this,services:e.services}),this._upNext=new UpNextMonitor({controller:this,services:e.services}),this._rollMonitor=new RollMonitor({controller:this,services:e.services}),this._queueModifier=new BaseModifiableQueue,this._shuffler=new BaseShuffler,this._seekable=new BaseSeekable(this._mediaItemPlayback),this._repeatable=new BaseRepeatable,this._dispatcher.subscribe(po.autoplayEnabledDidChange,this.updateAutoplay)}}ss([Bind(),cs("design:type",Function),cs("design:paramtypes",[String,Boolean])],PlaybackController.prototype,"updateAutoplay",null);function rejectOnLast(){return Promise.reject("The last middleware in the stack should not call next")}function processMiddleware(e,...n){return e.length?function createNextFunction([e,...n]){return(...d)=>e(createNextFunction(n),...d)}([...e,rejectOnLast])(...n):Promise.reject("processMiddleware requires at mimimum one middleware function")}function parameterizeString(e,n){return function(e){try{return function recursiveTokenizeParameterizedString(e,n=[]){if(e.startsWith("{{")){const d=e.indexOf("}}");if(-1===d)throw new Error("UNCLOSED_PARAMETER");const p={type:us.Parameter,value:e.slice(2,d)};return d+2<e.length?recursiveTokenizeParameterizedString(e.slice(d+2),[...n,p]):[...n,p]}{const d=e.indexOf("{{");return-1===d?[...n,{type:us.Static,value:e}]:recursiveTokenizeParameterizedString(e.slice(d),[...n,{type:us.Static,value:e.slice(0,d)}])}}(e)}catch(Y){if("UNCLOSED_PARAMETER"===Y.message)throw new Error(`Unclosed parameter in path: "${e}"`);throw Y}}(e).map(e=>{switch(e.type){case us.Parameter:return e.value in n?encodeURIComponent(""+n[e.value]):`{{${e.value}}}`;case us.Static:default:return e.value}}).join("")}var us;function _defineProperty$l(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpreadProps$f(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}function constructUrlMiddleware(e,n){let d=n.url;return d||(d=addPathToURL(n.baseUrl,n.path)),n.urlParameters&&(d=parameterizeString(d,n.urlParameters)),n.queryParameters&&(d=addQueryParamsToURL(d,n.queryParameters)),e(_objectSpreadProps$f(function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$l(e,n,d[n])}))}return e}({},n),{url:d}))}function asyncGeneratorStep$B(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$B(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$B(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$B(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function unwrapJSONFromResponse(e){return _unwrapJSONFromResponse.apply(this,arguments)}function _unwrapJSONFromResponse(){return(_unwrapJSONFromResponse=_asyncToGenerator$B((function*(e){try{return yield e.json()}catch(Y){return}}))).apply(this,arguments)}function fetchMiddlewareFactory(e){return n=_asyncToGenerator$B((function*(n,d){const p=yield e(d.url,d.fetchOptions),h={request:d,response:p,data:yield unwrapJSONFromResponse(p)};if(!p.ok)throw MKError.responseError(p);return h})),function(e,d){return n.apply(this,arguments)};var n}!function(e){e[e.Static=0]="Static",e[e.Parameter=1]="Parameter"}(us||(us={}));const ds=fetchMiddlewareFactory("undefined"!=typeof fetch?fetch:()=>{throw new Error("window.fetch is not defined")});function _defineProperty$k(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$k(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$k(e,n,d[n])}))}return e}function _objectSpreadProps$e(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}var ps;!function(e){e.Replace="REPLACE",e.Merge="MERGE"}(ps||(ps={}));const hs=["url"];class APISession{get config(){return this._config}request(e,n={},d={}){var p;return processMiddleware(this.middlewareStack,_objectSpreadProps$e(_objectSpread$k({},this.config.defaultOptions,d),{baseUrl:this.config.url,path:e,fetchOptions:mergeFetchOptions(null===(p=this.config.defaultOptions)||void 0===p?void 0:p.fetchOptions,d.fetchOptions),queryParameters:_objectSpread$k({},this.config.defaultQueryParameters,n),urlParameters:_objectSpread$k({},this.config.defaultUrlParameters,d.urlParameters)}))}reconfigure(e,n=ps.Replace){n===ps.Merge&&(e=deepmerge(this.config,e)),hs.forEach(n=>{if(void 0===e[n])throw new Error(`Session requires a valid SessionConfig, missing "${n}"`)}),this._config=e,this.middlewareStack=this.createMiddlewareStack()}createMiddlewareStack(){return Array.isArray(this.config.middleware)?[constructUrlMiddleware,...this.config.middleware,this.makeFetchMiddleware()]:[constructUrlMiddleware,this.makeFetchMiddleware()]}makeFetchMiddleware(){return"function"==typeof this.config.fetchFunction?fetchMiddlewareFactory(this.config.fetchFunction):ds}constructor(e){this.reconfigure(e)}}function _objectWithoutProperties(e,n){if(null==e)return{};var d,p,h=function(e,n){if(null==e)return{};var d,p,h={},y=Object.keys(e);for(p=0;p<y.length;p++)d=y[p],n.indexOf(d)>=0||(h[d]=e[d]);return h}(e,n);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(p=0;p<y.length;p++)d=y[p],n.indexOf(d)>=0||Object.prototype.propertyIsEnumerable.call(e,d)&&(h[d]=e[d])}return h}const ys={music:{url:"https://api.music.apple.com"},apps:{url:"https://amp-api.apps.apple.com"},books:{url:"https://amp-api.books.apple.com"},fitness:{url:"https://amp-api.fitness.apple.com"}};ys.music={url:"https://amp-api.music.apple.com"},ys.videos={url:"https://amp-api.videos.apple.com"},ys.podcasts={url:"https://amp-api.podcasts.apple.com"};class MediaAPIV3{configure(e,n,d=ps.Merge){this.storefrontId=n.storefrontId;const p=function(e){let n={};e.url&&(n.url=e.url);e.storefrontId&&(n.defaultUrlParameters={storefrontId:e.storefrontId});e.mediaUserToken&&(n.defaultOptions={fetchOptions:{headers:{"Media-User-Token":e.mediaUserToken}}});e.developerToken&&(n=deepmerge(n,{defaultOptions:{fetchOptions:{headers:{Authorization:"Bearer "+e.developerToken}}}}));e.options&&(n=deepmerge(n,e.options));return n}(n);if(this[e])this[e].session.reconfigure(p,d);else{var h;const n=new APISession(p),d=n.request.bind(n);d.session=n;const y="undefined"!=typeof process&&"test"===(null===(h=process.env)||void 0===h?void 0:h.NODE_ENV);Object.defineProperty(this,e,{value:d,writable:y,enumerable:!0})}}constructor(e){const{realmConfig:n}=e,d=_objectWithoutProperties(e,["realmConfig"]);for(const p in ys){let e=deepmerge(ys[p],d);const h=null==n?void 0:n[p];h&&(e=deepmerge(e,h)),this.configure(p,e)}}}function asyncGeneratorStep$A(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}var fs,ms,gs={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},vs={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};class StationTrackLoader{activate(){this.dispatcher.unsubscribe(po.queuePositionDidChange,this.checkLoadMore),this.dispatcher.subscribe(po.queuePositionDidChange,this.checkLoadMore),this.isActive=!0}deactivate(){this.dispatcher.unsubscribe(po.queuePositionDidChange,this.checkLoadMore),this.isActive=!1}start(){return this.isActive||this.activate(),this.loadNextTracks()}checkLoadMore(){if(!(this.queue.isEmpty||this.queue.nextPlayableItemIndex>=0))return this.loadNextTracks()}loadNextTracks(){var e,n=this;return(e=function*(){let e=[];const{apiManager:d}=n;if((null==d?void 0:d.api)instanceof MediaAPIV3){var p;const h=yield d.api.music("v1/me/stations/next-tracks/"+n.station.id,void 0,{fetchOptions:{method:"POST"}});e=null==h||null===(p=h.data)||void 0===p?void 0:p.data}else{var h;const p={};var y;Do.features["enhanced-hls"]&&(p.extend={songs:["extendedAssetUrls"]}),e=null!==(y=yield null===(h=d.mediaAPI)||void 0===h?void 0:h.nextStationTracks(n.station.id,null,{queryParameters:p}))&&void 0!==y?y:[]}if(0===e.length)throw Ut.warn("No track data is available for the current station",{stationId:n.station.id}),new MKError(MKError.CONTENT_UNAVAILABLE,"No track data is available for the current station.");const m=descriptorToMediaItems({context:n.context,loaded:e,container:n.station});n.queue.splice(n.queue.length,0,m)},function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$A(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$A(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))})()}constructor(e,n,{dispatcher:d,apiManager:p},h={}){this.queue=e,this.station=n,this.context=h,this.isActive=!1,this.dispatcher=d,this.apiManager=p}}gs([Bind(),vs("design:type",Function),vs("design:paramtypes",[])],StationTrackLoader.prototype,"checkLoadMore",null),function(e){e.artist="artist",e.song="song",e.station="station",e.radioStation="radioStation"}(fs||(fs={})),function(e){e.BEATS1="beats1"}(ms||(ms={}));const isIdentityQueue=e=>e&&void 0!==e.identity;function asyncGeneratorStep$z(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$z(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$z(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$z(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$j(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}var bs={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},_s={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};const{queueIsReady:Ps}=po;class ContinuousPlaybackController extends PlaybackController{get continuous(){return!0}set continuous(e){if(!0!==e)throw new MKError(MKError.UNSUPPORTED_ERROR,"Continuous playback cannot be disabled for station queues.")}get context(){return function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$j(e,n,d[n])}))}return e}({featureName:mr.STATION},this._context)}get isLive(){return this._isLive}set isLive(e){e!==this._isLive&&(this._isLive=e,this._dispatcher.publish(po.capabilitiesChanged))}changeToMediaItem(e){var n=this;return _asyncToGenerator$z((function*(){n.generateMethodNotAvailable("changeToMediaItem")}))()}hasCapabilities(e){switch(e){case $o.PAUSE:case $o.SKIP_NEXT:return!this.isLive;case $o.SKIP_PREVIOUS:case $o.SKIP_TO_ITEM:return!1;default:return super.hasCapabilities(e)}}pause(e){var n=this,_superprop_get_pause=()=>super.pause;return _asyncToGenerator$z((function*(){if(!n.isLive)return _superprop_get_pause().call(n,e);n.generateMethodNotAvailable("pause")}))()}skipToPreviousItem(){var e=this;return _asyncToGenerator$z((function*(){e.generateMethodNotAvailable("skipToPreviousItem")}))()}_dataForQueueOptions(e){var n=this,_superprop_get__dataForQueueOptions=()=>super._dataForQueueOptions;return _asyncToGenerator$z((function*(){const d=yield _superprop_get__dataForQueueOptions().call(n,e);return n.isLive&&(d.loaded=n.station),d}))()}returnQueueForOptions(e){var n=this;return _asyncToGenerator$z((function*(){var d;const p=isIdentityQueue(e)?yield n.loadStationByIdentity(e.identity):yield n.loadStationByStationId(n.generateStationId(e));if(void 0===p)return Promise.reject(new MKError(MKError.UNSUPPORTED_ERROR,"Cannot load requested station"));n.station=p,n.isLive=isIdentityQueue(e)||!!(null==p?void 0:p.isLive)||!!(null==p||null===(d=p.attributes)||void 0===d?void 0:d.isLive);const h={services:{dispatcher:n._dispatcher},descriptor:yield n._dataForQueueOptions(e)};return n.queue=new Queue(h),n.isLive||(n.trackLoader=new StationTrackLoader(n.queue,p,{dispatcher:n._dispatcher,apiManager:n._services.apiManager},n.context),yield n.trackLoader.start()),n._seekable=n.isLive?new BaseSeekable(n._mediaItemPlayback):new Seekable(n._dispatcher,n._mediaItemPlayback),n._dispatcher.publish(Ps,n.queue.items),n.queue}))()}getNewSeeker(){return this.hasCapabilities($o.SEEK)?super.getNewSeeker():new UnsupportedSeeker}skipToNextItem(){var e=this,_superprop_get_skipToNextItem=()=>super.skipToNextItem;return _asyncToGenerator$z((function*(){if(!e.isLive)return _superprop_get_skipToNextItem().call(e);e.generateMethodNotAvailable("skipToNextItem")}))()}generateMethodNotAvailable(e){Ut.warn(e+" is not supported for this type of playback")}generateStationId(e){let n;if(isQueueURLOption(e)){const{contentId:d,kind:p,storefrontId:h}=formattedMediaURL(e.url);e[p]=d,xo.storefrontId=h,n=p}const d=e;if(d.artist)return"ra."+d.artist;if(d.song)return"ra."+d.song;if(d.station)return d.station;if(d.radioStation)return d.radioStation;throw new MKError(MKError.UNSUPPORTED_ERROR,n?n+" is not a supported option. Use setQueue instead.":"Unsupported options specified for setStationQueue. You may want setQueue instead.")}loadStationByIdentity(e){var n=this;return _asyncToGenerator$z((function*(){var d;const{apiManager:p}=n._services;if((null==p?void 0:p.api)instanceof MediaAPIV3){var h,y;const n=yield p.api.music("v1/catalog/{{storefrontId}}/stations",{filter:{identity:e}});return null==n||null===(h=n.data)||void 0===h||null===(y=h.data)||void 0===y?void 0:y[0]}const m=yield null==p||null===(d=p.mediaAPI)||void 0===d?void 0:d.stations(void 0,{filter:{identity:e}});return m&&m[0]}))()}loadStationByStationId(e){var n=this;return _asyncToGenerator$z((function*(){var d;const{apiManager:p}=n._services;if((null==p?void 0:p.api)instanceof MediaAPIV3){var h,y;const n=yield p.api.music("v1/catalog/{{storefrontId}}/stations/"+e);return null==n||null===(h=n.data)||void 0===h||null===(y=h.data)||void 0===y?void 0:y[0]}return null==p||null===(d=p.mediaAPI)||void 0===d?void 0:d.station(e)}))()}activate(){super.activate(),this.trackLoader&&this.trackLoader.activate()}deactivate(){var e=this,_superprop_get_deactivate=()=>super.deactivate;return _asyncToGenerator$z((function*(){yield _superprop_get_deactivate().call(e),e.trackLoader&&e.trackLoader.deactivate()}))()}constructor(e){super(e),this.type=as.continuous,this._isLive=!1,this._continuous=!0}}function asyncGeneratorStep$y(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}bs([Bind(),_s("design:type",Function),_s("design:paramtypes",[void 0===$o?Object:$o])],ContinuousPlaybackController.prototype,"hasCapabilities",null);var Ts={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},Ss={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};class PercentageWatcher{startMonitor(){this.dispatcher.unsubscribe(po.playbackDurationDidChange,this.updateThreshold),this.dispatcher.unsubscribe(po.playbackTimeDidChange,this.handleTimeChange),this.dispatcher.subscribe(po.playbackDurationDidChange,this.updateThreshold),this.dispatcher.subscribe(po.playbackTimeDidChange,this.handleTimeChange)}stopMonitor(){this.dispatcher.unsubscribe(po.playbackDurationDidChange,this.updateThreshold),this.dispatcher.unsubscribe(po.playbackTimeDidChange,this.handleTimeChange),this.threshold=-1}handleTimeChange(e,{currentPlaybackDuration:n,currentPlaybackTime:d}){var p,h=this;return(p=function*(){h.threshold<0&&h.updateThreshold(e,{duration:n}),d<h.threshold||(h.stopMonitor(),yield h.callback(d,h))},function(){var e=this,n=arguments;return new Promise((function(d,h){var y=p.apply(e,n);function _next(e){asyncGeneratorStep$y(y,d,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$y(y,d,h,_next,_throw,"throw",e)}_next(void 0)}))})()}updateThreshold(e,{duration:n}){this.threshold=n*this.percentage}constructor(e,n,d){this.dispatcher=e,this.callback=n,this.percentage=d,this.threshold=-1}}function asyncGeneratorStep$x(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}Ts([Bind(),Ss("design:type",Function),Ss("design:paramtypes",[void 0,void 0])],PercentageWatcher.prototype,"handleTimeChange",null),Ts([Bind(),Ss("design:type",Function),Ss("design:paramtypes",[void 0,void 0])],PercentageWatcher.prototype,"updateThreshold",null);class Preloader extends PlaybackMonitor{handlePlaybackThreshold(){var e,n=this;return(e=function*(){const e=n.getNextPlayableItem();e&&(yield n.playbackController.prepareToPlay(e,!0))},function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$x(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$x(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))})()}shouldMonitor(){if(!super.shouldMonitor())return!1;if(!this.playbackController.hasAuthorization||this.playbackController.previewOnly)return!1;const e=this.getNextPlayableItem(),n=void 0!==e;return this.isSeamlessAudioTransitionsEnabled?n:n&&!(null==e?void 0:e.isPreparedToPlay)}getNextPlayableItem(){return this.playbackController.queue.nextPlayableItem}constructor(e){super(e),this.isSeamlessAudioTransitionsEnabled=!1,this.watchers=[new PercentageWatcher(this.dispatcher,this.handlePlaybackThreshold,.3)],this.isSeamlessAudioTransitionsEnabled=Do.features["seamless-audio-transitions"]}}function dasherize(e){return e.replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()}function asyncGeneratorStep$w(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$w(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$w(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$w(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$i(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$i(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$i(e,n,d[n])}))}return e}function _objectSpreadProps$d(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}function loadRelationshipData(e,n,d){return _loadRelationshipData.apply(this,arguments)}function _loadRelationshipData(){return(_loadRelationshipData=_asyncToGenerator$w((function*(e,n,d,p={}){if(void 0===n)return d;void 0===p.limit&&(p.limit=100),void 0===p.offset&&(p.offset=0);const{relationship:h,method:y}=n,m=e[y].bind(e);let g;return isDataRecord(d)?(void 0===d[h]&&d.setProperty(h,[],"relationships"),g=d[h]):(d.relationships=d.relationships||{},void 0===d.relationships[h]&&Object.defineProperty(d.relationships,h,{value:{data:[]},enumerable:!0}),g=d.relationships[h].data),yield Es(m,[d.id,h,p],g),d}))).apply(this,arguments)}const Es=function(){var e=_asyncToGenerator$w((function*(e,n,d){const[p,h,y]=n,m=d.length;if(m>0&&m<y.limit+y.offset)return d;const g=_objectSpread$i({},y);let b;g.offset=m;try{b=yield e(p,h,g)}catch(Lr){return d}return d.push(...b),b.length<g.limit?d:Es(e,n,d)}));return function(n,d,p){return e.apply(this,arguments)}}(),getNamedQueueOptions=(e,n)=>{const d=[],p=e.namedQueueOptions;for(const h in n)Object.keys(p).includes(h)&&d.push([h,p[h]]);return d},ks=function(){var e=_asyncToGenerator$w((function*(e,n,d){const[p]=d,h=n[p];if(!Array.isArray(h))return loadSelectedQueueValue(e,n,d,h);const y=new Map;h.forEach(e=>{const n=e.indexOf("."),d=-1===n?"":e.substring(0,n);y.has(d)||y.set(d,[]);const p=y.get(d);p&&p.push(e)});const m=(yield Promise.all([...y.values()].map(p=>loadSelectedQueueValue(e,n,d,p)))).reduce((e,n)=>{var d;return(n=null!==(d=n.data)&&void 0!==d?d:n).forEach(n=>{e.set(n.id,n)}),e},new Map),g=[];return h.forEach(e=>{const n=m.get(e);n&&g.push(n)}),g}));return function(n,d,p){return e.apply(this,arguments)}}();function loadSelectedQueueValue(e,n,d,p){return _loadSelectedQueueValue.apply(this,arguments)}function _loadSelectedQueueValue(){return(_loadSelectedQueueValue=_asyncToGenerator$w((function*(e,n,d,p){const h=yield e.getAPIForItem(Array.isArray(p)?p[0]:p);return h instanceof MediaAPIV3?loadSelectedQueueValueV3(h,n,d,p):loadSelectedQueueValueV2(h,n,d,p)}))).apply(this,arguments)}function loadSelectedQueueValueV2(e,n,d,p){return _loadSelectedQueueValueV2.apply(this,arguments)}function _loadSelectedQueueValueV2(){return(_loadSelectedQueueValueV2=_asyncToGenerator$w((function*(e,n,d,p){const[,h]=d;let y=n.parameters;Do.features["enhanced-hls"]&&(y=_objectSpreadProps$d(_objectSpread$i({},y),{extend:{songs:["extendedAssetUrls"]}}));let m=yield e[h.apiMethod](p,y);return h.loadedQueueTransform&&(m=h.loadedQueueTransform(m)),Array.isArray(p)||(yield loadRelationshipData(e,h.relationshipMethod,m)),m}))).apply(this,arguments)}function loadSelectedQueueValueV3(e,n,d,p){return _loadSelectedQueueValueV3.apply(this,arguments)}function _loadSelectedQueueValueV3(){return(_loadSelectedQueueValueV3=_asyncToGenerator$w((function*(e,n,d,p){const[h]=d,y=Array.isArray(p),m=T(y?""+p[0]:""+p),g=/^(?:playlists?|albums?)$/i.test(h);let b=dasherize(h);b.endsWith("s")||(b+="s");let _=(m?"/v1/me/library":"/v1/catalog/{{storefrontId}}")+"/"+b;y||(_+="/{{id}}");const P={};y&&(P.ids=p),m&&g&&(P.include="tracks");const S=yield e.music(_,P,{urlParameters:{id:p}});return y?S.data.data:S.data.data[0]}))).apply(this,arguments)}function asyncGeneratorStep$v(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$v(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$v(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$v(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$h(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$h(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$h(e,n,d[n])}))}return e}function _objectSpreadProps$c(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}var ws={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},Os={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};const Is=["library-songs","songs"],isAutoplaySupportedForType=e=>Is.includes(e),normalizeTypeForAutoplay=(e,n)=>(T(e)&&!(null!=n?n:"").startsWith("library-")?"library-":"")+normalizeContentType(n);class AutoplayTrackLoader{activate(){this.isActive||(this.dispatcher.unsubscribe(po.queuePositionDidChange,this.onQueueChanged),this.dispatcher.subscribe(po.queuePositionDidChange,this.onQueueChanged),this.dispatcher.unsubscribe(po.repeatModeDidChange,this.onRepeatableChanged),this.dispatcher.subscribe(po.repeatModeDidChange,this.onRepeatableChanged),this.isActive=!0)}deactivate(){this.isActive&&(this.dispatcher.unsubscribe(po.queuePositionDidChange,this.onQueueChanged),this.dispatcher.unsubscribe(po.repeatModeDidChange,this.onRepeatableChanged),this.isActive=!1,this.station=void 0,this.queue.hasAutoplayStation=!1)}start(){if(!this.isActive)return this.activate(),this.loadNextTracks()}stop(){this.isActive&&(this.deactivate(),this.cleanupQueue())}onRepeatableChanged(){this.repeatable.repeatMode===e.PlayerRepeatMode.none?this.checkLoadMore():this.cleanupQueue()}onQueueChanged(){if(!(this.queue.nextPlayableItemIndex>=0))return this.checkLoadMore()}get api(){const e=this.apiManager.mediaAPI;var n;return null!==(n=null==e?void 0:e.v3)&&void 0!==n?n:e}checkLoadMore(){var e;const n=null!==(e=this.queue.unplayedAutoplayItems.length)&&void 0!==e?e:0,d=Do.autoplay.maxUpcomingTracksToMaintain;if(!(this.queue.isEmpty||this.queue.unplayedUserItems.length>Do.autoplay.maxQueueSizeForAutoplay))return n<d?this.loadNextTracks(d-n):this.loadNextTracks()}cleanupQueue(){this.queue.removeQueueItems((e,n)=>!(n<=this.queue.position)&&!!e.isAutoplay)}loadNextTracks(n=Do.autoplay.maxUpcomingTracksToMaintain){var d=this;return _asyncToGenerator$v((function*(){var p;if(d.repeatable.repeatMode!==e.PlayerRepeatMode.none)return;let h,{station:y}=d;if(d.station){try{var m;h=yield d.api.music("v1/me/stations/next-tracks/"+d.station.id,{limit:n},{fetchOptions:{method:"POST"}}),h=null==h||null===(m=h.data)||void 0===m?void 0:m.data}catch(Lr){return}if(!d.isActive)return}else{var g;const e=yield d.startStation(n);if(!e||!d.isActive)return void(d.queue.hasAutoplayStation=!1);y=d.station=e.station,d.queue.hasAutoplayStation=!0,h=e.tracks,(null==e||null===(g=e.tracks)||void 0===g?void 0:g.length)||Ut.warn("No track data is available for the current station",{stationId:null==y?void 0:y.id})}const b=descriptorToMediaItems({context:_objectSpreadProps$c(_objectSpread$h({},d.context),{featureName:"now_playing",reco_id:(null===(p=d.context.featureName)||void 0===p?void 0:p.startsWith("listen-now"))?void 0:d.context.reco_id}),loaded:h,container:y});d.queue.appendQueueItems(toQueueItems(b,{isAutoplay:!0}))}))()}startStation(e){var n=this;return _asyncToGenerator$v((function*(){const{userAddedItems:d}=n.queue;var p;const h=null!==(p=d[d.length-2])&&void 0!==p?p:d[d.length-1],y=null==h?void 0:h.container,m=y?{container:{id:y.id,type:y.type}}:void 0,g=n.queue.items.slice(-1*Do.autoplay.maxQueueSizeInRequest).reduce((e,{id:d,type:p})=>{const h=normalizeTypeForAutoplay(d,p);return isAutoplaySupportedForType(h)&&!n.errorIds.has(d)&&e.push({id:d,type:h,meta:m}),e},[]);if(0===g.length)return;const b={data:g};let _;try{var P;_=yield n.api.music("v1/me/stations/continuous",{"limit[results:tracks]":e,with:["tracks"]},{fetchOptions:{method:"POST",body:JSON.stringify(b,void 0,2)}}),_=null==_||null===(P=_.data)||void 0===P?void 0:P.results}catch(Lr){g.forEach(e=>n.errorIds.add(e.id))}return _}))()}constructor(e,n,{dispatcher:d,apiManager:p},h={}){this.queue=e,this.repeatable=n,this.context=h,this.isActive=!1,this.errorIds=new Set,this.dispatcher=d,this.apiManager=p}}function asyncGeneratorStep$u(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$u(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$u(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$u(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$g(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$g(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$g(e,n,d[n])}))}return e}function _objectSpreadProps$b(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}ws([Bind(),Os("design:type",Function),Os("design:paramtypes",[])],AutoplayTrackLoader.prototype,"onRepeatableChanged",null),ws([Bind(),Os("design:type",Function),Os("design:paramtypes",[])],AutoplayTrackLoader.prototype,"onQueueChanged",null),ws([(e,n,d)=>{const p=d.value,h="_singlePromise_"+n,y="undefined"!=typeof Symbol?Symbol(h):h;return d.value=function(...e){if(this[y])return this[y];const n=this[y]=p.apply(this,e),reset=()=>{this[y]=void 0};return n.then(reset,reset),n},d},Os("design:type",Function),Os("design:paramtypes",[Number])],AutoplayTrackLoader.prototype,"loadNextTracks",null);var As={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},Rs={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};const{queueIsReady:Cs}=po;var Ms,Ds;!function(e){e.album="album",e.musicVideo="musicVideo",e.playlist="playlist",e.song="song",e.episode="episode",e.podcast="podcast",e.uploadedAudio="uploadedAudio",e.uploadedVideo="uploadedVideo"}(Ms||(Ms={})),function(e){e.albums="albums",e.musicVideos="musicVideos",e.playlists="playlists",e.songs="songs",e.episodes="episodes",e.podcasts="podcasts",e.uploadedAudio="uploadedAudios",e.uploadedVideo="uploadedVideos"}(Ds||(Ds={}));class SerialPlaybackController extends PlaybackController{get autoplayEnabled(){return this._autoplayEnabled}set autoplayEnabled(e){var n;this._autoplayEnabled=e;const d=e?"start":"stop";null===(n=this._autoplayTrackLoader)||void 0===n||n[d]()}activate(){super.activate(),this._preloader.activate(),this._dispatcher.subscribe(Ka,this.onSeamlessAudioTransition),this._dispatcher.subscribe(po.repeatModeDidChange,this.onRepeatModeChange)}deactivate(){var e=this,_superprop_get_deactivate=()=>super.deactivate;return _asyncToGenerator$u((function*(){yield _superprop_get_deactivate().call(e),e._preloader.deactivate(),e._dispatcher.unsubscribe(Ka,e.onSeamlessAudioTransition),e._dispatcher.unsubscribe(po.repeatModeDidChange,e.onRepeatModeChange)}))()}onSeamlessAudioTransition(n,d){Ut.debug("controller handling seamless audio transition, PAF stop",d),this._next({userInitiated:!1,seamlessAudioTransition:!0,endReasonType:e.PlayActivityEndReasonType.NATURAL_END_OF_TRACK,position:d.previous.playbackDuration/1e3,isPlaying:!1})}hasCapabilities(e){var n,d,p;return e===$o.SKIP_PREVIOUS||(e!==$o.REPEAT&&e!==$o.SHUFFLE||!(null===(n=this.queue)||void 0===n||null===(d=n.currentQueueItem)||void 0===d?void 0:d.isAutoplay))&&((e!==$o.SEEK&&e!==$o.PAUSE||!(null===(p=this.nowPlayingItem)||void 0===p?void 0:p.isAssetScrubbingDisabled))&&super.hasCapabilities(e))}onRepeatModeChange(){var e;this.queue.nextPlayableItem&&(Ut.info("SerialPlaybackController: preparing new item after RepeatMode change",null===(e=this.queue.nextPlayableItem)||void 0===e?void 0:e.title),this.prepareToPlay(this.queue.nextPlayableItem,!0))}prepareToPlay(n,d=!1){var p=this;return _asyncToGenerator$u((function*(){if(Ut.debug("mk: SerialController - prepareToPlay - ",{item:n,preload:d}),n.isPlayable)return p._mediaItemPlayback.prepareToPlay(n).catch(n=>{const h=!d&&-1===[MKError.DEVICE_LIMIT,MKError.STREAM_UPSELL].indexOf(n.errorCode);if(p.continuous&&h)return p._dispatcher.publish(hr.applicationActivityIntent,{endReasonType:e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS,userInitiated:!1}),p._next();throw n})}))()}prepend(e,n){var d=this,_superprop_get_prepend=()=>super.prepend;return _asyncToGenerator$u((function*(){const p=yield _superprop_get_prepend().call(d,e,n);if(d.shouldTransitionSeamlessly){const e=d.queue,n=e.position,p=e.item(n+1);Ut.debug("prepend preparing ",p.title),yield d._mediaItemPlayback.prepareToPlay(p)}return p}))()}returnQueueForOptions(e){var n=this;return _asyncToGenerator$u((function*(){void 0!==(e=parseQueueURLOption(e)).startPosition&&(deprecationWarning("startPosition",{message:"startPosition has been deprecated in favor of startWith"}),void 0===e.startWith&&(e.startWith=e.startPosition));const d=yield n._dataForQueueOptions(e),p={services:{dispatcher:n._dispatcher,mediaItemPlayback:n._mediaItemPlayback},descriptor:d};if(void 0!==e.shuffleMode&&(n.shuffleMode=e.shuffleMode),n.queue=new Queue(p),"number"==typeof e.startTime){const d=n.queue.nextPlayableItem;d&&n._mediaItemPlayback.playOptions.set(d.id,{startTime:e.startTime})}if(0===n.queue.length)throw Ut.warn("No item data is available for the current media queue",e),new MKError(MKError.CONTENT_UNAVAILABLE,"No item data is available for the current media queue.");return n._autoplayTrackLoader&&n._autoplayTrackLoader.deactivate(),n._autoplayTrackLoader=new AutoplayTrackLoader(n.queue,n._repeatable,{dispatcher:n._dispatcher,apiManager:n._services.apiManager},n._context),n.autoplayEnabled&&n._autoplayTrackLoader.start(),n._dispatcher.publish(Cs,n.queue.items),n.queue}))()}skipToPreviousItem(){var e=this;return _asyncToGenerator$u((function*(){return e._previous({userInitiated:!0})}))()}_dataForQueueOptions(e){var n=this,_superprop_get__dataForQueueOptions=()=>super._dataForQueueOptions;return _asyncToGenerator$u((function*(){var d;const p=e,h=((e,n)=>{const d=getNamedQueueOptions(e,n);if(d.length>1)throw new MKError(MKError.UNSUPPORTED_ERROR,"Queues with multiple media types are not supported.");if(0===d.length)return;const[p]=d,[h,y]=p;if(Array.isArray(n[h])!==y.isPlural)throw new MKError(MKError.UNSUPPORTED_ERROR,y.isPlural?`Queue option ${h} must be an array of id values`:`Queue option ${h} must be a single id value`);return p})(n._services.apiManager.apiService,e);return void 0===h||((null===(d=n.storekit)||void 0===d?void 0:d.restrictedEnabled)&&(e.parameters=_objectSpreadProps$b(_objectSpread$g({},e.parameters),{restrict:"explicit"})),p.loaded=yield ks(n._services.apiManager.apiService,e,h)),_objectSpread$g({},yield _superprop_get__dataForQueueOptions().call(n,e),p)}))()}_changeToMediaAtIndex(e=0,n={userInitiated:!1}){var d=this,_superprop_get__changeToMediaAtIndex=()=>super._changeToMediaAtIndex;return _asyncToGenerator$u((function*(){const p=yield _superprop_get__changeToMediaAtIndex().call(d,e,n),h=d.queue.nextPlayableItem;return h&&d.shouldTransitionSeamlessly&&(yield d.prepareToPlay(h)),p}))()}_next(n={}){var d=this;return _asyncToGenerator$u((function*(){if(d.queue.isEmpty)return;const{userInitiated:p=!1}=n;return d.repeatMode===e.PlayerRepeatMode.one&&void 0!==d.queue.currentItem?(yield d.stop(_objectSpread$g({userInitiated:p},n)),void(yield d.play())):(!p&&n.seamlessAudioTransition&&(d._dispatcher.publish(hr.playbackStop,_objectSpread$g({userInitiated:p,endReasonType:e.PlayActivityEndReasonType.NATURAL_END_OF_TRACK},n)),n={userInitiated:n.userInitiated,seamlessAudioTransition:!0}),d._nextAtIndex(d.queue.nextPlayableItemIndex,n))}))()}_previous(n={}){var d=this;return _asyncToGenerator$u((function*(){if(d.queue.isEmpty)return;const{userInitiated:p=!1}=n;if(d.repeatMode===e.PlayerRepeatMode.one&&void 0!==d.queue.currentItem)return yield d.stop({endReasonType:e.PlayActivityEndReasonType.TRACK_SKIPPED_BACKWARDS,userInitiated:p}),void(yield d.play());const h=d.queue.previousPlayableItemIndex;if(p&&d.repeatMode===e.PlayerRepeatMode.none&&void 0!==d.nowPlayingItem&&-1===h)return yield d.stop({endReasonType:e.PlayActivityEndReasonType.TRACK_SKIPPED_BACKWARDS,userInitiated:!0}),void(yield d.play());if(-1===h)return;const y=d.isPlaying,m=d._mediaItemPlayback.currentPlaybackTime,g=yield d._changeToMediaAtIndex(h,{userInitiated:p});return d._notifySkip(y,g,{userInitiated:p,seamlessAudioTransition:!1,direction:e.PlayActivityEndReasonType.TRACK_SKIPPED_BACKWARDS,position:m}),g}))()}_prepareQueue(e){super._prepareQueue(e),this._shuffler.checkAndReshuffle()}get shouldTransitionSeamlessly(){return this._isSeamlessAudioTransitionsEnabled&&this.hasAuthorization&&!this.previewOnly}constructor(e){var n;super(e),this.type=as.serial,this._queue=new Queue(e),this._repeatable=new Repeatable(this._dispatcher),this._seekable=new Seekable(this._dispatcher,this._mediaItemPlayback),this._shuffler=new Shuffler(this,{dispatcher:this._dispatcher}),this._queueModifier=new ModifiableQueue(this._queue,this._mediaItemPlayback),this._isSeamlessAudioTransitionsEnabled=!!(null==e||null===(n=e.bag)||void 0===n?void 0:n.features["seamless-audio-transitions"]);const d={controller:this,services:e.services};this._preloader=new Preloader(d)}}As([Bind(),Rs("design:type",Function),Rs("design:paramtypes",[void 0,void 0])],SerialPlaybackController.prototype,"onSeamlessAudioTransition",null),As([Bind(),Rs("design:type",Function),Rs("design:paramtypes",[void 0===$o?Object:$o])],SerialPlaybackController.prototype,"hasCapabilities",null),As([Bind(),Rs("design:type",Function),Rs("design:paramtypes",[])],SerialPlaybackController.prototype,"onRepeatModeChange",null);class MKDialog{static presentError(e){const n=e.dialog;void 0!==n?MKDialog.serverDialog(n).present():new MKDialog(e.message).present()}static serverDialog(e){const n=new this(e.message,e.explanation);return e.okButtonAction&&e.okButtonAction.url&&(n._okButtonActionURL=e.okButtonAction.url),e.okButtonString&&(n._okButtonString=e.okButtonString),e.cancelButtonString&&(n._cancelButtonString=e.cancelButtonString),n}static clientDialog(e){const n=new this(e.message,e.explanation);return e.okButtonAction&&(n._okButtonAction=e.okButtonAction),e.cancelButtonAction&&(n._cancelButtonAction=e.cancelButtonAction),e.okButtonString&&(n._okButtonString=e.okButtonString),e.cancelButtonString&&(n._cancelButtonString=e.cancelButtonString),n}get actions(){return this.cancelButton?`<div id="mk-dialog-actions">${this.cancelButton}${this.okButton}</div>`:`<div id="mk-dialog-actions">${this.okButton}</div>`}get cancelButton(){if("string"==typeof this._cancelButtonString)return`<button type="button">${this._cancelButtonString}</button>`}set cancelButton(e){this._cancelButtonString=e}get explanation(){return`<p id="mk-dialog-explanation">${this._explanation}</p>`}get hasOKButtonAction(){return!!this._okButtonActionURL||!!this._okButtonAction}get message(){return`<h5 id="mk-dialog-title">${this._message}</h5>`}get okButton(){return this.hasOKButtonAction&&this._okButtonActionURL?`<button type="button" data-ok-action-url='${this._okButtonActionURL}'>${this._okButtonString}</button>`:`<button type="button">${this._okButtonString}</button>`}present(){const e=document.createDocumentFragment(),n=document.createElement("div");n.id=this.scrimId,e.appendChild(n);const d=document.createElement("div");d.id=this.id,d.classList.add("mk-dialog"),d.setAttribute("role","alertDialog"),d.setAttribute("aria-modal","true"),d.setAttribute("aria-labeledby","mk-dialog-title"),d.setAttribute("aria-describedby","mk-dialog-explanation");let p=`\n      <div id="mk-dialog-body">\n        ${this.message}\n        ${this.explanation}\n      </div>`;p=`\n      ${p}\n      ${this.actions}\n    `,d.innerHTML=p,e.appendChild(d),document.body.appendChild(e),document.querySelector(`#${d.id} #mk-dialog-actions *:first-child`).focus(),setTimeout(()=>{document.querySelector(`#${d.id} #mk-dialog-actions *:first-child`).addEventListener("click",()=>{this._cancelButtonAction&&this._cancelButtonAction(),d.parentElement.removeChild(d),n.parentElement.removeChild(n)}),this.hasOKButtonAction&&(this._okButtonActionURL?document.querySelector(`#${d.id} #mk-dialog-actions *:last-child`).addEventListener("click",e=>{window.open(e.target.dataset.okActionUrl,"_blank"),d.parentElement.removeChild(d),n.parentElement.removeChild(n)}):this._okButtonAction&&document.querySelector(`#${d.id} #mk-dialog-actions *:last-child`).addEventListener("click",e=>{this._okButtonAction(),d.parentElement.removeChild(d),n.parentElement.removeChild(n)}))})}_appendStyle(e){const n=document.createElement("style");n.id=this.styleId,n.styleSheet?n.styleSheet.cssText=e:n.innerHTML=e,document.body.appendChild(n)}constructor(e,n=""){this._message=e,this._explanation=n,this.id="musickit-dialog",this.scrimId=this.id+"-scrim",this.styleId=this.id+"-style",this._okButtonString="OK",[this.id,this.scrimId,this.styleId].forEach(e=>{try{const n=document.getElementById(e);n.parentElement.removeChild(n)}catch(Lr){}}),this._appendStyle("\n#musickit-dialog {\n  --mk-dialog-background: rgba(255, 255, 255, 1);\n  --mk-dialog-text: rgba(0, 0, 0, 0.95);\n  --mk-dialog-border: rgba(0, 0, 0, 0.07);\n  --mk-dialog-scrim: rgba(255, 255, 255, 0.8);\n  --mk-dialog-primary: rgba(0, 122, 255, 1);\n}\n\n@media (prefers-color-scheme: dark) {\n  #musickit-dialog {\n      --mk-dialog-background: rgba(30, 30, 30, 1);\n      --mk-dialog-text: rgba(255, 255, 255, 0.85);\n      --mk-dialog-border: rgba(255, 255, 255, 0.1);\n      --mk-dialog-scrim: rgba(38, 38, 38, 0.8);\n      --mk-dialog-primary: rgba(8, 132, 255, 1);\n  }\n}\n\n#musickit-dialog-scrim {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.35);\n}\n\n#musickit-dialog * {\n  -webkit-tap-highlight-color: transparent;\n  -webkit-touch-callout: none;\n  -ms-touch-action: none;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  font-family: -apple-system, SF UI Text, Helvetica Neue, Helvetica, sans-serif;\n  font-size: 15px;\n  line-height: 20px;\n}\n\n#musickit-dialog *:focus { outline: 0; }\n\n#musickit-dialog {\n  display: -webkit-box;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: column;\n  -moz-flex-direction: column;\n  flex-direction: column;\n  -webkit-justify-content: space-between;\n  -moz-justify-content: space-between;\n  justify-content: space-between;\n  min-width: 277px;\n  max-width: 290px;\n  min-height: 109px;\n  background: var(--mk-dialog-background);\n  box-shadow: 0px 0px 9px rgba(0, 0, 0, 0.18);\n  border-radius: 10px;\n  color: var(--mk-dialog-text);\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  margin-left: -142px;\n  margin-top: -67px;\n  z-index: 9999999999999999999999999;\n}\n\n#musickit-dialog #mk-dialog-body {\n  display: -webkit-box;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: column;\n  -moz-flex-direction: column;\n  flex-direction: column;\n  flex-grow: 1;\n  -webkit-justify-content: space-evenly;\n  -moz-justify-content: space-evenly;\n  justify-content: space-evenly;\n  -webkit-align-items: stretch;\n  align-items: stretch;\n  padding: 10px 20px;\n  min-height: 74px;\n  text-align: center;\n}\n\n#musickit-dialog .mk-dialog h5 {\n  font-weight: 500;\n  line-height: 20px;\n  margin: 7px 0 0 0;\n  padding: 0;\n}\n\n#musickit-dialog .mk-dialog p {\n  margin: 0 0 7px 0;\n  padding: 0;\n  paddin-top: 3px;\n  line-height: 18px;\n  font-size: 13px;\n  font-weight: 300;\n}\n\n#musickit-dialog #mk-dialog-actions {\n  border-top: 1px solid var(--mk-dialog-border);\n  display: -webkit-box;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: row;\n  -moz-flex-direction: colrowumn;\n  flex-direction: row;\n  max-height: 41px;\n  min-height: 34px;\n  -webkit-justify-self: flex-end;\n  -moz-justify-self: flex-end;\n  justify-self: flex-end;\n}\n\n#musickit-dialog #mk-dialog-actions button {\n  flex-grow: 1;\n  border: 0;\n  background: none;\n  color: var(--mk-dialog-primary);\n  padding: 0;\n  margin: 0;\n  min-height: 34px;\n  height: 41px;\n  text-align: center;\n}\n\n#musickit-dialog #mk-dialog-actions *:nth-child(2) {\n  border-left: 1px solid var(--mk-dialog-border);\n  font-weight: 500;\n}\n")}}var js;function asyncGeneratorStep$t(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}!function(e){e.MEDIA_API="media-api",e.UTS_CLIENT="uts-client"}(js||(js={}));class APIServiceManager{get api(){return this.getApiByType(this._defaultAPI)}get apiService(){if(void 0!==this._defaultAPI)return this._apisByType[this._defaultAPI];Ut.error("There is no API instance configured")}get mediaAPI(){return this.getApiByType(js.MEDIA_API)}get utsClient(){return this.getApiByType(js.UTS_CLIENT)}getApiByType(e){let n;if(void 0!==e&&(n=this._apisByType[e]),void 0===n||void 0===n.api)throw new MKError(MKError.CONFIGURATION_ERROR,"There is no API instance configured for the requested type: "+e);return n.api}set defaultApiType(e){this._defaultAPI=e}registerAPIService(e){var n,d=this;return(n=function*(){const{apiType:n,configureFn:p,options:h}=e,y=h.apiOptions||{};void 0===d._defaultAPI&&(d._defaultAPI=n),d._apisByType[n]=yield p.call(d,{apiOptions:y,store:d.store,dispatcher:d._dispatcher})},function(){var e=this,d=arguments;return new Promise((function(p,h){var y=n.apply(e,d);function _next(e){asyncGeneratorStep$t(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$t(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))})()}constructor(e,n){this.store=e,this._dispatcher=n,this._apisByType={}}}const xs={};function adaptAddEventListener(e,n,d,p={}){const{once:h}=p,y=function(e,n){const d=getCallbacksForName(e),wrappedCallback=(e,d)=>{n(d)};return d.push([n,wrappedCallback]),wrappedCallback}(n,d);!0===h?e.subscribeOnce(n,y):e.subscribe(n,y)}function getCallbacksForName(e){let n=xs[e];return n||(n=[],xs[e]=n),n}function asyncGeneratorStep$s(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$s(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$s(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$s(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}const $s=Ut.createChild("rtc");class RTCStreamingTracker{configure(e,n){var d=this;return _asyncToGenerator$s((function*(){d.instance=e}))()}handleEvent(e,n,d){}loadScript(){return _asyncToGenerator$s((function*(){if(!Do.urls.rtc)throw new Error("bag.urls.rtc is not configured");yield loadScript(Do.urls.rtc)}))()}prepareReportingAgent(e){this.clearReportingAgent();const n=e||this.instance.nowPlayingItem,d=n?n.defaultPlayable:void 0,{Sender:p,ClientName:h,ServiceName:y,ApplicationName:m,ReportingStoreBag:g,DeviceName:b}=window.rtc.RTCReportingAgentConfigKeys,_={firmwareVersion:this.generateBrowserVersion(),model:this.options.browserName};var P;d?((null===(P=d.mediaMetrics)||void 0===P?void 0:P.MediaIdentifier)&&(_.MediaIdentifier=d.mediaMetrics.MediaIdentifier),d.channelId&&(_.ContentProvider=d.channelId)):"musicVideo"===(null==e?void 0:e.type)?_.MediaIdentifier="adamid="+e.id:(null==e?void 0:e.isLiveVideoStation)&&(_.MediaIdentifier="raid="+e.id);void 0===this._storeBag&&(this._storeBag=this.generateStoreBag());const T={[p]:"HLSJS",[h]:this.options.clientName,[y]:this.options.serviceName,[m]:this.options.applicationName,[g]:this._storeBag,[b]:this.options.osVersion,userInfoDict:_};return $s.debug("RTC: creating reporting agent with config",T),this.reportingAgent=new window.rtc.RTCReportingAgent(T),$s.debug("RTC: created reporting agent",this.reportingAgent),this.reportingAgent}cleanup(){var e=this;return _asyncToGenerator$s((function*(){e.clearReportingAgent()}))()}clearReportingAgent(){void 0!==this.reportingAgent&&(this.reportingAgent.destroy(),$s.debug("RTC: called destroy on reporting agent",this.reportingAgent),this.reportingAgent=void 0)}generateBrowserVersion(){return this.options.browserMajorVersion?`${this.options.browserMajorVersion}.${this.options.browserMinorVersion||0}`:"unknown"}generateStoreBag(){var e;const{storeBagURL:n,clientName:d,applicationName:p,serviceName:h,browserName:y}=this.options,m={iTunesAppVersion:`${`${Do.app.name}-${Do.app.build}`}/${null===(e=this.instance)||void 0===e?void 0:e.version}`},g=new window.rtc.RTCStorebag.RTCReportingStoreBag(n,d,h,p,y,m);return $s.debug("RTC: created store bag",g),g}constructor(e){this.requestedEvents=[],this.options=e}}function asyncGeneratorStep$r(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _defineProperty$f(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}var Ls={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},Ns={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};class PlayActivityService{cleanup(){this.trackers.forEach(e=>{var n;return null===(n=e.cleanup)||void 0===n?void 0:n.call(e)}),this.clearIntention(),this.teardownListeners(),this.registeredEvents.clear()}configure(e,n){var d,p=this;return(d=function*(){p.cleanup(),p.registeredEvents=function(e){const n=[];for(const d of e)n.push(...d.requestedEvents);return new Set(n)}(p.trackers),p.setupListeners();try{yield Promise.all(p.trackers.map(d=>d.configure(e,n)))}catch(Lr){Ut.error("Error configuring a play activity service",Lr)}},function(){var e=this,n=arguments;return new Promise((function(p,h){var y=d.apply(e,n);function _next(e){asyncGeneratorStep$r(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$r(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))})()}getTrackerByType(e){return this.trackers.find(n=>n instanceof e)}handleEvent(e,n={}){const d=this.addIntention(e,n);e===hr.playerActivate&&(d.flush="boolean"==typeof n.isPlaying?!n.isPlaying:void 0);for(const p of this.trackers)p.handleEvent(e,d,n.item)}addIntention(e,n){if(![hr.playbackPause,hr.playbackStop].includes(e))return n;const d=function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$f(e,n,d[n])}))}return e}({},this.lastUserIntent,this.lastApplicationIntent,n);return this.clearIntention(),d}clearIntention(){this.lastUserIntent=void 0,this.lastApplicationIntent=void 0}recordApplicationIntent(e,n){this.lastApplicationIntent=n}recordUserIntent(e,n){this.lastUserIntent=n}setupListeners(){this.registeredEvents.forEach(e=>{this.dispatcher.subscribe(e,this.handleEvent)}),this.dispatcher.subscribe(hr.userActivityIntent,this.recordUserIntent),this.dispatcher.subscribe(hr.applicationActivityIntent,this.recordApplicationIntent)}teardownListeners(){this.registeredEvents.forEach(e=>{this.dispatcher.unsubscribe(e,this.handleEvent)}),this.dispatcher.unsubscribe(hr.userActivityIntent,this.recordUserIntent),this.dispatcher.unsubscribe(hr.applicationActivityIntent,this.recordApplicationIntent)}constructor(e,n){this.dispatcher=e,this.trackers=n,this.registeredEvents=new Set}}function asyncGeneratorStep$q(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$q(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$q(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$q(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}Ls([Bind(),Ns("design:type",Function),Ns("design:paramtypes",[String,Object])],PlayActivityService.prototype,"handleEvent",null),Ls([Bind(),Ns("design:type",Function),Ns("design:paramtypes",[String,"undefined"==typeof ActivityIntention?Object:ActivityIntention])],PlayActivityService.prototype,"recordApplicationIntent",null),Ls([Bind(),Ns("design:type",Function),Ns("design:paramtypes",[String,"undefined"==typeof ActivityIntention?Object:ActivityIntention])],PlayActivityService.prototype,"recordUserIntent",null);const Us=BooleanDevFlag.register("mk-force-safari-hlsjs");function useNativeSafariPlayback(){return!Us.enabled}function requiresHlsJs(e){return _requiresHlsJs.apply(this,arguments)}function _requiresHlsJs(){return(_requiresHlsJs=_asyncToGenerator$q((function*(e){const n=null!=e?e:yield findKeySystemPreference(),d=!useNativeSafariPlayback();return n!==Wt.FAIRPLAY||d}))).apply(this,arguments)}function asyncGeneratorStep$p(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _defineProperty$e(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpreadProps$a(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}const Gs=function(){var e,n=(e=function*(e,n,d){const p=new Headers({Authorization:"Bearer "+n,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+d}),h=urlEncodeParameters(_objectSpreadProps$a(function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$e(e,n,d[n])}))}return e}({},e.playParams),{keyFormat:"web"})),y=`${Do.urls.mediaApi}/play/assets?${h}`,m=yield fetch(y,{method:"GET",headers:p});if(500===m.status){const n=new MKError(MKError.SERVER_ERROR);throw n.data=e,n}if(403===m.status){let n;try{var g;n=yield m.json(),n=null==n||null===(g=n.errors)||void 0===g?void 0:g[0]}catch(Lr){}const d="40303"===(null==n?void 0:n.code)?MKError.SUBSCRIPTION_ERROR:MKError.ACCESS_DENIED;var b;const p=new MKError(d,null!==(b=null==n?void 0:n.title)&&void 0!==b?b:null==n?void 0:n.detail);throw p.data=e,p}if(!m.ok){const n=new MKError(MKError.CONTENT_UNAVAILABLE);throw n.data=e,n}const _=(yield m.json()).results;return Ut.debug(`media-item: loaded data from ${y}: ${JSON.stringify(_)}`),_},function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$p(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$p(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))});return function(e,d,p){return n.apply(this,arguments)}}();function asyncGeneratorStep$o(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$o(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$o(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$o(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}const Bs=function(){var e=_asyncToGenerator$o((function*(e,n,d){e.hasOffersHlsUrl?yield Fs(e):e.isLiveRadioStation?yield Ks(e,n,d):yield Hs(e,n,d)}));return function(n,d,p){return e.apply(this,arguments)}}(),Fs=function(){var e=_asyncToGenerator$o((function*(e){const n=Do.urls.hlsOffersKeyUrls;if(!n)throw new MKError(MKError.CONTENT_UNSUPPORTED,"HLS OFFERS");e.updateWithLoadedKeys(n),yield Vs(e,e.offersHlsUrl)}));return function(n){return e.apply(this,arguments)}}(),Ks=function(){var e=_asyncToGenerator$o((function*(e,n,d){if(!Do.features["playready-live-radio"]&&ir===Wt.PLAYREADY&&"video"!==e.attributes.mediaKind&&!Do.features["mse-live-radio"])throw new MKError(MKError.CONTENT_UNSUPPORTED,"LIVE_RADIO");const p=(yield Gs(e,n,d)).assets[0];e.updateWithLoadedKeys({"hls-key-cert-url":p.fairPlayKeyCertificateUrl,"hls-key-server-url":p.keyServerUrl,"widevine-cert-url":p.widevineKeyCertificateUrl}),filterUnavailableLiveRadioUrls(p,e),e.isLiveVideoStation?e.assetURL=p.url:yield Vs(e,p.url)}));return function(n,d,p){return e.apply(this,arguments)}}(),Vs=function(){var e=_asyncToGenerator$o((function*(e,n){let d;try{d=yield fetch(n)}catch(Lr){throw makeContentUnavailableError(e)}const p=yield d.text();extractAssetsFromMasterManifest(p,n,e)}));return function(n,d){return e.apply(this,arguments)}}(),extractAssetsFromMasterManifest=(e,n,d)=>{const p=/^#EXT-X-STREAM-INF:.*BANDWIDTH=(\d+),CODECS="(.*)"\s*\n(.*$)/gim;let h;for(;h=p.exec(e);){let[e,p,y,m]=h;/^http(s)?:\/\//.test(m)||(m=rewriteLastUrlPath(n,m)),d.assets.push({bandwidth:Number(p),codec:y,URL:m})}},filterUnavailableLiveRadioUrls=(e,n)=>{const d=new URL(e.url);if(!d.host.endsWith(".apple.com")&&!d.host.endsWith(".applemusic.com"))throw makeContentUnavailableError(n)},makeContentUnavailableError=e=>{const n=new MKError(MKError.CONTENT_UNAVAILABLE);return n.data=e,n},Hs=function(){var e=_asyncToGenerator$o((function*(e,n,d){if(Ut.debug("mk: loadWithMZPlay",e.playParams),"podcast-episodes"===e.type)return void(e.assetURL=e.attributes.assetUrl);if(!(yield hasMusicSubscription()))return;const p=e.playParams.id,h=new Headers({Authorization:"Bearer "+n,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+d});let y={salableAdamId:p};if(e.isCloudItem){y={},e.playParams.purchasedId&&(y.purchaseAdamId=e.playParams.purchasedId),e.playParams.catalogId&&(y.subscriptionAdamId=e.playParams.catalogId);const n=/^a\.(\d+)$/;n.test(p)?y.subscriptionAdamId=p.replace(n,"$1"):T(p)&&(y.universalLibraryId=p)}if(!Do.urls.webPlayback)throw new Error("bag.urls.webPlayback is not configured");const m=yield fetch(Do.urls.webPlayback,{method:"POST",body:JSON.stringify(y),headers:h}),g=yield m.text(),b=JSON.parse(g);if(!b||!b.songList){const n=MKError.serverError(b,MKError.UNSUPPORTED_ERROR);return e.updateFromLoadError(n),Ut.debug("mk: prepareItemWithMZPlay - rejecting with error",n),Promise.reject(n)}const[_]=b.songList;e.updateFromSongList(_)}));return function(n,d,p){return e.apply(this,arguments)}}();function asyncGeneratorStep$n(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$n(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$n(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$n(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function prepareToPlayMediaItem(e,n){return _prepareToPlayMediaItem.apply(this,arguments)}function _prepareToPlayMediaItem(){return(_prepareToPlayMediaItem=_asyncToGenerator$n((function*(e,n){const{developerToken:d,userToken:p}=e.store;if(void 0===d||void 0===p)return Promise.reject(new MKError(MKError.AUTHORIZATION_ERROR,"Unable to prepare media item for play."));if(n.isPreparedToPlay)Ut.warn("media-item: item is prepared to play");else{if(Ut.debug("media-item: item.prepareToPlay playParams",n.playParams),n.state=G.loading,n.isUTS)return Promise.reject(new MKError(MKError.UNSUPPORTED_ERROR,"Item was not prepared to play"));yield Bs(n,d,p)}}))).apply(this,arguments)}function _shouldPlayPreview(){return(_shouldPlayPreview=_asyncToGenerator$n((function*(e,n){return!!e.previewURL&&(!!n||!e.playRawAssetURL&&(!e.isUTS&&!(yield hasMusicSubscription())||(!hasAuthorization()||!e.isPlayable||(e.isUTS?"Preview"===e.type:!supportsDrm()))))}))).apply(this,arguments)}function _prepareForEncryptedPlayback(){return(_prepareForEncryptedPlayback=_asyncToGenerator$n((function*(e,n,d){if(Ut.debug("prepareForEncryptedPlayback"),!hasAuthorization())return Promise.reject(new MKError(MKError.AUTHORIZATION_ERROR,"Unable to prepare for playback."));try{yield e.store.validateAgeVerification(n)}catch(Y){return Y.errorCode===MKError.CONTENT_RESTRICTED&&n.restrict(),Promise.reject(Y)}try{yield prepareToPlayMediaItem(e,n)}catch(Y){if([MKError.AUTHORIZATION_ERROR].includes(Y.errorCode))yield e.store.storekit.revokeUserToken();else if(Y.errorCode===MKError.TOKEN_EXPIRED)try{return yield e.store.storekit.renewUserToken(),yield prepareToPlayMediaItem(e,n),n.playbackData=_playbackDataForItem(n,d),n}catch(Lr){}if(Y)return Promise.reject(Y)}return n.playbackData=_playbackDataForItem(n,d),n}))).apply(this,arguments)}function _playbackDataForItem(n,d){if(Ut.debug("mk: _playbackDataForItem",n),n.isCloudUpload)return n.assets[0];if("musicVideo"!==n.type&&!n.isLiveVideoStation){if(!n.isLiveRadioStation&&!n.hasOffersHlsUrl){const[e]=n.assets.filter(e=>{if(!("flavor"in e))return!1;const n=new RegExp(`\\d{1,2}\\:(c${(null===(p=window.WebKitMediaKeys)||void 0===p?void 0:p.isTypeSupported(or+".1_0",rr.AVC1))?"bc":"tr"}p)(\\d{2,3})`,"i");var p;const h=n.test(e.flavor);var y;const m=null!==(y=e.flavor.match(n))&&void 0!==y?y:[];return h&&parseInt(m[2],10)<=d.bitrate});return e}{const p=n.assets.reduce((e,n)=>{const d=n.bandwidth;return e[d]||(e[d]=[]),e[d].push(n),e},{}),h=Object.keys(p).sort((e,n)=>parseInt(e,10)-parseInt(n,10)),y=d.bitrate===e.PlaybackBitrate.STANDARD?h[0]:h[h.length-1];n.assetURL=p[y][0].URL}}}class HlsJsPreviewImageLoader{loadPreviewImage(e){return this.lastPosition===e||(this.lastPosition=e,this.lastPromise=new Promise((n,d)=>{this.hls.loadImageIframeData$(e).subscribe(e=>{const{data:d}=e,p=new Blob([d],{type:"image/jpeg"});n(p)})})),this.lastPromise}constructor(e){this.hls=e}}function _defineProperty$d(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$d(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$d(e,n,d[n])}))}return e}function _objectSpreadProps$9(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}var qs={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},zs={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};const{audioTracksSwitched:Ws,audioTracksUpdated:Ys,inlineStylesParsed:Qs,textTracksSwitched:Js,textTracksUpdated:Xs}=tr;class HlsJsTracks extends Notifications{get audioTracks(){return this._audioTracks}get textTracks(){return this._textTracks}set audioTrack(e){this.session&&e&&void 0!==e.id&&(this.session.audioSelectedPersistentID=e.id)}set textTrack(e){var n;this.session.subtitleSelectedPersistentID=null!==(n=null==e?void 0:e.id)&&void 0!==n?n:-1}selectForcedTrack(){const{session:e}=this;if(!(null==e?void 0:e.audioTracks))return;const n=e.audioTracks.filter(n=>n.persistentID===e.audioSelectedPersistentID),d=n&&n.length&&n[0];if(!d)return;const p=e.subtitleMediaOptions.filter(e=>0===e.MediaSelectionOptionsDisplaysNonForcedSubtitles&&e.MediaSelectionOptionsExtendedLanguageTag===d.lang),h=null==p?void 0:p[0];let y;return h?(Lt.debug("hlsjsTracks: found forced track for "+h.MediaSelectionOptionsExtendedLanguageTag),e.subtitleSelectedPersistentID=h.MediaSelectionOptionsPersistentID,y=this.normalizeTextTrack(h)):e.subtitleSelectedPersistentID=-1,y}audioTracksUpdated(e,n){const d=(n&&n.audioMediaSelectionGroup&&n.audioMediaSelectionGroup.MediaSelectionGroupOptions||[]).map(this.normalizeAudioTrack,this);this._audioTracks=d,this.dispatchEvent(Ys,d)}handleAudioTrackSwitched(){this.dispatchEvent(Ws,{selectedId:this.session.audioSelectedPersistentID})}handleInlineStylesParsed(e,n){this.dispatchEvent(Qs,n)}handleManifestLoaded(e,n){this.audioTracksUpdated(e,n),this.subtitleTracksUpdated(e,n)}handleSubtitleTrackSwitch(e,n){this.dispatchEvent(Js,n)}subtitleTracksUpdated(e,n){const d=n&&n.subtitleMediaSelectionGroup&&n.subtitleMediaSelectionGroup.MediaSelectionGroupOptions||[],p=[];d.forEach(e=>{0!==e.MediaSelectionOptionsDisplaysNonForcedSubtitles&&p.push(this.normalizeTextTrack(e))}),this._textTracks=p,this.dispatchEvent(Xs,p)}normalizeAudioTrack(e){const n=e.MediaSelectionOptionsTaggedMediaCharacteristics,d=(null!=n?n:[]).includes("public.accessibility.describes-video")?"description":"main";return _objectSpreadProps$9(_objectSpread$d({},this.normalizeSelectionOption(e)),{enabled:!1,kind:d,characteristics:n})}normalizeTextTrack(e){var n;let d;return d=(null===(n=e.MediaSelectionOptionsTaggedMediaCharacteristics)||void 0===n?void 0:n.includes("public.accessibility.describes-music-and-sound"))||"clcp"===e.MediaSelectionOptionsMediaType?"captions":"subtitles",_objectSpreadProps$9(_objectSpread$d({},this.normalizeSelectionOption(e)),{mode:"disabled",kind:d})}normalizeSelectionOption(e){return{id:e.MediaSelectionOptionsPersistentID,label:e.MediaSelectionOptionsName,language:e.MediaSelectionOptionsExtendedLanguageTag}}destroy(){const{MANIFEST_LOADED:e,AUDIO_TRACK_SWITCHED:n,SUBTITLE_TRACK_SWITCH:d,INLINE_STYLES_PARSED:p}=window.Hls.Events;this.session.off(e,this.handleManifestLoaded),this.session.off(n,this.handleAudioTrackSwitched),this.session.off(d,this.handleSubtitleTrackSwitch),this.session.off(p,this.handleInlineStylesParsed)}constructor(e){super([Ws,Ys,Qs,Js,Xs]),this.session=e,this._audioTracks=[],this._textTracks=[];const{MANIFEST_LOADED:n,AUDIO_TRACK_SWITCHED:d,SUBTITLE_TRACK_SWITCH:p,INLINE_STYLES_PARSED:h}=window.Hls.Events;this.session.on(n,this.handleManifestLoaded),this.session.on(d,this.handleAudioTrackSwitched),this.session.on(p,this.handleSubtitleTrackSwitch),this.session.on(h,this.handleInlineStylesParsed)}}function asyncGeneratorStep$m(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$m(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$m(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$m(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}qs([Bind(),zs("design:type",Function),zs("design:paramtypes",[])],HlsJsTracks.prototype,"handleAudioTrackSwitched",null),qs([Bind(),zs("design:type",Function),zs("design:paramtypes",[void 0,void 0])],HlsJsTracks.prototype,"handleInlineStylesParsed",null),qs([Bind(),zs("design:type",Function),zs("design:paramtypes",[void 0,void 0])],HlsJsTracks.prototype,"handleManifestLoaded",null),qs([Bind(),zs("design:type",Function),zs("design:paramtypes",[void 0,void 0])],HlsJsTracks.prototype,"handleSubtitleTrackSwitch",null);var Zs={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},ec={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};const tc={keySystemGenericError:"keySystemGenericError"},rc=new Set([MKError.DEVICE_LIMIT,MKError.GEO_BLOCK,MKError.WIDEVINE_CDM_EXPIRED]),nc={};nc[Wt.FAIRPLAY]="fairplaystreaming",nc[Wt.PLAYREADY]="playready",nc[Wt.WIDEVINE]="widevine";const ic=BooleanDevFlag.get("mk-block-report-cdn-server"),ac={nightly:!0,carry:!0},oc=JsonDevFlag.register("mk-hlsjs-config-overrides");class HlsJsVideoPlayer extends VideoPlayer{get shouldDispatchErrors(){return!this.userInitiated||this._playbackDidStart}get supportsPreviewImages(){var e,n;return!(zt.isAndroid||zt.isiOS||zt.isMacOs&&navigator.maxTouchPoints>2)&&(null===(e=this._hls)||void 0===e||null===(n=e.iframeVariants)||void 0===n?void 0:n.some(e=>"mjpg"===e.imageCodec))}get currentPlayingDate(){var e;return null===(e=this._hls)||void 0===e?void 0:e.playingDate}get isPlayingAtLiveEdge(){var e;const n=this._hls;return!(!n||!(null===(e=this.nowPlayingItem)||void 0===e?void 0:e.isLinearStream))&&!!n.isPlayingAtLive}get seekableTimeRanges(){const e=this._hls;return e?e.seekableTimeRanges:this.currentPlaybackDuration?[{start:0,end:this.currentPlaybackDuration}]:void 0}initializeExtension(){var e=this;return _asyncToGenerator$m((function*(){e._keySystem=yield findKeySystemPreference();try{var n;if(!Yt.urls.hls)throw new Error("bag.urls.hls is not configured");yield Promise.all([loadScript(Yt.urls.hls),null===(n=e._rtcTracker)||void 0===n?void 0:n.loadScript()])}catch(Lr){throw Lt.error("hlsjs-video-player failed to load script "+Yt.urls.hls,Lr),Lr}}))()}destroy(){var e;if(Lt.debug("hlsjs-video-player.destroy"),null===(e=this._hlsJsTracks)||void 0===e||e.destroy(),this._hls){const{ERROR:e,INTERNAL_ERROR:n,MANIFEST_PARSED:d,KEY_REQUEST_STARTED:p,LICENSE_CHALLENGE_CREATED:h,LEVEL_SWITCHED:y,UNRESOLVED_URI_LOADING:m}=window.Hls.Events,g=this._hls;g.stopLoad(),g.detachMedia(),g.off(e,this.handleHlsError),g.off(n,this.handleHlsError),g.off(d,this.handleManifestParsed),g.off(p,this.handleKeyRequestStarted),g.off(h,this.handleLicenseChallengeCreated),g.off(y,this.handleLevelSwitched),this._shouldLoadManifestsOnce&&g.off(m,this.handleUnresolvedUriLoading),g.destroy(),window.hlsSession=void 0}super.destroy(),asAsync(this._license.stop())}playHlsStream(e,n,d={}){var p=this;return _asyncToGenerator$m((function*(){Lt.debug("hlsjs-video-player.playHlsStream",e,n);const{_keySystem:h}=p;if(!h)return;let y,m;p._unrecoverableError=void 0,p.createHlsPlayer();const hasKey=(e,n)=>{var d;return void 0!==(null==n||null===(d=n.keyURLs)||void 0===d?void 0:d[e])};h===Wt.WIDEVINE&&hasKey("widevine-cert-url",n)&&(y="WIDEVINE_SOFTWARE",m={initDataTypes:["cenc","keyids"],distinctiveIdentifier:"optional",persistentState:"required"});const g={subs:"accepts-css",platformInfo:{requiresCDMAttachOnStart:h!==Wt.NONE,maxSecurityLevel:y,keySystemConfig:m},appData:{serviceName:Yt.app.name}},{_rtcTracker:b,_hls:_}=p;if(b){const e=b.prepareReportingAgent(n);void 0!==e&&(g.appData.reportingAgent=e)}Lt.debug("RTC: loadSource with load options",g);const P=p.startPlaybackSequence();return p._shouldLoadManifestsOnce&&(e=e.replace("https://","manifest://"),Lt.info("Manifest already loaded, passing url to HLSJS",e)),_.loadSource(e,g,d.startTime),_.attachMedia(p.video),n&&(p._licenseServerUrl=n.keyURLs["hls-key-server-url"],h===Wt.FAIRPLAY&&hasKey("hls-key-cert-url",n)?_.setProtectionData({fairplaystreaming:{serverCertUrl:n.keyURLs["hls-key-cert-url"]}}):hasKey("widevine-cert-url",n)&&_.setProtectionData({widevine:{serverCertUrl:n.keyURLs["widevine-cert-url"]}})),P}))()}createHlsPlayer(){const{_keySystem:e}=this,{Hls:n}=window,d=ye.get(),p={clearMediaKeysOnPromise:!1,customTextTrackCueRenderer:!0,debug:!!d,debugLevel:d,enableIFramePreloading:!1,enablePerformanceLogging:!!d,enablePlayReadyKeySystem:!0,enableQueryParamsForITunes:!this._shouldLoadManifestsOnce,enableRtcReporting:void 0!==this._rtcTracker,keySystemPreference:nc[e],useMediaKeySystemAccessFilter:!0,nativeControlsEnabled:zt.isAndroid};(e=>{const{Hls:n}=window;if(n&&ic){const d=deepClone(n.DefaultConfig.fragLoadPolicy);d.default.reportCDNServer=!1,d.customURL.reportCDNServer=!1,e.fragLoadPolicy=d}})(p),(e=>{const n=ue.value;if(!n)return;var d;const p=null!==(d=determineCdnPathPrefix())&&void 0!==d?d:"";n.socketurl&&isAppleHostname(n.socketurl)&&ac[p.split(".")[0]]&&(e.socketurl=n.socketurl,e.socketid=n.socketid,e.log=n.log)})(p),(e=>{const n=oc.value;n&&"object"==typeof n&&Object.assign(e,n)})(p);const h=new n(p),{ERROR:y,INTERNAL_ERROR:m,MANIFEST_PARSED:g,KEY_REQUEST_STARTED:b,LICENSE_CHALLENGE_CREATED:_,LEVEL_SWITCHED:P,UNRESOLVED_URI_LOADING:T}=n.Events;h.on(y,this.handleHlsError),h.on(m,this.handleHlsError),h.on(g,this.handleManifestParsed),h.on(b,this.handleKeyRequestStarted),h.on(_,this.handleLicenseChallengeCreated),h.on(P,this.handleLevelSwitched),this._shouldLoadManifestsOnce&&h.on(T,this.handleUnresolvedUriLoading),this._hls=h,window.hlsSession=h,this._hlsJsTracks=new HlsJsTracks(this._hls),this.setupTrackManagers(this._hlsJsTracks),this._hlsPreviewImageLoader=new HlsJsPreviewImageLoader(this._hls)}handleUnresolvedUriLoading(e,n){var d=this;return _asyncToGenerator$m((function*(){const e=d._hls,p=n.uri,h=p.replace("manifest://","https://");var y;Lt.debug("handleUnresolvedUriLoading for uri ",p);const m=null!==(y=Io.getManifest(h))&&void 0!==y?y:yield Io.fetchManifest(h);m?(Io.clear(h),e.off(window.Hls.Events.UNRESOLVED_URI_LOADING,d.handleUnresolvedUriLoading),e.handleResolvedUri(p,{url:h,status:200,data:m.content})):Lt.error("No cached manifest for "+h)}))()}handleLevelSwitched(e,n){var d,p;const{level:h}=n;if(!h)return;const y=null===(d=this._levels)||void 0===d?void 0:d.find(e=>e.persistentId===h);if(!y||(null===(p=this._currentLevel)||void 0===p?void 0:p.persistentId)===(null==y?void 0:y.persistentId))return;this._currentLevel=y;const m=void 0!==y.audioGroupId?this._channelsByGroup[y.audioGroupId]:void 0;this._dispatcher.publish(hr.hlsLevelUpdated,{level:y,channels:m})}handleHlsError(e,n){if(Lt.warn("HLS.js error",JSON.stringify(n)),this._unrecoverableError)return;let d=new MKError(MKError.UNSUPPORTED_ERROR,n.reason);d.data=n;const{keySystemGenericError:p}=tc;if(n.details!==p){if("output-restricted"===n.reason&&(d=new MKError(MKError.OUTPUT_RESTRICTED,n.reason)),n.fatal){if(this._hls.destroy(),!this.shouldDispatchErrors)throw d;this._dispatcher.publish(fr.mediaPlaybackError,d)}}else this._dispatcher.publish(p,d)}handleManifestParsed(e,n){var d=this;return _asyncToGenerator$m((function*(){var e,p;let h;Lt.debug("handleManifestParsed",n),d._levels=null!==(e=n.levels)&&void 0!==e?e:[],d.nowPlayingItem.state=G.ready,d._channelsByGroup=(null!==(p=n.audioTracks)&&void 0!==p?p:[]).reduce((e,n)=>(e[n.groupId]=n.channels,e),{});try{yield d._playMedia()}catch(Lr){throw Lt.warn("error from media element, possibly non-fatal",Lr),Lr}finally{h=yield d.finishPlaybackSequence()}return h}))()}handleKeyRequestStarted(e,n){Lt.debug("hlsjs-video.handleKeyRequestStarted"),this._hls.generateKeyRequest(n.keyuri,{})}handleLicenseChallengeCreated(n,d){var p=this;return _asyncToGenerator$m((function*(){const{_licenseServerUrl:n,nowPlayingItem:h,_keySystem:y,userInitiated:m}=p;try{var g;const e=yield null===(g=p._license)||void 0===g?void 0:g.start(n,h,d,y,m),b={statusCode:e.status};(null==e?void 0:e.license)&&(y===Wt.FAIRPLAY?b.ckc=Ie(e.license):b.license=Ie(e.license));const _=e["renew-after"];_&&(b.renewalDate=new Date(Date.now()+1e3*_)),p._hls.setLicenseResponse(d.keyuri,b)}catch(Lr){if(p._unrecoverableError)return;const h=Lr.data,y={};void 0!==(null==h?void 0:h.status)&&(y.statusCode=+h.status),Lt.warn("Passing license response error to Hls.js",y),p._hls.setLicenseResponse(d.keyuri,y),rc.has(Lr.name)&&(p._unrecoverableError=Lr,p.resetDeferredPlay(),yield p.stop({endReasonType:e.PlayActivityEndReasonType.FAILED_TO_LOAD,userInitiated:m})),p.onPlaybackLicenseError(Lr)}}))()}seekToTime(e){var n=this;return _asyncToGenerator$m((function*(){n._hls?(Lt.debug("hlsjs-video: hls seekTo",e),n._hls.seekTo=e):(Lt.debug("hlsjs-video: media element seek to",e),n._targetElement.currentTime=e)}))()}loadPreviewImage(e){var n=this;return _asyncToGenerator$m((function*(){var d;return null===(d=n._hlsPreviewImageLoader)||void 0===d?void 0:d.loadPreviewImage(e)}))()}constructor(e){var n;super(e),this._channelsByGroup={},this._rtcTracker=null==e||null===(n=e.playbackServices)||void 0===n?void 0:n.getRTCStreamingTracker(),this._license=new License}}var sc;Zs([Bind(),ec("design:type",Function),ec("design:paramtypes",[String,"undefined"==typeof HlsUnresolvedUriData?Object:HlsUnresolvedUriData])],HlsJsVideoPlayer.prototype,"handleUnresolvedUriLoading",null),Zs([Bind(),ec("design:type",Function),ec("design:paramtypes",[void 0,void 0])],HlsJsVideoPlayer.prototype,"handleLevelSwitched",null),Zs([Bind(),ec("design:type",Function),ec("design:paramtypes",[void 0,void 0])],HlsJsVideoPlayer.prototype,"handleHlsError",null),Zs([Bind(),ec("design:type",Function),ec("design:paramtypes",[void 0,void 0])],HlsJsVideoPlayer.prototype,"handleManifestParsed",null),Zs([Bind(),ec("design:type",Function),ec("design:paramtypes",[void 0,void 0])],HlsJsVideoPlayer.prototype,"handleKeyRequestStarted",null),Zs([Bind(),ec("design:type",Function),ec("design:paramtypes",[void 0,void 0])],HlsJsVideoPlayer.prototype,"handleLicenseChallengeCreated",null),Zs([AsyncDebounce(250),ec("design:type",Function),ec("design:paramtypes",[Number])],HlsJsVideoPlayer.prototype,"seekToTime",null),Zs([(sc=250,(e,n,d)=>{const p=function(e,n){let d,p,h=0;const resetState=()=>{clearTimeout(p),p=0,d=void 0};return function(...y){const m=this;return new Promise((function(g,b){const _=Date.now();_-h<n?(d&&(d.resolve(void 0),resetState()),d={resolve:g,reject:b,args:y},p=setTimeout(()=>{e.apply(m,d.args).then(d.resolve).catch(d.reject),resetState()},n-(_-h+1))):(resetState(),h=_,e.apply(m,y).then(g).catch(b))}))}}(d.value,sc);d.value=p}),ec("design:type",Function),ec("design:paramtypes",[Number])],HlsJsVideoPlayer.prototype,"loadPreviewImage",null);class VideoMediaExtension extends MediaExtension{destroy(e){var n;null===(n=this._session)||void 0===n||n.stopLicenseSession(),super.destroy(e)}}function asyncGeneratorStep$l(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$l(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$l(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$l(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}var cc={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},lc={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};const{mediaPlaybackError:uc}=fr,{playbackLicenseError:dc,playbackSessionError:pc}=tr;class NativeSafariVideoPlayer extends VideoPlayer{get currentPlayingDate(){}get isPlayingAtLiveEdge(){return!1}get seekableTimeRanges(){return this.currentPlaybackDuration?[{start:0,end:this.currentPlaybackDuration}]:void 0}get supportsPreviewImages(){return!1}initializeExtension(){var e=this;return _asyncToGenerator$l((function*(){if(!e.video)return void Lt.warn("NativeSafariVideoPlayer.initializeExtension No video element, not initializing extension");const n=new VideoMediaExtension(e.video,'video/mp4;codecs="avc1.42E01E"');e.extension=n,yield n.initializeKeySystem(),n.addEventListener(dc,e.onPlaybackLicenseError),n.addEventListener(pc,e.onPlaybackSessionError)}))()}destroy(){Lt.debug("native-safari-video-player.destroy");const{extension:e,video:n}=this;this._blobUrl&&(URL.revokeObjectURL(this._blobUrl),this._blobUrl=void 0),e&&n&&(e.removeEventListener(dc,this.onPlaybackLicenseError),e.removeEventListener(pc,this.onPlaybackSessionError),n.removeEventListener("loadedmetadata",this.onMetadataLoaded),super.destroy())}loadPreviewImage(e){return _asyncToGenerator$l((function*(){}))()}playHlsStream(e,n,d={}){var p=this;return _asyncToGenerator$l((function*(){Lt.debug("native-safari-video-player.playHlsStream",e);const{video:h}=p;if(!h){const e="NativeSafariVideoPlayer.playHlsStream(): No video element";throw Lt.error(e),new Error(e)}p.setupTrackManagers();const y=p.startPlaybackSequence(),m=(p._shouldLoadManifestsOnce?p.playByBlob(e,h,d):p.playBySource(e,h,d)).then(()=>y);var g;n&&(null===(g=p.extension)||void 0===g||g.setMediaItem(n));return h.addEventListener("loadedmetadata",p.onMetadataLoaded),m}))()}onPlaybackSessionError(e){this._dispatcher.publish(uc,new MKError(MKError.MEDIA_SESSION,e))}onMetadataLoaded(){var e=this;return _asyncToGenerator$l((function*(){Lt.debug("native-safari-video-player.onMetadataLoaded");const{nowPlayingItem:n}=e;n&&(n.state=G.ready),yield e._playMedia(),e.finishPlaybackSequence()}))()}seekToTime(e){var n=this;return _asyncToGenerator$l((function*(){Lt.debug("native-safari-video-player: media element seek to",e),n._targetElement.currentTime=e}))()}playByBlob(e,n,d={}){var p=this;return _asyncToGenerator$l((function*(){Lt.debug("native-safari-video-player: playing video by blob");let h=Io.getManifest(e);if(!h&&(Lt.debug("native-safari-video-player: fetching manifest"),h=yield Io.fetchManifest(e),!h))throw Lt.error("No manifest for "+e),new MKError(MKError.CONTENT_UNAVAILABLE,"Failed to load manifest");Lt.debug("native-safari-video-player: loaded manifest",!!h),Io.clear(e);const y=h.contentType,m=h.content.replace(/^#EXT-X-SESSION-DATA-ITUNES:.*$/gm,""),g=new Blob([m],{type:y});e=URL.createObjectURL(g),p._blobUrl=e;const b=document.createElement("source");b.setAttribute("src",e),y&&b.setAttribute("type",y),Lt.debug("native-safari-video-player: blob url",e),void 0!==d.startTime&&(n.currentTime=d.startTime),n.appendChild(b)}))()}playBySource(e,n,d={}){return _asyncToGenerator$l((function*(){Lt.debug("native-safari-video-player: playing video by source"),void 0!==d.startTime&&(e+="#t="+d.startTime),n.src=e}))()}}function asyncGeneratorStep$k(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}cc([Bind(),lc("design:type",Function),lc("design:paramtypes",[void 0])],NativeSafariVideoPlayer.prototype,"onPlaybackSessionError",null),cc([Bind(),lc("design:type",Function),lc("design:paramtypes",[])],NativeSafariVideoPlayer.prototype,"onMetadataLoaded",null),cc([AsyncDebounce(250),lc("design:type",Function),lc("design:paramtypes",[Number])],NativeSafariVideoPlayer.prototype,"seekToTime",null);const hc=BooleanDevFlag.register("mk-safari-force-native-live-stream");class Factory{getPlayerForMediaItem(e,n,d){var p,h=this;return(p=function*(){Lt.debug("mk: getPlayerForMediaItem",e,n);const p=getPlayerType(e);let y=h._playersByType[p];if((null==y?void 0:y.isDestroyed)&&(Lt.debug("mk: existingPlayer was previously destroyed. Removing from factory."),y=void 0,delete h._playersByType[p]),y&&y===d)return d;if(y)return h._applyPlayerState(y,n),y;const{_playerOptions:m}=h;let g;switch(p){case"audio":g=new AudioPlayer(m),h._playersByType[p]=g;break;case"video":{var b;const n=yield null===(b=h._playerOptions.playbackServices)||void 0===b?void 0:b.requiresHlsJs(),d=h._shouldForceHlsJsPlayer(e);g=n||d?new HlsJsVideoPlayer(m):new NativeSafariVideoPlayer(m);break}default:throw new Error("Invalid player type requested: "+p)}return yield g.initialize(),h._applyPlayerState(g,n),g},function(){var e=this,n=arguments;return new Promise((function(d,h){var y=p.apply(e,n);function _next(e){asyncGeneratorStep$k(y,d,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$k(y,d,h,_next,_throw,"throw",e)}_next(void 0)}))})()}_shouldForceHlsJsPlayer(e){var n,d,p;return!hc.enabled&&(e.isLiveVideoStation||e.isLinearStream||(null===(n=e.defaultPlayable)||void 0===n||null===(d=n.assets)||void 0===d||null===(p=d.fpsKeyServerUrl)||void 0===p?void 0:p.startsWith("https://linear.tv.apple.com")))}_applyPlayerState(e,n){return n?(Lt.debug("_applyPlayerState",n),Object.keys(n).forEach(d=>{void 0!==e[d]&&(e[d]=n[d])}),e):e}destroy(){Object.values(this._playersByType).forEach(e=>e.destroy())}constructor(e){this._playersByType={},this._playerOptions=e}}function asyncGeneratorStep$j(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$j(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$j(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$j(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}var yc={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},fc={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};const{mediaPlaybackError:mc,playerTypeDidChange:gc}=fr,{playbackLicenseError:vc}=tr,{keySystemGenericError:bc}=tc,_c=function(){var e=_asyncToGenerator$j((function*(e,n){var d,p;if(null===(d=e.container)||void 0===d||null===(p=d.attributes)||void 0===p?void 0:p.requiresSubscription){if(!(yield n())){const n=new MKError(MKError.SUBSCRIPTION_ERROR);throw n.data=e,n}}}));return function(n,d){return e.apply(this,arguments)}}();let Pc=!1;class MediaItemPlayback{get currentPlaybackTime(){return this._currentPlayer.currentPlaybackTime}get currentPlaybackTimeRemaining(){return this._currentPlayer.currentPlaybackTimeRemaining}get currentPlayingDate(){return this._currentPlayer.currentPlayingDate}get isPlayingAtLiveEdge(){return this._currentPlayer.isPlayingAtLiveEdge}get seekableTimeRanges(){return this._currentPlayer.seekableTimeRanges}get audioTracks(){return this._currentPlayer.audioTracks}get currentAudioTrack(){return this._currentPlayer.currentAudioTrack}set currentAudioTrack(e){this._currentPlayer.currentAudioTrack=e}get currentPlaybackDuration(){return this._currentPlayer.currentPlaybackDuration}get currentBufferedProgress(){return this._currentPlayer.currentBufferedProgress}get currentPlaybackProgress(){return this._currentPlayer.currentPlaybackProgress}get currentTextTrack(){return this._currentPlayer.currentTextTrack}set currentTextTrack(e){this._currentPlayer.currentTextTrack=e}get previewOnly(){return this._previewOnly}set previewOnly(e){this._previewOnly=e}get isPlaying(){return this._currentPlayer.isPlaying}get isPrimaryPlayer(){return this._currentPlayer.isPrimaryPlayer}set isPrimaryPlayer(e){this._currentPlayer.isPrimaryPlayer=e}get isReady(){return this._currentPlayer.isReady}get nowPlayingItem(){return this._currentPlayer.nowPlayingItem}get playbackRate(){return this._currentPlayer.playbackRate}set playbackRate(e){this._updatePlayerState("playbackRate",e)}get playbackState(){return this._currentPlayer.playbackState}set playbackState(e){this._currentPlayer.setPlaybackState(e,this.nowPlayingItem)}get playbackTargetAvailable(){return this._currentPlayer.playbackTargetAvailable}get playbackTargetIsWireless(){return this._currentPlayer.playbackTargetIsWireless}get supportsPreviewImages(){return this._currentPlayer.supportsPreviewImages}get textTracks(){return this._currentPlayer.textTracks}get volume(){return this._currentPlayer.volume}set volume(e){var n;this._currentPlayer.isDestroyed&&(null===(n=this._dispatcher)||void 0===n||n.publish(fr.playbackVolumeDidChange,{}));this._updatePlayerState("volume",e)}clearNextManifest(){this._currentPlayer.clearNextManifest()}destroy(){var e,n;this._playerFactory.destroy(),null===(e=this._dispatcher)||void 0===e||e.unsubscribe(vc,this.onPlaybackLicenseError),null===(n=this._dispatcher)||void 0===n||n.unsubscribe(bc,this.onKeySystemGenericError)}exitFullscreen(){return this._currentPlayer.exitFullscreen()}loadPreviewImage(e){var n=this;return _asyncToGenerator$j((function*(){return n._currentPlayer.loadPreviewImage(e)}))()}getNewSeeker(){return this._currentPlayer.newSeeker()}mute(){this._volumeAtMute=this.volume,this.volume=0}pause(e){var n=this;return _asyncToGenerator$j((function*(){return n._currentPlayer.pause(e)}))()}play(){var e=this;return _asyncToGenerator$j((function*(){return e._currentPlayer.play()}))()}preload(){var e=this;return _asyncToGenerator$j((function*(){return e._currentPlayer.preload()}))()}prepareToPlay(e){var n=this;return _asyncToGenerator$j((function*(){var d;Vt.debug("invoking prepareToPlay for ",e.title);const p=yield n.prepareForEncryptedPlayback(e,{bitrate:n._bitrateCalculator.bitrate}),h=null===(d=n._currentPlayback)||void 0===d?void 0:d.item,y=Yt.features["seamless-audio-transitions"],m="song"===(null==h?void 0:h.type)&&"song"===e.type,g=!e.playRawAssetURL;return y&&m&&g&&(Vt.debug(`setting ${e.title} for seamless audio transition`),yield n._currentPlayer.setNextSeamlessItem(e)),p}))()}requestFullscreen(e){return this._currentPlayer.requestFullscreen(e)}showPlaybackTargetPicker(){this._currentPlayer.showPlaybackTargetPicker()}seekToTime(e,n=br.Manual){var d=this;return _asyncToGenerator$j((function*(){yield d._currentPlayer.seekToTime(e,n)}))()}setPresentationMode(e){var n=this;return _asyncToGenerator$j((function*(){return n._currentPlayer.setPresentationMode(e)}))()}startMediaItemPlayback(e,n=!1){var d=this;return _asyncToGenerator$j((function*(){var p;Vt.debug("MediaItemPlayback: startMediaItemPlayback",e),e.resetState(),(e=>{if(e.isLinearStream&&(zt.isiOS||zt.isMacOs&&navigator.maxTouchPoints>2)){Vt.warn("Cannot play linear stream on iOS or iPad");const n=new MKError(MKError.CONTENT_UNSUPPORTED,"IOS LINEAR");throw n.data={item:e},n}})(e),yield _c(e,d.hasMusicSubscription);const h=yield d._getPlayerForMediaItem(e);if(yield d.setCurrentPlayer(h),!(null===(p=d._currentPlayer)||void 0===p?void 0:p.hasMediaElement))return Vt.warn(`MediaItemPlayback: Could not play media of type ${e.type}, marking item as unsupported and skipping.`),void e.notSupported();try{e.beginMonitoringStateDidChange(e=>{var n;return null===(n=d._dispatcher)||void 0===n?void 0:n.publish(I.mediaItemStateDidChange,e)}),e.beginMonitoringStateWillChange(e=>{var n;return null===(n=d._dispatcher)||void 0===n?void 0:n.publish(I.mediaItemStateWillChange,e)});const p=d.playOptions.get(e.id);p&&d.playOptions.delete(e.id);const h=yield d._playAccordingToPlaybackType(e,n,p);return d._currentPlayback={item:e,userInitiated:n},h}catch(Y){throw e.updateFromLoadError(Y),Vt.error(Y.message,Y),Y}}))()}_playAccordingToPlaybackType(e,n,d){var p=this;return _asyncToGenerator$j((function*(){return(yield function(e,n){return _shouldPlayPreview.apply(this,arguments)}(e,p._previewOnly))?p._playPreview(e,n):function(e){return!(!e.playRawAssetURL||!e.attributes.assetUrl)}(e)?p._playRawAsset(e,n,d):isBroadcastRadio(e)?p._playBroadcastRadio(e,n):((e=>{if(!supportsDrm()){const n=new MKError(MKError.CONTENT_UNSUPPORTED,"NO DRM");throw n.data={item:e},Vt.warn("No DRM detected"),n}})(e),p._playEncryptedFull(e,n,d))}))()}_playEncryptedFull(e,n,d){var p=this;return _asyncToGenerator$j((function*(){if(Vt.debug("MediaItemPlayback: play encrypted full",e),!e||!e.isPlayable)return Promise.reject(new MKError(MKError.MEDIA_PLAYBACK,"Not Playable"));const h=p._currentPlayer;try{yield p.prepareForEncryptedPlayback(e,{bitrate:p._bitrateCalculator.bitrate})}catch(Y){return Vt.error("prepareForEncryptedPlayback Error: userInitiated "+n),h.destroy(),n?Promise.reject(Y):void h.dispatch(fr.mediaPlaybackError,Y)}return yield function(e){return new Promise((n,d)=>{const{ageGatePolicy:p}=e;if(!p||!p.age||!p.frequencyInMinutes)return Ut.debug("No ageGatePolicy. Resolving handleAgeGate()"),n(void 0);const h=getLocalStorage(),y=null==h?void 0:h.ageGatePolicyAge,m=null==h?void 0:h.ageGatePolicyExpiration;if(y&&m&&parseInt(m,10)>Date.now()&&parseInt(y,10)>=p.age)return n(void 0);MKDialog.clientDialog({okButtonString:"Yes",okButtonAction:()=>(null==h||h.setItem("ageGatePolicyAge",p.age.toString()),null==h||h.setItem("ageGatePolicyExpiration",(Date.now()+60*p.frequencyInMinutes*1e3).toString()),n(void 0)),cancelButtonString:"No",cancelButtonAction:()=>d(new MKError("AGE_GATE","Age Gate Declined")),explanation:`This content may not be appropriate for ages younger than ${p.age}.`,message:`Are you ${p.age} or older?`}).present()})}(e),Vt.debug("About to play item as encrypted",e),yield h.playItemFromEncryptedSource(e,n,d),e}))()}_playBroadcastRadio(n,d){var p=this;return _asyncToGenerator$j((function*(){if(Vt.debug("MediaItemPlayback: play broadcast radio",n),!Yt.features["broadcast-radio"]){const e=new MKError(MKError.CONTENT_UNAVAILABLE);throw e.data=n,e}const h=p._currentPlayer,y=h.isPaused()&&!d,m=yield Gs(n,ba.developerToken,ba.musicUserToken),g=m.assets[0];return n.playbackType=e.PlaybackType.unencryptedFull,n.trackInfo=m["track-info"],h.nowPlayingItem=n,yield h.playItemFromUnencryptedSource(g.url,y),n}))()}_playRawAsset(n,d,p){var h=this;return _asyncToGenerator$j((function*(){Vt.debug("MediaItemPlayback: play raw asset",n);const y=h._currentPlayer,m=y.isPaused()&&!d;return n.playbackType=e.PlaybackType.unencryptedFull,y.nowPlayingItem=n,yield y.playItemFromUnencryptedSource(n.attributes.assetUrl,m,p),n}))()}_playPreview(n,d){var p=this;return _asyncToGenerator$j((function*(){Vt.debug("MediaItemPlayback: play preview",n);const h=p._currentPlayer,y=h.isPaused()&&!d;return supportsDrm()||h.dispatch(fr.drmUnsupported,{item:n}),n.playbackType=e.PlaybackType.preview,h.nowPlayingItem=n,yield h.playItemFromUnencryptedSource(n.previewURL,y),n}))()}stop(e){var n=this;return _asyncToGenerator$j((function*(){yield n._currentPlayer.stop(e)}))()}unmute(){this.volume>0||(this.volume=this._volumeAtMute||1,this._volumeAtMute=void 0)}_getPlayerForMediaItem(e){var n=this;return _asyncToGenerator$j((function*(){Vt.debug("MediaItemPlayback:  _getPlayerForMediaItem",e.id);return yield n._playerFactory.getPlayerForMediaItem(e,n.playerState,n._currentPlayer)}))()}setCurrentPlayer(e){var n=this;return _asyncToGenerator$j((function*(){var d;n._currentPlayer!==e&&(Vt.debug("MediaItemPlayback: setting currentPlayer",e),yield n._currentPlayer.stop(),n._currentPlayer=e,null===(d=n._dispatcher)||void 0===d||d.publish(gc,{player:e}))}))()}onKeySystemGenericError(e,n){var d=this;return _asyncToGenerator$j((function*(){var e;Pc?null===(e=d._dispatcher)||void 0===e||e.publish(mc,n):(Pc=!0,Vt.warn("Retrying playback after keysystemGenericError"),yield d.restartPlayback())}))()}onPlaybackLicenseError(e,n){var d=this;return _asyncToGenerator$j((function*(){var e;n.errorCode===MKError.PLAYREADY_CBC_ENCRYPTION_ERROR?(Vt.warn("MediaItemPlayback: PLAYREADY_CBC_ENCRYPTION_ERROR...retrying with different key system"),yield d.restartPlayback()):null===(e=d._dispatcher)||void 0===e||e.publish(mc,n)}))()}restartPlayback(){var e=this;return _asyncToGenerator$j((function*(){yield e.stop();const{_currentPlayback:n}=e;if(n){const{item:d,userInitiated:p}=n;d.resetState(),yield e.startMediaItemPlayback(d,p)}}))()}_updatePlayerState(e,n){this.playerState[e]=n,this._currentPlayer[e]=n}constructor(e){this.playerState={playbackRate:1,volume:1},this.playOptions=new Map,this._previewOnly=!1;const{playbackServices:n}=e;var d,p;this.hasMusicSubscription=n.hasMusicSubscription,this.prepareForEncryptedPlayback=n.prepareForEncryptedPlayback,d=e.tokens,ba=d,e.bag&&(p=e.bag,Object.assign(Yt,p)),this._dispatcher=e.services.dispatcher,this._bitrateCalculator=e.services.bitrateCalculator,this._playerFactory=new Factory(e),this._currentPlayer=new PlayerStub(e),this._dispatcher.subscribe(vc,this.onPlaybackLicenseError),this._dispatcher.subscribe(bc,this.onKeySystemGenericError)}}function asyncGeneratorStep$i(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$i(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$i(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$i(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$c(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$c(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$c(e,n,d[n])}))}return e}yc([Bind(),fc("design:type",Function),fc("design:paramtypes",[void 0,void 0])],MediaItemPlayback.prototype,"onKeySystemGenericError",null),yc([Bind(),fc("design:type",Function),fc("design:paramtypes",[void 0,void 0])],MediaItemPlayback.prototype,"onPlaybackLicenseError",null);var Tc={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},Sc={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};const Ec=[MKError.AGE_VERIFICATION,MKError.CONTENT_EQUIVALENT,MKError.CONTENT_RESTRICTED,MKError.CONTENT_UNAVAILABLE,MKError.CONTENT_UNSUPPORTED,MKError.SERVER_ERROR,MKError.SUBSCRIPTION_ERROR,MKError.UNSUPPORTED_ERROR,MKError.USER_INTERACTION_REQUIRED];var kc;e.PlaybackMode=void 0,(kc=e.PlaybackMode||(e.PlaybackMode={}))[kc.PREVIEW_ONLY=0]="PREVIEW_ONLY",kc[kc.MIXED_CONTENT=1]="MIXED_CONTENT",kc[kc.FULL_PLAYBACK_ONLY=2]="FULL_PLAYBACK_ONLY",kc[kc.SHAREPLAY_PARTICIPANT=3]="SHAREPLAY_PARTICIPANT";const wc=JsonDevFlag.register("mk-bag-features-overrides");class MKInstance{get developerToken(){return xo.developerToken}get api(){return this._services.apiManager.api}get audioTracks(){return this._mediaItemPlayback.audioTracks}get authorizationStatus(){return xo.authorizationStatus}get bitrate(){return this._services.bitrateCalculator.bitrate}set bitrate(e){this._services.bitrateCalculator.bitrate=e}get browserSupportsPictureInPicture(){return function(){if(qt)return!1;const e=Xt,n=e&&e.webkitSupportsPresentationMode&&"function"==typeof e.webkitSetPresentationMode,d=document.pictureInPictureEnabled;return!(!n&&!d)}()}get browserSupportsVideoDrm(){return supportsDrm()}get cid(){return(this.realm===e.SKRealm.TV||this.sourceType!==jr.MUSICKIT)&&xo.cid}get continuous(){return this._playbackController.continuous}set continuous(e){this._playbackController.continuous=e}get autoplayEnabled(){return this._autoplayEnabled}set autoplayEnabled(n){this.realm!==e.SKRealm.MUSIC&&(n=!1),n!==this.autoplayEnabled&&(this._autoplayEnabled=n,this._services.dispatcher.publish(po.autoplayEnabledDidChange,this.autoplayEnabled))}get currentAudioTrack(){return this._mediaItemPlayback.currentAudioTrack}set currentAudioTrack(e){this._mediaItemPlayback.currentAudioTrack=e}get currentPlaybackDuration(){return this._mediaItemPlayback.currentPlaybackDuration}get currentPlaybackProgress(){return this._mediaItemPlayback.currentPlaybackProgress}get currentPlaybackTime(){return this._mediaItemPlayback.currentPlaybackTime}get currentPlayingDate(){return this._mediaItemPlayback.currentPlayingDate}get isPlayingAtLiveEdge(){return this._mediaItemPlayback.isPlayingAtLiveEdge}get seekableTimeRanges(){return this._mediaItemPlayback.seekableTimeRanges}get currentPlaybackTimeRemaining(){return this._mediaItemPlayback.currentPlaybackTimeRemaining}get currentTextTrack(){return this._mediaItemPlayback.currentTextTrack}set currentTextTrack(e){this._mediaItemPlayback.currentTextTrack=e}get isAuthorized(){return xo.isAuthorized}get isPlaying(){return this._playbackController.isPlaying}get isRestricted(){return xo.isRestricted}get metricsClientId(){return xo.metricsClientId}set metricsClientId(e){xo.metricsClientId=e}get musicUserToken(){return xo.musicUserToken}set musicUserToken(e){e&&xo.musicUserToken===e||(xo.musicUserToken=e)}updateUserTokenFromStorage(){return xo.updateUserTokenFromStorage()}get needsGDPR(){return xo.needsGDPR}get nowPlayingItem(){return this._mediaItemPlayback.nowPlayingItem}get nowPlayingItemIndex(){return this._playbackController.nowPlayingItemIndex}get playbackMode(){return this._playbackMode}set playbackMode(n){if(-1===Object.values(e.PlaybackMode).indexOf(n))return;this._playbackMode=n;const d=n===e.PlaybackMode.PREVIEW_ONLY,p=this._services.mediaItemPlayback;p&&(p.previewOnly=d)}get playbackRate(){return this._mediaItemPlayback.playbackRate}set playbackRate(e){this._mediaItemPlayback.playbackRate=e}get playbackState(){return this._mediaItemPlayback.playbackState}get playbackTargetAvailable(){return this._mediaItemPlayback.playbackTargetAvailable}get playbackTargetIsWireless(){return this._mediaItemPlayback.playbackTargetIsWireless}get previewOnly(){return this.playbackMode===e.PlaybackMode.PREVIEW_ONLY}set previewOnly(n){this.playbackMode=n?e.PlaybackMode.PREVIEW_ONLY:e.PlaybackMode.MIXED_CONTENT}get queue(){return this._playbackController.queue}get queueIsEmpty(){return this._playbackController.queue.isEmpty}get realm(){return xo.realm}get repeatMode(){return this._playbackController.repeatMode}set repeatMode(e){this._playbackController.repeatMode=e}set requestUserToken(e){xo.requestUserToken=e}get restrictedEnabled(){return xo.restrictedEnabled}set restrictedEnabled(e){xo.restrictedEnabled=e}get supportsPreviewImages(){return this._mediaItemPlayback.supportsPreviewImages}get seekSeconds(){return this._playbackController.seekSeconds}get services(){return this._services}set shuffle(e){this._playbackController.shuffle=e}get shuffleMode(){return this._playbackController.shuffleMode}set shuffleMode(e){this._playbackController.shuffleMode=e}get storefrontCountryCode(){return xo.storefrontCountryCode}get subscribeURL(){return xo.subscribeURL}get subscribeFamilyURL(){return xo.subscribeFamilyURL}get subscribeIndividualURL(){return xo.subscribeIndividualURL}get subscribeStudentURL(){return xo.subscribeStudentURL}get textTracks(){return this._mediaItemPlayback.textTracks}get videoContainerElement(){return this.context.videoContainerElement}set videoContainerElement(e){this.context.videoContainerElement=e}get volume(){return this._mediaItemPlayback.volume}set volume(e){this._mediaItemPlayback.volume=e}get storefrontId(){return xo.storefrontId}set storefrontId(e){xo.storefrontId=e}get _mediaItemPlayback(){return this._services.mediaItemPlayback}get _playbackController(){if(void 0!==this._playbackControllerInternal)return this._playbackControllerInternal;Vt.debug("setting _playbackController");const e=this._getPlaybackControllerByType(as.serial);return this._playbackController=e,e}set _playbackController(e){this._playbackControllerInternal=e,this._playbackControllerInternal.autoplayEnabled=this._autoplayEnabled,this._playbackControllerInternal.activate(),this.capabilities.updateChecker(this._playbackControllerInternal.hasCapabilities),this.capabilities.controller=this._playbackControllerInternal}addEventListener(e,n,d={}){adaptAddEventListener(this._services.dispatcher,e,n,d)}authorize(){var e=this;return _asyncToGenerator$i((function*(){return e.deferPlayback(),xo.authorize()}))()}canAuthorize(){return supportsDrm()&&!this.isAuthorized}canUnauthorize(){return supportsDrm()&&this.isAuthorized}changeToMediaAtIndex(e){var n=this;return _asyncToGenerator$i((function*(){n._isPlaybackSupported()&&(yield n._validateAuthorization(),n._signalChangeItemIntent(),yield n._playbackController.changeToMediaAtIndex(e))}))()}changeToMediaItem(e){var n=this;return _asyncToGenerator$i((function*(){Vt.debug("instance.changeToMediaItem",e),n._isPlaybackSupported()&&(yield n._validateAuthorization(),n._signalChangeItemIntent(),yield n._playbackController.changeToMediaItem(e))}))()}changeUserStorefront(e){var n=this;return _asyncToGenerator$i((function*(){n.storefrontId=e}))()}cleanup(){var n=this;return _asyncToGenerator$i((function*(){var d;null===(d=n._services.mediaItemPlayback)||void 0===d||d.destroy(),n._signalIntent({endReasonType:e.PlayActivityEndReasonType.EXITED_APPLICATION});const p=Object.keys(n._playbackControllers).map(e=>n._playbackControllers[e].destroy());try{yield Promise.all(p)}catch(Lr){Vt.error("Error cleaning up controller",Lr)}n._services.dispatcher.clear()}))()}configure(e){var n=this;return _asyncToGenerator$i((function*(){return n._whenConfigured=n._configure(e),n._whenConfigured}))()}_configure(e){var n=this;return _asyncToGenerator$i((function*(){yield xo.storekit.whenAuthCompleted;const d=e.map(n._services.apiManager.registerAPIService,n._services.apiManager);yield Promise.all(d),yield n._configurePlayActivity(),n._initializeExternalEventPublishing()}))()}deferPlayback(){Vt.debug("deferPlayback",this._playbackControllerInternal),deferPlayback()}getApiByType(e){var n;return null===(n=this._services.apiManager)||void 0===n?void 0:n.getApiByType(e)}me(){return _asyncToGenerator$i((function*(){try{return yield xo.storekit.me()}catch(Lr){return Promise.reject(new MKError(MKError.AUTHORIZATION_ERROR,"Unauthorized"))}}))()}musicSubscriptionOffers(){return xo.storekit.musicSubscriptionOffers(this.storefrontId)}musicSubcriptionOffers(){return deprecationWarning("musicSubcriptionOffers",{message:"musicSubcriptionOffers has been deprecated, use musicSubscriptionOffers instead"}),this.musicSubscriptionOffers()}hasMusicSubscription(){return hasMusicSubscription(xo.storekit)}mute(){return this._mediaItemPlayback.mute()}pause(n){var d=this;return _asyncToGenerator$i((function*(){if(d._isPlaybackSupported()){try{d._signalIntent({endReasonType:e.PlayActivityEndReasonType.PLAYBACK_MANUALLY_PAUSED}),yield d._playbackController.pause(n)}catch(Y){d._handlePlaybackError(Y)}return Promise.resolve()}}))()}play(){var e=this;return _asyncToGenerator$i((function*(){if(Vt.debug("instance.play()"),e._isPlaybackSupported()){yield e._validateAuthorization();try{yield e._playbackController.play()}catch(Y){e._handlePlaybackError(Y)}return Promise.resolve()}}))()}playMediaItem(e,n){var d=this;return _asyncToGenerator$i((function*(){if(Vt.debug("mk: playMediaItem",e),(null==n?void 0:n.bingeWatching)||d.deferPlayback(),n=_objectSpread$c({},n),(null==e?void 0:e.playEvent)&&!hasOwn(n,"startTime")){const{playEvent:d}=e;d.isDone||void 0===d.playCursorInSeconds||(n.startTime=d.playCursorInSeconds)}try{n&&d._mediaItemPlayback.playOptions.set(e.id,n);const p=yield d._playbackController.playSingleMediaItem(e,n);return d.services.dispatcher.publish(po.capabilitiesChanged),p}catch(Y){Vt.error("mk:playMediaItem error",Y),d._handlePlaybackError(Y)}}))()}removeEventListener(e,n){!function(e,n,d){const p=getCallbacksForName(n);let h;for(let y=p.length-1;y>=0;y--){const[e,n]=p[y];if(e===d){h=n,p.splice(y,1);break}}h&&e.unsubscribe(n,h)}(this._services.dispatcher,e,n)}shouldDisplayPrivacyLink(e){return _asyncToGenerator$i((function*(){return xo.shouldDisplayPrivacyLink(e)}))()}exitFullscreen(){return this._mediaItemPlayback.exitFullscreen()}requestFullscreen(e){return this._mediaItemPlayback.requestFullscreen(e)}loadPreviewImage(e){var n=this;return _asyncToGenerator$i((function*(){return n._mediaItemPlayback.loadPreviewImage(e)}))()}getNewSeeker(){return this._playbackController.getNewSeeker()}seekToTime(e,n=br.Manual){var d=this;return _asyncToGenerator$i((function*(){if(d._isPlaybackSupported()){yield d._validateAuthorization();try{yield d._playbackController.seekToTime(e,n)}catch(Y){d._handlePlaybackError(Y)}return Promise.resolve()}}))()}setPresentationMode(e){var n=this;return _asyncToGenerator$i((function*(){return n._mediaItemPlayback.setPresentationMode(e)}))()}skipToNextItem(){var n=this;return _asyncToGenerator$i((function*(){if(n._isPlaybackSupported()){yield n._validateAuthorization(),n._signalIntent({endReasonType:e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS,direction:e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS});try{yield n._playbackController.skipToNextItem()}catch(Y){n._handlePlaybackError(Y)}}}))()}skipToPreviousItem(){var n=this;return _asyncToGenerator$i((function*(){if(n._isPlaybackSupported()){yield n._validateAuthorization(),n._signalIntent({endReasonType:e.PlayActivityEndReasonType.TRACK_SKIPPED_BACKWARDS,direction:e.PlayActivityEndReasonType.TRACK_SKIPPED_BACKWARDS});try{yield n._playbackController.skipToPreviousItem()}catch(Y){n._handlePlaybackError(Y)}}}))()}seekForward(){var n=this;return _asyncToGenerator$i((function*(){if(n._isPlaybackSupported()){yield n._validateAuthorization();try{n._signalIntent({endReasonType:e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS,direction:e.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS}),yield n._playbackController.seekForward()}catch(Y){n._handlePlaybackError(Y)}}}))()}seekBackward(){var e=this;return _asyncToGenerator$i((function*(){if(e._isPlaybackSupported()){yield e._validateAuthorization();try{yield e._playbackController.seekBackward()}catch(Y){e._handlePlaybackError(Y)}}}))()}showPlaybackTargetPicker(){this._playbackController.showPlaybackTargetPicker()}stop(e){var n=this;return _asyncToGenerator$i((function*(){if(n._isPlaybackSupported()){var d;n._signalIntent({endReasonType:null==e?void 0:e.endReasonType,userInitiated:null===(d=null==e?void 0:e.userInitiated)||void 0===d||d});try{yield n._playbackController.stop(e)}catch(Y){n._handlePlaybackError(Y)}}}))()}resetSubscribeViewEligibility(){xo.storekit.resetSubscribeViewEligibility()}unauthorize(){return _asyncToGenerator$i((function*(){return xo.unauthorize()}))()}unmute(){return this._mediaItemPlayback.unmute()}_createPlayerControllerOptions(){return{tokens:xo,bag:Do,playbackServices:{getRTCStreamingTracker:()=>{var e;return null===(e=this._services.playActivity)||void 0===e?void 0:e.getTrackerByType(RTCStreamingTracker)},hasMusicSubscription:hasMusicSubscription,prepareForEncryptedPlayback:(e,n)=>function(e,n,d){return _prepareForEncryptedPlayback.apply(this,arguments)}(this._services.apiManager,e,n),requiresHlsJs:requiresHlsJs},services:this._services,context:this.context,autoplayEnabled:this.autoplayEnabled,privateEnabled:this.privateEnabled,siriInitiated:this.siriInitiated,storekit:null==xo?void 0:xo.storekit}}_getPlaybackControllerByType(e){const n=this._playbackControllers[e];if(n)return n;let d;switch(e){case as.serial:d=new SerialPlaybackController(this._createPlayerControllerOptions());break;case as.continuous:d=new ContinuousPlaybackController(this._createPlayerControllerOptions());break;default:throw new MKError(MKError.UNSUPPORTED_ERROR,"Unsupported controller requested: "+e)}return this._playbackControllers[e]=d,d}_handlePlaybackError(e){if(Vt.error("mediaPlaybackError",e),Ec.includes(e.name))throw e;this._playbackErrorDialog&&!qt&&MKDialog.presentError(e)}_initializeInternalEventHandling(){xo.storekit.addEventListener(po.userTokenDidChange,()=>{this._whenConfigured&&this._whenConfigured.then(()=>this._configurePlayActivity().catch()).catch()});const n=this._services.dispatcher;n.subscribe(po.mediaPlaybackError,(e,n)=>this._handlePlaybackError(n)),n.subscribe(po.playbackStateDidChange,(n,d)=>{d.state===e.PlaybackStates.paused&&(Vt.debug("mk: playbackStateDidChange callback - calling storekit.presentSubscribeViewForEligibleUsers"),xo.storekit.presentSubscribeViewForEligibleUsers({state:d.state,item:this.nowPlayingItem},!1))})}_initializeExternalEventPublishing(){[po.authorizationStatusDidChange,po.needsGDPRDidChange,po.storefrontCountryCodeDidChange,po.storefrontIdentifierDidChange,po.userTokenDidChange,po.eligibleForSubscribeView].forEach(e=>{xo.storekit.addEventListener(e,n=>this._services.dispatcher.publish(e,n))});const e=ae[this.storefrontId.toUpperCase()],n=ie[e];this._services.dispatcher.subscribe(Va,(e,d)=>{d.resolveAdamIdFromStorefront(n),this._services.dispatcher.publish(po.timedMetadataDidChange,d)})}configureLogger(e){var n;Vt.level===Ft&&(!0===e.debug?setRootLoggingLevel(A.DEBUG):void 0!==e.logLevel&&setRootLoggingLevel(e.logLevel)),void 0!==e.logHandler&&(n=e.logHandler,Vt.handlers.external=new CallbackHandler(n))}_configurePlayActivity(){var e=this;return _asyncToGenerator$i((function*(){void 0!==e._services.playActivity&&(yield e._services.playActivity.configure(e,{services:e._services}))}))()}_isPlaybackSupported(){return!qt||(Vt.warn("Media playback is not supported in Node environments."),!1)}_updatePlaybackController(e){var n=this;return _asyncToGenerator$i((function*(){Vt.debug("mk: _updatePlaybackController",e),n._playbackControllerInternal!==e&&(n._playbackControllerInternal&&(yield n._playbackControllerInternal.deactivate()),n._playbackController=e)}))()}_signalChangeItemIntent(){this._signalIntent({endReasonType:e.PlayActivityEndReasonType.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM})}_signalIntent(e){this.services.dispatcher.publish(hr.userActivityIntent,_objectSpread$c({userInitiated:!0},e))}_validateAuthorization(n=!1){var d=this;return _asyncToGenerator$i((function*(){(n||d.playbackMode===e.PlaybackMode.FULL_PLAYBACK_ONLY)&&(void 0!==d._playbackControllerInternal&&d._playbackControllerInternal.isReady&&d._playbackControllerInternal.isPlaying||(yield d.authorize()))}))()}constructor(n,d={}){if(this._autoplayEnabled=!1,this.privateEnabled=!1,this.siriInitiated=!1,this.sourceType=jr.MUSICKIT,this.version=e.version,this._bag=Do,this._playbackControllers={},this._playbackErrorDialog=!0,this._playbackMode=e.PlaybackMode.MIXED_CONTENT,this._whenConfigured=void 0,"string"!=typeof n)throw new Error("MusicKit was initialized without an developerToken.");Object.assign(Do.features,function(e=[]){const n={};return e.forEach(e=>{"-"===e.charAt(0)?(e=e.substr(1),n[e]=!1):n[e]=!0}),n}(d.features));const p=wc.get();p&&(Vt.warn("Overriding bag.features with",p),Do.features=_objectSpread$c({},Do.features,p)),Object.assign(Do.autoplay,d.autoplay),this.context={};const h=new PubSub;this.capabilities=new Capabilities(h),d.playbackActions&&(this.playbackActions=d.playbackActions),d.guid&&(this.guid=d.guid);const y=new TimingAccuracy(!!Do.features["player-accurate-timing"]),m=new BitrateCalculator(h,d.bitrate);this._services={dispatcher:h,timing:y,bitrateCalculator:m},void 0!==d.playActivityAPI&&(this._services.playActivity=new PlayActivityService(h,d.playActivityAPI)),d.services=this._services,this.configureLogger(d),Do.app=d.app||{},Do.store=new DataStore({filter:getFilterFromFlags(d.storeFilterTypes||[]),shouldDisableRecordReuse:!!Do.features["disable-data-store-record-reuse"]}),Object.assign(Do.urls,d.urls||{});const g=function(e,n){return xo=new Store(e,n),xo}(n,d);this._services.apiManager=new APIServiceManager(g,h);const b=new MediaItemPlayback(this._createPlayerControllerOptions());if(this._services.mediaItemPlayback=b,d.sourceType&&(this.sourceType=d.sourceType),this._initializeInternalEventHandling(),d.bitrate&&(this.bitrate=d.bitrate),d.prefix&&/^(?:web|preview)$/.test(d.prefix)&&(this.prefix=Do.prefix=d.prefix),d.suppressErrorDialog&&(this._playbackErrorDialog=!d.suppressErrorDialog),void 0!==d.playbackMode&&(this.playbackMode=d.playbackMode),this.privateEnabled=d.privateEnabled||!1,this.siriInitiated=d.siriInitiated||!1,this.id=generateUUID(),Vt.info("MusicKit JS Version: "+this.version),Vt.info("InstanceId",this.id),Vt.debug("Link Parameters",d.linkParameters),Do.app&&Vt.debug("App",Do.app),d.userToken){const{userToken:e}=d;"function"==typeof e?xo.dynamicMusicUserToken=e:this.musicUserToken=e}}}function asyncGeneratorStep$h(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$h(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$h(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$h(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function dispatchDocumentEvent(e){if(qt)return;const n=new Event(e,{bubbles:!0,cancelable:!0});setTimeout(()=>document.dispatchEvent(n))}function _loadWebComponents(){return(_loadWebComponents=_asyncToGenerator$h((function*(){var e;if(qt)return;const n=findScript("musickit.js");if(""!==(null==n||null===(e=n.dataset)||void 0===e?void 0:e.webComponents))return;const d="noModule"in n,p=`components/musickit-components/musickit-components${d?".esm":""}.js`,h="https:"+cdnBaseURL(p)+p,y={};d&&(y.type="module"),n.hasAttribute("async")&&(y.async=""),n.hasAttribute("defer")&&(y.defer=""),yield loadScript(h,y),dispatchDocumentEvent(po.webComponentsLoaded)}))).apply(this,arguments)}function asyncGeneratorStep$g(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$g(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$g(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$g(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$b(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$b(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$b(e,n,d[n])}))}return e}Tc([AsyncDebounce(250,{isImmediate:!0}),Sc("design:type",Function),Sc("design:paramtypes",["undefined"==typeof ActivityNotificationOptions?Object:ActivityNotificationOptions])],MKInstance.prototype,"pause",null),Tc([AsyncDebounce(250,{isImmediate:!0}),Sc("design:type",Function),Sc("design:paramtypes",[])],MKInstance.prototype,"play",null),Tc([SerialAsync("skip"),Sc("design:type",Function),Sc("design:paramtypes",[])],MKInstance.prototype,"skipToNextItem",null),Tc([SerialAsync("skip"),Sc("design:type",Function),Sc("design:paramtypes",[])],MKInstance.prototype,"skipToPreviousItem",null),Tc([SerialAsync("seek"),Sc("design:type",Function),Sc("design:paramtypes",[])],MKInstance.prototype,"seekForward",null),Tc([SerialAsync("seek"),Sc("design:type",Function),Sc("design:paramtypes",[])],MKInstance.prototype,"seekBackward",null);const Oc="undefined"!=typeof window&&"undefined"!=typeof document;let Ic=!1;const Ac=[];function cleanupInstances(){return _cleanupInstances.apply(this,arguments)}function _cleanupInstances(){return(_cleanupInstances=_asyncToGenerator$g((function*(){const e=Ac.map(e=>e.cleanup());yield Promise.all(e),Ac.splice(0,Ac.length)}))).apply(this,arguments)}function configure$2(e){return _configure$1.apply(this,arguments)}function _configure$1(){return(_configure$1=_asyncToGenerator$g((function*(e,n=MKInstance,d){if(!e)throw new MKError(MKError.INVALID_ARGUMENTS,"configuration required");const p={},{developerToken:h,mergeQueryParams:y}=e;if(!h)throw new MKError(MKError.CONFIGURATION_ERROR,"Missing developer token");y&&Oc&&window.location&&(p.linkParameters=_objectSpread$b({},e.linkParameters||{},parseQueryParams(window.location.href))),yield findKeySystemPreference();const m=new n(h,_objectSpread$b({},e,p));return Ic||(yield cleanupInstances()),d&&(yield d(m)),Ac.push(m),dispatchDocumentEvent(po.configured),m}))).apply(this,arguments)}function getInstances(){return Ac}function _defineProperty$a(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$a(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$a(e,n,d[n])}))}return e}function transformParameters(e,n=25){if(e)return e.limit&&(e.limit=e.limit>n?n:e.limit),e}function transformStoreData(e){const n=_objectSpread$a({},e),{href:d}=n;return void 0!==d&&(delete n.href,n.attributes=_objectSpread$a({},n.attributes,{href:d})),n}Oc&&(asAsync(function(){return _loadWebComponents.apply(this,arguments)}()),dispatchDocumentEvent(po.loaded));function transformTrackParameters(e){return e.map(e=>"string"==typeof e?{id:e,type:"songs"}:{id:e.id,type:e.type||"songs"})}const Rc=["extend","include","l","platform","views"];class LocalDataStore{get hasDataStore(){return this.enableDataStore&&void 0!==this._store}delete(e,n){this.hasDataStore&&this._store.remove(e,n)}read(e,n,d,p){p||"function"!=typeof d||(p=d,d=void 0);const h={};let y=!1;if(d&&(y=Object.keys(d).some(e=>/^(fields|extend)/.test(e)),d.views&&(h.views=d.views),d.include&&(h.relationships=d.include)),this.hasDataStore&&!y){let p,y=[];if(d&&(y=Object.keys(d).reduce((e,n)=>(-1===Rc.indexOf(n)&&e.push([n,d[n]]),e),y)),p=y&&1===y.length?this._store.query(y[0][0],y[0][1]):this._store.peek(e,n,h),Array.isArray(p)){if(!d&&p.length)return p}else if(p)return p}if("function"==typeof p)return p()}write(e){return this._prepareDataForDataStore(e,e=>this._store.save(e))}parse(e){return this._prepareDataForDataStore(e,e=>this._store.populateDataRecords(e,{}))}_prepareDataForDataStore(e,n){return this.hasDataStore?Array.isArray(e)?n({data:e}):Object.keys(e).reduce((d,p)=>{const h=e[p];return hasOwn(h,"data")&&(d[p]=n({data:h.data})),"meta"===p&&(d[p]=e[p]),d},{}):e}constructor(e={}){this.enableDataStore=!1;let n=!1;e.features&&hasOwn(e.features,"api-data-store")&&(this.enableDataStore=!!e.features["api-data-store"]),e.features&&hasOwn(e.features,"disable-data-store-record-reuse")&&(n=!!e.features["disable-data-store-record-reuse"]),this.enableDataStore&&(this._store=e.store||new DataStore({shouldDisableRecordReuse:n}),this._store.mapping=transformStoreData)}}function asyncGeneratorStep$f(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$f(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$f(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$f(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}const ChunkedIdApi=(e,n=100,d=1e3)=>(p,h,y)=>{if(void 0===y||"function"!=typeof y.value)throw new TypeError(`Only methods can be decorated with @ChunkedIdApi, but ${h} is not a method.`);return{configurable:!0,get(){const p=y.value;function chunkedIdApi(){return _chunkedIdApi.apply(this,arguments)}function _chunkedIdApi(){return(_chunkedIdApi=_asyncToGenerator$f((function*(...h){const y=h[e];if(y&&Array.isArray(y)){const m=y[0].length||20,g=Math.min(n,Math.floor(d/m)),b=Math.ceil(y.length/g);if(b>1){const n=h.slice(0,e),d=h.slice(e+1),m=[];let _=0;for(let e=1;e<=b;e++){const h=Math.min(e*g,y.length),b=[...n,y.slice(_,h),...d];m.push(p.apply(this,b)),_+=g}const P=yield Promise.all(m);return[].concat(...P)}}return p.apply(this,h)}))).apply(this,arguments)}return Object.defineProperty(this,h,{value:chunkedIdApi,configurable:!0,writable:!0}),chunkedIdApi}}},formatTimezoneOffset=(e=new Date)=>{const n=e.getTimezoneOffset(),d=Math.floor(Math.abs(n)/60),p=Math.round(Math.abs(n)%60);let h="+";return 0!==n&&(h=n>0?"-":"+"),`${h}${leadingZeros(d,2)}:${leadingZeros(p,2)}`},leadingZeros=(e,n=2)=>{let d=""+e;for(;d.length<n;)d="0"+d;return d};function asyncGeneratorStep$e(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$e(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$e(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$e(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$9(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpreadProps$8(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}var Cc={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},Mc={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};class Books extends TokenSession{audioBook(e,n,d){return this.resource("audio-books",e,n,d)}audioBooks(e,n,d){return this.collection("audio-books",e,n,d)}collection(e,n,d,p){var h=this;return _asyncToGenerator$e((function*(){const y=`catalog/${h.storefrontId}/${e}`;return n&&((d=d||{}).ids=n),makeRequest(h,y,d,p)}))()}parseResultData(e,n){return e?this._store.write(n):this._store.parse(n)}resource(e,n,d,p){var h=this;return _asyncToGenerator$e((function*(){if(!(null==p?void 0:p.reload)){const p=h._store.read(e,n,d);if(p)return p}const[y]=yield h.collection(e,n,d,p);return y}))()}constructor(e,n,d,p,h={},y){super("https://api.books.apple.com/v1",e,_objectSpreadProps$8(function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$9(e,n,d[n])}))}return e}({},y),{userToken:n,storage:p})),this.storefrontId=Ne.ID,d&&(this.storefrontId=d),this._store=new LocalDataStore(h),this.defaultIncludePaginationMetadata=h.features&&hasOwn(h.features,"api-pagination-metadata")}}function asyncGeneratorStep$d(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$d(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$d(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$d(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$8(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$8(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$8(e,n,d[n])}))}return e}function _objectSpreadProps$7(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}Cc([ChunkedIdApi(1),Mc("design:type",Function),Mc("design:paramtypes",[String,Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof InternalMakeRequestOptions?Object:InternalMakeRequestOptions])],Books.prototype,"collection",null);var Dc={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},jc={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};class Podcasts extends TokenSession{catalogResource(e,n,d,p){return this.resource(e,n,d,p)}catalogResources(e,n,d,p){return this.collection(e,n,d,p)}catalogResourceRelationship(e,n,d,p,h){return this.collection(`${e}/${n}/${d}`,void 0,p,h)}search(e,n,d){return this.collection("search",void 0,_objectSpread$8({term:e,types:"podcasts"},n),d)}artist(e,n,d){return this.catalogResource("artists",e,n,d)}artists(e,n,d){return this.catalogResources("artists",e,n,d)}artistRelationship(e,n,d,p){return this.catalogResourceRelationship("artists",e,n,d,p)}charts(e,n,d){return this.catalogResources("charts",void 0,_objectSpread$8({types:e},n),d)}podcast(e,n,d){return this.catalogResource("podcasts",e,_objectSpread$8({include:"episodes"},n),d)}podcasts(e,n,d){var p=this;return _asyncToGenerator$d((function*(){return p.catalogResources("podcasts",e,_objectSpread$8({include:"episodes"},n),d)}))()}podcastRelationship(e,n,d,p){var h=this;return _asyncToGenerator$d((function*(){return h.catalogResourceRelationship("podcasts",e,n,d,p)}))()}episode(e,n,d){var p=this;return _asyncToGenerator$d((function*(){return p.resource("podcast-episodes",e,n,d)}))()}episodes(e,n,d){var p=this;return _asyncToGenerator$d((function*(){return p.catalogResources("podcast-episodes",e,n,d)}))()}collection(e,n,d,p){var h=this;return _asyncToGenerator$d((function*(){let y;if(n){const p={};p["charts"===e?"types":"ids"]=n,y=Object.assign(p,d)}else y=d;const m=`catalog/${h.storefrontId}/${e}`;return makeRequest(h,m,y,p)}))()}parseResultData(e,n){return e?this._store.write(n):this._store.parse(n)}resource(e,n,d,p){var h=this;return _asyncToGenerator$d((function*(){if(!(null==p?void 0:p.reload)){const p=h._store.read(e,n,d);if(p)return p}const[y]=yield h.collection(e,n,d,p);return y}))()}constructor(e,n,d=Ne.ID,p,h={},y){super("https://amp-api.podcasts.apple.com/v1",e,_objectSpreadProps$7(_objectSpread$8({},y),{userToken:n,storage:p})),this.storefrontId=d,this._store=new LocalDataStore(h),this.defaultIncludePaginationMetadata=h.features&&hasOwn(h.features,"api-pagination-metadata")}}function asyncGeneratorStep$c(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _defineProperty$7(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$7(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$7(e,n,d[n])}))}return e}function _objectSpreadProps$6(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}Dc([ChunkedIdApi(1),jc("design:type",Function),jc("design:paramtypes",[String,Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof InternalMakeRequestOptions?Object:InternalMakeRequestOptions])],Podcasts.prototype,"collection",null);var xc={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},$c={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};const Lc=new Set(["editorial-items"]);class Fitness extends TokenSession{workout(e,n,d){return this.resource("workouts",e,n,d)}contributor(e,n,d){return this.resource("contributors",e,n,d)}editorialItem(e,n,d){return this.resource("editorial-items",e,n,d)}modalities(e,n,d){return this.collection("modalities",e,n,d)}modality(e,n,d){return this.resource("modalities",e,n,d)}workoutProgram(e,n,d){return this.resource("workout-programs",e,n,d)}collection(e,n,d,p){let h;h=n?_objectSpread$7({ids:n},d):d;let y="catalog";Lc.has(e)&&(y="editorial");return makeRequest(this,`${y}/${this.storefrontId}/${e}`,h,p)}parseResultData(e,n){return e?this._store.write(n):this._store.parse(n)}resource(e,n,d,p){var h,y=this;return(h=function*(){const h=y._store.read(e,n,d);if(h)return h;const[m]=yield y.collection(e,n,d,p);return m},function(){var e=this,n=arguments;return new Promise((function(d,p){var y=h.apply(e,n);function _next(e){asyncGeneratorStep$c(y,d,p,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$c(y,d,p,_next,_throw,"throw",e)}_next(void 0)}))})()}constructor(e,n,d=Ne.ID,p,h={},y){var m;super("https://amp-api.fitness.apple.com/v1",e,_objectSpreadProps$6(_objectSpread$7({},y),{userToken:n,storage:p})),this.storefrontId=Ne.ID,this.storefrontId=d,this._store=new LocalDataStore(h),this.defaultIncludePaginationMetadata=!!(null==h||null===(m=h.features)||void 0===m?void 0:m["api-pagination-metadata"])}}function asyncGeneratorStep$b(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$b(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$b(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$b(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$6(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$6(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$6(e,n,d[n])}))}return e}function _objectSpreadProps$5(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}xc([ChunkedIdApi(1),$c("design:type",Function),$c("design:paramtypes",[String,Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof MakeRequestOptions?Object:MakeRequestOptions])],Fitness.prototype,"collection",null);var Nc={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},Uc={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};class TVLibrary extends TokenSession{genres(e,n){var d=this;return _asyncToGenerator$b((function*(){return d.collection("genres",_objectSpread$6({types:"tv-episodes,movies"},e),n)}))()}movies(e,n){var d=this;return _asyncToGenerator$b((function*(){return d.collection("movies",e,n)}))()}purchases(e,n){var d=this;return _asyncToGenerator$b((function*(){return d.collection("",_objectSpread$6({types:"tv-episodes,movies"},e),n)}))()}tvEpisodes(e,n){var d=this;return _asyncToGenerator$b((function*(){return d.collection("tv-episodes",e,n)}))()}collection(e,n,d){var p=this;return _asyncToGenerator$b((function*(){try{return yield makeRequest(p,"me/purchases/"+e,n,d)}catch(Y){if(Y.name===MKError.CONTENT_UNAVAILABLE)return(null==d?void 0:d.includePagination)?{data:[],meta:{}}:[];throw Y}}))()}parseResultData(e,n){return e?this._store.write(n):this._store.parse(n)}constructor(e,n,d,p={},h){super("https://amp-api.videos.apple.com/v1",e,_objectSpreadProps$5(_objectSpread$6({},h),{userToken:n,storage:d})),this._store=new LocalDataStore(p),this.defaultIncludePaginationMetadata=p.features&&hasOwn(p.features,"api-pagination-metadata")}}function asyncGeneratorStep$a(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$a(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$a(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$a(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$5(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$5(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$5(e,n,d[n])}))}return e}function _objectSpreadProps$4(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}Nc([ChunkedIdApi(1),Uc("design:type",Function),Uc("design:paramtypes",[String,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof InternalMakeRequestOptions?Object:InternalMakeRequestOptions])],TVLibrary.prototype,"collection",null);const RecommendationUpdate=()=>(e,n,d)=>{if(void 0===d||"function"!=typeof d.value)throw new TypeError(`Only methods can be decorated with @RecommendationUpdate, but ${n} is not a method.`);return{configurable:!0,get(){const e=d.value;function recommendationUpdate(){return _recommendationUpdate.apply(this,arguments)}function _recommendationUpdate(){return(_recommendationUpdate=_asyncToGenerator$a((function*(...n){const d=yield e.apply(this,n),p=new Map,h=[],y=new Date;if(!d||!Array.isArray(d))return d;if(d.forEach((e,n)=>{var d;const m=e.id;var g;const b=null!==(g=e.nextUpdateDate)&&void 0!==g?g:null===(d=e.attributes)||void 0===d?void 0:d.nextUpdateDate;if(!m||!b)return;new Date(b)<y&&(h.push(m),p.set(m,n))}),!h.length)return d;let[m,g,b,..._]=n;b=_objectSpreadProps$4(_objectSpread$5({},b),{reload:!0});const P=[h,g,b,..._];return(yield e.apply(this,P)).forEach(e=>{const n=p.get(e.id);void 0!==n&&(d[n]=e)}),d}))).apply(this,arguments)}return Object.defineProperty(this,n,{value:recommendationUpdate,configurable:!0,writable:!0}),recommendationUpdate}}};function asyncGeneratorStep$9(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function makeAlbumKey(e){var n;return(null===(n=e.artwork)||void 0===n?void 0:n.url)+""+e.artistName+""+e.name}class ServerLedger{_initData(){return{lastTimestamp:0,albums:{added:Object.create(null),removed:Object.create(null)},playlists:{added:Object.create(null),removed:Object.create(null)}}}_checkTimestamp(){const e=this._data.lastTimestamp;e&&e+24e5<Date.now()&&(this._data=this._initData(),this._sessionStorage&&this._sessionStorage.removeItem(this._storageKey))}added(e){this.load();const n=null==e?void 0:e.playlists,d=null==e?void 0:e.albums;return n||d?(n&&n.forEach(e=>{const n=Date.now();this._data.playlists.added[e]=n,this._data.lastTimestamp=n}),d&&d.forEach(e=>{const n=Date.now();this._data.albums.added[e]=n,this._data.lastTimestamp=n}),this.save(),e):e}removed(e){this.load();const n=null==e?void 0:e.playlists;return n?(ensureArray(n).forEach(e=>{if(0!==e.indexOf("pl.")){const n=Date.now();this._data.playlists.removed[e]=n,this._data.lastTimestamp=n}}),this.save(),e):e}reconcile(e,n,d,p,h){var y,m=this;return(y=function*(){m._checkTimestamp();const h=n.data||n;if(!h||!Array.isArray(h)||Array.isArray(d))return n;const y=m._data.albums.added,g=m._data.playlists.removed,b=m._data.playlists.added,_=[],P=p&&!p.offset||!!d&&(void 0===d.offset||0===d.offset);let T=!1;if("all"===e||"playlists"===e){for(let e=h.length-1;e>=0;e--){var S;const n=h[e],d=null===(S=n.playParams)||void 0===S?void 0:S.globalId;"library-playlists"===n.type&&(g[n.id]?h.splice(e,1):d&&b[d]&&(delete b[d],T=!0,P||h.splice(e,1)))}if(P&&m._catalogApi){const e=Object.keys(b);if(e.length){const n=yield m._catalogApi.playlists(e);_.splice(0,0,...n)}}}if(m._catalogApi&&("all"===e||"albums"===e)){const e=Object.keys(y);if(e.length){const n=yield m._catalogApi.albums(e),d=Object.create(null);n.forEach((n,p)=>{const h=makeAlbumKey(n);d[h]={catalogId:e[p],album:n}});for(let e=h.length-1;e>=0;e--){var E;const n=h[e];if(null===(E=n.playParams)||void 0===E||E.globalId,"library-albums"===n.type){const p=makeAlbumKey(n),m=d[p];m&&(delete y[m.catalogId],T=!0,P?delete d[p]:h.splice(e,1))}}if(P){const e=Object.keys(d).map(e=>d[e].album);e.length&&_.splice(0,0,...e)}}}if(T&&m.save(),P&&_.length&&(_.sort((e,n)=>{const d=m._data.albums.added[e.id]||m._data.playlists.added[e.id]||0;return(m._data.albums.added[n.id]||m._data.playlists.added[n.id]||0)-d}),h.splice(0,0,..._)),!h.length)throw new MKError(MKError.CONTENT_UNAVAILABLE,"The requested content is not available.");const k=n.meta;return k&&void 0===k.total&&(k.total=h.length),n},function(){var e=this,n=arguments;return new Promise((function(d,p){var h=y.apply(e,n);function _next(e){asyncGeneratorStep$9(h,d,p,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$9(h,d,p,_next,_throw,"throw",e)}_next(void 0)}))})()}load(){if(!this._sessionStorage)return;const e=this._sessionStorage.getItem(this._storageKey);if(e)try{this._data=JSON.parse(e),this._data.albums&&this._data.playlists||(this._data=this._initData())}catch(Lr){this._data||(this._data=this._initData())}else this._data=this._initData()}save(){if(!this._sessionStorage)return;const e=this._data,n=0===Object.keys(e.albums.added).length&&0===Object.keys(e.albums.removed).length&&0===Object.keys(e.playlists.added).length&&0===Object.keys(e.playlists.removed).length;try{if(n)this._sessionStorage.getItem(this._storageKey)&&this._sessionStorage.removeItem(this._storageKey);else{const e=JSON.stringify(this._data);this._sessionStorage.setItem(this._storageKey,e)}}catch(Lr){}}constructor(e,n,d){this._data=this._initData(),this._catalogApi=n,this._storageKey="mk-server-ledger:"+(e||""),this._sessionStorage=d||getSessionStorage(),this.load()}}function asyncGeneratorStep$8(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$8(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$8(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$8(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$4(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$4(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$4(e,n,d[n])}))}return e}function _objectSpreadProps$3(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}var Gc={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},Bc={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};const Fc="me/library";class Library extends TokenSession{add(e){var n=this;return _asyncToGenerator$8((function*(){const d=transformKeys(e,dasherize),p=Date.now();if(p-n._last<1e3)return Promise.reject(new MKError(MKError.QUOTA_EXCEEDED));const h=new Headers({Authorization:"Bearer "+n.developerToken,[se]:n.userToken}),y=Object.keys(d).map(e=>`ids[${e}]=${d[e].join(",")}`).join("&");try{const e=yield fetch(`${n.url}/${Fc}?${y}`,{method:"POST",headers:h});return e.ok?(n._last=p,n._serverLedger.added(d)):Promise.reject(MKError.responseError(e))}catch(m){return Promise.reject(MKError.responseError(m))}}))()}remove(e){var n=this;return _asyncToGenerator$8((function*(){if(!n.developerToken||!n.userToken)return Promise.reject("Invalid tokens");const d=new Headers({Authorization:"Bearer "+n.developerToken,[se]:n.userToken}),p=transformKeys(e,dasherize),h=Object.keys(p)[0],y=Object.values(p)[0];try{const e=yield fetch(`${n.url}/${Fc}/${h}/${y}`,{method:"DELETE",headers:d});return e.ok?n._serverLedger.removed(p):Promise.reject(MKError.responseError(e))}catch(m){return Promise.reject(MKError.responseError(m))}}))()}album(e,n,d){var p=this;return _asyncToGenerator$8((function*(){return p.resource("albums",e,n,d)}))()}albumRelationship(e,n,d,p){var h=this;return _asyncToGenerator$8((function*(){return h.collection(`albums/${e}/${n}`,void 0,d,p)}))()}albums(e,n,d){var p=this;return _asyncToGenerator$8((function*(){let h;try{h=yield p.collection("albums",e,n,_objectSpreadProps$3(_objectSpread$4({},d),{shouldCacheResults:!1}))}catch(Lr){if(Lr.errorCode!==MKError.CONTENT_UNAVAILABLE)throw Lr;h={data:[],meta:{}}}return p._serverLedger.reconcile("albums",h,e,n,d)}))()}artist(e,n,d){var p=this;return _asyncToGenerator$8((function*(){return p.resource("artists",e,n,d)}))()}artistRelationship(e,n="albums",d,p){var h=this;return _asyncToGenerator$8((function*(){return h.collection(`artists/${e}/${n}`,void 0,d,p)}))()}artists(e,n,d){var p=this;return _asyncToGenerator$8((function*(){return p.collection("artists",e,n,d)}))()}createPlaylist(e={},n){var d=this;return _asyncToGenerator$8((function*(){let p;const{name:h,description:y,tracks:m=[]}=e,g={attributes:{name:h,description:y},relationships:{tracks:{data:transformTrackParameters(m)}}},b=JSON.stringify(g);try{p=yield d.request(Fc+"/playlists",n,{body:b,method:"POST"})}catch(Y){return Promise.reject(MKError.responseError(Y))}try{const[e]=d._store.write(p);return e}catch(Y){return Promise.reject(MKError.parseError(Y))}}))()}deletePlaylist(e,n){var d=this;return _asyncToGenerator$8((function*(){let p;const h=`${Fc}/playlists/${e}`;try{p=yield d.request(h,n,{method:"DELETE"})}catch(Y){return Promise.reject(MKError.responseError(Y))}d.purgePlaylistFromCaches(e)}))()}editPlaylist(e,n,d){var p=this;return _asyncToGenerator$8((function*(){let h;const y=JSON.stringify({attributes:n});try{h=yield p.request(`${Fc}/playlists/${e}`,d,{body:y,method:"PATCH"})}catch(Y){return Promise.reject(MKError.responseError(Y))}try{const d=n,h="library-playlists";return p._store.write({data:[{type:h,id:e,attributes:d}]}),n}catch(Y){return Promise.reject(MKError.parseError(Y))}}))()}updatePlaylistTracklist(e,n){var d=this;return _asyncToGenerator$8((function*(){yield d.putPlaylistTracklisting(e,n,"PUT"),d.purgePlaylistFromCaches(e)}))()}appendTracksToPlaylist(e,n){var d=this;return _asyncToGenerator$8((function*(){yield d.putPlaylistTracklisting(e,n,"POST"),d.purgePlaylistFromCaches(e)}))()}playlistFolder(e,n,d){return this.resource("playlist-folders",e,n,d)}playlistFolders(e,n,d){return this.collection("playlist-folders",e,n,d)}playlistFoldersRoot(e,n){return e=_objectSpreadProps$3(_objectSpread$4({},e),{filter:_objectSpreadProps$3(_objectSpread$4({},null==e?void 0:e.filter),{identity:"playlistsroot"})}),this.playlistFolders(void 0,e,n)}playlistFolderChildren(e,n,d){const p=`playlist-folders/${e}/children`;return this.collection(p,void 0,n,d)}musicVideo(e,n,d){var p=this;return _asyncToGenerator$8((function*(){return p.resource("music-videos",e,n,d)}))()}musicVideos(e,n,d){var p=this;return _asyncToGenerator$8((function*(){return p.collection("music-videos",e,n,d)}))()}parseResultData(e,n){return e?this._store.write(n):this._store.parse(n)}playlist(e,n,d){var p=this;return _asyncToGenerator$8((function*(){return n=_objectSpread$4({include:"tracks"},n),p.resource("playlists",e,n,d)}))()}createCatalogPlaylist(e,n,d){var p=this;return _asyncToGenerator$8((function*(){return d=_objectSpread$4({method:"POST"},d),p.resource(`playlists/${e}/catalog`,void 0,n,d)}))()}playlistRelationship(e,n="tracks",d,p){var h=this;return _asyncToGenerator$8((function*(){return h.collection(`playlists/${e}/${n}`,void 0,d,p)}))()}playlists(e,n,d){var p=this;return _asyncToGenerator$8((function*(){let h;try{h=e&&e.length>0?yield Promise.all(e.map(e=>p.playlist(e,n,d))):yield p.collection("playlists",e,n,_objectSpreadProps$3(_objectSpread$4({},d),{shouldCacheResults:!1}))}catch(Lr){if(Lr.errorCode!==MKError.CONTENT_UNAVAILABLE)throw Lr;h={data:[],meta:{}}}return p._serverLedger.reconcile("playlists",h,e,n,d)}))()}recentlyAdded(e,n){var d=this;return _asyncToGenerator$8((function*(){const p=null==e?void 0:e.limit;let h;try{h=yield d.collection("recently-added",void 0,transformParameters(e,p||10),_objectSpreadProps$3(_objectSpread$4({},n),{shouldCacheResults:!1}))}catch(Lr){if(Lr.errorCode!==MKError.CONTENT_UNAVAILABLE)throw Lr;h={data:[],meta:{}}}return d._serverLedger.reconcile("all",h,void 0,e,n)}))()}search(e,n,d){var p=this;return _asyncToGenerator$8((function*(){n=p._denormalizeLibraryTypes(n);const h=_objectSpread$4({term:e,types:"library-albums"},n);return p.collection("search",void 0,h,_objectSpreadProps$3(_objectSpread$4({},d),{shouldCacheResults:!1}))}))()}song(e,n,d){var p=this;return _asyncToGenerator$8((function*(){return p.resource("songs",e,n,d)}))()}songRelationship(e,n,d,p){var h=this;return _asyncToGenerator$8((function*(){return h.collection(`songs/${e}/${n}`,void 0,d,p)}))()}songs(e,n,d){var p=this;return _asyncToGenerator$8((function*(){return p.collection("songs",e,n,d)}))()}collection(e,n,d,p){var h=this;return _asyncToGenerator$8((function*(){!n||n.length||d||(d=transformParameters(n,100),n=void 0);const y=n?_objectSpread$4({ids:n},d):d;return makeRequest(h,`${Fc}/${e}`,y,p)}))()}resource(e,n,d,p){var h=this;return _asyncToGenerator$8((function*(){if(!(null==p?void 0:p.reload)){const p=h._store.read(e,n,d);if(p)return p}let y=`${Fc}/${e}`;n&&(y=`${y}/${n}`);const[m]=yield makeRequest(h,y,d,p);return m}))()}purgePlaylistFromCaches(e){this._store.delete("library-playlists",e),this.networkCache.removeItemsMatching(this.constructURL(`${Fc}/playlists/${e}`,{}),!1)}putPlaylistTracklisting(e,n,d="PUT"){var p=this;return _asyncToGenerator$8((function*(){const h=transformTrackParameters(n),y=JSON.stringify({data:h});try{yield p.request(`${Fc}/playlists/${e}/tracks`,void 0,{body:y,method:d})}catch(Y){return Promise.reject(MKError.responseError(Y))}}))()}_denormalizeLibraryTypes(e={},n="types"){let d=e[n];return d?("string"==typeof d&&(d=d.split(",")),e[n]=d.map(e=>e.replace(/^(albums|music-videos|playlists|songs)$/,"library-$1")),e):e}constructor(e,n,d,p={},h,y){super(e,n,_objectSpreadProps$3(_objectSpread$4({},y),{userToken:d})),this._last=0,this._store=new LocalDataStore(p),this._serverLedger=new ServerLedger(d,h),this.defaultIncludePaginationMetadata=p.features&&hasOwn(p.features,"api-pagination-metadata")}}function asyncGeneratorStep$7(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$7(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$7(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$7(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$3(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$3(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$3(e,n,d[n])}))}return e}function _objectSpreadProps$2(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}Gc([ChunkedIdApi(1),Bc("design:type",Function),Bc("design:paramtypes",[String,Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof MakeRequestOptions?Object:MakeRequestOptions])],Library.prototype,"collection",null);var Kc,Vc,Hc={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},qc={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};!function(e){e[e.Global=0]="Global",e.Lyrics="lyrics",e.Catalog="catalog",e.Personalized="me",e.Editorial="editorial",e.Engagement="engagement",e.Social="social"}(Kc||(Kc={})),function(e){e.songs="songs",e.albums="albums",e.playlists="playlists",e.stations="stations",e["music-videos"]="music-videos",e["library-music-videos"]="library-music-videos",e["library-playlists"]="library-playlists",e["library-songs"]="library-songs"}(Vc||(Vc={}));class API extends TokenSession{get needsEquivalents(){const{userStorefrontId:e}=this;return void 0!==e&&""!==e&&e!==this.storefrontId}activity(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.resource(Kc.Catalog,"activities",e,n,d)}))()}activities(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.collection(Kc.Catalog,"activities",e,n,d)}))()}album(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.resource(Kc.Catalog,"albums",e,n,d)}))()}albumRelationship(e,n,d,p){var h=this;return _asyncToGenerator$7((function*(){return h.collection(Kc.Catalog,`albums/${e}/${n}`,void 0,d,p)}))()}albums(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.collection(Kc.Catalog,"albums",e,n,d)}))()}appleCurator(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.resource(Kc.Catalog,"apple-curators",e,n,d)}))()}appleCurators(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.collection(Kc.Catalog,"apple-curators",e,n,d)}))()}artist(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.resource(Kc.Catalog,"artists",e,n,d)}))()}artistRelationship(e,n,d,p){var h=this;return _asyncToGenerator$7((function*(){return h.collection(Kc.Catalog,`artists/${e}/${n}`,void 0,d,p)}))()}artistView(e,n,d,p){return this.collection(Kc.Catalog,`artists/${e}/view/${n}`,void 0,d,p)}artists(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.collection(Kc.Catalog,"artists",e,n,d)}))()}audioBook(e,n,d){return this.books.audioBook(e,n,d)}audioBooks(e,n,d){return this.books.audioBooks(e,n,d)}catalogResources(e,n={},d){const p=function(e){const n={};if(!e)return n;for(const d of e){if(!d)continue;const{type:e,id:p}=d;e in n||(n[e]=[]),n[e].push(p)}return n}(e);return n=_objectSpreadProps$2(_objectSpread$3({},n),{ids:p}),makeRequest(this,`${Kc.Catalog}/${this.storefrontId}`,n,d)}changeStation(e,n,d={}){var p=this;return _asyncToGenerator$7((function*(){return yield makeRequest(p,"me/stations/change-station/"+e,n,_objectSpreadProps$2(_objectSpread$3({},d),{reload:!0,method:"POST",shouldCacheResults:!1}))}))()}charts(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.collection(Kc.Catalog,"charts",e,n,_objectSpreadProps$2(_objectSpread$3({},d),{returnRawJSONApiRecords:!0}))}))()}contents(e,n,d){return this.collection(Kc.Catalog,"contents",e,n,d)}curator(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.resource(Kc.Catalog,"contents",e,n,d)}))()}curators(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.collection(Kc.Catalog,"contents",e,n,d)}))()}curatorRelationship(e,n,d,p){var h=this;return _asyncToGenerator$7((function*(){return h.collection(Kc.Catalog,`curators/${e}/${n}`,void 0,d,p)}))()}episode(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p._podcastsAPI.catalogResource("podcast-episodes",e,n,d)}))()}episodes(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p._podcastsAPI.catalogResources("podcast-episodes",e,n,d)}))()}genre(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.resource(Kc.Catalog,"genres",e,n,d)}))()}genres(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.collection(Kc.Catalog,"genres",e,n,d)}))()}grouping(e,n,d){var p=this;return _asyncToGenerator$7((function*(){!n&&isObject(e)&&(n=e,e=void 0);const h=_objectSpread$3({},{platform:"desktop"},n);return p.resource(Kc.Editorial,"groupings",e,h,_objectSpreadProps$2(_objectSpread$3({},d),{shouldCacheResults:!1}))}))()}groupings(e,n={},d){var p=this;return _asyncToGenerator$7((function*(){const h=_objectSpread$3({},{platform:"desktop"},n);return p.collection(Kc.Editorial,"groupings",e,h,_objectSpreadProps$2(_objectSpread$3({},d),{shouldCacheResults:!1}))}))()}lyric(e,n,d){return this.resource(Kc.Catalog,`songs/${e}/lyrics`,"",n,_objectSpread$3({reload:!0},d))}lyricSnippet(e,n,d){return this.collection(Kc.Lyrics,"snippet/songs",e,n,_objectSpreadProps$2(_objectSpread$3({},d),{returnRawJSONApiRecords:!0}))}historyHeavyRotation(e,n){var d=this;return _asyncToGenerator$7((function*(){return d.collection(Kc.Personalized,"history/heavy-rotation",void 0,transformParameters(e,10),n)}))()}multiplex(e,n,d){var p=this;return _asyncToGenerator$7((function*(){const h=p._store.read("multiplex",e,n);return h||(d=_objectSpread$3({returnRawJSONApiRecords:!0},d),makeRequest(p,`${Kc.Editorial}/${p.storefrontId}/multiplex/${e}`,n,d))}))()}multiroom(e,n,d){var p=this;return _asyncToGenerator$7((function*(){const h=p._store.read("multirooms",e,n);if(h)return h;const[y]=yield p.collection(Kc.Editorial,"multirooms/"+e,void 0,n,d);return y}))()}musicMovie(e,n,d){return this.resource(Kc.Catalog,"music-movies",e,n,d)}musicMovies(e,n,d){return this.collection(Kc.Catalog,"music-movies",e,n,d)}musicVideo(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.resource(Kc.Catalog,"music-videos",e,n,d)}))()}musicVideos(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.collection(Kc.Catalog,"music-videos",e,n,d)}))()}nextStationTracks(e,n,d={}){var p=this;return _asyncToGenerator$7((function*(){var h;const y=null!==(h=d.queryParameters)&&void 0!==h?h:{};(null==n?void 0:n.clean)&&(y.clean=n.clean,delete n.clean),(null==n?void 0:n.limit)&&(y.limit=n.limit,delete n.limit);return yield makeRequest(p,"me/stations/next-tracks/"+e,n,_objectSpreadProps$2(_objectSpread$3({},d),{reload:!0,method:"POST",queryParameters:y,shouldCacheResults:!1}))}))()}continuousStation(e,n,d={}){var p=this;return _asyncToGenerator$7((function*(){return yield makeRequest(p,"me/stations/continuous",e,_objectSpreadProps$2(_objectSpread$3({},d),{reload:!0,method:"POST",queryParameters:n,returnRawJSONApiRecords:!0,shouldCacheResults:!1}))}))()}playlist(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.resource(Kc.Catalog,"playlists",e,n,d)}))()}playlistRelationship(e,n,d,p){var h=this;return _asyncToGenerator$7((function*(){return h.collection(Kc.Catalog,`playlists/${e}/${n}`,void 0,d,p)}))()}playlists(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.collection(Kc.Catalog,"playlists",e,n,d)}))()}podcast(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p._podcastsAPI.catalogResource("podcasts",e,_objectSpread$3({include:"episodes"},n),d)}))()}podcastRelationship(e,n,d,p){var h=this;return _asyncToGenerator$7((function*(){return h._podcastsAPI.catalogResourceRelationship("podcasts",e,n,d,p)}))()}podcasts(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p._podcastsAPI.catalogResources("podcasts",e,_objectSpread$3({include:"episodes"},n),d)}))()}recentPlayed(e,n){var d=this;return _asyncToGenerator$7((function*(){return d.collection(Kc.Personalized,"recent/played",void 0,transformParameters(e,10),n)}))()}recentRadioStations(e,n){var d=this;return _asyncToGenerator$7((function*(){return d.collection(Kc.Personalized,"recent/radio-stations",void 0,transformParameters(e,10),n)}))()}recordLabel(e,n,d){return this.resource(Kc.Catalog,"record-labels",e,n,d)}recordLabels(e,n,d){return this.collection(Kc.Catalog,"record-labels",e,n,d)}recordLabelView(e,n,d,p){return this.collection(Kc.Catalog,`record-labels/${e}/view/${n}`,void 0,d,p)}personalRecommendation(e,n,d,p=!0){var h=this;return _asyncToGenerator$7((function*(){const y=yield h.personalRecommendations(e,n,d,p),[m]=y;return m}))()}refreshPersonalRecommendation(e,n,d){return n=_objectSpread$3({timezone:formatTimezoneOffset()},n),d=_objectSpreadProps$2(_objectSpread$3({},d),{method:"POST",queryParameters:n}),this.resource(Kc.Personalized,"recommendations",e,void 0,d)}personalRecommendations(e,n,d={},p=!0){var h=this;return _asyncToGenerator$7((function*(){const y=formatTimezoneOffset(),m=yield h.collection(Kc.Personalized,"recommendations",e,_objectSpread$3({timezone:y},n),_objectSpreadProps$2(_objectSpread$3({},d),{shouldCacheResults:p,returnRawJSONApiRecords:!0}));h._reindexRelationships(m,"recommendations");try{return mapRequestResult(m,e=>h.parseResultData(!1,e))}catch(Y){return Promise.reject(MKError.parseError(Y))}}))()}personalRecommendationView(e,n,d,p={}){var h=this;return _asyncToGenerator$7((function*(){return h.collection(Kc.Personalized,`recommendations/${e}/view/${n}`,void 0,d,p)}))()}recommendations(e,n,d={}){var p=this;return _asyncToGenerator$7((function*(){const h=formatTimezoneOffset(),y=yield p.collection(Kc.Global,"recommendations/"+p.storefrontId,e,_objectSpread$3({timezone:h},n),_objectSpreadProps$2(_objectSpread$3({},d),{shouldCacheResults:!1,returnRawJSONApiRecords:!0}));p._reindexRelationships(y,"recommendations");try{return mapRequestResult(y,e=>p.parseResultData(!1,e))}catch(Y){return Promise.reject(MKError.parseError(Y))}}))()}recommendedFriends(e,n,d={}){return d=_objectSpreadProps$2(_objectSpread$3({},d),{method:"POST",body:JSON.stringify(_objectSpread$3({ids:{socialProfiles:e}},d.body))}),this.collection(Kc.Global,"social/recommended-friends",void 0,n,_objectSpreadProps$2(_objectSpread$3({},d),{shouldCacheResults:!1,returnRawJSONApiRecords:!0}))}room(e,n,d){var p=this;return _asyncToGenerator$7((function*(){const h=p._store.read("rooms",e,n);if(h&&h.hasAttributes("title"))return h;const y=yield p.collection(Kc.Editorial,"rooms/"+e,void 0,n,d),[m]=y;return m}))()}roomContents(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.collection(Kc.Editorial,`rooms/${e}/contents`,void 0,n,d)}))()}search(e,n,d){var p=this;return _asyncToGenerator$7((function*(){const h=_objectSpread$3({term:e},n);return d=_objectSpreadProps$2(_objectSpread$3({},d),{useRawResponse:!0}),p.collection(Kc.Catalog,"search",void 0,h,_objectSpreadProps$2(_objectSpread$3({},d),{shouldCacheResults:!1}))}))()}searchHints(e,n,d){var p=this;return _asyncToGenerator$7((function*(){const h=_objectSpread$3({term:e},n),y=yield p.collection(Kc.Catalog,"search/hints",void 0,h,_objectSpreadProps$2(_objectSpread$3({},d),{returnRawJSONApiRecords:!0}));return"topResults"===(null==h?void 0:h.with)&&"topResults"in y&&(y.topResults=p.parseResultData(!0,y.topResults)),y}))()}searchQuery(e,n){var d=this;return _asyncToGenerator$7((function*(){return n=_objectSpreadProps$2(_objectSpread$3({},n),{useRawResponse:!0}),d.collection(Kc.Catalog,"search/query",void 0,e,_objectSpreadProps$2(_objectSpread$3({},n),{shouldCacheResults:!1}))}))()}searchSuggestions(e,n,d){var p=this;return _asyncToGenerator$7((function*(){n=_objectSpread$3({term:e},n);const h=yield p.collection(Kc.Catalog,"search/suggestions",void 0,n,_objectSpreadProps$2(_objectSpread$3({},d),{returnRawJSONApiRecords:!0}));return Array.isArray(null==h?void 0:h.suggestions)&&h.suggestions.forEach(e=>{"topResults"===e.kind&&(e.content=p.parseResultData(!0,[e.content])[0])}),h}))()}socialBadgingMap(e,n){return this.collection(Kc.Global,"social/badging-map",void 0,e,_objectSpreadProps$2(_objectSpread$3({},n),{returnRawJSONApiRecords:!0}))}socialProfile(e,n,d){return this.resource(Kc.Social,"social-profiles",e,n,d)}socialProfiles(e,n,d){return this.collection(Kc.Social,"social-profiles",e,n,d)}personalSocialProfile(e,n){return this.resource(Kc.Personalized,"social-profile",void 0,e,n)}socialPost(e,n={},d){var p=this;return _asyncToGenerator$7((function*(){e.startsWith("sa.")?n.filter={post:e}:n.ids=e;const[h]=yield p.collection(Kc.Catalog,"contents","",n,d);return h}))()}socialSearch(e,n={},d){var p=this;return _asyncToGenerator$7((function*(){return n=_objectSpreadProps$2(_objectSpread$3({},n),{term:e}),p.collection(Kc.Social,"search",void 0,n,d)}))()}song(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.resource(Kc.Catalog,"songs",e,n,d)}))()}songRelationship(e,n,d,p){var h=this;return _asyncToGenerator$7((function*(){return h.collection(Kc.Catalog,`songs/${e}/${n}`,void 0,d,p)}))()}songs(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return!n&&isObject(e)&&(n=e,e=void 0),p.collection(Kc.Catalog,"songs",e,n,d)}))()}tastePreferences(e,n){var d=this;return _asyncToGenerator$7((function*(){return d.collection(Kc.Personalized,"taste/taste-preferences",void 0,e,_objectSpreadProps$2(_objectSpread$3({},n),{shouldCacheResults:!1}))}))()}saveTastePreferences(e){var n=this;return _asyncToGenerator$7((function*(){e=e.map(e=>e instanceof DataRecord?e.serialize().data:e);const d={method:"POST",body:JSON.stringify({data:e}),shouldCacheResults:!0};try{return yield makeRequest(n,"me/taste/taste-preferences",void 0,d)}catch(Y){return Y.name===MKError.CONTENT_UNAVAILABLE?[]:Promise.reject(MKError.parseError(Y))}}))()}tvEpisode(e,n,d){return this.resource(Kc.Catalog,"tv-episodes",e,_objectSpread$3({include:"seasons"},n),d)}tvEpisodes(e,n,d){return this.collection(Kc.Catalog,"tv-episodes",e,_objectSpread$3({include:"seasons"},n),d)}tvSeason(e,n,d){return this.resource(Kc.Catalog,"tv-seasons",e,_objectSpread$3({include:"episodes"},n),d)}tvSeasons(e,n,d){return this.collection(Kc.Catalog,"tv-seasons",e,_objectSpread$3({include:"episodes"},n),d)}tvShow(e,n,d){return this.resource(Kc.Catalog,"tv-shows",e,n,d)}tvShows(e,n,d){return this.collection(Kc.Catalog,"tv-shows",e,n,d)}uploadedAudio(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return n=_objectSpread$3({include:"curator,artists"},n),p.resource(Kc.Catalog,"uploaded-audios",e,n,d)}))()}uploadedAudios(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return n=_objectSpread$3({include:"curator,artists"},n),p.collection(Kc.Catalog,"uploaded-audios",e,n,d)}))()}uploadedVideo(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return n=_objectSpread$3({include:"curator,artists"},n),p.resource(Kc.Catalog,"uploaded-videos",e,n,d)}))()}uploadedVideos(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return n=_objectSpread$3({include:"curator,artists"},n),p.collection(Kc.Catalog,"uploaded-videos",e,n,d)}))()}upsellMarketingItems(e,n){return this.collection(Kc.Engagement,"upsell/marketing-items",void 0,e,n)}station(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.resource(Kc.Catalog,"stations",e,n,d)}))()}stations(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return!n&&isObject(e)&&(n=e,e=void 0),p.collection(Kc.Catalog,"stations",e,n,d)}))()}storefront(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.resource(Kc.Global,"storefronts",e,n,d)}))()}storefronts(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.collection(Kc.Global,"storefronts",e,n,d)}))()}musicSummary(e,n,d){var p=this;return _asyncToGenerator$7((function*(){return p.resource(Kc.Personalized,"music-summaries",e,n,d)}))()}musicSummarySearch(e={},n){var d=this;return _asyncToGenerator$7((function*(){return d.collection(Kc.Personalized,"music-summaries/search",void 0,e,n)}))()}addToLibrary(e){var n=this;return _asyncToGenerator$7((function*(){return n.developerToken&&n.userToken&&n.library?n.library.add(e):Promise.reject("Invalid tokens")}))()}rating(e,n,d){var p=this;return _asyncToGenerator$7((function*(){const[h]=yield p.ratings(e,n,d);return h}))()}ratings(e,n,d){if(!this.developerToken||!this.userToken)return Promise.reject("Invalid tokens");const[p]=Object.keys(e),h=e[p],y=Array.isArray(h);if(y&&0===h.length)return Promise.resolve([]);let m="me/ratings/"+formatRatingsContentType(p,y?h[0]:h);return y?n=_objectSpreadProps$2(_objectSpread$3({},n),{ids:h.map(normalizeAdamId)}):m=`${m}/${normalizeAdamId(h)}`,makeRequest(this,m,n,_objectSpread$3({shouldCacheResults:!1,reload:!0,includePagination:!1},d))}putRating(e,n,d){var p=this;return _asyncToGenerator$7((function*(){if(!p.developerToken||!p.userToken)return Promise.reject("Invalid tokens");const[h]=Object.keys(e),y=e[h],m=formatRatingsContentType(h,y),g={method:"PUT",body:JSON.stringify({type:"rating",attributes:{value:n}}),includePagination:!1},b=yield makeRequest(p,`me/ratings/${m}/${normalizeAdamId(y)}`,d,_objectSpread$3({shouldCacheResults:!1},g)),[_]=b;return _}))()}deleteRating(e,n){var d=this;return _asyncToGenerator$7((function*(){if(!d.developerToken||!d.userToken)return Promise.reject("Invalid tokens");const[p]=Object.keys(e),h=e[p],y=formatRatingsContentType(p,h);if(Array.isArray(h))return Promise.all(h.map(e=>d.deleteRating({[p]:e},n))).then(()=>{});yield makeRequest(d,`me/ratings/${y}/${h}`,n,{method:"DELETE",shouldCacheResults:!1,returnRawJSONApiRecords:!0});try{d._store.delete(y,h)}catch(Y){return Promise.reject(MKError.parseError(Y))}}))()}equivalent(e,n){var d=this;return _asyncToGenerator$7((function*(){let p=`catalog/${d.userStorefrontId}/${e}`,h={};switch(e){case"albums":case"songs":h={"filter[equivalents]":n};break;case"artists":case"playlists":p=`${p}/${n}`;break;default:return Promise.reject(new MKError(MKError.INVALID_ARGUMENTS,"Invalid equivalent type"))}return d.resource(Kc.Global,p,"",h)}))()}collection(e,n,d,p,h){var y=this;return _asyncToGenerator$7((function*(){let m,g,b=null==h?void 0:h.shouldCacheResults;switch(m=d?_objectSpread$3({["charts"===n?"types":"ids"]:d},p):p,e){case Kc.Catalog:case Kc.Editorial:case Kc.Engagement:case Kc.Social:case Kc.Lyrics:const d=y.storefrontId;g=`${e}/${d}/${n}`;break;case Kc.Global:g=n;break;case Kc.Personalized:g=`${e}/${n}`,b=!1}return makeRequest(y,g,m,_objectSpreadProps$2(_objectSpread$3({},h),{shouldCacheResults:b}))}))()}parseResultData(e,n){return e?this._store.write(n):this._store.parse(n)}resource(e,n,d,p,h){var y=this;return _asyncToGenerator$7((function*(){if(!(null==h?void 0:h.reload)){const e=y._store.read(n,d,p);if(e)return e}const[m]=yield y.collection(e,n,d,p,h);return m}))()}_reindexRelationships(e,n){("data"in e?e.data:e).forEach(e=>{hasOwn(e,"relationships")&&hasOwn(e.relationships,n)&&hasOwn(e.relationships[n],"data")&&Array.isArray(e.relationships[n].data)&&e.relationships[n].data.forEach((e,n)=>{e.id=`${e.id}-${n}`})})}constructor(e,n,d,p,h,y,m={},g){super(e,n,_objectSpreadProps$2(_objectSpread$3({},g),{userToken:p,storage:y})),this.storefrontId=Ne.ID,this.resourceRelatives={artists:{albums:{include:"tracks"},playlists:{include:"tracks"},songs:null}},this.defaultIncludePaginationMetadata=m.features&&hasOwn(m.features,"api-pagination-metadata"),this._store=new LocalDataStore(m),d&&(this.storefrontId=d.toLowerCase()),p&&h&&(this.userStorefrontId=h.toLowerCase()),this._podcastsAPI=new Podcasts(n,p,d,y,m,_objectSpread$3({},g)),this.fitness=new Fitness(n,p,d,y,m,_objectSpread$3({},g)),this.tvLibrary=new TVLibrary(n,p,y,m,_objectSpread$3({},g)),this.library=new Library(e,n,p,m,this,_objectSpread$3({},g)),this.books=new Books(n,p,d,y,m,_objectSpread$3({},g)),this.v3=new MediaAPIV3({developerToken:n,mediaUserToken:p,storefrontId:d,realmConfig:{music:{url:e.replace(/\/v[0-9]+(\/)?$/,"")}}})}}function asyncGeneratorStep$6(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$6(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$6(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$6(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}let zc;Hc([RecommendationUpdate(),qc("design:type",Function),qc("design:paramtypes",[Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof MakeRequestOptions?Object:MakeRequestOptions,void 0])],API.prototype,"personalRecommendations",null),Hc([RecommendationUpdate(),qc("design:type",Function),qc("design:paramtypes",[Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof MakeRequestOptions?Object:MakeRequestOptions])],API.prototype,"recommendations",null),Hc([ChunkedIdApi(2),qc("design:type",Function),qc("design:paramtypes",[void 0===Kc?Object:Kc,String,Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof InternalMakeRequestOptions?Object:InternalMakeRequestOptions])],API.prototype,"collection",null);const Wc=function(){var e=_asyncToGenerator$6((function*(e,n=!1){if(zc&&!n){if(void 0===e.storefrontId||e.storefrontId===zc.storefrontId)return zc;zc.clear()}return zc=new MediaAPIService(e.dispatcher),zc.configure(e)}));return function(n){return e.apply(this,arguments)}}(),Yc={album:{isPlural:!1,apiMethod:"album",relationshipMethod:{method:"albumRelationship",relationship:"tracks"}},albums:{isPlural:!0,apiMethod:"albums"},audioBook:{isPlural:!1,apiMethod:"audioBook"},audioBooks:{isPlural:!0,apiMethod:"audioBooks"},episode:{isPlural:!1,apiMethod:"episode"},episodes:{isPlural:!0,apiMethod:"episodes"},musicVideo:{isPlural:!1,apiMethod:"musicVideo"},musicVideos:{isPlural:!0,apiMethod:"musicVideos"},musicMovie:{isPlural:!1,apiMethod:"musicMovie"},musicMovies:{isPlural:!0,apiMethod:"musicMovies"},podcast:{isPlural:!1,apiMethod:"podcast"},podcasts:{isPlural:!0,apiMethod:"podcasts"},playlist:{isPlural:!1,apiMethod:"playlist",relationshipMethod:{method:"playlistRelationship",relationship:"tracks"}},playlists:{isPlural:!0,apiMethod:"playlists"},song:{isPlural:!1,apiMethod:"song"},songs:{isPlural:!0,apiMethod:"songs"},tvEpisode:{isPlural:!1,apiMethod:"tvEpisode"},tvEpisodes:{isPlural:!0,apiMethod:"tvEpisodes"},uploadedAudio:{isPlural:!1,apiMethod:"uploadedAudio"},uploadedAudios:{isPlural:!0,apiMethod:"uploadedAudios"},uploadedVideo:{isPlural:!1,apiMethod:"uploadedVideo"},uploadedVideos:{isPlural:!0,apiMethod:"uploadedVideos"}};class MediaAPIService{get api(){if(void 0===this._api)throw new MKError(MKError.CONFIGURATION_ERROR,"The API cannot be accessed before it is configured.");return this._api}get storefrontId(){return this.store&&this.store.storefrontId}configure(e){var n=this;return _asyncToGenerator$6((function*(){if(void 0!==e.store)return n.store=e.store,[po.authorizationStatusDidChange,po.userTokenDidChange,po.storefrontIdentifierDidChange,po.storefrontCountryCodeDidChange].forEach(e=>{n.store.storekit.addEventListener(e,()=>n.resetAPI())}),n._initializeAPI(e),n}))()}clear(){this.api&&this.api.clearNetworkCache&&this.api.clearNetworkCache()}getAPIForItem(e){var n=this;return _asyncToGenerator$6((function*(){return T(e)?(yield n.store.authorize(),n.api.library||n.api):n.api}))()}resetAPI(){var e=this;return _asyncToGenerator$6((function*(){e.clear(),e._initializeAPI()}))()}_initializeAPI(e){if(void 0!==(null==e?void 0:e.api))return void(this._api=e.api);const n=e&&e.store||this.store;if(void 0===n)return;const d=Do.features["api-session-storage"]?getSessionStorage():void 0,p=e&&e.storefrontId||n.storefrontId,h=new API(this.url,n.developerToken,p,n.storekit.userToken,n.storekit.storefrontCountryCode,d,Do,e&&e.apiOptions&&e.apiOptions.sessionOptions);this._api=h.v3,this._api=h}_updateStorefrontId(e){var n=this;return _asyncToGenerator$6((function*(){n.api&&e===n.api.storefrontId||(yield n.configure({dispatcher:n._dispatcher,store:n.store,storefrontId:e}))}))()}constructor(e){if(this._dispatcher=e,!Do.urls.mediaApi)throw new Error("bag.urls.mediaApi is not configured");this.url=Do.urls.mediaApi,this.namedQueueOptions=Yc;var n=this;this._dispatcher.subscribe(hr.apiStorefrontChanged,function(){var e=_asyncToGenerator$6((function*(e,{storefrontId:d}){yield n._updateStorefrontId(d)}));return function(n,d){return e.apply(this,arguments)}}())}}const Qc=["uploadedVideo","uploadedAudio","uploaded-videos","uploaded-audios"];function asyncGeneratorStep$5(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$5(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$5(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$5(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$2(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$2(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$2(e,n,d[n])}))}return e}function _objectSpreadProps$1(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}const Jc=Ut.createChild("paf"),asCode=n=>{switch(typeof n){case"string":return n;case"undefined":return"undefined";default:return"PlayActivityEndReasonType."+e.PlayActivityEndReasonType[n]}};class MPAFTracker{get requestedEvents(){return Array.from(this.dispatchTable.keys())}get activityTracker(){if(void 0===this._activityTracker)throw new MKError(MKError.CONFIGURATION_ERROR,"Play Activity service was called before configuration.");return this._activityTracker}configure(e,n){var d=this;return _asyncToGenerator$5((function*(){d.instance=e,d._activityTracker=function(e){var n;return new PlayActivity(e.developerToken,e.musicUserToken,e.storefrontCountryCode,{app:{build:Do.app.build,name:null!==(n=Do.app.name)&&void 0!==n?n:"",version:Do.app.version},fetch:!qt&&fetch.bind(globalThis),isQA:Xc.enabled,logInfo:Jc.enabled,sourceType:e.sourceType,guid:e.guid,userIsSubscribed:()=>!(!e.isAuthorized||!xo.storekit._getIsActiveSubscription.getCachedValue())})}(e)}))()}handleEvent(e,n,d){if(!this.shouldTrackPlayActivity(e,d))return;const p=this.dispatchTable.get(e);void 0!==p&&"function"==typeof this[p]&&this[p](d,n)}activate(e,n={}){return this.activityTracker.activate(n.flush)}exit(e,n={}){return Jc.debug("PAF debug",`client.exit(${n.position})`),this.activityTracker.exit(n.position)}pause(e,n={}){return"number"==typeof n.endReasonType?(Jc.debug("PAF debug",`client.stop(${n.position}, ${n.endReasonType})`),this.activityTracker.stop(n.position,n.endReasonType)):(Jc.debug("PAF debug",`client.pause(${n.position})`),this.activityTracker.pause(n.position))}play(e,n={}){const d=generateItemDescriptorForPAF(hr.playbackPlay,this.instance,e);return isLiveRadioKind(e,"video")&&(this.musicLiveVideoStartTime=Date.now()),Jc.debug("PAF debug",`client.play(${JSON.stringify(d)}, ${n.position})`),this.activityTracker.play(d,n.position)}scrub(e,n={}){return Jc.debug("PAF debug",`client.scrub(${n.position}, ${asCode(n.endReasonType)})`),this.activityTracker.scrub(n.position,n.endReasonType)}seek(n,d={}){var p=this;return _asyncToGenerator$5((function*(){yield p.scrub(n,{position:d.startPosition,endReasonType:e.PlayActivityEndReasonType.SCRUB_BEGIN}),yield p.scrub(n,{position:d.position,endReasonType:e.PlayActivityEndReasonType.SCRUB_END})}))()}skip(e,n={}){var d=this;return _asyncToGenerator$5((function*(){const p=generateItemDescriptorForPAF(hr.playbackSkip,d.instance,e);Jc.debug("PAF debug",`client.skip(${JSON.stringify(p)}, ${asCode(n.direction)}, ${n.position})`);try{yield d.activityTracker.skip(p,n.direction,n.position)}catch(Lr){if("A play stop() method was called without a previous play() descriptor"!==Lr.message)return Promise.reject(Lr);yield d.play(e,n)}}))()}stop(n,d={}){var p;(isLiveRadioKind(n,"video")?(d.position=(Date.now()-this.musicLiveVideoStartTime)/1e3,this.musicLiveVideoStartTime=0):(null==n?void 0:n.isLiveRadioStation)&&d.position&&(d.position=d.position-(d.startPosition||0)),null==n?void 0:n.isLiveRadioStation)&&(d.endReasonType=null!==(p=d.endReasonType)&&void 0!==p?p:e.PlayActivityEndReasonType.PLAYBACK_MANUALLY_PAUSED);return Jc.debug("PAF debug",`client.stop(${d.position}, ${asCode(d.endReasonType)})`),this.activityTracker.stop(d.position,d.endReasonType)}shouldTrackPlayActivity(n,d){const p=hasAuthorization(),h=!d||d.playbackType!==e.PlaybackType.preview,y=this.alwaysSendForActivityType(n),m=!d||d&&this.mediaRequiresPlayActivity(d);return!(!p||!h||!y&&!m)}alwaysSendForActivityType(e){return e===hr.playerActivate||e===hr.playerExit}mediaRequiresPlayActivity(e){return void 0!==(n=e.type)&&Qc.includes(n)||-1!==["musicVideo","song","radioStation"].indexOf(e.type);var n}constructor(){this.musicLiveVideoStartTime=0,this.dispatchTable=new Map([[hr.playbackPlay,"play"],[hr.playbackPause,"pause"],[hr.playbackScrub,"scrub"],[hr.playbackSeek,"seek"],[hr.playbackSkip,"skip"],[hr.playbackStop,"stop"],[hr.playerActivate,"activate"],[hr.playerExit,"exit"]])}}function generateItemDescriptorForPAF(n,d,p){const h=_objectSpreadProps$1(_objectSpread$2({},function(n,d,p){if(void 0===(null==p?void 0:p.playbackActions)||void 0===d)return{};const h={[e.PlayerRepeatMode.all]:wr.REPEAT_ALL,[e.PlayerRepeatMode.none]:wr.REPEAT_OFF,[e.PlayerRepeatMode.one]:wr.REPEAT_ONE},y={[e.PlayerShuffleMode.off]:Or.SHUFFLE_OFF,[e.PlayerShuffleMode.songs]:Or.SHUFFLE_ON};return{playMode(){let n=wr.REPEAT_UNKNOWN,d=Or.SHUFFLE_UNKNOWN,m=Ir.AUTO_UNKNOWN;const{playbackActions:g}=p;var b;return g&&(g.includes(e.PlaybackActions.REPEAT)&&(n=h[p.repeatMode]),g.includes(e.PlaybackActions.SHUFFLE)&&(d=y[p.shuffleMode]),g.includes(e.PlaybackActions.AUTOPLAY)&&(m=p.autoplayEnabled?(b=p.queue).hasAutoplayStation&&b.items.some(e=>{const{id:n,type:d,container:p}=e;if(p&&"stations"===p.type&&p.name===mr.RADIO)return!1;const h=normalizeTypeForAutoplay(n,d);return isAutoplaySupportedForType(h)})?Ir.AUTO_ON:Ir.AUTO_ON_CONTENT_UNSUPPORTED:Ir.AUTO_OFF)),{repeatPlayMode:n,shufflePlayMode:d,autoplayMode:m}}}}(0,p,d),function(e,n){var d;if(!typeRequiresItem(e))return{};if(void 0===n)return{};const p=null===(d=n.attributes)||void 0===d?void 0:d.mediaKind;return _objectSpread$2({},void 0!==p?{mediaType:p}:{},n.playParams)}(n,p),function(e,n){if(!typeRequiresItem(e)||void 0===n)return{};const{context:d={}}=n;return{recoData:d.reco_id}}(n,p),function(e,n){if(!typeRequiresItem(e)||void 0===n)return{};const d=n.playbackDuration;if(!d)return{};return{duration:d/1e3}}(n,p),function(e,n){var d,p;const h=function(e,n){var d;return itemIsRequired(e,n)&&(null==n||null===(d=n.container)||void 0===d?void 0:d.name)||null}(e,n),y=itemIsRequired(e,n)?_objectSpread$2({},null==n?void 0:n.container,null==n||null===(d=n.container)||void 0===d||null===(p=d.attributes)||void 0===p?void 0:p.playParams):null;if(null===h&&null===y)return;return{container:cleanContainer(_objectSpread$2({},y,null!==h?{name:h}:{}))}}(n,p)),{trackInfo:null==p?void 0:p.trackInfo});return Jc.trace("PAF descriptor",h),h}const Xc=BooleanDevFlag.register("mk-use-paf-qa-endpoint");const typeRequiresItem=e=>[hr.playbackPlay,hr.playbackSkip].includes(e),itemIsRequired=(e,n)=>void 0!==n&&typeRequiresItem(e);function cleanContainer(e){const n=_objectSpread$2({},e);return delete n.attributes,n}function asyncGeneratorStep$4(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$4(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$4(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$4(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$1(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}function _objectSpread$1(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty$1(e,n,d[n])}))}return e}function _objectSpreadProps(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);n&&(p=p.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),d.push.apply(d,p)}return d}(Object(n)).forEach((function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(n,d))})),e}const Zc=Ut.createChild("lyrics");class LyricsTracker{get requestedEvents(){return Array.from(this.dispatchTable.keys())}get activityTracker(){if(void 0===this.instance)throw new MKError(MKError.CONFIGURATION_ERROR,"Lyrics Play Activity service was called before configuration.");var e,n;return void 0===this._activityTracker&&(this._activityTracker=(e=this.instance,new LyricsPlayActivity(e.developerToken,e.musicUserToken,e.storefrontCountryCode,{app:{build:Do.app.build,name:null!==(n=Do.app.name)&&void 0!==n?n:"",version:Do.app.version},fetch:!qt&&fetch.bind(globalThis),logInfo:Zc.level<=A.INFO,sourceType:e.sourceType,isQA:el.enabled,userIsSubscribed:()=>e.isAuthorized&&xo.storekit._getIsActiveSubscription.getCachedValue()}))),this._activityTracker}static configure(e,n){var d=this;return _asyncToGenerator$4((function*(){const p=new d;return p.configure(e,n),p}))()}configure(e,n){var d=this;return _asyncToGenerator$4((function*(){d.instance=e}))()}handleEvent(e,n,d){const p=this.dispatchTable.get(e);void 0!==p&&"function"==typeof this[p]&&this[p](d,n)}lyricsPlay(e,n){var d=this;return _asyncToGenerator$4((function*(){const p=null==n?void 0:n.lyrics;if(void 0===p)throw new MKError(MKError.MEDIA_DESCRIPTOR,"Key lyrics is missing from descriptor provided to lyricsPlay");if(void 0===e)throw new MKError(MKError.MEDIA_DESCRIPTOR,"Cannot display lyrics without a MediaItem");d.activityTracker.play(function(e,n,d){var p,h,y,m;return _objectSpreadProps(_objectSpread$1({id:n.id,duration:0,eventType:Rr.LYRIC_DISPLAY,container:_objectSpread$1({},n.container,null===(p=n.container)||void 0===p||null===(h=p.attributes)||void 0===h?void 0:h.playParams)},n.playParams),{lyricDescriptor:{id:null!==(m=d.id)&&void 0!==m?m:n.id,displayType:d.displayType,language:d.language},trackInfo:n.trackInfo,recoData:null===(y=n.attributes)||void 0===y?void 0:y.reco_id})}(hr.lyricsPlay,e,p))}))()}lyricsStop(e,n){var d=this;return _asyncToGenerator$4((function*(){d.activityTracker.stop()}))()}exit(e,n){var d=this;return _asyncToGenerator$4((function*(){d.activityTracker.exit()}))()}constructor(){this.dispatchTable=new Map([[hr.lyricsPlay,"lyricsPlay"],[hr.lyricsStop,"lyricsStop"],[hr.playerExit,"exit"]])}}const el=BooleanDevFlag.register("mk-use-paf-qa-endpoint");const SharePlayGuard=e=>(n,d,p)=>{const h=p.value;return p.value=function(...n){if(!this.isInSharePlay)return h.apply(this,n);e&&this.services.dispatcher.publish(e)},p};function asyncGeneratorStep$3(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$3(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$3(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$3(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}var tl={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},rl={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};class MusicKitInstance extends MKInstance{addToLibrary(e,n){var d=this;return _asyncToGenerator$3((function*(){yield d.authorize(),n||(n=/[a-z]{2}\.[a-z0-9\-]+/i.test(e)?"playlists":"albums");const p={};let h;return p[n]=[e],h=d.api.addToLibrary(p),h}))()}changeToMediaItem(e){var n=this,_superprop_get_changeToMediaItem=()=>super.changeToMediaItem;return _asyncToGenerator$3((function*(){return n._checkNeedsEquivalent(),_superprop_get_changeToMediaItem().call(n,e)}))()}play(){var e=this,_superprop_get_play=()=>super.play;return _asyncToGenerator$3((function*(){return e._checkNeedsEquivalent(),_superprop_get_play().call(e)}))()}playMediaItem(e,n){var d=this,_superprop_get_playMediaItem=()=>super.playMediaItem;return _asyncToGenerator$3((function*(){if(d._isPlaybackSupported())return d._checkNeedsEquivalent(),_superprop_get_playMediaItem().call(d,e,n)}))()}_isStationQueueOptions(e){return!(!(e=>!!e&&(!!isIdentityQueue(e)||(!!isQueueURLOption(e)||Object.keys(fs).some(n=>void 0!==e[n]))))(e=parseQueueURLOption(e))||(e=>{if(!e)return!1;if(isQueueURLOption(e))return!0;if(isQueueItems(e))return!0;return Object.keys(Ms).concat(Object.keys(Ds)).some(n=>void 0!==e[n])})(e))}setStationQueue(e){var n=this,_superprop_get__validateAuthorization=()=>super._validateAuthorization;return _asyncToGenerator$3((function*(){if(!n._isPlaybackSupported())return void Vt.warn("Playback is not supported");n._signalChangeItemIntent(),n.deferPlayback(),yield n._updatePlaybackController(n._getPlaybackControllerByType(as.continuous)),yield _superprop_get__validateAuthorization().call(n,!0),e=parseQueueURLOption(e);const d=n._playbackController.setQueue(e);return void 0!==e.autoplay&&(deprecationWarning("autoplay",{message:"autoplay has been deprecated, use startPlaying instead"}),void 0===e.startPlaying&&(e.startPlaying=e.autoplay)),e.startPlaying&&(yield n.play()),d}))()}setQueue(e){var n=this;return _asyncToGenerator$3((function*(){if(Vt.debug("instance.setQueue()",e),n._checkNeedsEquivalent(),!n._isPlaybackSupported())return void Vt.warn("Playback is not supported");if(n._isStationQueueOptions(e))return Vt.warn("setQueue options contained a station queue request. Changing to setStationQueue mode."),n.setStationQueue(e);n._signalChangeItemIntent(),n.deferPlayback(),yield n._updatePlaybackController(n._getPlaybackControllerByType(as.serial));const d=yield n._playbackController.setQueue(e);return void 0!==e.repeatMode&&(n._playbackController.repeatMode=e.repeatMode),void 0!==e.autoplay&&(deprecationWarning("autoplay",{message:"autoplay has been deprecated, use startPlaying instead"}),void 0===e.startPlaying&&(e.startPlaying=e.autoplay)),e.startPlaying&&(yield n.play()),d}))()}_checkNeedsEquivalent(){var n;if(this.realm===e.SKRealm.MUSIC&&!this.previewOnly&&(null===(n=this.api)||void 0===n?void 0:n.needsEquivalents))throw new MKError(MKError.CONTENT_EQUIVALENT)}playNext(e,n=!1){var d=this;return _asyncToGenerator$3((function*(){if(d._isPlaybackSupported())return d._playbackController.queue?(d.deferPlayback(),d._playbackController.prepend(e,n)):d.setQueue(e);Vt.warn("Playback is not supported")}))()}playLater(e){var n=this;return _asyncToGenerator$3((function*(){if(n._isPlaybackSupported())return n._playbackController.queue?(n.deferPlayback(),n._playbackController.append(e)):n.setQueue(e);Vt.warn("Playback is not supported")}))()}playAt(e,n){var d=this;return _asyncToGenerator$3((function*(){if(d._isPlaybackSupported())return d._playbackController.queue?(d.deferPlayback(),d._playbackController.insertAt(e,n)):d.setQueue(n);Vt.warn("Playback is not supported")}))()}clearQueue(){var e=this;return _asyncToGenerator$3((function*(){return e._mediaItemPlayback.clearNextManifest(),e._playbackController.clear()}))()}lyricsStart(e){this.services.dispatcher.publish(hr.lyricsPlay,{item:this.nowPlayingItem,lyrics:e})}lyricsStop(){this.services.dispatcher.publish(hr.lyricsStop)}}function _defineProperty(e,n,d){return n in e?Object.defineProperty(e,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[n]=d,e}tl([SharePlayGuard(),rl("design:type",Function),rl("design:paramtypes",[Number,"undefined"==typeof SerialQueueOptions?Object:SerialQueueOptions])],MusicKitInstance.prototype,"playAt",null);class SharePlaySession{updateState(e){const{displayName:n,members:d,mediaState:p}=e;n&&(this.displayName=n),d&&(this.participantCount=d.length),this.mediaState=function(e){for(var n=1;n<arguments.length;n++){var d=null!=arguments[n]?arguments[n]:{},p=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(p=p.concat(Object.getOwnPropertySymbols(d).filter((function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})))),p.forEach((function(n){_defineProperty(e,n,d[n])}))}return e}({},this.mediaState,p),this.dispatcher.publish(Po,this.mediaState)}shouldUpdate(e,n){return this.mediaState[e]!==n}get lastKnownElapsedTime(){const{queue:e,currentPlayingIndex:n}=this.mediaState,d=e[n];return Math.round(null==d?void 0:d.attributes.elapsedTime)||0}constructor(n,d){this.participantCount=0,this.mediaState={autoPlay:!1,playbackState:e.PlaybackStates.none,volume:1,queue:[],shuffleMode:e.PlayerShuffleMode.off,repeatMode:e.PlayerRepeatMode.none,currentPlayingIndex:0};const{id:p,displayName:h}=n;this.id=p,this.displayName=h,this.dispatcher=d}}function asyncGeneratorStep$2(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$2(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$2(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$2(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}var nl={}&&{}.__decorate||function(e,n,d,p){var h,y=arguments.length,m=y<3?n:null===p?p=Object.getOwnPropertyDescriptor(n,d):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,n,d,p);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(m=(y<3?h(m):y>3?h(n,d,m):h(n,d))||m);return y>3&&m&&Object.defineProperty(n,d,m),m},il={}&&{}.__metadata||function(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)};class SharePlayInstance extends MusicKitInstance{get sharePlay(){return this._sharePlay}get isInSharePlay(){return this.playbackMode===e.PlaybackMode.SHAREPLAY_PARTICIPANT}startSharePlay(n){var d=this;return _asyncToGenerator$2((function*(){var p;if(void 0!==d.sharePlay)return d.sharePlay;d.savePlaybackState();const h=new SharePlaySession(n,d.services.dispatcher);return d.services.dispatcher.subscribe(Po,d.onMediaStateUpdate),d._voidPlayer=new VoidPlayer(d._createPlayerControllerOptions()),d.playbackMode=e.PlaybackMode.SHAREPLAY_PARTICIPANT,d._sharePlay=h,yield d._voidPlayer.initialize(),yield d._mediaItemPlayback.setCurrentPlayer(d._voidPlayer),null===(p=d.services.playActivity)||void 0===p||p.cleanup(),h}))()}endSharePlay(){var e=this;return _asyncToGenerator$2((function*(){e.isInSharePlay&&(e.updateQueue([],0),e._sharePlay=void 0,e.services.dispatcher.unsubscribe(Po,e.onMediaStateUpdate),e._configurePlayActivity(),e.restorePlaybackState())}))()}get shuffleMode(){return this.isInSharePlay?this._shuffleMode:this._playbackController.shuffleMode}set shuffleMode(e){var n;if(null===(n=this.sharePlay)||void 0===n?void 0:n.shouldUpdate("shuffleMode",e))return this._shuffleMode=e,void this.services.dispatcher.publish(go,e);this._playbackController.shuffleMode=e}get repeatMode(){return super.repeatMode}set repeatMode(e){var n;super.repeatMode=e,(null===(n=this.sharePlay)||void 0===n?void 0:n.shouldUpdate("repeatMode",this.repeatMode))&&this.services.dispatcher.publish(vo,{repeatMode:this.repeatMode})}get autoplayEnabled(){return super.autoplayEnabled}set autoplayEnabled(e){var n;super.autoplayEnabled=e,(null===(n=this.sharePlay)||void 0===n?void 0:n.shouldUpdate("autoPlay",this.autoplayEnabled))&&this.services.dispatcher.publish(bo,{autoPlay:this.autoplayEnabled})}get volume(){return super.volume}set volume(e){var n;super.volume=e,(null===(n=this.sharePlay)||void 0===n?void 0:n.shouldUpdate("volume",this.volume))&&this.services.dispatcher.publish(yo,{playbackState:this.volume})}play(){var e=this,_superprop_get_play=()=>super.play;return _asyncToGenerator$2((function*(){var n;yield _superprop_get_play().call(e),(null===(n=e.sharePlay)||void 0===n?void 0:n.shouldUpdate("playbackState",e.playbackState))&&e.services.dispatcher.publish(ho,{playbackState:e.playbackState})}))()}pause(e){var n=this,_superprop_get_pause=()=>super.pause;return _asyncToGenerator$2((function*(){var d;yield _superprop_get_pause().call(n,e),(null===(d=n.sharePlay)||void 0===d?void 0:d.shouldUpdate("playbackState",n.playbackState))&&n.services.dispatcher.publish(ho,{playbackState:n.playbackState})}))()}seekToTime(e,n=br.Manual){var d=this,_superprop_get_seekToTime=()=>super.seekToTime;return _asyncToGenerator$2((function*(){var p;yield _superprop_get_seekToTime().call(d,e,n),(null===(p=d.sharePlay)||void 0===p?void 0:p.lastKnownElapsedTime)!==d.currentPlaybackTime&&d.services.dispatcher.publish(_o,{elapsedTime:d.currentPlaybackTime})}))()}skipToNextItem(){var e=this,_superprop_get_skipToNextItem=()=>super.skipToNextItem;return _asyncToGenerator$2((function*(){return _superprop_get_skipToNextItem().call(e)}))()}skipToPreviousItem(){var e=this,_superprop_get_skipToPreviousItem=()=>super.skipToPreviousItem;return _asyncToGenerator$2((function*(){return _superprop_get_skipToPreviousItem().call(e)}))()}playMediaItem(e,n){var d=this,_superprop_get_playMediaItem=()=>super.playMediaItem;return _asyncToGenerator$2((function*(){return _superprop_get_playMediaItem().call(d,e,n)}))()}setStationQueue(e){var n=this,_superprop_get_setStationQueue=()=>super.setStationQueue;return _asyncToGenerator$2((function*(){return _superprop_get_setStationQueue().call(n,e)}))()}setQueue(e){var n=this,_superprop_get_setQueue=()=>super.setQueue;return _asyncToGenerator$2((function*(){return _superprop_get_setQueue().call(n,e)}))()}_checkNeedsEquivalent(){super._checkNeedsEquivalent()}playNext(e,n=!1){var d=this,_superprop_get_playNext=()=>super.playNext;return _asyncToGenerator$2((function*(){return _superprop_get_playNext().call(d,e,n)}))()}playLater(e){var n=this,_superprop_get_playLater=()=>super.playLater;return _asyncToGenerator$2((function*(){return _superprop_get_playLater().call(n,e)}))()}playAt(e,n){var d=this,_superprop_get_playAt=()=>super.playAt;return _asyncToGenerator$2((function*(){return _superprop_get_playAt().call(d,e,n)}))()}updateQueue(n,d){const p=n.map(e=>new MediaItem(e)),h=p[d];h&&(h.playbackType=e.PlaybackType.encryptedFull),this._voidPlayer&&(this._voidPlayer.nowPlayingItem=h),this.queue.updateItems(p),this.queue.position=d}onMediaStateUpdate(n,{autoPlay:d,currentPlayingIndex:p,queue:h,playbackState:y,shuffleMode:m,repeatMode:g,volume:b}){var _=this;return _asyncToGenerator$2((function*(){var n;_.updateQueue(h,p||0),y===e.PlaybackStates.paused?yield _.pause():y===e.PlaybackStates.playing&&(yield _.play()),_.autoplayEnabled=d,_.repeatMode=g,_.shuffleMode=m,_.volume=b,_.seekToTime((null===(n=_.sharePlay)||void 0===n?void 0:n.lastKnownElapsedTime)||0)}))()}savePlaybackState(){this._previousPlaybackState={playbackMode:this.playbackMode}}restorePlaybackState(){const{playbackMode:e}=this._previousPlaybackState;this.playbackMode=e}constructor(...n){super(...n),this._shuffleMode=e.PlayerShuffleMode.off,this._previousPlaybackState={playbackMode:e.PlaybackMode.MIXED_CONTENT}}}function asyncGeneratorStep$1(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator$1(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep$1(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}nl([SharePlayGuard(fo),il("design:type",Function),il("design:paramtypes",[])],SharePlayInstance.prototype,"skipToNextItem",null),nl([SharePlayGuard(mo),il("design:type",Function),il("design:paramtypes",[])],SharePlayInstance.prototype,"skipToPreviousItem",null),nl([SharePlayGuard(),il("design:type",Function),il("design:paramtypes",[void 0===MediaItem?Object:MediaItem,"undefined"==typeof PlayOptions?Object:PlayOptions])],SharePlayInstance.prototype,"playMediaItem",null),nl([SharePlayGuard(),il("design:type",Function),il("design:paramtypes",["undefined"==typeof StationQueueOptions?Object:StationQueueOptions])],SharePlayInstance.prototype,"setStationQueue",null),nl([SharePlayGuard(),il("design:type",Function),il("design:paramtypes",[Object])],SharePlayInstance.prototype,"setQueue",null),nl([SharePlayGuard(),il("design:type",Function),il("design:paramtypes",[])],SharePlayInstance.prototype,"_checkNeedsEquivalent",null),nl([SharePlayGuard(),il("design:type",Function),il("design:paramtypes",["undefined"==typeof SerialQueueOptions?Object:SerialQueueOptions,void 0])],SharePlayInstance.prototype,"playNext",null),nl([SharePlayGuard(),il("design:type",Function),il("design:paramtypes",["undefined"==typeof SerialQueueOptions?Object:SerialQueueOptions])],SharePlayInstance.prototype,"playLater",null),nl([SharePlayGuard(),il("design:type",Function),il("design:paramtypes",[Number,"undefined"==typeof SerialQueueOptions?Object:SerialQueueOptions])],SharePlayInstance.prototype,"playAt",null),nl([Bind(),il("design:type",Function),il("design:paramtypes",[void 0,void 0])],SharePlayInstance.prototype,"onMediaStateUpdate",null);function loadLinksData(){return _loadLinksData.apply(this,arguments)}function _loadLinksData(){return(_loadLinksData=_asyncToGenerator$1((function*(){const e=[{feature:"album-song",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/albums?/(?:[^/]+/)?(?<album>\\d+)$",requiredQueryParams:{i:"(?<identifier>\\d+)"},mediaAPI:{resources:["songs"]}},{feature:"albums",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/albums?/(?:[^/]+/)?(?<identifier>\\d+)$",mediaAPI:{resources:["albums"]}},{feature:"algo-stations",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/stations?/(?:[^/]+/)?(?<identifier>(?:ra|st).\\d+)",mediaAPI:{resources:["stations"]}},{feature:"artist-default-playable-content",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/artists?/(?:[^/]+/)?(?<identifier>\\d+)$",mediaAPI:{resources:["artists","default-playable-content"]}},{feature:"genre-stations",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/genre-stations?",mediaAPI:{resources:["stations"],parameterMapping:{genres:"filter[genres]",eras:"filter[eras]",tags:"filter[tags]",moods:"filter[moods]"}}},{feature:"library-albums",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/library/albums?/(?:[^/]+/)?(?<identifier>(?:l).[a-zA-Z0-9-]+)$",mediaAPI:{resources:["albums"]}},{feature:"library-album-song",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/library/albums?/(?:[^/]+/)?(?<album>(?:l).[a-zA-Z0-9-]+)$",requiredQueryParams:{i:"(?<identifier>i\\.[a-zA-Z0-9-]+)"},mediaAPI:{resources:["songs"]}},{feature:"library-playlists",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/library/playlists?/(?:[^/]+/)?(?<identifier>(?:p).[a-zA-Z0-9-]+)$",mediaAPI:{resources:["playlists"]}},{feature:"music-videos",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/music-videos?/(?:[^/]+/)?(?<identifier>\\d+)$",mediaAPI:{resources:["musicVideos"]}},{feature:"personal-general-radio",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/stations?/me$",mediaAPI:{resources:["stations"],parameters:{"filter[identity]":"personal"}}},{feature:"personal-mixes",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/(?:personal-)?mix/(?:[^/]+/)?(?<identifier>mx.(?:\\d{1,2}|rp-\\d{4}))$",mediaAPI:{resources:["playlists"]}},{feature:"playlists",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/playlists?/(?:[^/]+/)?(?<identifier>(?:pl).[a-zA-Z0-9-]+)$",mediaAPI:{resources:["playlists"]}},{feature:"song",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/songs?/(?:[^/]+/)?(?<identifier>\\d+)$",mediaAPI:{resources:["songs"]}},{feature:"steering-request",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/me/stations?/change-station/?$",mediaAPI:{resources:["stations"]}}].map(e=>(e.regex=new RegExp(e.regex),e.requiredQueryParams&&(e.requiredQueryParams=Object.keys(e.requiredQueryParams).reduce((n,d)=>(n[d]=new RegExp(e.requiredQueryParams[d]),n),{})),e));return Promise.resolve(e)}))).apply(this,arguments)}function meetsLinkRequirements(e,n,d={}){const[p]=e.split(/\?|\#|\&/),h=n.regex.test(p);return h&&n.requiredQueryParams?Object.keys(n.requiredQueryParams).every(e=>{const p=d[e];return n.requiredQueryParams[e].test(p)}):h}function filterLinks(e){return _filterLinks.apply(this,arguments)}function _filterLinks(){return(_filterLinks=_asyncToGenerator$1((function*(e){const n=yield loadLinksData(),d=parseQueryParams(e);return n.reduce((n,p)=>{if(meetsLinkRequirements(e,p,d)){if(n.length>0)if(p.requiredQueryParams)n=n.filter(e=>e.requiredQueryParams);else if(n.some(e=>e.requiredQueryParams))return n;p.requiredQueryParams?p.mediaAPI.parameters=Object.keys(p.requiredQueryParams).reduce((e,n)=>(e[n]=d[n],e),{}):p.mediaAPI.parameterMapping&&(p.mediaAPI.parameters=transform$9(p.mediaAPI.parameterMapping,d,!0)),n.push(p)}return n},[])}))).apply(this,arguments)}function _resolveCanonical(){return(_resolveCanonical=_asyncToGenerator$1((function*(e){return{results:{links:yield filterLinks(e)},meta:{originalUrl:e,originalQueryParams:parseQueryParams(e)}}}))).apply(this,arguments)}function asyncGeneratorStep(e,n,d,p,h,y,m){try{var g=e[y](m),b=g.value}catch(Y){return void d(Y)}g.done?n(b):Promise.resolve(b).then(p,h)}function _asyncToGenerator(e){return function(){var n=this,d=arguments;return new Promise((function(p,h){var y=e.apply(n,d);function _next(e){asyncGeneratorStep(y,p,h,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(y,p,h,_next,_throw,"throw",e)}_next(void 0)}))}}function configure(e){return _configure.apply(this,arguments)}function _configure(){return(_configure=_asyncToGenerator((function*(e){Vt.linkChild(Ut),Vt.linkChild(Lt),Vt.linkChild(ge),Vt.linkChild(Nt),e.playActivityAPI=[new MPAFTracker,new LyricsTracker];let n=MusicKitInstance;e.rtcOptions&&e.playActivityAPI.push(new RTCStreamingTracker(e.rtcOptions)),n=SharePlayInstance;return yield configure$2(e,n,function(){var n=_asyncToGenerator((function*(n){const d={apiType:js.MEDIA_API,configureFn:Wc,options:{}};d.options.apiOptions=e.apiOptions,yield n.configure([d]),e.declarativeMarkup&&"undefined"!=typeof console&&console.warn&&console.warn("The declarativeMarkup configuration option has been removed in MusicKit JS V3")}));return function(e){return n.apply(this,arguments)}}())}))).apply(this,arguments)}if(Oc){const e=function(){function meta(e){if(qt)return;const n=document.head.querySelector(`meta[name=${e}]`);return(null==n?void 0:n.content)||void 0}const e=meta("apple-music-developer-token")||meta("JWT"),n=meta("apple-music-app-build")||meta("version"),d=meta("apple-music-app-name"),p=meta("apple-music-app-version");let h;return(e||n||d||p)&&(h={},e&&(h.developerToken=e),(n||d||p)&&(h.app={},n&&(h.app.build=n),d&&(h.app.name=d),p&&(h.app.version=p))),h}(),n=/interactive|complete|loaded/.test(document.readyState);e&&e.developerToken&&0===getInstances().length&&(n?asAsync(configure(e)):document.addEventListener("DOMContentLoaded",()=>configure(e)))}e.Events=po,e.MKError=MKError,e.MediaItem=MediaItem,e.VideoTypes={movie:!0,musicVideo:!0,musicMovie:!0,trailer:!0,tvEpisode:!0,uploadedVideo:!0,"uploaded-videos":!0,"music-videos":!0,"music-movies":!0,"tv-episodes":!0,Bonus:!0,Extra:!0,Episode:!0,Movie:!0,Preview:!0,Promotional:!0,Season:!0,Show:!0,Vod:!0,EditorialVideoClip:!0,RealityVideo:!0,SportingEvent:!0,LiveService:!0},e.__dev=le,e.__log=Ht,e.configure=configure,e.enableMultipleInstances=function(){Ic=!0},e.formatArtworkURL=formatArtworkURL,e.formatMediaTime=function(e,n=":"){const{hours:d,minutes:p}=formattedSeconds(e);e=Math.floor(e%3600%60);const h=[];return d?(h.push(""+d),h.push(p<10?"0"+p:""+p)):h.push(""+p),h.push(e<10?"0"+e:""+e),h.join(n)},e.formattedMediaURL=formattedMediaURL,e.formattedMilliseconds=function(e){return formattedSeconds(e/1e3)},e.formattedSeconds=formattedSeconds,e.generateEmbedCode=function(e,n={height:"450",width:"660"}){if(!p.test(e))throw new Error("Invalid content url");var d;let m=null!==(d=n.height)&&void 0!==d?d:"450";var g;let b=null!==(g=n.width)&&void 0!==g?g:"660";const{kind:_,isUTS:P}=formattedMediaURL(e),T="post"===_||"musicVideo"===_||P;"song"===_||"episode"===_?m="175":T&&(m=""+Math.round(.5625*parseInt(b,10))),m=(""+m).replace(/(\d+)px/i,"$1"),b=(""+b).replace(/^(\d+)(?!px)%?$/i,"$1px");const S=(T?"width:"+b:"width:100%;"+(b?"max-width:"+b:""))+";overflow:hidden;border-radius:10px;";let E="https://embed.music.apple.com";return["podcast","episode"].includes(_)&&!P&&(E="https://embed.podcasts.apple.com"),`<iframe ${[`allow="${y.join("; ")}"`,'frameborder="0"',m?`height="${m}"`:"",`style="${S}"`,`sandbox="${h.join(" ")}"`,`src="${e.replace(p,E)}"`].join(" ")}></iframe>`},e.getHlsJsCdnConfig=getHlsJsCdnConfig,e.getInstance=function(e){if(0!==Ac.length)return void 0===e?Ac[Ac.length-1]:Ac.find(n=>n.id===e)},e.getInstances=getInstances,e.getPlayerType=getPlayerType,e.prepareMediaAPIItem=Bs,e.resolveCanonical=function(e){return _resolveCanonical.apply(this,arguments)},Object.defineProperty(e,"__esModule",{value:!0})}));
